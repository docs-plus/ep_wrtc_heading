"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return s(e)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=i(e);if(t){var o=i(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return c(this,n)}}function u(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}function p(){return p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=u(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},p.apply(this,arguments)}function l(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(t){var n=e(t);return null!=t&&("object"==n||"function"==n)}Object.defineProperty(exports,"__esModule",{value:!0});var v="object"==("undefined"==typeof global?"undefined":e(global))&&global&&global.Object===Object&&global,y="object"==("undefined"==typeof self?"undefined":e(self))&&self&&self.Object===Object&&self,g=v||y||Function("return this")(),b=function(){return g.Date.now()},C=/\s/;var w=/^\s+/;function S(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&C.test(e.charAt(t)););return t}(e)+1).replace(w,""):e}var k=g.Symbol,T=Object.prototype,_=T.hasOwnProperty,R=T.toString,E=k?k.toStringTag:void 0;var P=Object.prototype.toString;var x=k?k.toStringTag:void 0;function I(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":x&&x in Object(e)?function(e){var t=_.call(e,E),n=e[E];try{e[E]=void 0;var r=!0}catch(e){}var o=R.call(e);return r&&(t?e[E]=n:delete e[E]),o}(e):function(e){return P.call(e)}(e)}function O(t){return"symbol"==e(t)||function(t){return null!=t&&"object"==e(t)}(t)&&"[object Symbol]"==I(t)}var M=/^[-+]0x[0-9a-f]+$/i,A=/^0b[01]+$/i,L=/^0o[0-7]+$/i,D=parseInt;function j(e){if("number"==typeof e)return e;if(O(e))return NaN;if(m(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=m(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=S(e);var n=A.test(e);return n||L.test(e)?D(e.slice(2),n?2:8):M.test(e)?NaN:+e}var N=Math.max,B=Math.min;function F(e,t,n){var r,o,i,a,s,c,d=0,u=!1,p=!1,l=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var n=r,i=o;return r=o=void 0,d=t,a=e.apply(i,n)}function h(e){return d=e,s=setTimeout(y,t),u?f(e):a}function v(e){var n=e-c;return void 0===c||n>=t||n<0||p&&e-d>=i}function y(){var e=b();if(v(e))return g(e);s=setTimeout(y,function(e){var n=t-(e-c);return p?B(n,i-(e-d)):n}(e))}function g(e){return s=void 0,l&&r?f(e):(r=o=void 0,a)}function C(){var e=b(),n=v(e);if(r=arguments,o=this,c=e,n){if(void 0===s)return h(c);if(p)return clearTimeout(s),s=setTimeout(y,t),f(c)}return void 0===s&&(s=setTimeout(y,t)),a}return t=j(t)||0,m(n)&&(u=!!n.leading,i=(p="maxWait"in n)?N(j(n.maxWait)||0,t):i,l="trailing"in n?!!n.trailing:l),C.cancel=function(){void 0!==s&&clearTimeout(s),d=0,r=c=o=s=void 0},C.flush=function(){return void 0===s?a:g(b())},C}var V="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function U(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function z(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var G={exports:{}},q={},H=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,W=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],J=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var o,i,a=H.exec(e||""),s={},c=14;c--;)s[W[c]]=a[c]||"";return-1!=n&&-1!=r&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){var n=/\/{2,9}/g,r=t.replace(n,"/").split("/");"/"!=t.substr(0,1)&&0!==t.length||r.splice(0,1);"/"==t.substr(t.length-1,1)&&r.splice(r.length-1,1);return r}(0,s.path),s.queryKey=(o=s.query,i={},o.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(i[t]=n)})),i),s};var K={exports:{}},Y=1e3,X=60*Y,Z=60*X,Q=24*Z,ee=7*Q,te=365.25*Q,ne=function(t,n){n=n||{};var r=e(t);if("string"===r&&t.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*te;case"weeks":case"week":case"w":return n*ee;case"days":case"day":case"d":return n*Q;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Z;case"minutes":case"minute":case"mins":case"min":case"m":return n*X;case"seconds":case"second":case"secs":case"sec":case"s":return n*Y;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(t);if("number"===r&&isFinite(t))return n.long?function(e){var t=Math.abs(e);if(t>=Q)return re(e,t,Q,"day");if(t>=Z)return re(e,t,Z,"hour");if(t>=X)return re(e,t,X,"minute");if(t>=Y)return re(e,t,Y,"second");return e+" ms"}(t):function(e){var t=Math.abs(e);if(t>=Q)return Math.round(e/Q)+"d";if(t>=Z)return Math.round(e/Z)+"h";if(t>=X)return Math.round(e/X)+"m";if(t>=Y)return Math.round(e/Y)+"s";return e+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function re(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}var oe=function(e){function t(e){var r,o,i,a=null;function s(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];if(s.enabled){var i=s,a=Number(new Date),c=a-(r||a);i.diff=c,i.prev=r,i.curr=a,r=a,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var d=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return"%";d++;var o=t.formatters[r];if("function"==typeof o){var a=n[d];e=o.call(i,a),n.splice(d,1),d--}return e})),t.formatArgs.call(i,n);var u=i.log||t.log;u.apply(i,n)}}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=n,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==a?a:(o!==t.namespaces&&(o=t.namespaces,i=t.enabled(e)),i)},set:function(e){a=e}}),"function"==typeof t.init&&t.init(s),s}function n(e,n){var r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){var e=[].concat(l(t.names.map(r)),l(t.skips.map(r).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=ne,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t};!function(e,t){var n;t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(o=r))})),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(n=!1,function(){n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=oe(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(K,K.exports),Object.defineProperty(q,"__esModule",{value:!0}),q.url=void 0;var ie=J,ae=K.exports("socket.io-client:url");q.url=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(ae("protocol-less url %s",e),e=void 0!==n?n.protocol+"//"+e:"https://"+e),ae("parse %s",e),r=ie(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var o=-1!==r.host.indexOf(":"),i=o?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+t,r.href=r.protocol+"://"+i+(n&&n.port===r.port?"":":"+r.port),r};var se={},ce={exports:{}},de={},ue={exports:{}};try{ue.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){ue.exports=!1}var pe="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")(),le=ue.exports,fe=pe,he=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||le))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(e){}if(!t)try{return new(fe[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}},me={exports:{}},ve=Object.create(null);ve.open="0",ve.close="1",ve.ping="2",ve.pong="3",ve.message="4",ve.upgrade="5",ve.noop="6";var ye=Object.create(null);Object.keys(ve).forEach((function(e){ye[ve[e]]=e}));var ge,be={PACKET_TYPES:ve,PACKET_TYPES_REVERSE:ye,ERROR_PACKET:{type:"error",data:"parser error"}},Ce=be.PACKET_TYPES,we="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Se="function"==typeof ArrayBuffer,ke=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+e)},n.readAsDataURL(e)},Te=function(e,t,n){var r,o=e.type,i=e.data;return we&&i instanceof Blob?t?n(i):ke(i,n):Se&&(i instanceof ArrayBuffer||(r=i,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer))?t?n(i):ke(new Blob([i]),n):n(Ce[o]+(i||""))},_e={};ge="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_e.encode=function(e){var t,n=new Uint8Array(e),r=n.length,o="";for(t=0;t<r;t+=3)o+=ge[n[t]>>2],o+=ge[(3&n[t])<<4|n[t+1]>>4],o+=ge[(15&n[t+1])<<2|n[t+2]>>6],o+=ge[63&n[t+2]];return r%3==2?o=o.substring(0,o.length-1)+"=":r%3==1&&(o=o.substring(0,o.length-2)+"=="),o},_e.decode=function(e){var t,n,r,o,i,a=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var d=new ArrayBuffer(a),u=new Uint8Array(d);for(t=0;t<s;t+=4)n=ge.indexOf(e[t]),r=ge.indexOf(e[t+1]),o=ge.indexOf(e[t+2]),i=ge.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|o>>2,u[c++]=(3&o)<<6|63&i;return d};var Re,Ee=be.PACKET_TYPES_REVERSE,Pe=be.ERROR_PACKET;"function"==typeof ArrayBuffer&&(Re=_e);var xe=function(e,t){if(Re){var n=Re.decode(e);return Ie(n,t)}return{base64:!0,data:e}},Ie=function(e,t){return"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e},Oe=Te,Me=function(e,t){if("string"!=typeof e)return{type:"message",data:Ie(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:xe(e.substring(1),t)}:Ee[n]?e.length>1?{type:Ee[n],data:e.substring(1)}:{type:Ee[n]}:Pe},Ae=String.fromCharCode(30),Le={protocol:4,encodePacket:Oe,encodePayload:function(e,t){var n=e.length,r=new Array(n),o=0;e.forEach((function(e,i){Oe(e,!1,(function(e){r[i]=e,++o===n&&t(r.join(Ae))}))}))},decodePacket:Me,decodePayload:function(e,t){for(var n=e.split(Ae),r=[],o=0;o<n.length;o++){var i=Me(n[o],t);if(r.push(i),"error"===i.type)break}return r}},De={exports:{}};!function(e){function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}De.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t)}return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}}();var $e,je=Le,Ne=De.exports,Be=K.exports("engine.io-client:transport"),Fe=function(e){o(i,Ne);var n=d(i);function i(e){var r;return t(this,i),(r=n.call(this)).opts=e,r.query=e.query,r.readyState="",r.socket=e.socket,r}return r(i,[{key:"onError",value:function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this}},{key:"open",value:function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState?this.write(e):Be("transport is not open, discarding packets")}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,this.emit("open")}},{key:"onData",value:function(e){var t=je.decodePacket(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){this.emit("packet",e)}},{key:"onClose",value:function(){this.readyState="closed",this.emit("close")}}]),i}(),Ve=Fe,Ue={encode:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},decode:function(e){for(var t={},n=e.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},ze="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ge={},qe=0,He=0;function We(e){var t="";do{t=ze[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function Je(){var e=We(+new Date);return e!==$e?(qe=0,$e=e):e+"."+We(qe++)}for(;He<64;He++)Ge[ze[He]]=He;Je.encode=We,Je.decode=function(e){var t=0;for(He=0;He<e.length;He++)t=64*t+Ge[e.charAt(He)];return t};var Ke=Je,Ye=Ve,Xe=Ue,Ze=Le,Qe=Ke,et=K.exports("engine.io-client:polling"),tt=function(e){o(i,Ye);var n=d(i);function i(){return t(this,i),n.apply(this,arguments)}return r(i,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;function n(){et("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(et("we are currently polling - waiting to pause"),r++,this.once("pollComplete",(function(){et("pre-pause polling complete"),--r||n()}))),this.writable||(et("we are currently writing - waiting to pause"),r++,this.once("drain",(function(){et("pre-pause writing complete"),--r||n()})))}else n()}},{key:"poll",value:function(){et("polling"),this.polling=!0,this.doPoll(),this.emit("poll")}},{key:"onData",value:function(e){var t=this;et("polling got data %s",e);Ze.decodePayload(e,this.socket.binaryType).forEach((function(e,n,r){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():et('ignoring poll - transport state "%s"',this.readyState))}},{key:"doClose",value:function(){var e=this;function t(){et("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(et("transport open - closing"),t()):(et("transport not open - deferring close"),this.once("open",t))}},{key:"write",value:function(e){var t=this;this.writable=!1,Ze.encodePayload(e,(function(e){t.doWrite(e,(function(){t.writable=!0,t.emit("drain")}))}))}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"https":"http",n="";return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=Qe()),this.supportsBinary||e.sid||(e.b64=1),e=Xe.encode(e),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),e.length&&(e="?"+e),t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+e}}]),i}(),nt=tt,rt={pick:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}},ot=he,it=nt,at=De.exports,st=rt.pick,ct=pe,dt=K.exports("engine.io-client:polling-xhr");function ut(){}var pt=null!=new ot({xdomain:!1}).responseType,lt=function(e){o(i,it);var n=d(i);function i(e){var r;if(t(this,i),r=n.call(this,e),"undefined"!=typeof location){var o="https:"===location.protocol,a=location.port;a||(a=o?443:80),r.xd="undefined"!=typeof location&&e.hostname!==location.hostname||a!==e.port,r.xs=e.secure!==o}var s=e&&e.forceBase64;return r.supportsBinary=pt&&!s,r}return r(i,[{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new ft(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this.request({method:"POST",data:e}),r=this;n.on("success",t),n.on("error",(function(e){r.onError("xhr post error",e)}))}},{key:"doPoll",value:function(){dt("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e}}]),i}(),ft=function(e){o(i,at);var n=d(i);function i(e,r){var o;return t(this,i),(o=n.call(this)).opts=r,o.method=r.method||"GET",o.uri=e,o.async=!1!==r.async,o.data=void 0!==r.data?r.data:null,o.create(),o}return r(i,[{key:"create",value:function(){var e=st(this.opts,"agent","enablesXDR","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;var t=this.xhr=new ot(e),n=this;try{dt("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var r in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout((function(){n.onError("number"==typeof t.status?t.status:0)}),0))},dt("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout((function(){n.onError(e)}),0)}"undefined"!=typeof document&&(this.index=i.requestsCount++,i.requests[this.index]=this)}},{key:"onSuccess",value:function(){this.emit("success"),this.cleanup()}},{key:"onData",value:function(e){this.emit("data",e),this.onSuccess()}},{key:"onError",value:function(e){this.emit("error",e),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=ut:this.xhr.onreadystatechange=ut,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete i.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&this.onData(e)}},{key:"hasXDR",value:function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR}},{key:"abort",value:function(){this.cleanup()}}]),i}();if(ft.requestsCount=0,ft.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",ht);else if("function"==typeof addEventListener){addEventListener("onpagehide"in ct?"pagehide":"unload",ht,!1)}function ht(){for(var e in ft.requests)ft.requests.hasOwnProperty(e)&&ft.requests[e].abort()}me.exports=lt,me.exports.Request=ft;var mt,vt=nt,yt=pe,gt=/\n/g,bt=/\\n/g,Ct=function(e){o(a,vt);var n=d(a);function a(e){var r;t(this,a),(r=n.call(this,e)).query=r.query||{},mt||(mt=yt.___eio=yt.___eio||[]),r.index=mt.length;var o=s(r);return mt.push((function(e){o.onData(e)})),r.query.j=r.index,r}return r(a,[{key:"supportsBinary",get:function(){return!1}},{key:"doClose",value:function(){this.script&&(this.script.onerror=function(){},this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),p(i(a.prototype),"doClose",this).call(this)}},{key:"doPoll",value:function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)}},{key:"doWrite",value:function(e,t){var n,r=this;if(!this.form){var o=document.createElement("form"),i=document.createElement("textarea"),a=this.iframeId="eio_iframe_"+this.index;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=a,o.method="POST",o.setAttribute("accept-charset","utf-8"),i.name="d",o.appendChild(i),document.body.appendChild(o),this.form=o,this.area=i}function s(){c(),t()}function c(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(e)}catch(e){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),c(),e=e.replace(bt,"\\\n"),this.area.value=e.replace(gt,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&s()}:this.iframe.onload=s}}]),a}(),wt=pe,St={WebSocket:wt.WebSocket||wt.MozWebSocket,usingBrowserWebSocket:!0,defaultBinaryType:"arraybuffer"},kt=Ve,Tt=Le,_t=Ue,Rt=Ke,Et=rt.pick,Pt=St.WebSocket,xt=St.usingBrowserWebSocket,It=St.defaultBinaryType,Ot=K.exports("engine.io-client:websocket"),Mt="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),At=function(e){o(i,kt);var n=d(i);function i(e){var r;return t(this,i),(r=n.call(this,e)).supportsBinary=!e.forceBase64,r}return r(i,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,n=Mt?{}:Et(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=xt&&!Mt?t?new Pt(e,t):new Pt(e):new Pt(e,t,n)}catch(e){return this.emit("error",e)}this.ws.binaryType=this.socket.binaryType||It,this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n,r=e.length,o=0,i=r;o<i;o++)n=e[o],Tt.encodePacket(n,t.supportsBinary,(function(e){try{xt&&t.ws.send(e)}catch(e){Ot("websocket closed before onclose event")}--r||a()}));function a(){t.emit("flush"),setTimeout((function(){t.writable=!0,t.emit("drain")}),0)}}},{key:"onClose",value:function(){kt.prototype.onClose.call(this)}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"wss":"ws",n="";return this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Rt()),this.supportsBinary||(e.b64=1),(e=_t.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+e}},{key:"check",value:function(){return!(!Pt||"__initialize"in Pt&&this.name===i.prototype.name)}}]),i}(),Lt=At,Dt=he,$t=me.exports,jt=Ct,Nt=Lt;de.polling=function(e){var t=!1,n=!1,r=!1!==e.jsonp;if("undefined"!=typeof location){var o="https:"===location.protocol,i=location.port;i||(i=o?443:80),t=e.hostname!==location.hostname||i!==e.port,n=e.secure!==o}if(e.xdomain=t,e.xscheme=n,"open"in new Dt(e)&&!e.forceJSONP)return new $t(e);if(!r)throw new Error("JSONP disabled");return new jt(e)},de.websocket=Nt;var Bt=de,Ft=De.exports,Vt=K.exports("engine.io-client:socket"),Ut=Le,zt=J,Gt=Ue,qt=function(n){o(a,Ft);var i=d(a);function a(n){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(this,a),r=i.call(this),n&&"object"===e(n)&&(o=n,n=null),n?(n=zt(n),o.hostname=n.host,o.secure="https"===n.protocol||"wss"===n.protocol,o.port=n.port,n.query&&(o.query=n.query)):o.host&&(o.hostname=zt(o.host).host),r.secure=null!=o.secure?o.secure:"undefined"!=typeof location&&"https:"===location.protocol,o.hostname&&!o.port&&(o.port=r.secure?"443":"80"),r.hostname=o.hostname||("undefined"!=typeof location?location.hostname:"localhost"),r.port=o.port||("undefined"!=typeof location&&location.port?location.port:r.secure?443:80),r.transports=o.transports||["polling","websocket"],r.readyState="",r.writeBuffer=[],r.prevBufferLen=0,r.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,jsonp:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{}},o),r.opts.path=r.opts.path.replace(/\/$/,"")+"/","string"==typeof r.opts.query&&(r.opts.query=Gt.decode(r.opts.query)),r.id=null,r.upgrades=null,r.pingInterval=null,r.pingTimeout=null,r.pingTimeoutTimer=null,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){r.transport&&(r.transport.removeAllListeners(),r.transport.close())}),!1),r.open(),r}return r(a,[{key:"createTransport",value:function(e){Vt('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.opts.query);t.EIO=Ut.protocol,t.transport=e,this.id&&(t.sid=this.id);var n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return Vt("options: %j",n),new Bt[e](n)}},{key:"open",value:function(){var e;if(this.opts.rememberUpgrade&&a.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return Vt("error while creating transport: %s",e),this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){Vt("setting transport %s",e.name);var t=this;this.transport&&(Vt("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))}},{key:"probe",value:function(e){Vt('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function o(){if(r.onlyBinaryUpgrades){var o=!this.supportsBinary&&r.transport.supportsBinary;n=n||o}n||(Vt('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(o){if(!n)if("pong"===o.type&&"probe"===o.data){if(Vt('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;a.priorWebsocketSuccess="websocket"===t.name,Vt('pausing current transport "%s"',r.transport.name),r.transport.pause((function(){n||"closed"!==r.readyState&&(Vt("changing transport and sending upgrade packet"),p(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())}))}else{Vt('probe transport "%s" failed',e);var i=new Error("probe error");i.transport=t.name,r.emit("upgradeError",i)}})))}function i(){n||(n=!0,p(),t.close(),t=null)}function s(n){var o=new Error("probe error: "+n);o.transport=t.name,i(),Vt('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",o)}function c(){s("transport closed")}function d(){s("socket closed")}function u(e){t&&e.name!==t.name&&(Vt('"%s" works - aborting "%s"',e.name,t.name),i())}function p(){t.removeListener("open",o),t.removeListener("error",s),t.removeListener("close",c),r.removeListener("close",d),r.removeListener("upgrading",u)}a.priorWebsocketSuccess=!1,t.once("open",o),t.once("error",s),t.once("close",c),this.once("close",d),this.once("upgrading",u),t.open()}},{key:"onOpen",value:function(){if(Vt("socket open"),this.readyState="open",a.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){Vt("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Vt('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else Vt('packet received with socket readyState "%s"',this.readyState)}},{key:"onHandshake",value:function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=setTimeout((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout)}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()}},{key:"flush",value:function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Vt("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:e,data:t,options:n};this.emit("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}}},{key:"close",value:function(){var e=this;function t(){e.onClose("forced close"),Vt("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){this.upgrading?r():t()})):this.upgrading?r():t()),this}},{key:"onError",value:function(e){Vt("socket error %j",e),a.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){Vt('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),a}();qt.priorWebsocketSuccess=!1,qt.protocol=Ut.protocol;var Ht=qt;ce.exports=function(e,t){return new Ht(e,t)},ce.exports.Socket=Ht,ce.exports.protocol=Ht.protocol,ce.exports.Transport=Ve,ce.exports.transports=de,ce.exports.parser=Le;var Wt={},Jt={},Kt={},Yt={};Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.hasBinary=Yt.isBinary=void 0;var Xt="function"==typeof ArrayBuffer,Zt=Object.prototype.toString,Qt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Zt.call(Blob),en="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Zt.call(File);function tn(e){return Xt&&(e instanceof ArrayBuffer||function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}(e))||Qt&&e instanceof Blob||en&&e instanceof File}Yt.isBinary=tn,Yt.hasBinary=function t(n,r){if(!n||"object"!==e(n))return!1;if(Array.isArray(n)){for(var o=0,i=n.length;o<i;o++)if(t(n[o]))return!0;return!1}if(tn(n))return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return t(n.toJSON(),!0);for(var a in n)if(Object.prototype.hasOwnProperty.call(n,a)&&t(n[a]))return!0;return!1},Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.reconstructPacket=Kt.deconstructPacket=void 0;var nn=Yt;function rn(t,n){if(!t)return t;if(nn.isBinary(t)){var r={_placeholder:!0,num:n.length};return n.push(t),r}if(Array.isArray(t)){for(var o=new Array(t.length),i=0;i<t.length;i++)o[i]=rn(t[i],n);return o}if("object"===e(t)&&!(t instanceof Date)){var a={};for(var s in t)t.hasOwnProperty(s)&&(a[s]=rn(t[s],n));return a}return t}function on(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(Array.isArray(t))for(var r=0;r<t.length;r++)t[r]=on(t[r],n);else if("object"===e(t))for(var o in t)t.hasOwnProperty(o)&&(t[o]=on(t[o],n));return t}Kt.deconstructPacket=function(e){var t=[],n=e.data,r=e;return r.data=rn(n,t),r.attachments=t.length,{packet:r,buffers:t}},Kt.reconstructPacket=function(e,t){return e.data=on(e.data,t),e.attachments=void 0,e},function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Decoder=n.Encoder=n.PacketType=n.protocol=void 0;var a,s=De.exports,c=Kt,u=Yt,l=K.exports("socket.io-parser");n.protocol=5,function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(a=n.PacketType||(n.PacketType={}));var f=function(){function e(){t(this,e)}return r(e,[{key:"encode",value:function(e){return l("encoding packet %j",e),e.type!==a.EVENT&&e.type!==a.ACK||!u.hasBinary(e)?[this.encodeAsString(e)]:(e.type=e.type===a.EVENT?a.BINARY_EVENT:a.BINARY_ACK,this.encodeAsBinary(e))}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==a.BINARY_EVENT&&e.type!==a.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),l("encoded %j as %s",e,t),t}},{key:"encodeAsBinary",value:function(e){var t=c.deconstructPacket(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}]),e}();n.Encoder=f;var h=function(n){o(c,n);var s=d(c);function c(){return t(this,c),s.call(this)}return r(c,[{key:"add",value:function(e){var t;if("string"==typeof e)(t=this.decodeString(e)).type===a.BINARY_EVENT||t.type===a.BINARY_ACK?(this.reconstructor=new m(t),0===t.attachments&&p(i(c.prototype),"emit",this).call(this,"decoded",t)):p(i(c.prototype),"emit",this).call(this,"decoded",t);else{if(!u.isBinary(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,p(i(c.prototype),"emit",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,n={type:Number(e.charAt(0))};if(void 0===a[n.type])throw new Error("unknown packet type "+n.type);if(n.type===a.BINARY_EVENT||n.type===a.BINARY_ACK){for(var r=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var o=e.substring(r,t);if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(o)}if("/"===e.charAt(t+1)){for(var i=t+1;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(i,t)}else n.nsp="/";var s=e.charAt(t+1);if(""!==s&&Number(s)==s){for(var d=t+1;++t;){var u=e.charAt(t);if(null==u||Number(u)!=u){--t;break}if(t===e.length)break}n.id=Number(e.substring(d,t+1))}if(e.charAt(++t)){var p=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t));if(!c.isPayloadValid(n.type,p))throw new Error("invalid payload");n.data=p}return l("decoded %s as %j",e,n),n}},{key:"destroy",value:function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}],[{key:"isPayloadValid",value:function(t,n){switch(t){case a.CONNECT:return"object"===e(n);case a.DISCONNECT:return void 0===n;case a.CONNECT_ERROR:return"string"==typeof n||"object"===e(n);case a.EVENT:case a.BINARY_EVENT:return Array.isArray(n)&&n.length>0;case a.ACK:case a.BINARY_ACK:return Array.isArray(n)}}}]),c}(s);n.Decoder=h;var m=function(){function e(n){t(this,e),this.packet=n,this.buffers=[],this.reconPack=n}return r(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=c.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}()}(Jt);var an={};Object.defineProperty(an,"__esModule",{value:!0}),an.on=void 0,an.on=function(e,t,n){return e.on(t,n),function(){e.off(t,n)}},Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.Socket=void 0;var sn=Jt,cn=De.exports,dn=an,un=K.exports("socket.io-client:socket"),pn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),ln=function(e){o(a,cn);var n=d(a);function a(e,r,o){var i;return t(this,a),(i=n.call(this)).receiveBuffer=[],i.sendBuffer=[],i.ids=0,i.acks={},i.flags={},i.io=e,i.nsp=r,i.ids=0,i.acks={},i.receiveBuffer=[],i.sendBuffer=[],i.connected=!1,i.disconnected=!0,i.flags={},o&&o.auth&&(i.auth=o.auth),i.io._autoConnect&&i.open(),i}return r(a,[{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[dn.on(e,"open",this.onopen.bind(this)),dn.on(e,"packet",this.onpacket.bind(this)),dn.on(e,"error",this.onerror.bind(this)),dn.on(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(pn.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.unshift(e);var o={type:sn.PacketType.EVENT,data:n,options:{}};o.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]&&(un("emitting packet with ack id %d",this.ids),this.acks[this.ids]=n.pop(),o.id=this.ids++);var i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,a=this.flags.volatile&&(!i||!this.connected);return a?un("discard packet as the transport is not currently writable"):this.connected?this.packet(o):this.sendBuffer.push(o),this.flags={},this}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;un("transport is open - connecting"),"function"==typeof this.auth?this.auth((function(t){e.packet({type:sn.PacketType.CONNECT,data:t})})):this.packet({type:sn.PacketType.CONNECT,data:this.auth})}},{key:"onerror",value:function(e){this.connected||p(i(a.prototype),"emit",this).call(this,"connect_error",e)}},{key:"onclose",value:function(e){un("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,p(i(a.prototype),"emit",this).call(this,"disconnect",e)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case sn.PacketType.CONNECT:if(e.data&&e.data.sid){var t=e.data.sid;this.onconnect(t)}else p(i(a.prototype),"emit",this).call(this,"connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case sn.PacketType.EVENT:case sn.PacketType.BINARY_EVENT:this.onevent(e);break;case sn.PacketType.ACK:case sn.PacketType.BINARY_ACK:this.onack(e);break;case sn.PacketType.DISCONNECT:this.ondisconnect();break;case sn.PacketType.CONNECT_ERROR:var n=new Error(e.data.message);n.data=e.data.data,p(i(a.prototype),"emit",this).call(this,"connect_error",n)}}},{key:"onevent",value:function(e){var t=e.data||[];un("emitting event %j",t),null!=e.id&&(un("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=f(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(this._anyListeners.slice());try{for(n.s();!(t=n.n()).done;){t.value.apply(this,e)}}catch(e){n.e(e)}finally{n.f()}}p(i(a.prototype),"emit",this).apply(this,e)}},{key:"ack",value:function(e){var t=this,n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];un("sending ack %j",o),t.packet({type:sn.PacketType.ACK,id:e,data:o})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t?(un("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):un("bad ack %s",e.id)}},{key:"onconnect",value:function(e){un("socket connected with id %s",e),this.id=e,this.connected=!0,this.disconnected=!1,p(i(a.prototype),"emit",this).call(this,"connect"),this.emitBuffered()}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){return e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){un("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&(un("performing disconnect (%s)",this.nsp),this.packet({type:sn.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}}]),a}();Wt.Socket=ln;var fn=hn;function hn(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}hn.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},hn.prototype.reset=function(){this.attempts=0},hn.prototype.setMin=function(e){this.ms=e},hn.prototype.setMax=function(e){this.max=e},hn.prototype.setJitter=function(e){this.jitter=e},Object.defineProperty(se,"__esModule",{value:!0}),se.Manager=void 0;var mn=ce.exports,vn=Wt,yn=De.exports,gn=Jt,bn=an,Cn=fn,wn=K.exports("socket.io-client:manager"),Sn=function(n){o(s,yn);var a=d(s);function s(n,r){var o;t(this,s),(o=a.call(this)).nsps={},o.subs=[],n&&"object"===e(n)&&(r=n,n=void 0),(r=r||{}).path=r.path||"/socket.io",o.opts=r,o.reconnection(!1!==r.reconnection),o.reconnectionAttempts(r.reconnectionAttempts||1/0),o.reconnectionDelay(r.reconnectionDelay||1e3),o.reconnectionDelayMax(r.reconnectionDelayMax||5e3),o.randomizationFactor(r.randomizationFactor||.5),o.backoff=new Cn({min:o.reconnectionDelay(),max:o.reconnectionDelayMax(),jitter:o.randomizationFactor()}),o.timeout(null==r.timeout?2e4:r.timeout),o._readyState="closed",o.uri=n;var i=r.parser||gn;return o.encoder=new i.Encoder,o.decoder=new i.Decoder,o._autoConnect=!1!==r.autoConnect,o._autoConnect&&o.open(),o}return r(s,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(wn("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;wn("opening %s",this.uri),this.engine=mn(this.uri,this.opts);var n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;var o=bn.on(n,"open",(function(){r.onopen(),e&&e()})),a=bn.on(n,"error",(function(n){wn("error"),r.cleanup(),r._readyState="closed",p(i(s.prototype),"emit",t).call(t,"error",n),e?e(n):r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var c=this._timeout;wn("connect attempt will timeout after %d",c),0===c&&o();var d=setTimeout((function(){wn("connect attempt timed out after %d",c),o(),n.close(),n.emit("error",new Error("timeout"))}),c);this.subs.push((function(){clearTimeout(d)}))}return this.subs.push(o),this.subs.push(a),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){wn("open"),this.cleanup(),this._readyState="open",p(i(s.prototype),"emit",this).call(this,"open");var e=this.engine;this.subs.push(bn.on(e,"ping",this.onping.bind(this)),bn.on(e,"data",this.ondata.bind(this)),bn.on(e,"error",this.onerror.bind(this)),bn.on(e,"close",this.onclose.bind(this)),bn.on(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){p(i(s.prototype),"emit",this).call(this,"ping")}},{key:"ondata",value:function(e){this.decoder.add(e)}},{key:"ondecoded",value:function(e){p(i(s.prototype),"emit",this).call(this,"packet",e)}},{key:"onerror",value:function(e){wn("error",e),p(i(s.prototype),"emit",this).call(this,"error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n||(n=new vn.Socket(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++){var r=n[t];if(this.nsps[r].active)return void wn("socket %s is still active, skipping close",r)}this._close()}},{key:"_packet",value:function(e){wn("writing packet %j",e);for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){wn("cleanup"),this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){wn("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,"opening"===this._readyState&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e){wn("onclose"),this.cleanup(),this.backoff.reset(),this._readyState="closed",p(i(s.prototype),"emit",this).call(this,"close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)wn("reconnect failed"),this.backoff.reset(),p(i(s.prototype),"emit",this).call(this,"reconnect_failed"),this._reconnecting=!1;else{var n=this.backoff.duration();wn("will wait %dms before reconnect attempt",n),this._reconnecting=!0;var r=setTimeout((function(){t.skipReconnect||(wn("attempting reconnect"),p(i(s.prototype),"emit",e).call(e,"reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(n){n?(wn("reconnect attempt error"),t._reconnecting=!1,t.reconnect(),p(i(s.prototype),"emit",e).call(e,"reconnect_error",n)):(wn("reconnect success"),t.onreconnect())})))}),n);this.subs.push((function(){clearTimeout(r)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),p(i(s.prototype),"emit",this).call(this,"reconnect",e)}}]),s}();se.Manager=Sn,function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.Socket=n.io=n.Manager=n.protocol=void 0;var r=q,o=se,i=Wt;Object.defineProperty(n,"Socket",{enumerable:!0,get:function(){return i.Socket}});var a=K.exports("socket.io-client");t.exports=n=c;var s=n.managers={};function c(t,n){"object"===e(t)&&(n=t,t=void 0),n=n||{};var i,c=r.url(t,n.path),d=c.source,u=c.id,p=c.path,l=s[u]&&p in s[u].nsps;return n.forceNew||n["force new connection"]||!1===n.multiplex||l?(a("ignoring socket cache for %s",d),i=new o.Manager(d,n)):(s[u]||(a("new io instance for %s",d),s[u]=new o.Manager(d,n)),i=s[u]),c.query&&!n.query&&(n.query=c.queryKey),i.socket(c.path,n)}n.io=c;var d=Jt;Object.defineProperty(n,"protocol",{enumerable:!0,get:function(){return d.protocol}}),n.connect=c;var u=se;Object.defineProperty(n,"Manager",{enumerable:!0,get:function(){return u.Manager}})}(G,G.exports);var kn=U(G.exports);kn.Manager,function(){if(navigator.mediaDevices||(navigator.mediaDevices={}),!navigator.mediaDevices.getUserMedia){var e=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.getUserMedia;navigator.mediaDevices.getUserMedia=e?function(t){return new Promise((function(n,r){e(t,(function(e){n(e)}),(function(e){r(e)}))}))}:function(){return new Promise((function(e,t){var n;window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.RTCIceGatherer?((n=new Error("insecure connection")).name="CustomSecureConnectionError",t(n)):((n=new Error("getUserMedia is not supported in this browser.")).name="CustomNotSupportedError",t(n))}))}}}();!function(){function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){if(!s&&z)return z(a);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};t[a][0].call(d.exports,(function(e){return o(t[a][1][e]||e)}),d,d.exports,e,t,n,r)}return n[a].exports}for(var i=z,a=0;a<r.length;a++)o(r[a]);return o}return e}()({1:[function(e,t,n){var r=(0,e("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});t.exports=r},{"./adapter_factory.js":2}],2:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.adapterFactory=u;var r=d(e("./utils")),o=d(e("./chrome/chrome_shim")),i=d(e("./firefox/firefox_shim")),a=d(e("./safari/safari_shim")),s=d(e("./common_shim")),c=d(e("sdp"));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function u(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=r.log,d=r.detectBrowser(e),u={browserDetails:d,commonShim:s,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings,sdp:c};switch(d.browser){case"chrome":if(!o||!o.shimPeerConnection||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),u;if(null===d.version)return n("Chrome shim can not determine version, not shimming."),u;n("adapter.js shimming chrome."),u.browserShim=o,s.shimAddIceCandidateNullOrEmpty(e,d),s.shimParameterlessSetLocalDescription(e,d),o.shimGetUserMedia(e,d),o.shimMediaStream(e,d),o.shimPeerConnection(e,d),o.shimOnTrack(e,d),o.shimAddTrackRemoveTrack(e,d),o.shimGetSendersWithDtmf(e,d),o.shimGetStats(e,d),o.shimSenderReceiverGetStats(e,d),o.fixNegotiationNeeded(e,d),s.shimRTCIceCandidate(e,d),s.shimConnectionState(e,d),s.shimMaxMessageSize(e,d),s.shimSendThrowTypeError(e,d),s.removeExtmapAllowMixed(e,d);break;case"firefox":if(!i||!i.shimPeerConnection||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),u;n("adapter.js shimming firefox."),u.browserShim=i,s.shimAddIceCandidateNullOrEmpty(e,d),s.shimParameterlessSetLocalDescription(e,d),i.shimGetUserMedia(e,d),i.shimPeerConnection(e,d),i.shimOnTrack(e,d),i.shimRemoveStream(e,d),i.shimSenderGetStats(e,d),i.shimReceiverGetStats(e,d),i.shimRTCDataChannel(e,d),i.shimAddTransceiver(e,d),i.shimGetParameters(e,d),i.shimCreateOffer(e,d),i.shimCreateAnswer(e,d),s.shimRTCIceCandidate(e,d),s.shimConnectionState(e,d),s.shimMaxMessageSize(e,d),s.shimSendThrowTypeError(e,d);break;case"safari":if(!a||!t.shimSafari)return n("Safari shim is not included in this adapter release."),u;n("adapter.js shimming safari."),u.browserShim=a,s.shimAddIceCandidateNullOrEmpty(e,d),s.shimParameterlessSetLocalDescription(e,d),a.shimRTCIceServerUrls(e,d),a.shimCreateOfferLegacy(e,d),a.shimCallbacksAPI(e,d),a.shimLocalStreamsAPI(e,d),a.shimRemoteStreamsAPI(e,d),a.shimTrackEventTransceiver(e,d),a.shimGetUserMedia(e,d),a.shimAudioContext(e,d),s.shimRTCIceCandidate(e,d),s.shimMaxMessageSize(e,d),s.shimSendThrowTypeError(e,d),s.removeExtmapAllowMixed(e,d);break;default:n("Unsupported browser!")}return u}},{"./chrome/chrome_shim":3,"./common_shim":6,"./firefox/firefox_shim":7,"./safari/safari_shim":10,"./utils":11,sdp:12}],3:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),n.shimMediaStream=d,n.shimOnTrack=u,n.shimGetSendersWithDtmf=p,n.shimGetStats=l,n.shimSenderReceiverGetStats=f,n.shimAddTrackRemoveTrackWithNative=h,n.shimAddTrackRemoveTrack=m,n.shimPeerConnection=v,n.fixNegotiationNeeded=y;var a=s(e("../utils.js"));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function u(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(r){var o=void 0;o=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.track.id})):{track:r.track};var i=new Event("track");i.track=r.track,i.receiver=o,i.transceiver={receiver:o},i.streams=[t.stream],n.dispatchEvent(i)})),t.stream.getTracks().forEach((function(r){var o=void 0;o=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.id})):{track:r};var i=new Event("track");i.track=r,i.receiver=o,i.transceiver={receiver:o},i.streams=[t.stream],n.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else a.wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function p(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var o=n.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){o.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){n._senders.push(t(n,e))}))};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function l(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),r=n[0],o=n[1],i=n[2];if(arguments.length>0&&"function"==typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof r))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){o(s(a(e)))};return t.apply(this,[c,r])}return new Promise((function(n,r){t.apply(e,[function(e){n(s(a(e)))},r])})).then(o,i)}}}function f(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return a.filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var o=e.RTCPeerConnection.prototype.getReceivers;o&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=o.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),a.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return a.filterStats(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],n=void 0,r=void 0,o=void 0;return this.getSenders().forEach((function(e){e.track===t&&(n?o=!0:n=e)})),this.getReceivers().forEach((function(e){return e.track===t&&(r?o=!0:r=e),e.track===t})),o||n&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function h(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));if(n)throw new DOMException("Track already exists.","InvalidAccessError")}));var r=this.getSenders();n.apply(this,arguments);var o=this.getSenders().filter((function(e){return-1===r.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(o)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]})),o.apply(this,arguments)}}function m(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return h(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){var t=n.getSenders().find((function(t){return t.track===e}));if(t)throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var o=new e.MediaStream(t.getTracks());this._streams[t.id]=o,this._reverseStreams[o.id]=t,t=o}r.apply(this,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var o=[].slice.call(arguments,1);if(1!==o.length||!o[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var i=this.getSenders().find((function(e){return e.track===t}));if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var a=this._streams[n.id];if(a)a.addTrack(t),Promise.resolve().then((function(){r.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new e.MediaStream([t]);this._streams[n.id]=s,this._reverseStreams[s.id]=n,this.addStream(s)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=c({},t,(function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[function(n){var r=s(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((function(t){return s(e,t)}))}));e.RTCPeerConnection.prototype[t]=r[t]}));var i=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=d(this,arguments[0]),i.apply(this,arguments)):i.apply(this,arguments)};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach((function(r){t._streams[r].getTracks().find((function(t){return e.track===t}))&&(n=t._streams[r])})),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],o=e._streams[r.id];n=n.replace(new RegExp(o.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function d(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],o=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),o.id)})),new RTCSessionDescription({type:t.type,sdp:n})}}function v(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=c({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}))}function y(e,t){a.wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){var n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}},{"../utils.js":11,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,n){function r(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((function(t){var r=n.video&&n.video.width,o=n.video&&n.video.height,i=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}},r&&(n.video.mandatory.maxWidth=r),o&&(n.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=r},{}],5:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}n.shimGetUserMedia=a;var i=o(e("../utils.js")).log;function a(e,t){var n=e&&e.navigator;if(n.mediaDevices){var o=function(e){if("object"!==(void 0===e?"undefined":r(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var o="object"===r(e[n])?e[n]:{ideal:e[n]};void 0!==o.exact&&"number"==typeof o.exact&&(o.min=o.max=o.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==o.ideal){t.optional=t.optional||[];var a={};"number"==typeof o.ideal?(a[i("min",n)]=o.ideal,t.optional.push(a),(a={})[i("max",n)]=o.ideal,t.optional.push(a)):(a[i("",n)]=o.ideal,t.optional.push(a))}void 0!==o.exact&&"number"!=typeof o.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=o.exact):["min","max"].forEach((function(e){void 0!==o[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=o[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,a){if(t.version>=61)return a(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===r(e.audio)){var s=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};s((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"===r(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":r(c))?c:{ideal:c});var d=t.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||d)){delete e.video.facingMode;var u=void 0;if("environment"===c.exact||"environment"===c.ideal?u=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(u=["front"]),u)return n.mediaDevices.enumerateDevices().then((function(t){t=t.filter((function(e){return"videoinput"===e.kind}));var n=t.find((function(e){return u.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!n&&t.length&&u.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=c.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),a(e)}))}e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),a(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,t,r){a(e,(function(e){n.webkitGetUserMedia(e,t,(function(e){r&&r(s(e))}))}))};if(n.getUserMedia=c.bind(n),n.mediaDevices.getUserMedia){var d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,(function(e){return d(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(s(e))}))}))}}}}},{"../utils.js":11}],6:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimRTCIceCandidate=c,n.shimMaxMessageSize=d,n.shimSendThrowTypeError=u,n.shimConnectionState=p,n.removeExtmapAllowMixed=l,n.shimAddIceCandidateNullOrEmpty=f,n.shimParameterlessSetLocalDescription=h;var o=s(e("sdp")),i=a(e("./utils"));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}function c(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),i=o.default.parseCandidate(e.candidate),a=Object.assign(n,i);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,i.wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function d(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=function(e){if(!e||!e.sdp)return!1;var t=o.default.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=o.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},a=function(e,n){var r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);var i=o.default.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),n(arguments[0])){var e=r(arguments[0]),o=i(e),c=a(arguments[0],e),d=void 0;d=0===o&&0===c?Number.POSITIVE_INFINITY:0===o||0===c?Math.max(o,c):Math.min(o,c);var u={};Object.defineProperty(u,"maxMessageSize",{get:function(){return d}}),this._sctp=u}return s.apply(this,arguments)}}}function u(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},i.wrapPeerConnectionEvent(e,"datachannel",(function(e){return n(e.channel,e.target),e}))}function n(e,t){var n=e.send;e.send=function(){var r=arguments[0],o=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}function p(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}}function l(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var r=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return n.apply(this,arguments)}}}function f(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}function h(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!==(void 0===t?"undefined":r(t))||t.type&&t.sdp)return n.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?n.apply(this,[t]):("offer"===t.type?this.createOffer:this.createAnswer).apply(this).then((function(t){return n.apply(e,[t])}))})}}},{"./utils":11,sdp:12}],7:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),n.shimOnTrack=d,n.shimPeerConnection=u,n.shimSenderGetStats=p,n.shimReceiverGetStats=l,n.shimRemoveStream=f,n.shimRTCDataChannel=h,n.shimAddTransceiver=m,n.shimGetParameters=v,n.shimCreateOffer=y,n.shimCreateAnswer=g;var a=s(e("../utils"));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){"object"===(void 0===e?"undefined":r(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function u(e,t){if("object"===(void 0===e?"undefined":r(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=c({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}));var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),r=e[0],i=e[1],a=e[2];return o.apply(this,[r||null]).then((function(e){if(t.version<53&&!i)try{e.forEach((function(e){e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,a)}}}function p(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function l(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n}),a.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function f(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;a.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)}))})}function h(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function m(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var r=t.apply(this,arguments);if(n){var o=r.sender,i=o.getParameters();(!("encodings"in i)||1===i.encodings.length&&0===Object.keys(i.encodings[0]).length)&&(i.encodings=e.sendEncodings,o.sendEncodings=e.sendEncodings,this.setParametersPromises.push(o.setParameters(i).then((function(){delete o.sendEncodings})).catch((function(){delete o.sendEncodings}))))}return r})}}function v(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function y(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,n=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(e,n)})).finally((function(){e.setParametersPromises=[]})):t.apply(this,arguments)}}}function g(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,n=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(e,n)})).finally((function(){e.setParametersPromises=[]})):t.apply(this,arguments)}}}},{"../utils":11,"./getdisplaymedia":8,"./getusermedia":9}],8:[function(e,t,n){function r(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=r},{}],9:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimGetUserMedia=a;var o=i(e("../utils"));function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e,t){var n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){o.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":r(e))&&"object"===r(e.audio)&&(e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","mozAutoGainControl"),a(e.audio,"noiseSuppression","mozNoiseSuppression")),s(e)},i&&i.prototype.getSettings){var c=i.prototype.getSettings;i.prototype.getSettings=function(){var e=c.apply(this,arguments);return a(e,"mozAutoGainControl","autoGainControl"),a(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var d=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":r(e))&&(e=JSON.parse(JSON.stringify(e)),a(e,"autoGainControl","mozAutoGainControl"),a(e,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[e])}}}}},{"../utils":11}],10:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimLocalStreamsAPI=a,n.shimRemoteStreamsAPI=s,n.shimCallbacksAPI=c,n.shimGetUserMedia=d,n.shimConstraints=u,n.shimRTCIceServerUrls=p,n.shimTrackEventTransceiver=l,n.shimCreateOfferLegacy=f,n.shimAudioContext=h;var o=i(e("../utils"));function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(r){return t.call(n,r,e)})),e.getVideoTracks().forEach((function(r){return t.call(n,r,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,r=arguments.length,o=Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return o&&o.forEach((function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach((function(e){r.includes(e.track)&&t.removeTrack(e)}))}})}}function s(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}}function c(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,o=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],r=o.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};var c=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=c,c=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=c,c=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=c}}function d(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return r(u(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function u(e){return e&&void 0!==e.video?Object.assign({},e,{video:o.compactObject(e.video)}):e}function p(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(o.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,r.push(a)):r.push(e.iceServers[i])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function l(e){"object"===(void 0===e?"undefined":r(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function f(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function h(e){"object"!==(void 0===e?"undefined":r(e))||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}},{"../utils":11}],11:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.extractVersion=s,n.wrapPeerConnectionEvent=c,n.disableLog=d,n.disableWarnings=u,n.log=p,n.deprecated=l,n.detectBrowser=f,n.compactObject=m,n.walkStats=v,n.filterStats=y;var i=!0,a=!0;function s(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function c(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return o.apply(this,arguments);var i=function(e){var t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,i),o.apply(this,[e,i])};var i=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(n))return i.apply(this,arguments);var r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,i.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function d(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":r(e))+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function u(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":r(e))+". Please use a boolean."):(a=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function p(){if("object"===("undefined"==typeof window?"undefined":r(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function l(e,t){a&&console.warn(e+" is deprecated, please use "+t+" instead.")}function f(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var n=e.navigator;if(n.mozGetUserMedia)t.browser="firefox",t.version=s(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=s(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=s(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function h(e){return"[object Object]"===Object.prototype.toString.call(e)}function m(e){return h(e)?Object.keys(e).reduce((function(t,n){var r=h(e[n]),i=r?m(e[n]):e[n],a=r&&!Object.keys(i).length;return void 0===i||a?t:Object.assign(t,o({},n,i))}),{}):e}function v(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((function(r){r.endsWith("Id")?v(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((function(t){v(e,e.get(t),n)}))})))}function y(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;var i=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)})),i.forEach((function(t){e.forEach((function(n){n.type===r&&n.trackId===t.id&&v(e,n,o)}))})),o}},{}],12:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};o.localCName=o.generateIdentifier(),o.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},o.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},o.getDescription=function(e){var t=o.splitSections(e);return t&&t[0]},o.getMediaSections=function(e){var t=o.splitSections(e);return t.shift(),t},o.matchPrefix=function(e,t){return o.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},o.parseCandidate=function(e){for(var t=void 0,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},o.writeCandidate=function(e){var t=[];t.push(e.foundation);var n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},o.parseIceOptions=function(e){return e.substr(14).split(" ")},o.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},o.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},o.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},o.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},o.parseFmtp=function(e){for(var t={},n=void 0,r=e.substr(e.indexOf(" ")+1).split(";"),o=0;o<r.length;o++)t[(n=r[o].trim().split("="))[0].trim()]=n[1];return t},o.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},o.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},o.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},o.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},o.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},o.getMid=function(e){var t=o.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},o.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},o.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:o.matchPrefix(e+t,"a=fingerprint:").map(o.parseFingerprint)}},o.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},o.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},o.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===r(e.keyParams)?o.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},o.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},o.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},o.getCryptoParameters=function(e,t){return o.matchPrefix(e+t,"a=crypto:").map(o.parseCryptoLine)},o.getIceParameters=function(e,t){var n=o.matchPrefix(e+t,"a=ice-ufrag:")[0],r=o.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substr(12),password:r.substr(10)}:null},o.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},o.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=o.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var i=n[r],a=o.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(a){var s=o.parseRtpMap(a),c=o.matchPrefix(e,"a=fmtp:"+i+" ");switch(s.parameters=c.length?o.parseFmtp(c[0]):{},s.rtcpFeedback=o.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(o.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return o.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(o.parseExtmap(e))})),t},o.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=o.writeRtpMap(e),n+=o.writeFmtp(e),n+=o.writeRtcpFb(e)}));var r=0;return t.codecs.forEach((function(e){e.maxptime>r&&(r=e.maxptime)})),r>0&&(n+="a=maxptime:"+r+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=o.writeExtmap(e)})),n},o.parseRtpEncodingParameters=function(e){var t=[],n=o.parseRtpParameters(e),r=-1!==n.fecMechanisms.indexOf("RED"),i=-1!==n.fecMechanisms.indexOf("ULPFEC"),a=o.matchPrefix(e,"a=ssrc:").map((function(e){return o.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),s=a.length>0&&a[0].ssrc,c=void 0,d=o.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));d.length>0&&d[0].length>1&&d[0][0]===s&&(c=d[0][1]),n.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(n.rtx={ssrc:c}),t.push(n),r&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:s,mechanism:i?"red+ulpfec":"red"},t.push(n))}})),0===t.length&&s&&t.push({ssrc:s});var u=o.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,t.forEach((function(e){e.maxBitrate=u}))),t},o.parseRtcpParameters=function(e){var t={},n=o.matchPrefix(e,"a=ssrc:").map((function(e){return o.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var r=o.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=0===r.length;var i=o.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},o.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},o.parseMsid=function(e){var t=void 0,n=o.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var r=o.matchPrefix(e,"a=ssrc:").map((function(e){return o.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return r.length>0?{stream:(t=r[0].value.split(" "))[0],track:t[1]}:void 0},o.parseSctpDescription=function(e){var t=o.parseMLine(e),n=o.matchPrefix(e,"a=max-message-size:"),r=void 0;n.length>0&&(r=parseInt(n[0].substr(19),10)),isNaN(r)&&(r=65536);var i=o.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:t.fmt,maxMessageSize:r};var a=o.matchPrefix(e,"a=sctpmap:");if(a.length>0){var s=a[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:r}}},o.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},o.generateSessionId=function(){return Math.random().toString().substr(2,21)},o.writeSessionBoilerplate=function(e,t,n){var r=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||o.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},o.getDirection=function(e,t){for(var n=o.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?o.getDirection(t):"sendrecv"},o.getKind=function(e){return o.splitLines(e)[0].split(" ")[0].substr(2)},o.isRejected=function(e){return"0"===e.split(" ",2)[1]},o.parseMLine=function(e){var t=o.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},o.parseOLine=function(e){var t=o.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},o.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=o.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"===(void 0===t?"undefined":r(t))&&(t.exports=o)},{}]},{},[1])(1);var Tn={exports:{}},_n=Tn.exports=function(t,n,r){var o,i="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(o=void 0!==V?V:null)&&"undefined"==typeof window&&void 0!==V&&(V.navigator={userAgent:i,getUserMedia:function(){}},V.console||(V.console={}),void 0!==V.console.log&&void 0!==V.console.error||(V.console.error=V.console.log=V.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(o.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},o.HTMLVideoElement=function(){}),"undefined"==typeof location&&(o.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(o.screen={width:0,height:0}),"undefined"==typeof URL&&(o.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),"undefined"==typeof MediaStreamTrack&&(o.MediaStreamTrack=function(){}),void 0===a&&(o.RTCPeerConnection=function(){}),o.window=V);var a=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;"undefined"==typeof MediaStreamTrack&&(MediaStreamTrack={});var s={encryption:"sha-256",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{audioBytesSent:0,videoBytestSent:0},speed:0},results:{},connectionType:{systemNetworkType:((navigator.connection||{}).type||"unknown").toString().toLowerCase(),systemIpAddress:"192.168.1.2",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(){p=!0}},c={checkIfOfferer:function(e){"googLibjingleSession"===e.type&&(s.isOfferer=e.googInitiator)}},d=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),u=this;if(!(arguments[0]instanceof a))throw"1st argument is not instance of RTCPeerConnection.";u=arguments[0],arguments[1]instanceof MediaStreamTrack&&(t=arguments[1],n=arguments[2],r=arguments[3]);var p=!1;function l(){f((function(t){if(t&&t.forEach){t.forEach((function(e){Object.keys(c).forEach((function(t){if("function"==typeof c[t])try{c[t](e)}catch(e){console.error(e.message,e.stack,e)}}))}));try{-1!==u.iceConnectionState.search(/failed|closed|disconnected/gi)&&(p=!0)}catch(e){p=!0}!0===p&&(s.datachannel&&(s.datachannel.state="close"),s.ended=!0),s.results=t,s.audio&&s.video&&(s.bandwidth.speed=s.audio.bytesSent-s.bandwidth.helper.audioBytesSent+(s.video.bytesSent-s.bandwidth.helper.videoBytesSent),s.bandwidth.helper.audioBytesSent=s.audio.bytesSent,s.bandwidth.helper.videoBytesSent=s.video.bytesSent),n(s),p||null!=e(r)&&r&&setTimeout(l,r||1e3)}}))}function f(e){void 0!==window.InstallTrigger||d?u.getStats(window.mediaStreamTrack||null).then((function(t){var n=[];t.forEach((function(e){n.push(e)})),e(n)})).catch(e):u.getStats((function(t){var n=[];t.result().forEach((function(e){var t={};e.names().forEach((function(n){t[n]=e.stat(n)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,n.push(t)})),e(n)}))}c.datachannel=function(e){"datachannel"===e.type&&(s.datachannel={state:e.state})},c.googCertificate=function(e){"googCertificate"==e.type&&(s.encryption=e.googFingerprintAlgorithm),"certificate"==e.type&&(s.encryption=e.fingerprintAlgorithm)},c.checkAudioTracks=function(e){if("audio"===e.mediaType){var t=e.id.split("_").pop();if(!0===e.isRemote&&(t="recv"),!1===e.isRemote&&(t="send"),t){if(-1===s.audio[t].codecs.indexOf(e.googCodecName||"opus")&&s.audio[t].codecs.push(e.googCodecName||"opus"),e.bytesSent){var n=0;s.internal.audio[t].prevBytesSent||(s.internal.audio[t].prevBytesSent=e.bytesSent);var r=e.bytesSent-s.internal.audio[t].prevBytesSent;s.internal.audio[t].prevBytesSent=e.bytesSent,n=r/1024,s.audio[t].availableBandwidth=n.toFixed(1),s.audio.bytesSent=n.toFixed(1)}e.bytesReceived&&(n=0,s.internal.audio[t].prevBytesReceived||(s.internal.audio[t].prevBytesReceived=e.bytesReceived),r=e.bytesReceived-s.internal.audio[t].prevBytesReceived,s.internal.audio[t].prevBytesReceived=e.bytesReceived,n=r/1024,s.audio.bytesReceived=n.toFixed(1)),e.googTrackId&&-1===s.audio[t].tracks.indexOf(e.googTrackId)&&s.audio[t].tracks.push(e.googTrackId),e.googCurrentDelayMs&&(n=0,s.internal.audio.prevGoogCurrentDelayMs||(s.internal.audio.prevGoogCurrentDelayMs=e.googCurrentDelayMs),r=e.googCurrentDelayMs-s.internal.audio.prevGoogCurrentDelayMs,s.internal.audio.prevGoogCurrentDelayMs=e.googCurrentDelayMs,s.audio.latency=r.toFixed(1),s.audio.latency<0&&(s.audio.latency=0)),e.packetsLost&&(n=0,s.internal.audio.prevPacketsLost||(s.internal.audio.prevPacketsLost=e.packetsLost),r=e.packetsLost-s.internal.audio.prevPacketsLost,s.internal.audio.prevPacketsLost=e.packetsLost,s.audio.packetsLost=r.toFixed(1),s.audio.packetsLost<0&&(s.audio.packetsLost=0))}}},c.checkVideoTracks=function(e){if("video"===e.mediaType){var t=e.id.split("_").pop();if(!0===e.isRemote&&(t="recv"),!1===e.isRemote&&(t="send"),t){if(-1===s.video[t].codecs.indexOf(e.googCodecName||"VP8")&&s.video[t].codecs.push(e.googCodecName||"VP8"),e.bytesSent){var n=0;s.internal.video[t].prevBytesSent||(s.internal.video[t].prevBytesSent=e.bytesSent);var r=e.bytesSent-s.internal.video[t].prevBytesSent;s.internal.video[t].prevBytesSent=e.bytesSent,n=r/1024,s.video[t].availableBandwidth=n.toFixed(1),s.video.bytesSent=n.toFixed(1)}e.bytesReceived&&(n=0,s.internal.video[t].prevBytesReceived||(s.internal.video[t].prevBytesReceived=e.bytesReceived),r=e.bytesReceived-s.internal.video[t].prevBytesReceived,s.internal.video[t].prevBytesReceived=e.bytesReceived,n=r/1024,s.video.bytesReceived=n.toFixed(1)),e.googFrameHeightReceived&&e.googFrameWidthReceived&&(s.resolutions[t].width=e.googFrameWidthReceived,s.resolutions[t].height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(s.resolutions[t].width=e.googFrameWidthSent,s.resolutions[t].height=e.googFrameHeightSent),e.googTrackId&&-1===s.video[t].tracks.indexOf(e.googTrackId)&&s.video[t].tracks.push(e.googTrackId),e.framerateMean&&(s.bandwidth.framerateMean=e.framerateMean,n=0,s.internal.video[t].prevFramerateMean||(s.internal.video[t].prevFramerateMean=e.bitrateMean),r=e.bytesSent-s.internal.video[t].prevFramerateMean,s.internal.video[t].prevFramerateMean=e.framerateMean,n=r/1024,s.video[t].framerateMean=r.toFixed(1)),e.bitrateMean&&(s.bandwidth.bitrateMean=e.bitrateMean,n=0,s.internal.video[t].prevBitrateMean||(s.internal.video[t].prevBitrateMean=e.bitrateMean),r=e.bytesSent-s.internal.video[t].prevBitrateMean,s.internal.video[t].prevBitrateMean=e.bitrateMean,n=r/1024,s.video[t].bitrateMean=r.toFixed(1)),e.googCurrentDelayMs&&(n=0,s.internal.video.prevGoogCurrentDelayMs||(s.internal.video.prevGoogCurrentDelayMs=e.googCurrentDelayMs),r=e.googCurrentDelayMs-s.internal.video.prevGoogCurrentDelayMs,s.internal.video.prevGoogCurrentDelayMs=e.googCurrentDelayMs,s.video.latency=r.toFixed(1),s.video.latency<0&&(s.video.latency=0)),e.packetsLost&&(n=0,s.internal.video.prevPacketsLost||(s.internal.video.prevPacketsLost=e.packetsLost),r=e.packetsLost-s.internal.video.prevPacketsLost,s.internal.video.prevPacketsLost=e.packetsLost,s.video.packetsLost=r.toFixed(1),s.video.packetsLost<0&&(s.video.packetsLost=0))}}},c.bweforvideo=function(e){"VideoBwe"===e.type&&(s.bandwidth.availableSendBandwidth=e.googAvailableSendBandwidth,s.bandwidth.googActualEncBitrate=e.googActualEncBitrate,s.bandwidth.googAvailableSendBandwidth=e.googAvailableSendBandwidth,s.bandwidth.googAvailableReceiveBandwidth=e.googAvailableReceiveBandwidth,s.bandwidth.googRetransmitBitrate=e.googRetransmitBitrate,s.bandwidth.googTargetEncBitrate=e.googTargetEncBitrate,s.bandwidth.googBucketDelay=e.googBucketDelay,s.bandwidth.googTransmitBitrate=e.googTransmitBitrate)},c.candidatePair=function(e){if("googCandidatePair"===e.type||"candidate-pair"===e.type||"local-candidate"===e.type||"remote-candidate"===e.type){if("true"==e.googActiveConnection&&(Object.keys(s.internal.candidates).forEach((function(t){var n=s.internal.candidates[t];-1!==n.ipAddress.indexOf(e.googLocalAddress)&&(s.connectionType.local.candidateType=n.candidateType,s.connectionType.local.ipAddress=n.ipAddress,s.connectionType.local.networkType=n.networkType,s.connectionType.local.transport=n.transport),-1!==n.ipAddress.indexOf(e.googRemoteAddress)&&(s.connectionType.remote.candidateType=n.candidateType,s.connectionType.remote.ipAddress=n.ipAddress,s.connectionType.remote.networkType=n.networkType,s.connectionType.remote.transport=n.transport)})),s.connectionType.transport=e.googTransportType,(t=s.internal.candidates[e.localCandidateId])&&t.ipAddress&&(s.connectionType.systemIpAddress=t.ipAddress),(n=s.internal.candidates[e.remoteCandidateId])&&n.ipAddress&&(s.connectionType.systemIpAddress=n.ipAddress)),"candidate-pair"===e.type&&!0===e.selected&&!0===e.nominated&&"succeeded"===e.state)var t=s.internal.candidates[e.remoteCandidateId],n=s.internal.candidates[e.remoteCandidateId];if("local-candidate"===e.type&&(s.connectionType.local.candidateType=e.candidateType,s.connectionType.local.ipAddress=e.ipAddress,s.connectionType.local.networkType=e.networkType,s.connectionType.local.transport=e.mozLocalTransport||e.transport),"remote-candidate"===e.type&&(s.connectionType.remote.candidateType=e.candidateType,s.connectionType.remote.ipAddress=e.ipAddress,s.connectionType.remote.networkType=e.networkType,s.connectionType.remote.transport=e.mozRemoteTransport||e.transport),d){var r=e.localCandidateId?"send":"recv";if(!r)return;if(e.bytesSent){var o=0;s.internal.video[r].prevBytesSent||(s.internal.video[r].prevBytesSent=e.bytesSent);var i=e.bytesSent-s.internal.video[r].prevBytesSent;s.internal.video[r].prevBytesSent=e.bytesSent,o=i/1024,s.video[r].availableBandwidth=o.toFixed(1),s.video.bytesSent=o.toFixed(1)}e.bytesReceived&&(o=0,s.internal.video[r].prevBytesReceived||(s.internal.video[r].prevBytesReceived=e.bytesReceived),i=e.bytesReceived-s.internal.video[r].prevBytesReceived,s.internal.video[r].prevBytesReceived=e.bytesReceived,o=i/1024,s.video.bytesReceived=o.toFixed(1)),e.availableOutgoingBitrate&&(o=0,s.internal.video[r].prevAvailableOutgoingBitrate||(s.internal.video[r].prevAvailableOutgoingBitrate=e.availableOutgoingBitrate),i=e.availableOutgoingBitrate-s.internal.video[r].prevAvailableOutgoingBitrate,s.internal.video[r].prevAvailableOutgoingBitrate=e.availableOutgoingBitrate,o=i/1024,s.video.availableOutgoingBitrate=o.toFixed(1)),e.availableIncomingBitrate&&(o=0,s.internal.video[r].prevAvailableIncomingBitrate||(s.internal.video[r].prevAvailableIncomingBitrate=e.availableIncomingBitrate),i=e.availableIncomingBitrate-s.internal.video[r].prevAvailableIncomingBitrate,s.internal.video[r].prevAvailableIncomingBitrate=e.availableIncomingBitrate,o=i/1024,s.video.availableIncomingBitrate=o.toFixed(1))}}};var h={},m={},v={},y={};c.localcandidate=function(e){"localcandidate"!==e.type&&"local-candidate"!==e.type||e.id&&(h[e.id]||(h[e.id]=[]),m[e.id]||(m[e.id]=[]),v[e.id]||(v[e.id]=[]),y[e.id]||(y[e.id]=[]),e.candidateType&&-1===h[e.id].indexOf(e.candidateType)&&h[e.id].push(e.candidateType),e.transport&&-1===m[e.id].indexOf(e.transport)&&m[e.id].push(e.transport),e.ipAddress&&-1===v[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&v[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===y[e.id].indexOf(e.networkType)&&y[e.id].push(e.networkType),s.internal.candidates[e.id]={candidateType:h[e.id],ipAddress:v[e.id],portNumber:e.portNumber,networkType:y[e.id],priority:e.priority,transport:m[e.id],timestamp:e.timestamp,id:e.id,type:e.type},s.connectionType.local.candidateType=h[e.id],s.connectionType.local.ipAddress=v[e.id],s.connectionType.local.networkType=y[e.id],s.connectionType.local.transport=m[e.id])};var g={},b={},C={},w={};c.remotecandidate=function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||e.id&&(g[e.id]||(g[e.id]=[]),b[e.id]||(b[e.id]=[]),C[e.id]||(C[e.id]=[]),w[e.id]||(w[e.id]=[]),e.candidateType&&-1===g[e.id].indexOf(e.candidateType)&&g[e.id].push(e.candidateType),e.transport&&-1===b[e.id].indexOf(e.transport)&&b[e.id].push(e.transport),e.ipAddress&&-1===C[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&C[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===w[e.id].indexOf(e.networkType)&&w[e.id].push(e.networkType),s.internal.candidates[e.id]={candidateType:g[e.id],ipAddress:C[e.id],portNumber:e.portNumber,networkType:w[e.id],priority:e.priority,transport:b[e.id],timestamp:e.timestamp,id:e.id,type:e.type},s.connectionType.remote.candidateType=g[e.id],s.connectionType.remote.ipAddress=C[e.id],s.connectionType.remote.networkType=w[e.id],s.connectionType.remote.transport=b[e.id])},c.dataSentReceived=function(e){!e.googCodecName||"video"!==e.mediaType&&"audio"!==e.mediaType||(e.bytesSent&&(s[e.mediaType].bytesSent=parseInt(e.bytesSent)),e.bytesReceived&&(s[e.mediaType].bytesReceived=parseInt(e.bytesReceived)))},c.inboundrtp=function(e){if(d&&"inbound-rtp"===e.type){var t=e.mediaType||"audio",n=e.isRemote?"recv":"send";if(n){if(e.bytesSent){var r=0;s.internal[t][n].prevBytesSent||(s.internal[t][n].prevBytesSent=e.bytesSent);var o=e.bytesSent-s.internal[t][n].prevBytesSent;s.internal[t][n].prevBytesSent=e.bytesSent,r=o/1024,s[t][n].availableBandwidth=r.toFixed(1),s[t].bytesSent=r.toFixed(1)}e.bytesReceived&&(r=0,s.internal[t][n].prevBytesReceived||(s.internal[t][n].prevBytesReceived=e.bytesReceived),o=e.bytesReceived-s.internal[t][n].prevBytesReceived,s.internal[t][n].prevBytesReceived=e.bytesReceived,r=o/1024,s[t].bytesReceived=r.toFixed(1))}}},c.outboundrtp=function(e){if(d&&"outbound-rtp"===e.type){var t=e.mediaType||"audio",n=e.isRemote?"recv":"send";if(n){if(e.bytesSent){var r=0;s.internal[t][n].prevBytesSent||(s.internal[t][n].prevBytesSent=e.bytesSent);var o=e.bytesSent-s.internal[t][n].prevBytesSent;s.internal[t][n].prevBytesSent=e.bytesSent,r=o/1024,s[t][n].availableBandwidth=r.toFixed(1),s[t].bytesSent=r.toFixed(1)}e.bytesReceived&&(r=0,s.internal[t][n].prevBytesReceived||(s.internal[t][n].prevBytesReceived=e.bytesReceived),o=e.bytesReceived-s.internal[t][n].prevBytesReceived,s.internal[t][n].prevBytesReceived=e.bytesReceived,r=o/1024,s[t].bytesReceived=r.toFixed(1))}}},c.track=function(e){if(d&&"track"===e.type){var t=!0===e.remoteSource?"send":"recv";e.frameWidth&&e.frameHeight&&(s.resolutions[t].width=e.frameWidth,s.resolutions[t].height=e.frameHeight)}};var S={audio:{send:[],recv:[]},video:{send:[],recv:[]}};c.ssrc=function(e){if(e.googCodecName&&("video"===e.mediaType||"audio"===e.mediaType)&&"ssrc"===e.type){var t=e.id.split("_").pop();-1===S[e.mediaType][t].indexOf(e.ssrc)&&S[e.mediaType][t].push(e.ssrc),s[e.mediaType][t].streams=S[e.mediaType][t].length}},l()};const Rn=(e,t,n)=>((e,t,n,r,o)=>{const i=-1!==n?n:e.length;for(let n=t;n<i;++n)if(0===e[n].indexOf(r)&&(!o||-1!==e[n].toLowerCase().indexOf(o.toLowerCase())))return n;return null})(e,0,-1,t,n),En=e=>{const t=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),n=e.match(t);return n&&2===n.length?n[1]:null},Pn=(e,t,n)=>((e,t,n)=>{if(navigator.mozGetUserMedia||!t)return e;if(n&&(t.screen?t.screen<300&&console.warn("\n        It seems that you are using wrong bandwidth value for screen.\n        Screen sharing is expected to fail.\n      "):console.warn("\n        It seems that you are not using bandwidth for screen.\n        Screen sharing is expected to fail.\n    ")),t.screen&&n&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,`a=mid:video\r\nb=AS:${t.screen}\r\n`)),(t.audio||t.video||t.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.audio&&(e=e.replace(/a=mid:audio\r\n/g,`a=mid:audio\r\nb=AS:${t.audio}\r\n`)),t.video){const r=/a=mid:video\r\n/g;e=e.replace(r,`\n      a=mid:video\n      b=AS:${n?t.screen:t.video}\n    `)}return e})(e,t,n),xn=(e,t)=>((e,t)=>{const n=(t=t||{}).min,r=t.max,o=t.codec.toUpperCase()||"VP8",i=e.split("\r\n"),a=Rn(i,"a=rtpmap",`${o}/90000`);let s;if(a&&(s=En(i[a])),!s)return e;const c=Rn(i,"a=rtpmap","rtx/90000");let d;if(c&&(d=En(i[c])),!c)return e;const u=Rn(i,`a=fmtp:${d.toString()}`);if(null!=u){let t="\r\n";t+=`a=fmtp:${s} x-google-min-bitrate=${n||"228"}; x-google-max-bitrate=${r||"228"}`,i[u]=i[u].concat(t),e=i.join("\r\n")}return e})(e,t),In=(e,t)=>((e,t)=>{t=t||{};const n=e.split("\r\n"),r=Rn(n,"a=rtpmap","opus/48000");let o;if(r&&(o=En(n[r])),!o)return e;const i=Rn(n,`a=fmtp:${o.toString()}`);if(null==i)return e;let a="";return a+=`; stereo=${void 0!==t.stereo?t.stereo:"1"}`,a+=`; sprop-stereo=${void 0!==t["sprop-stereo"]?t["sprop-stereo"]:"1"}`,void 0!==t.maxaveragebitrate&&(a+=`; maxaveragebitrate=${t.maxaveragebitrate||1048576}`),void 0!==t.maxplaybackrate&&(a+=`; maxplaybackrate=${t.maxplaybackrate||1048576}`),void 0!==t.cbr&&(a+=`; cbr=${void 0!==t.cbr?t.cbr:"1"}`),void 0!==t.useinbandfec&&(a+=`; useinbandfec=${t.useinbandfec}`),void 0!==t.usedtx&&(a+=`; usedtx=${t.usedtx}`),void 0!==t.maxptime&&(a+=`\r\na=maxptime:${t.maxptime}`),n[i]=n[i].concat(a),n.join("\r\n")})(e,t),On=e=>{const t={screen:300,audio:256,video:500,minVideo:128,maxVideo:2048,videoCodec:clientVars.webrtc.video.codec};return e=Pn(e,t,!1),e=xn(e,{min:t.minVideo,max:t.maxVideo,codec:t.videoCodec}),e=((e,t)=>{const n=(e=>{const t={};return e.split("\n").forEach((e=>{0===e.indexOf("m=video")&&(t.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach((n=>{(n=n.trim())&&n.length&&(t.videoCodecNumbers.push(n),t.videoCodecNumbersOriginal=e)}))),-1===e.indexOf("VP8/90000")||t.vp8LineNumber||(t.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||t.vp9LineNumber||(t.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||t.h264LineNumber||(t.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])})),t})(e);return t=t.toLowerCase(),n.videoCodecNumbers?("vp8"===t&&n.vp8LineNumber===n.videoCodecNumbers[0]||"vp9"===t&&n.vp9LineNumber===n.videoCodecNumbers[0]||"h264"===t&&n.h264LineNumber===n.videoCodecNumbers[0]||(e=((e,t,n,r)=>{let o="";if("vp8"===t){if(!n.vp8LineNumber)return e;o=n.vp8LineNumber}if("vp9"===t){if(!n.vp9LineNumber)return e;o=n.vp9LineNumber}if("h264"===t){if(!n.h264LineNumber)return e;o=n.h264LineNumber}let i=`${n.videoCodecNumbersOriginal.split("SAVPF")[0]}SAVPF `,a=[o];return r&&(a=[]),n.videoCodecNumbers.forEach((e=>{e!==o&&a.push(e)})),i+=a.join(" "),e.replace(n.videoCodecNumbersOriginal,i)})(e,t,n)),e):e})(e=In(e),t.videoCodec)};var Mn=(()=>{let e=0;const t={large:"260px",small:"160px"},n={},r={optional:[{DtlsSrtpKeyAgreement:!0}]},o={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},i={},a={},s=new Set;let c=null,d=null,u=null;const p={postAceInit:(e,r,o,i)=>{if(d=i,u=o,!clientVars.webrtc)throw new Error("[wrtc]: webrtc settings not found");n.iceServers=clientVars.webrtc.iceServers,clientVars.webrtc.video.sizes.large&&(t.large=`${clientVars.webrtc.video.sizes.large}px`),clientVars.webrtc.video.sizes.small&&(t.small=`${clientVars.webrtc.video.sizes.small}px`),p._pad=r.pad||window.pad,$(document).on("change",".select.audioSource select",p.audioVideoInputChange),$(document).on("change",".select.videoSource select",p.audioVideoInputChange),$(document).on("change",".select.audioOutputSec select",p.changeAudioDestination),$(window).on("unload",(()=>{console.info("[wrtc]: window unloaded, now hangupAll"),p.hangupAll()})),u.on("RTC_MESSAGE",(e=>{const t=e.data.payload;t.to===tr()&&t.data.headerId===window.headerId&&p.receiveMessage(e.data.payload)}))},appendVideoModalToBody:()=>{const e=$("#wrtcVideoModal").tmpl({videoChatLimit:clientVars.webrtc.videoChatLimit,headerId:""});$("body").prepend(e),$(document).on("click","#wrtc_modal .btn_toggle_modal",(function(){const e=$(this).parent().parent(),t=$(this).attr("data-action"),n=$("#wrtc_modal .videoWrapper").innerHeight();$(this).find(".fa_arrow-from-top").toggle(),$(this).find(".fa_arrow-to-top").toggle(),"collapse"===t?($(this).attr({"data-action":"expand"}),e.find(".btn_enlarge").removeAttr("active"),$("#wrtc_modal").css({transform:`translate(-50%, -${n}px)`})):($(this).attr({"data-action":"collapse"}),e.find(".btn_enlarge").attr({active:!0}),$("#wrtc_modal").css({transform:"translate(-50%, 0)"}))})),$(document).on("click","#wrtc_settings .btn_info",(function(){const e=Object.keys(a),t=$(this),n=t.attr("data-active"),r=$(document).find("#wrtc_settings .wrtc_info");if(n)return r.hide(),a[e[0]]&&_n(a[e[0]],(e=>{e.nomore()})),t.removeAttr("data-active"),!0;t.attr({"data-active":!0}),r.show(),a[e[0]]&&!n&&a[e[0]]})),$(document).on("click","#wrtc_settings .btn_close",(()=>{$("#wrtc_settings").toggleClass("active");const e=$("#wrtc_settings .btn_info");e.attr("data-active")&&e.trigger("click")}))},userLeave:(e,t,n)=>{(e=e||t.userInfo.userId)&&a[e]&&(p.hide(e),p.hangup(e,!0)),cr.userInRoom=!1,n&&n()},handleClientMessage_RTC_MESSAGE:(e,t)=>{t.payload.data.headerId===window.headerId&&p.receiveMessage(t.payload)},show:()=>{$("#pad_title").addClass("f_wrtcActive"),Gn()},showUserMediaError:(e,t,n)=>{let r;switch(console.error(`[wrtc]: mediaError, ${e}`),e.name){case"CustomNotSupportedError":r='Sorry, your browser does not support WebRTC. (or you have it disabled in your settings).<br><br>To participate in this audio/video chat you have to user a browser with WebRTC support like Chrome, Firefox or Opera.<a href="http://www.webrtc.org/" target="_new">Find out more</a>',p.sendErrorStat("NotSupported");break;case"CustomSecureConnectionError":r="Sorry, you need to install SSL certificates for your Etherpad instance to use WebRTC",p.sendErrorStat("SecureConnection");break;case"NotAllowedError":"https:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname?(r="Sorry, you need to give us permission to use your camera and microphone",p.sendErrorStat("Permission")):(r="Sorry, you need to install SSL certificates for your Etherpad instance to use WebRTC",p.sendErrorStat("SecureConnection"));break;case"NotFoundError":r="Sorry, we couldn't find a suitable camera on your device. If you have a camera, make sure it set up correctly and refresh this website to retry.",p.sendErrorStat("NotFound");break;case"NotReadableError":r=`Sorry, a hardware error occurred that prevented access to your camera and/or microphone:<br><br>${e.message}`,p.sendErrorStat("Hardware");break;case"AbortError":r=`Sorry, an error occurred (probably not hardware related) that prevented access to your camera and/or microphone:<br><br>${e.message}`,p.sendErrorStat("Abort");break;default:r=`Sorry, there was an unknown Error:<br><br>${e}`,p.sendErrorStat("Unknown")}$.gritter.add({title:"Error",text:`${r}; try again!`,time:4e3,sticky:!1,class_name:"error"}),t=t||clientVars.userId,n=n||window.headerId,Yn(n,{headerId:n,padId:d,userId:t})},hide:e=>{if(!e)return!1;e=e.split(".")[1],$("#rtcbox").find(`#video_a_${e}`).parent().remove()},activate:e=>{p.show(),p.hangupAll(),p.getUserMedia(e),cr.userInRoom=!0},deactivate:async(e,t)=>{if(!e)return!1;p.hide(e),p.hangupAll(t),p.hangup(e,!0,t),cr.localstream&&await nr(),cr.userInRoom=!1},toggleMuted:()=>{const e=cr.localstream.getAudioTracks()[0];return!e||(e.enabled=!e.enabled,!e.enabled)},toggleVideo:()=>{const e=cr.localstream.getVideoTracks()[0];if(e)return e.enabled=!e.enabled,!e.enabled},setStream:(e,n)=>{if(!e)return!1;const r=e===tr(),o=`video_${e.replace(/\./g,"_")}`;let i=$(`#${o}`)[0];const a=rr(e);if(!i&&n){const n=$("<div class='video-container'>").css({width:t.small,"max-height":t.small}).appendTo($("#wrtc_modal .videoWrapper")),s=a.name||"anonymous";n.append($('<div class="user-name">').text(s)),i=$("<video playsinline>").attr("id",o).css({"border-color":a.colorId,width:t.small,"max-height":t.small}).on({loadedmetadata:()=>{p.addInterface(e)}}).appendTo(n)[0],i.autoplay=!0,r&&(n.addClass("local-user"),i.muted=!0),p.addInterface(e)}n?((e,t)=>{void 0!==e.srcObject?e.srcObject=t:void 0!==e.mozSrcObject?e.mozSrcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):console.error("Error attaching stream to element.",e)})(i,n):i&&$(i).parent().remove()},addInterface:e=>{if(!e)return!1;const n=e===tr(),r=`video_${e.replace(/\./g,"_")}`,o=$(`#${r}`),i=$("<span class='interface-btn audio-btn buttonicon'>").attr("title","Mute").on({click:()=>{let e;n?e=p.toggleMuted():(o[0].muted=!o[0].muted,e=o[0].muted),i.attr("title",e?"Unmute":"Mute").toggleClass("muted",e)}});let a,d=!0;n&&(a=$("<span class='interface-btn video-btn buttonicon'>").attr("title","Disable video").on("click",(function(){p.toggleVideo(),d=!d;const e=d?"Disable video":"Enable video";$(this).attr("title",e).toggleClass("off",!d)})));let u=!1;const l=$("<span class='interface-btn enlarge-btn buttonicon'>").attr("title","Make video larger").on("click",(function(){u=!u,u?s.add(e):s.delete(e);const n=u?"Make video smaller":"Make video larger";$(this).attr("title",n).toggleClass("large",u);const r=$(document).find("#wrtc_modal .ndbtn.btn_enlarge").hasClass("large")?t.large:t.small;o.parent().css({width:r,"max-height":r}),o.css({width:r,"max-height":r})}));$(document).find("#wrtc_modal .ndbtn.btn_enlarge").hasClass("large")&&(o.parent().css({width:t.large,"max-height":t.large}),o.css({width:t.large,"max-height":t.large})),n&&(c=o);const f=$("<div class='latency'></div>");$(`#interface_${r}`).remove(),$("<div class='interface-container'>").attr("id",`interface_${r}`).append(i).append(a).append(l).append(f).insertAfter(o),p.changeAudioDestination()},sendErrorStat:e=>{const t={component:"pad",type:"STATS",data:{statName:e,type:"RTC_MESSAGE"}};u.emit("acceptNewCall",d,window.headerId),u.emit("message",t)},sendMessage:(e,t,n)=>{u.emit("RTC_MESSAGE",{type:"RTC_MESSAGE",payload:{data:t,to:e,padId:d,from:tr(),socket:{from:u.id,to:n}}},(e=>{}))},receiveMessage:e=>{const t=e.from,n=e.data,r=n.type;if(t!==tr())if("hangup"===r)p.hangup(t,!0);else if("offer"===r){a[t]?(p.hangup(t,!0),p.createPeerConnection(t,n.headerId)):p.createPeerConnection(t,n.headerId),cr.localstream&&(a[t].getLocalStreams?a[t].getLocalStreams().length||cr.localstream.getTracks().forEach((e=>{a[t].addTrack(e,cr.localstream)})):a[t].localStreams&&(a[t].localStreams.length||cr.localstream.getTracks().forEach((e=>{a[t].addTrack(e,cr.localstream)}))));const e=new RTCSessionDescription(n.offer);a[t].setRemoteDescription(e,(()=>{a[t].createAnswer((e=>{e.sdp=On(e.sdp),a[t].setLocalDescription(e,(()=>{p.sendMessage(t,{type:"answer",answer:e,headerId:n.headerId})}),l)}),l,o)}),l)}else if("answer"===r){if(a[t]){const e=new RTCSessionDescription(n.answer);a[t].setRemoteDescription(e,(()=>{}),l)}}else if("icecandidate"===r){if(a[t]){const e=new RTCIceCandidate(n.candidate),r=a[t].addIceCandidate(e);r&&r.then((()=>{})).catch((()=>{console.error("[wrtc]: Failure during addIceCandidate()",n)}))}}else console.error("[wrtc]: unknown message",n)},hangupAll:e=>{Object.keys(a).forEach((t=>{p.hangup(t,!0,e)}))},hangup:(e,t=!1,n)=>{t=!!e||t,a[e]&&e!==tr()&&(p.setStream(e,""),a[e].close(),delete a[e],t&&p.sendMessage(e,{type:"hangup",headerId:n}))},call:(e,t)=>{if(!cr.localstream)return;let n={optional:[],mandatory:{}};for(const e in n.mandatory)-1!==e.indexOf("Moz")&&delete n.mandatory[e];n=((e,t)=>{const n=e;for(const e in t.mandatory)n.mandatory[e]=t.mandatory[e];return n.optional.concat(t.optional),n})(n,o),a[e]||p.createPeerConnection(e,t),cr.localstream.getTracks().forEach((t=>{a[e].addTrack(t,cr.localstream)})),a[e].createOffer((n=>{n.sdp=On(n.sdp),a[e].setLocalDescription(n,(()=>{p.sendMessage(e,{type:"offer",offer:n,headerId:t})}),l)}),l,n)},createPeerConnection:(t,o)=>{a[t]&&console.warn("WARNING creating PC connection even though one exists",t),a[t]=new RTCPeerConnection(n,r),a[t].onicecandidate=n=>{n.candidate?p.sendMessage(t,{type:"icecandidate",headerId:o,candidate:n.candidate}):(e=0,u.emit("acceptNewCall",d,window.headerId))},a[t].oniceconnectionstatechange=()=>{console.info("[wrtc]: ICE state: ",a[t],a[t].iceConnectionState)},a[t].ontrack=e=>{console.info(e,"ontrack"),i[t]=e.streams[0],p.setStream(t,e.streams[0])},a[t].onremovestream=()=>{p.setStream(t,"")}},audioVideoInputChange:async()=>{await nr(),p.getUserMedia(window.headerId)},attachSinkId:(e,t)=>{e&&e[0]&&void 0!==e[0].sinkId?e[0].setSinkId(t).then((()=>{})).catch((e=>{let t=e;"SecurityError"===e.name&&(t=`\n                You need to use HTTPS for selecting audio output device: ${e}\n              `),console.error(t),null.selectedIndex=0})):(console.warn("Browser does not support output device selection."),$(document).find(".select.audioOutputSec").hide())},changeAudioDestination:()=>{const e=document.querySelector(".select.audioOutputSec select");if(!e)return;const t=e.value,n=c;p.attachSinkId(n,t)},getUserMedia:async e=>{$("#wrtc_modal #networkError").removeClass("active").hide();const t=await qn().catch((async t=>{console.error(t),sr.emit("enable room buttons",e,"LEAVE","VIDEO"),sr.emit("componentsFlow","video","open",!1),await nr(),p.showUserMediaError(t,tr(),e)}));cr.localstream=t,p.setStream(tr(),t),p._pad.collabClient.getConnectedUsers().forEach((t=>{t.userId!==tr()&&(a[t.userId]&&p.hangup(t.userId,!1,e),p.call(t.userId,e))}))},attemptToReconnect:()=>{if(e++,console.info("[wrtc]: Try reconnecting",e,60),60<=e)throw u.emit("acceptNewCall",d,window.headerId),new Error("[wrtc]: please reload the video chat and try again to connect!");var t,n;setTimeout((()=>{console.info("[wrtc]: reconnecting..."),p.getUserMedia(window.headerId)}),(t=200,n=1e3,Math.floor(Math.random()*(n-t+1)+t)))}},l=e=>{p.attemptToReconnect(),console.error("[wrtc]: LogError:",e),$("#wrtc_modal #networkError").show().addClass("active").text(`[wrtc]: Error: ${e} ,Reload the session.`)};return p.pc=a,p})();let An=null,Ln=null,Dn={},$n=0,jn=null,Nn=null;const Bn={startTime:0,latency:0,LMin:0,LMax:0,avg:0,LineAvg:[],colors:{normal:"#fff",warning:"#ffcc00",danger:"#cc3300"},interavCheck:1e3},Fn=(e,t,n)=>!!(e&&e.present<=$n)||((t=t||!0)&&!n&&$.gritter.add({title:"Video chat Limitation",text:`\n          The video chat room has reached its limit. \r\n\n          The size of this video chat room is ${$n}.\n          (If this seems wrong, please share the problem with the support team.)\n        `,sticky:!1,class_name:"error",time:"5000"}),!1),Vn=(e,t)=>{if(!e||!e.userId)return!1;const n=e.headerId,r=rr(e.userId);if(!r)return!0;const o=t.present;if($(`.header_videochat_icon[data-id='${n}'] .icon .userCount`).text(o),0===o&&$(`.header_videochat_icon[data-id='${n}'] .icon .userCount`).text(""),$(`.header_videochat_icon[data-id='${n}'] .icon`).addClass("active"),e.userId===clientVars.userId){window.headerId=e.headerId,Nn=setInterval((()=>{Bn.startTime=Date.now(),An.emit("pingil",Ln,window.headerId,tr(),Bn.avg)}),Bn.interavCheck);const o=ar(n).$inlineIcon();o&&o.querySelector(".btn_roomHandler").classList.add("active"),Mn.activate(e.headerId,r.userId),$("#wrtc_modal").css({transform:"translate(-50%, 0)",opacity:1}).attr({"data-active":!0}),sr.emit("enable room buttons",n,"JOIN",jn),sr.emit("componentsFlow","video","open",!0),Dn.userId||1!==t.present||An.emit("acceptNewCall",Ln,window.headerId),Dn=e,sr.emit("updateWrtcToolbarModal",n,t)}sr.emit("update store",e,n,"JOIN","VIDEO",t)},Un=async(e,t,n=!0,r=!1)=>(console.info("[wrtc]: gateway user joining,",e,t,n),e?e&&Fn(t,n,r)||r?Vn(e,t):(await nr(),!1):Fn(null,!1,!1)),zn=()=>clearInterval(Nn),Gn=()=>{navigator.mediaDevices.enumerateDevices().then((e=>{const t=localStorage.getItem("videoSettings"),{microphone:n,speaker:r,camera:o}=JSON.parse(t),i=document.querySelector(".select.audioSource select"),a=document.querySelector(".select.audioOutputSec select"),s=document.querySelector(".select.videoSource select"),c=document.createElement("select"),d=document.createElement("select"),u=document.createElement("select");for(const t of e){const e=document.createElement("option"),{deviceId:p,label:l,kind:f}=t;e.value=p,"audioinput"===f?(e.text=l||`microphone ${i?i.length+1:"1"}`,n===p&&(e.selected=!0),c.appendChild(e)):"audiooutput"===f?(e.text=l||`speaker ${a?a.length+1:"1"}`,r===p&&(e.selected=!0),d.appendChild(e)):"videoinput"===f&&(e.text=l||`camera ${s?s.length+1:"1"}`,o===p&&(e.selected=!0),u.appendChild(e))}$(i).remove(),$(a).remove(),$(s).remove(),$(".select.audioSource").append(c),$(".select.audioOutputSec").append(d),$(".select.videoSource").append(u)}))},qn=()=>{const e=document.querySelector("#wrtc_settings .select.audioSource"),t=document.querySelector("#wrtc_settings .select.audioOutputSec"),n=document.querySelector("#wrtc_settings .select.videoSource"),r=e?e.value:void 0,o=n?n.value:void 0,i=t?t.value:void 0,a={audio:!0,video:{width:320,height:240,frameRate:{ideal:15,max:30},facingMode:"user"}};r&&(a.audio.deviceId={exact:r}),o&&(a.video.deviceId={exact:o});const s={microphone:r,speaker:i,camera:o};return localStorage.setItem("videoSettings",JSON.stringify(s)),window.navigator.mediaDevices.getUserMedia(a)},Hn=(e,t)=>{Dn={},$("#wrtc_modal").css({transform:"translate(-50%, -100%)",opacity:0}).attr({"data-active":!1}),sr.emit("componentsFlow","video","open",!1),An.removeListener(`receiveTextMessage:${t}`),Mn.deactivate(e,t),zn(),window.headerId=null,sr.emit("update store",{},t,"LEAVE","VIDEO",{}),sr.emit("enable room buttons",t,"LEAVE","VIDEO"),Mn.userLeave(e),$(".header_videochat_icon .userCount").text("")},Wn=(e,t,n)=>{(async(e,t,n)=>{if(!e||!t||!e.userId)return!1;const r=e.headerId,o=t.present;if($(`.header_videochat_icon[data-id='${r}'] .icon .userCount`).text(o),0===o&&$(`.header_videochat_icon[data-id='${r}'] .icon .userCount`).text(""),e.userId===clientVars.userId){ir().find(`#wrtcVideoIcons #${r}`).removeClass("active"),Mn.deactivate(e.userId,e.headerId),zn(),window.headerId=null;const t=ar(r).$inlineIcon();t&&t.querySelector(".btn_roomHandler").classList.remove("active"),Dn={},$("#wrtc_modal").css({transform:"translate(-50%, -100%)",opacity:0}).attr({"data-active":!1}),sr.emit("componentsFlow","video","open",!1),await nr(),An.removeListener(`receiveTextMessage:${e.headerId}`)}n&&"function"==typeof n&&n(),sr.emit("update store",e,r,"LEAVE","VIDEO",t),sr.emit("enable room buttons",r,"LEAVE",jn),Mn.userLeave(e.userId)})(e,t,n)},Jn=async(e,t,n)=>{ir().find("button.btn_joinChat_chatRoom").removeClass("active"),jn=n;const r=window.pad.collabClient.getConnectedUsers().map((e=>e.userId));if(!Dn.userId)return An.emit("userJoin",Ln,r,t,"video",Un);An.emit("userLeave",Ln,Dn,"video",((e,n)=>{Wn(e,n,(()=>{An.emit("userJoin",Ln,r,t,"video",Un)}))}))},Kn=(e,t,n)=>{if(!t||!t.userId)return sr.emit("enable room buttons",e,"LEAVE",jn),!1;An.emit("reloadVideoSession",Ln,e)},Yn=(e,t,n)=>{jn=n,An.emit("userLeave",Ln,t,"video",Wn)},Xn=(e,t,n,r)=>{An=n,Ln=r,$n=2e3,sr.emit("componentsFlow","video","init",!0),An.on("userLatency",(e=>{if(tr()!==e.userId){const t=`interface_video_${e.userId.replace(/\./g,"_")}`;let n=Bn.colors.normal;e.latency>200&&e.latency<300&&(n=Bn.colors.warning),e.latency>300&&(n=Bn.colors.danger),$(document).find(`#${t} .latency`).css({color:n}).text(`${Math.ceil(e.latency)}ms`)}})),An.on("pongol",(e=>{Bn.latency=Date.now()-Bn.startTime,Bn.LMin<=Bn.latency&&Bn.latency>=Bn.LMax?Bn.LMax=Bn.latency:Bn.LMin=Bn.latency,Bn.LineAvg.length<4?Bn.LineAvg.push((Bn.LMax+Bn.LMin)/2):(Bn.avg=Bn.LineAvg.reduce(((e,t)=>e+t))/Bn.LineAvg.length,Bn.LineAvg=[],Bn.LMax=0);let t=Bn.colors.normal;Bn.avg>200&&Bn.avg<300&&(t=Bn.colors.warning),Bn.avg>300&&(t=Bn.colors.danger),$(document).find(".video-container.local-user .latency").css({color:t}).text(`${Math.ceil(Bn.avg)}ms`)})),An.on("reloadVideoSession",(e=>{if(Dn.headerId!==e)return!1;const t="PLUS",n={padId:clientVars.padId||window.pad.getPadId(),userId:clientVars.userId||window.pad.getUserId(),userName:clientVars.userName||"anonymous",headerId:e,target:t,action:"JOIN"};sr.emit("disable room buttons",e,"JOIN",t),Jn(0,n,t)}))},Zn=e=>e?`/static/getUserProfileImage/${e}/${window.pad.getPadId()}?t=${(new Date).getTime()}`:"../static/plugins/ep_profile_modal/static/img/user.png",Qn=["h1","h2","h3","h4"],er=function(e=""){if(""===e)return"";let t=window.decodeURIComponent(e);return t=t.trim().replace(/\s/g,""),/^(:\/\/)/.test(t)?`http${t}`:/^(f|ht)tps?:\/\//i.test(t)?t:`http://${t}`},tr=()=>clientVars.userId||window.pad.getUserId(),nr=e=>new Promise(((e,t)=>{const n=cr.localstream;n||e(),n.getTracks().forEach((e=>{e.stop(),n.removeTrack(e)})),cr.localstream=null,e()})),rr=e=>{const t={name:"anonymous",userId:e,colorId:"#FFF"};if(!window.pad||!window.pad.collabClient)return t;const n=window.pad.collabClient.getConnectedUsers().filter((t=>t.userId===e));return n.length>0?n[0]:t},or=e=>e.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\--+/g,"-").replace(/^-+/,"").replace(/-+$/,""),ir=()=>$(document).find('iframe[name="ace_outer"]').contents(),ar=e=>{const t=ir().find("iframe").contents().find("#innerdocbody").find(`.heading.${e}`);return{exist:t.length,$el:t,text:t.text(),tag:t.attr("data-htag"),offset:{top:()=>ur(t),left:()=>pr(t)},$inlineIcon:()=>t.find("wrt-inline-icon").length?t.find("wrt-inline-icon")[0].shadowRoot:null}},sr={events:{},on:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},off:function(e,t){if(this.events[e])for(let n=0;n<this.events[e].length;n++)if(this.events[e][n]===t){this.events[e].splice(n,1);break}},emit:function(e){const t=arguments.length,n=Array(t>1?t-1:0);let r=1;for(r=1;r<t;r++)n[r-1]=arguments[r];this.events[e]&&this.events[e].forEach((e=>{e.apply(void 0,n)}))}},cr={enable:!0,epProfileState:!0,userInRoom:!1,currentOpenRoom:null,socketState:"CLOSED",socket:null,localstream:null,components:{video:{init:!1,open:!1},room:{init:!1,open:!1},wrtc:{init:!1,open:!1}},rooms:new Map,globalVar:{},staticVar:{webSocket:{DISCONNECTED:"DISCONNECTED",OPENED:"OPENED"}}};sr.on("plugin enable",(e=>{ir().find("iframe").contents().find("#innerdocbody").find(".heading wrt-inline-icon").each(((t,n)=>{n.shadowRoot.querySelector(".btn_roomHandler").style.display=e?"flex":"none"})),ir().find("#outerdocbody").find("#wbrtc_avatarCol")[0].style.display=e?"flex":"none",e||(Yn(window.headerId,sr.currentOpenRoom,"PLUS"),sr.currentOpenRoom=null),cr.enable=e})),sr.on("update network information",(()=>{})),sr.on("socket state",(e=>{cr.socketState=e,console.info("[wrtc]: socket state has been change, new state:",e,cr.userInRoom,window.headerId),"OPENED"===e&&cr.userInRoom&&(console.info("Try reconnecting..."),WRTC.attemptToReconnect())})),sr.on("componentsFlow",((e,t,n)=>{cr.components[e][t]=n})),sr.on("update inlineAvatar info",((e,t)=>{clientVars.webrtc.displayInlineAvatar&&dr.update(e,t)})),sr.on("update store",((e,t,n,r,o,i)=>{if(!(e&&t&&n&&o&&r))return!1;cr.rooms.has(t)||cr.rooms.set(t,{VIDEO:{list:[]},TEXT:{list:[]},USERS:{},headerCount:0});const a=cr.rooms.get(t);let s=a.USERS;a[r]=o,s={},a.VIDEO.list&&a.VIDEO.list.forEach((e=>{s[e.userId]||(s[e.userId]={}),s[e.userId]=e})),dr[r](t,a[r]),dr.ROOM(t,s),cr.rooms.set(t,a),i&&i(a)})),sr.on("disable room buttons",((e,t,n)=>{const r=$("#header_videochat_icon")[0];r&&(r.classList.add("activeLoader"),r.setAttribute("disabled",!0))})),sr.on("enable room buttons",((e,t,n)=>{const r=$("#header_videochat_icon")[0];if(!r)return;const o="JOIN"===t?"LEAVE":"JOIN";r.removeAttribute("disabled"),r.setAttribute("data-action",o),r.classList.remove("activeLoader")})),sr.on("updateWrtcToolbarModal",((e,t)=>{const n=ar(e).text;$("#wrtc_modal .btn_roomHandler, #werc_toolbar p").attr("data-id",e),$("#wrtc_modal .nd_title .title").html(n)})),sr.on("updateWrtcToolbarTitleModal",((e,t)=>{t===window.headerId&&($(`#werc_toolbar .nd_title .titleb[data-id='${t}'`).html(e),$(document).find(`.wrtc_roomLink[data-id='${t}']`).text(e))}));const dr={ROOM:(e,t)=>{if(!clientVars.webrtc.displayInlineAvatar)return;const n=clientVars.webrtc.inlineAvatarLimit||4;let r=ir().find(`#wbrtc_avatarCol .${e}.wrtcIconLine .wrtc_inlineAvatars`);const o=ar(e).offset.top()-16;if(!r.length){const t=$("#wrtcLinesIcons").tmpl({headerId:e,offsetTop:o,userId:clientVars.userId});r=ir().find("#wbrtc_avatarCol").append(t),r=r.find(`.${e}.wrtcIconLine .wrtc_inlineAvatars`)}const i=ir().find("#wbrtc_avatarCol .wrtc_inlineAvatars");r.find(".avatar").remove(),Object.keys(t).forEach(((e,o)=>{const a=rr(t[e].userId)||{colorId:"",name:"anonymous"};if(a.userId)if(i.find(`.avatar[data-id="${a.userId}"]`).remove(),o<n){const e=a.name||"anonymous";r.find(".avatarMore").hide(),r.append(`\n            <div\n              class="avatar btn_roomHandler"\n              data-join="popup"\n              data-action="USERPROFILEMODAL"\n              data-id="${a.userId}"\n            >\n              <div\n                title='${e}'\n                style="\n                  background: url('${Zn(a.userId)}') no-repeat 50% 50%;\n                  background-size : cover;"\n              >\n              </div>\n            </div>`)}else r.find(".avatarMore").show().text("+"+(o+1-n))}))},VIDEO:function(e,t){const n=$(document).find("#werc_toolbar .wrtc_inlineAvatars");clientVars.webrtc.displayInlineAvatar?(n.show(),n.find(".avatar").remove(),this._append(t.list,n)):n.hide()},_append:(e,t)=>{if(!e)return;const n=clientVars.webrtc.inlineAvatarLimit||4;e.forEach(((e,r)=>{const o=rr(e.userId)||{colorId:"",name:"anonymous"};if(o.userId)if(r<n){const e=o.name||"anonymous";t.find(".avatarMore").hide(),t.append(`\n          <div\n            class="avatar btn_roomHandler"\n            data-join="popup"\n            data-action="USERPROFILEMODAL"\n            data-id="${o.userId}"\n          >\n            <div\n              title='${e}'\n              style="\n                background: url('${Zn(o.userId)}') no-repeat 50% 50%;\n                background-size : cover;\n              "\n            >\n              </div>\n          </div>`)}else t.find(".avatarMore").show().text("+"+(r+1-n))}))},update:(e,t)=>{if(!clientVars.webrtc.displayInlineAvatar)return;const n=ir().find("#wrtcVideoIcons .wrtcIconLine .wrtc_inlineAvatars"),r=$(document).find("#werc_toolbar .wrtc_inlineAvatars");n&&n.find(`.avatar[data-id="${e}"] img`).attr({src:t.imageUrl,title:t.userName}),r&&r.find(".avatar img").attr({src:t.imageUrl,title:t.userName})}},ur=e=>{if(!e.length)return;const t=e.outerHeight(),n=ir().find('iframe[name="ace_inner"]').css("padding-top"),r=parseInt(n,10);return Math.ceil(e.offset().top+r)+t/2},pr=e=>{if(!e.length)return;const t=e.outerWidth(),n=ir().find('iframe[name="ace_inner"]'),r=n.css("padding-left"),o=parseInt(r,10);return Math.ceil(n.offset().left-o)-t-6};var lr=Object.freeze({__proto__:null,hElements:["h1","h2","h3","h4","h5","h6",".h1",".h2",".h3",".h4",".h5",".h6"],hTags:Qn,getValidUrl:er,getUserId:tr,stopStreaming:nr,getUserFromId:rr,slugify:or,$bodyAceOuter:ir,createShareLink:(e,t="headerText")=>`${window.location.origin+window.location.pathname}?header=${or(t)}&id=${e}&target=video&join=true`,findAceHeaderElement:ar,wrtcPubsub:sr,wrtcStore:cr,inlineAvatar:dr,getHeaderRoomY:ur,getHeaderRoomX:pr});var fr=(()=>{let e=null,t=null,n=0,r=0;const o=e=>{const t=$('iframe[name="ace_outer"]').contents().find("iframe").contents().find(`.${e}`);if(0===t.length)return!1;t[0].scrollIntoView({behavior:"smooth"})};function i(e){const t=$(this).attr("data-id")||e,n=pad.getPadId();$.ajax({url:`/static/${n}/pluginfw/ep_profile_modal/getUserInfo/${t}`,type:"get",data:{},contentType:!1,processData:!1,beforeSend:()=>{$("#ep_profile_users_profile_userImage").css({"background-position":"50% 50%","background-image":"url(../static/plugins/ep_profile_modal/static/dist/img/loading.gif)","background-repeat":"no-repeat","background-size":"69px"}),$("#ep_profile_users_profile_name").text(""),$("#ep_profile_users_profile_desc").text(""),$("#ep_profile_users_profile").addClass("ep_profile_formModal_show"),$("#ep_profile_general_overlay").addClass("ep_profile_formModal_overlay_show"),$("#ep_profile_general_overlay").css({display:"block"})},error:e=>{$("#ep_profile_users_profile").removeClass("ep_profile_formModal_show"),$("#ep_profile_general_overlay").removeClass("ep_profile_formModal_overlay_show"),$("#ep_profile_general_overlay").css({display:"none"}),$("#ep_profile_modal").removeClass("ep_profile_modal-show"),$("#ep_profile_modal_user_list").removeClass("ep_profile_modal-show"),$("#ep_profile_users_profile").removeClass("ep_profile_formModal_show")},success:e=>{const r=`/static/getUserProfileImage/${t}/${n}?t=${(new Date).getTime()}`;let o=e.user.username;o&&""!==o||(o="Anonymous");const i=e.user.about||"",a=e.user.homepage||"";$("#ep_profile_users_profile_name").text(o),$("#ep_profile_users_profile_desc").text(i),""===a?$("#ep_profile_users_profile_homepage").hide():$("#ep_profile_users_profile_homepage").attr({href:er(a),target:"_blank"}),$("#ep_profile_users_profile_userImage").css({"background-position":"50% 50%","background-image":`url(${r})`,"background-repeat":"no-repeat","background-size":"69px"})}})}function a(e,t,n){if("string"!=typeof e&&(e.preventDefault(),!e.handleObj.selector))return!1;if(t=$(this).attr("data-id")||t,e=$(this).attr("data-action")||e,n=$(this).attr("data-join")||n,!t||!n)return!0;if(!cr.enable)return void console.info("[wrtc]: Plugin disabled");const r=$(this).attr("href");if(r){new URL(r).pathname!==location.pathname&&(window.location=r)}const o={padId:clientVars.padId||window.pad.getPadId(),userId:clientVars.userId||window.pad.getUserId(),userName:clientVars.userName||"anonymous",headerId:t,target:n,action:e};if("OPENED"!==cr.socketState)return $.gritter.add({title:"Video chat no longer responds",text:"\n          The socket is disconnected and we can no longer make a stable call,\n          please go to stable internet and then reload the page.\n        ",sticky:!1,class_name:"error",time:"15000"}),!1;if("JOIN"===e)sr.currentOpenRoom=o,sr.emit("disable room buttons",t,e,n),((e,t,n)=>{t&&t.userId?Dn&&Dn.headerId===e?sr.emit("enable room buttons",e,"LEAVE",jn):Jn(0,t,n):sr.emit("enable room buttons",e,"LEAVE",jn)})(t,o,n);else if("LEAVE"===e)sr.currentOpenRoom=null,Yn(t,o,n);else if("RELOAD"===e)Kn(t,o);else if("SHARELINK"===e)!function(e,t){e=$(this).attr("data-id")||e,t=(t=$(this).attr("data-join")||t).toLowerCase();const n=ir().find("iframe").contents().find("#innerdocbody").find(`.heading.${e}`).text(),r=`${window.location.origin+window.location.pathname}?header=${or(n)}&id=${e}&target=${t}&join=true`,o=$("<input>");$("body").append(o),o.val(r).select(),document.execCommand("copy"),o.remove(),$.gritter.add({title:"Copied",text:"Join link copied to clip board",sticky:!1,"class_name":"copyLinkToClipboard",time:"3000"})}(t,n);else if("USERPROFILEMODAL"===e)i(t);else if("JOINBYQUERY"===e){const e=$(this).attr("href");s(e)}}const s=e=>{e=e||window.location.href;const t=new URLSearchParams(e),n=t.get("id");let i=t.get("target");const c=t.get("join");if(!n)return!0;const d=new URL(e).pathname.split("/").pop(),u=location.pathname.split("/").pop();if(!cr.rooms.get(n))return d!==u?window.location.href=e:($.gritter.add({title:"Error",text:"The header seems not to exist anymore!",time:3e3,sticky:!1,class_name:"error"}),!1);n&&o(n),"true"===c&&i&&(i=i.toUpperCase(),"CLOSED"===cr.socketState&&r<=4?setTimeout((()=>{console.warn(`[wrtc]: socket state is ${cr.socketState}, try to join again!`),r++,s()}),1500):"OPENED"===cr.socketState?setTimeout((()=>a("JOIN",n,i)),1e3):console.error(`\n          [wrtc]: We try to join ${r}th,\n          Joining by query string has problem!\n        `,cr.socketState,r))};document.addEventListener("onPushState",(e=>{const{state:t}=e.detail;if("hyperLink"===t.type){const e=t.href;s(e)}}));const c=()=>{const e=ir();e.on("click",".btn_roomHandler",a),e.find("iframe").contents().find("#innerdocbody").on("click","chat-inline-icon",(function(){const e=$(this).attr("headerid");$(document).find("#header_videochat_icon").attr({"data-action":"JOIN","data-id":e}),$(document).find(`#tocItems .itemRow.tocItem[sectionid='${e}']`).trigger("click")})),$(document).on("click","#toc .itemRow.tocItem",(function(){const e=$(this).attr("sectionid"),t=cr.rooms.get(e);if(!t)return console.error("[wrtc]: room does not founded!",e,t),!1;$(".header_videochat_icon").attr("data-id",e),$(".header_videochat_icon .icon").removeClass("active"),$(".header_videochat_icon .icon .userCount").text("");const n=0===t.VIDEO.present?"":t.VIDEO.present;$(".header_videochat_icon .icon .userCount").text(n);t.VIDEO.list&&t.VIDEO.list.find((e=>e.userId===clientVars.userId))&&$(".header_videochat_icon .icon").addClass("active")})),$(document).on("click",".btn_roomHandler, .wrtc_roomLink",a),$(document).on("mouseenter",".video-container.local-user",(()=>{$(document).find("#wrtc_modal #networkStatus").addClass("active")})).on("mouseleave",".video-container.local-user",(()=>{$(document).find("#wrtc_modal #networkStatus").removeClass("active")})),$(document).on("click","#werc_toolbar p",(function(){const e=$(this).attr("data-id");o(e)})),$(document).on("click","#werc_toolbar .btn_enlarge",(function(){if(!$(this).attr("active"))return!0;$(this).toggleClass("large"),$("#wrtc_modal .video-container .enlarge-btn").each((function(){$(this).trigger("click")}))})),$(document).on("click","#werc_toolbar .btn_videoSetting",(function(){const e=$(this).position(),t=$(document).find("#wrtc_settings"),n=t.outerWidth();t.css({left:e.left-n+"px",top:`${e.top+4}px`}).toggleClass("active")}))},d={joinByQueryString:s,roomBtnHandler:a,userLeave:(e,t)=>{},postAceInit:(r,o,i,a)=>{e=i,t=a,n=clientVars.webrtc.videoChatLimit,sr.emit("componentsFlow","room","init",!0),e.on("userJoin",((e,t,n)=>{Un(e,t,!1)})),e.on("userLeave",((e,t,n)=>{Wn(e,t,n)})),c(),setTimeout((()=>{s()}),500)},adoptHeaderYRoom:()=>{const e=ir();e&&e.find("#wbrtc_avatarCol .wrtcIconLine").each((function(){const e=$(this),t=e.attr("id"),n=ar(t).$el;if(n.length<=0)return e.remove(),!1;e.css({top:ur(n)-14+"px"})}))},appendVideoIcon:(r,o={createAgain:!1})=>{if(!r)return!1;const i=cr.rooms.has(r);if(!o.createAgain&&i)return!1;const a=ar(r);if(!i&&a.exist){const o=ir().find("iframe").contents().find("#innerdocbody").children("div").find(`.heading.${r}`),i=ir().find('iframe[name="ace_inner"]').offset(),a=ir().find("#outerdocbody"),s=(e=>{const t=e.outerHeight(),n=ir().find('iframe[name="ace_inner"]').css("padding-top"),r=parseInt(n,10);return Math.ceil(e.offset().top+r)+t/2-22})(o),c=Math.ceil(i.left),d=o.parent().parent().prevAll().length,u={headingTagId:r,positionTop:s,positionLeft:c,headTitle:o.text(),lineNumber:d,videoChatLimit:n,userId:clientVars.userId};cr.rooms.set(r,{VIDEO:{list:[]},USERS:{},headerCount:0});const p=$("#wrtcLinesIcons").tmpl(u);a.find("#wrtcVideoIcons").append(p),e.emit("getVideoRoomInfo",t,r,(e=>{e&&dr.ROOM(r,e)}))}d.adoptHeaderYRoom()},syncVideoAvatars:n=>{if(!e)return!1;e.emit("getVideoRoomInfo",t,n,(e=>{e&&dr.ROOM(n,e)}))}};return d})();exports.aceDomLineProcessLineAttributes=(e,t)=>{const n=t.cls,r=/(?:^| )headerId:([A-Za-z0-9]*)/.exec(n),o=[];if(void 0===lr)return o;if(r){const e=/(?:^| )heading:([A-Za-z0-9]*)/.exec(n),t=r[1],i=e&&e[1];if(cr.components.video.open){const e=ar(t);sr.emit("updateWrtcToolbarTitleModal",e.text,t)}const a={preHtml:"",postHtml:`<chat-inline-icon headerid="${t}" ${$("body").hasClass("mobileView")?"mobile":"desktop"}></chat-inline-icon>`,processedMarker:!0};cr.rooms.set(t,{VIDEO:{list:[]},USERS:{},headerCount:0}),i&&Qn.includes(i)&&o.push(a)}return o},exports.aceEditEvent=(e,t)=>{const n=t.callstack.editEvent.eventType;"handleClick,idleWorkTimer,setup,importText,setBaseText,setWraps".includes(n)||t.callstack.domClean&&fr.adoptHeaderYRoom()},exports.aceEditorCSS=()=>{const e=clientVars.webrtc.version||1;return $("body").hasClass("mobileView")?[`ep_wrtc_heading/static/dist/css/innerLayer_mobile.css?v=${e}`]:[`ep_wrtc_heading/static/dist/css/innerLayer.css?v=${e}`]},exports.acePostWriteDomLineHTML=(e,t)=>{const n=$(t.node).find(":header");if(n.length){const e=n.attr("data-id");setTimeout((()=>{fr.syncVideoAvatars(e)}),250)}},exports.handleClientMessage_RTC_MESSAGE=(e,t)=>{Mn.handleClientMessage_RTC_MESSAGE(e,t)},exports.postAceInit=(e,t)=>{if(!localStorage.getItem("videoSettings")){const e=JSON.stringify({microphone:null,speaker:null,camera:null});localStorage.setItem("videoSettings",e)}clientVars.plugins.plugins.ep_profile_modal||(clientVars.webrtc.displayInlineAvatar=!1),window.clientVars.ep_profile_list={},(window.pad&&window.pad.socket).on("message",(e=>{if("COLLABROOM"===e.type&&e.data&&"CUSTOM"===e.data.type){const t=e.data.payload;"EP_PROFILE_USERS_LIST"===t.action&&t.list.forEach((e=>{window.clientVars.ep_profile_list[e.userId]||(window.clientVars.ep_profile_list[e.userId]={}),window.clientVars.ep_profile_list[e.userId]=e})),"EP_PROFILE_USER_LOGIN_UPDATE"===t.action&&(window.clientVars.ep_profile_list[t.userId]=t,lr&&sr&&sr.emit("update inlineAvatar info",t.userId,t))}}));t.ace;const n=window.pad.getUserId()||clientVars.padId,r=window.pad.getPadId()||clientVars.userId;if(!clientVars.userId||!clientVars.padId)throw new Error("[wrtc]: clientVars doesn't exists");const o=((e,t,n)=>{let r=kn;const{webSocket:{OPENED:o,DISCONNECTED:i}}=cr.staticVar,a=document.location,s=""===a.port?"https:"===a.protocol?443:80:a.port;let c=clientVars.webrtc.socketRemoteAddress;(clientVars.webrtc.useEtherpadSocket||"localhost"===a.hostname)&&(r=io,c=`${a.protocol}//${a.hostname}:${s}`),c=`${c}/${clientVars.webrtc.socketNamespace}`,console.info(`socket address: ${c}`);const d=r.connect(c,{reconnectionDelay:1e3,autoConnect:!0,reconnection:!0,transports:["websocket"]});return d.on("connect",(()=>{d.emit("join pad",t,n),sr.emit("socket state",o,d)})),d.on("disconnect",(e=>{console.error("[wrtc]: socket disconnection, reason:",e),sr.emit("socket state",i,d)})),d.on("connect_error",(e=>{console.error("[wrtc]: socket connect_error:",e),sr.emit("socket state",i,d)})),d})(0,r,n);Mn.postAceInit(e,t,o,r),Xn(0,0,o,r),fr.postAceInit(e,t,o,r),$("#editorcontainer iframe").ready((()=>{Mn.appendVideoModalToBody()})),$("#options-wrtc-heading").on("change",(e=>{$("#options-wrtc-heading").is(":checked")?sr.emit("plugin enable",!0):sr.emit("plugin enable",!1)})),window.onerror=(e,t,n,r,o)=>{console.error("[wrtc]: windows error, close stream"),window.headerId&&Hn(clientVars.userId,window.headerId)};const i=$('iframe[name="ace_outer"]').contents().find("#outerdocbody");if(i.find("#wbrtc_avatarCol").length)return!1;i.prepend('<div id="wbrtc_avatarCol" class="usersIconList"></div>'),$(window).resize(F(fr.adoptHeaderYRoom,250))},exports.userLeave=(e,t)=>{Mn.userLeave(null,t)};//# sourceMappingURL=bundle.js.map
