{"version":3,"sources":["adapter.js","getUserMediaPolyfill.js","jquery.tmpl.min.js","getStats.min.js","clientShare.js","copyPasteEvents.js","codecsHandler.js","textChat.js","videoChat.js","webrtcRoom.js","webrtc.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","adapter","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","1","adapterFactory","./adapter_factory.js","2","Object","defineProperty","value","_ref","arguments","undefined","options","shimChrome","shimFirefox","shimEdge","shimSafari","logging","utils","log","browserDetails","detectBrowser","commonShim","extractVersion","disableLog","disableWarnings","browser","chromeShim","shimPeerConnection","browserShim","shimGetUserMedia","shimMediaStream","shimOnTrack","shimAddTrackRemoveTrack","shimGetSendersWithDtmf","shimGetStats","shimSenderReceiverGetStats","fixNegotiationNeeded","shimRTCIceCandidate","shimConnectionState","shimMaxMessageSize","shimSendThrowTypeError","removeAllowExtmapMixed","firefoxShim","shimRemoveStream","shimSenderGetStats","shimReceiverGetStats","shimRTCDataChannel","edgeShim","shimGetDisplayMedia","shimReplaceTrack","safariShim","shimRTCIceServerUrls","shimCreateOfferLegacy","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","_interopRequireWildcard","obj","__esModule","newObj","key","prototype","hasOwnProperty","default","./chrome/chrome_shim","./common_shim","./edge/edge_shim","./firefox/firefox_shim","./safari/safari_shim","./utils","3","_typeof","Symbol","iterator","constructor","_getusermedia","enumerable","get","_getdisplaymedia","MediaStream","webkitMediaStream","RTCPeerConnection","_ontrack","set","removeEventListener","addEventListener","configurable","origSetRemoteDescription","setRemoteDescription","_this","_ontrackpoly","stream","te","receiver","getReceivers","find","track","id","event","Event","transceiver","streams","dispatchEvent","getTracks","forEach","apply","wrapPeerConnectionEvent","shimSenderWithDtmf","pc","dtmf","_dtmf","kind","createDTMFSender","_pc","getSenders","_senders","slice","origAddTrack","addTrack","sender","push","origRemoveTrack","removeTrack","idx","indexOf","splice","origAddStream","addStream","_this2","origRemoveStream","removeStream","_this3","s","RTCRtpSender","origGetSenders","_this4","senders","origGetStats","getStats","_this5","_arguments","Array","selector","onSucc","onErr","fixChromeStats_","response","standardReport","result","report","standardStats","timestamp","type","localcandidate","remotecandidate","names","name","stat","makeMapStats","stats","Map","keys","map","successCallbackWrapper_","Promise","resolve","reject","then","RTCRtpReceiver","_this6","filterStats","origGetReceivers","_this7","receivers","srcElement","MediaStreamTrack","err","DOMException","shimAddTrackRemoveTrackWithNative","version","origGetLocalStreams","getLocalStreams","_this11","nativeStreams","_reverseStreams","_this12","_streams","newStream","replaceInternalStreamId","description","sdp","internalId","externalStream","internalStream","replace","RegExp","RTCSessionDescription","replaceExternalStreamId","_this13","signalingState","alreadyExists","oldStream","method","nativeMethod","methodObj","_defineProperty","_this14","args","isLegacyCall","desc","origSetLocalDescription","setLocalDescription","origLocalDescription","getOwnPropertyDescriptor","_this15","streamid","webkitRTCPeerConnection","RTCIceCandidate","nativeAddIceCandidate","addIceCandidate","candidate","target","writable","_this8","_shimmedLocalStreams","streamId","_this9","existingSenders","newSenders","filter","newSender","concat","_this10","../utils.js","./getdisplaymedia","./getusermedia","4","getSourceId","navigator","mediaDevices","console","error","getDisplayMedia","constraints","sourceId","widthSpecified","video","width","heightSpecified","height","frameRateSpecified","frameRate","mandatory","chromeMediaSource","chromeMediaSourceId","maxFrameRate","maxWidth","maxHeight","getUserMedia","5","constraintsToChrome_","optional","cc","ideal","exact","min","max","oldname_","prefix","charAt","toUpperCase","oc","mix","advanced","shimConstraints_","func","JSON","parse","stringify","audio","remap","b","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","matches","enumerateDevices","devices","dev","d","some","match","label","toLowerCase","includes","deviceId","shimError_","PermissionDeniedError","PermissionDismissedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","message","constraint","constraintName","toString","onSuccess","onError","webkitGetUserMedia","bind","origGetUserMedia","cs","getAudioTracks","getVideoTracks","stop","6","NativeRTCIceCandidate","substr","nativeCandidate","parsedCandidate","_sdp2","parseCandidate","augmentedCandidate","assign","toJSON","sdpMid","sdpMLineIndex","usernameFragment","_sctp","sctpInDescription","sections","splitSections","shift","mediaSection","mLine","parseMLine","protocol","getRemoteFirefoxVersion","parseInt","getCanSendMaxMessageSize","remoteIsFirefox","canSendMaxMessageSize","getMaxMessageSize","maxMessageSize","matchPrefix","getConfiguration","sdpSemantics","isFirefox","canSendMMS","remoteMMS","Number","POSITIVE_INFINITY","Math","sctp","wrapDcSend","dc","origDataChannelSend","send","data","size","byteLength","readyState","TypeError","origCreateDataChannel","createDataChannel","dataChannel","channel","proto","completed","checking","iceConnectionState","_onconnectionstatechange","cb","origMethod","_connectionstatechangepoly","_lastConnectionState","connectionState","newEvent","nativeSRD","split","line","trim","join","_sdp","7","RTCIceGatherer","origMSTEnabled","ev","enabled","RTCDtmfSender","RTCDTMFSender","RTCPeerConnectionShim","_rtcpeerconnectionShim2","config","iceServers","_filtericeservers","filterIceServers","replaceTrack","setTrack","_rtcpeerconnectionShim","../utils","./filtericeservers","rtcpeerconnection-shim","8","edgeVersion","hasTurn","server","urls","url","deprecated","isString","validTurn","startsWith","9","10","catch","11","RTCTrackEvent","mozRTCPeerConnection","modernStatsTypes","inboundrtp","outboundrtp","candidatepair","nativeGetStats","DataChannel","RTCDataChannel","12","preferredMediaSource","mediaSource","13","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","14","_localStreams","_addTrack","index","tracks","getRemoteStreams","_remoteStreams","_onaddstream","_onaddstreampoly","origCreateOffer","createOffer","origCreateAnswer","createAnswer","successCallback","failureCallback","promise","withCallback","_getUserMedia","shimConstraints","errcb","OrigPeerConnection","pcConfig","pcConstraints","newIceServers","generateCertificate","offerOptions","offerToReceiveAudio","audioTransceiver","getTransceivers","direction","setDirection","addTransceiver","offerToReceiveVideo","videoTransceiver","compactObject","15","eventNameToWrap","wrapper","nativeAddEventListener","nativeEventName","wrappedCallback","modifiedEvent","_eventMap","nativeRemoveEventListener","unwrappedCb","bool","logDisabled_","deprecationWarnings_","oldMethod","newMethod","warn","mozGetUserMedia","userAgent","isSecureContext","supportsUnifiedPlan","RTCRtpTransceiver","isObject","reduce","accumulator","isObj","isEmptyObject","walkStats","outbound","streamStatsType","filteredResult","trackStats","trackIdentifier","trackStat","trackId","uastring","expr","pos","val","base","resultSet","has","endsWith","16","SDPUtils","writeMediaSection","caps","dtlsRole","writeRtpDescription","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","rtpSender","rtpReceiver","_initialTrackId","msid","sendEncodingParameters","ssrc","rtx","localCName","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","clockRate","numChannels","rtcpFeedback","fb","j","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","action","offer","answer","maybeAddCandidate","iceTransport","alreadyAdded","getRemoteCandidates","remoteCandidate","foundation","ip","port","priority","addRemoteCandidate","makeError","NotSupportedError","InvalidAccessError","OperationError","addTrackToStreamAndFireEvent","MediaStreamTrackEvent","fireAddTrack","trackEvent","setTimeout","_dispatchEvent","_eventTarget","document","createDocumentFragment","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","_localDescription","_remoteDescription","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","_iceGatherers","iceCandidatePoolSize","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","_isClosed","[object Object]","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","_emitGatheringStateChange","_createTransceiver","doNotAdd","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","_maybeFireNegotiationNeeded","clonedStream","clone","clonedTrack","_createIceGatherer","bufferedCandidateEvents","bufferCandidates","end","state","_gather","onlocalcandidate","evt","cand","component","ufrag","serializedCandidate","writeCandidate","getMediaSections","getDescription","complete","every","RTCIceTransport","onicestatechange","_updateIceConnectionState","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","recv","params","encodings","rtcp","cname","compound","rtcpParameters","receive","sessionpart","parseRtpParameters","isIceLite","isRejected","rejected","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","role","start","_updateSignalingState","receiverList","iceOptions","lines","splitLines","getKind","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","setTransport","setRemoteCandidates","getCapabilities","codec","isNewTrack","nativeTrack","removeTrackFromStreamAndFireEvent","sid","item","close","newState","states","new","closed","connected","disconnected","failed","connecting","numAudioTracks","numVideoTracks","writeSessionBoilerplate","remoteCodec","hdrExt","rHdrExt","getLocalCandidates","mediaSectionsInOffer","localTrack","reducedSize","candidateString","senderOrReceiver","promises","all","allStats","results","ortcObjectName","nativeGetstats","nativeStats","mapStats","methods","17","random","blob","part","parts","substring","address","relatedAddress","relatedPort","tcpType","parseIceOptions","parseRtpMap","parsed","channels","writeRtpMap","parseExtmap","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","param","parseRtcpFb","writeRtcpFb","parseSsrcMedia","sp","colon","attribute","parseSsrcGroup","semantics","ssrcs","parseFingerprint","algorithm","fingerprints","setupType","fp","password","mline","rtpmapline","fmtps","maxptime","extension","encodingParameters","hasRed","hasUlpfec","primarySsrc","secondarySsrc","flows","encParam","codecPayloadType","fec","mechanism","bandwidth","maxBitrate","remoteSsrc","rsize","mux","spec","planB","msidParts","sessId","sessVer","sessUser","sessionId","fmt","parseOLine","username","sessionVersion","netType","addressType","isValidSDP","msGetUserMedia","fn","domManip","q","h","l","_wrap","tmpl","parent","nodes","calls","nest","w","wrap","x","html","v","update","extend","_ctnt","m","createElement","innerHTML","makeArray","childNodes","Function","tag","_default","test","k","$1","$2","isArray","nodeType","getElementsByTagName","getAttribute","parentNode","removeAttribute","pop","_","template","wrapped","innerText","textContent","outerHTML","appendChild","cloneNode","insertBefore","remove","each","appendTo","prependTo","insertAfter","replaceAll","pushStack","tmplItem","afterManip","encode","open","if","else","=","!","jQuery","mediaStreamTrack","callback","interval","getStatsLooper","getStatsWrapper","getStatsParser","stack","peer","search","nomore","getStatsResult","datachannel","ended","speed","bytesSent","helper","audioBytesSent","videoBytesSent","InstallTrigger","isSafari","res","items","that","browserFakeUserAgent","documentElement","captureStream","mozCaptureStream","getContext","play","pause","drawImage","toDataURL","HTMLVideoElement","location","href","hash","screen","URL","createObjectURL","revokeObjectURL","systemNetworkType","connection","encryption","availableBandwidth","framerateMean","bitrateMean","bytesReceived","latency","packetsLost","systemBandwidth","sentPerSecond","encodedPerSecond","videoBytestSent","connectionType","systemIpAddress","local","candidateType","transport","ipAddress","networkType","remote","resolutions","internal","candidates","checkIfOfferer","isOfferer","googInitiator","googCertificate","googFingerprintAlgorithm","fingerprintAlgorithm","checkAudioTracks","mediaType","sendrecvType","isRemote","googCodecName","kilobytes","prevBytesSent","bytes","toFixed","prevBytesReceived","googTrackId","googCurrentDelayMs","prevGoogCurrentDelayMs","prevPacketsLost","checkVideoTracks","googFrameHeightReceived","googFrameWidthReceived","googFrameHeightSent","googFrameWidthSent","prevFramerateMean","prevBitrateMean","bweforvideo","availableSendBandwidth","googAvailableSendBandwidth","googActualEncBitrate","googAvailableReceiveBandwidth","googRetransmitBitrate","googTargetEncBitrate","googBucketDelay","googTransmitBitrate","candidatePair","googActiveConnection","cid","googLocalAddress","googRemoteAddress","googTransportType","localCandidate","localCandidateId","remoteCandidateId","selected","nominated","mozLocalTransport","mozRemoteTransport","availableOutgoingBitrate","prevAvailableOutgoingBitrate","availableIncomingBitrate","prevAvailableIncomingBitrate","LOCAL_candidateType","LOCAL_transport","LOCAL_ipAddress","LOCAL_networkType","portNumber","REMOTE_candidateType","REMOTE_transport","REMOTE_ipAddress","REMOTE_networkType","dataSentReceived","remoteSource","frameWidth","frameHeight","SSRC","share","getAvatarUrl","userId","pad","getPadId","Date","getTime","scrollDownToLastChatText","$element","$","animate","scrollTop","scrollHeight","duration","queue","getUserFromId","collabClient","getConnectedUsers","user","slugify","text","$body_ace_outer","contents","wrtcStore","userInRoom","socketState","components","active","room","wrtcPubsub","events","on","eventName","off","emit","_len","_key","inlineAvatar","ROOM","headerId","inlineAvatarLimit","clientVars","webrtc","css","left","WRTC_Room","getHeaderRoomX","userInList","colorId","hide","append","show","TEXT","list","VIDEO","el","$roomBox","$textBox","$videoBox","attr","src","imageUrl","title","userName","info","WRTC","attemptToReconnect","componentName","status","requestUser","roomInfo","USERS","users","actions","$headingRoom","$btnVideo","$btnText","$btnPlus","prop","newAction","data-action","hElements","createShareLink","headingTagId","headerText","origin","pathname","notifyNewUserJoined","msg","btnJoin","headerTitle","roomCounter","userCount","VIDEOCHATLIMIT","authorClass","charCodeAt","minutes","time","getMinutes","hours","getHours","timeStr","headId","addTextChatMessage","roomBoxIconActive","textActive","videoActive","addClass","removeClass","appendUserList","empty","getUserId","stopStreaming","getValidUrl","newUrl","decodeURIComponent","randomString","padInner","getFirstColumnOfSelection","rep","firstLineOfSelection","selStart","getLastColumnOfSelection","lastLineOfSelection","lastColumnOfSelection","nextLine","startLineOffset","offsetOfIndex","getLength","selEnd","hasHeaderOnLine","lineNumber","firstColumn","lastColumn","attributeManager","foundHeadOnLine","column","object","getAttributesOnLine","getSelectionHtml","getSelection","sel","rangeCount","container","len","getRangeAt","cloneContents","selection","createRange","htmlText","hasHeaderOnSelection","hasVideoHeader","documentAttributeManager","selectionOfMultipleLine","hasMultipleLineSelected","foundLineWithHeader","hasHeaderOnMultipleLineSelection","hasMultipleLine","addTextOnClipboard","aces","inner","removeSelection","callWithAce","ace","ace_hasHeaderOnSelection","rawHtml","class","selectionMultipleLine","hTag","content","selectionOneLine","originalEvent","clipboardData","setData","raw","multiLine","preventDefault","execCommand","pastOnSelection","hasWrtcObject","getData","range","insertNode","collapse","removeAllRanges","addRange","findTags","CodecsHandler","preferCodec","codecName","videoCodecNumbers","vp8LineNumber","vp9LineNumber","h264LineNumber","preferCodecHelper","ignore","preferCodecNumber","newLine","videoCodecNumbersOriginal","newOrder","codecNumber","findLine","sdpLines","startLine","endLine","realEndLine","findLineInRange","getCodecPayloadType","sdpLine","pattern","removeVPX","disableNACK","prioritize","codecMimeType","getParameters","mimeType","unshift","setParameters","removeNonG722","setApplicationSpecificBandwidth","isScreen","setBAS","setVideoBitrates","xgoogle_min_bitrate","xgoogle_max_bitrate","videoCodec","vp8Index","vp8Payload","rtxIndex","rtxPayload","rtxFmtpLineIndex","appendrtxNext","_setVideoBitrates","setOpusAttributes","opusIndex","opusPayload","opusFmtpLineIndex","appendOpusNext","stereo","maxaveragebitrate","maxplaybackrate","cbr","useinbandfec","usedtx","_setOpusAttributes","preferVP9","forceStereoAudio","fmtpLineIndex","extractSdp","padutils","textChat","socket","padId","currentRoom","$joinBtn","createAndAppendMessage","tim","escapeHtmlWithClickableLinks","data-authorid","author","eventTextChatInput","keyCode","which","textMessage","incomMsg","deactivateModal","$TextChatWrapper","removeAttr","$btn","toggle","activateModal","headTitle","existTextChat","data-id","textChatBox","headingId","addUserToRoom","present","data-text","removeUserFromRoom","$textChatUserList","socketBulkUpdateRooms","rooms","roomsInfo","postAceInit","hook","context","webSocket","docId","chatBox","innerHeight","transform","userJoin","userData","$joinButton","userLeave","bulkUpdateRooms","hTagList","videoChat","localStream","networkInterval","pingos","startTime","LMin","LMax","avg","LineAvg","colors","normal","warning","danger","interavCheck","$videoChatUserList","deactivate","clearInterval","opacity","data-active","removeListener","data-video","setInterval","now","activate","prepend","hasClass","createSession","userInfo","gateway_userJoin","_userData","gateway_userLeave","showUserMediaError","reachedVideoRoomSize","showAlert","isBulkUpdate","gritter","add","sticky","class_name","bulkUpdate","videoChatLimit","videoId","color","ceil","reloadSession","reloadCurrentSession","videoSettings","localStorage","getItem","microphone","speaker","camera","audioInputSelect","querySelector","audioOutputSelect","videoSelect","deviceInfo","option","scroll2Header","scrollIntoView","behavior","closeTextChat","trigger","roomBtnHandler","hasHref","joinChatRoom","leaveChatRoom","pathName","link","$temp","select","shareRoomsLink","getHeaderRoomY","outerHeight","paddingTop","aceOuterPadding","offset","top","outerWidth","paddingLeft","showUserProfileModal","ep_profile_list","about","homepage","display","background-position","background-image","background-repeat","background-size","background-color","activeEventListener","$wbrtc_roomBox","link2Clipboard","toggleClass","position","$box","aceSetAuthorStyle","border-color","urlParams","URLSearchParams","joinByQueryString","adoptHeaderYRoom","$padOuter","$el","hClassId","$headingEl","hTags","children","aceInnerOffset","newHTagAdded","newY","newX","positionTop","positionLeft","headerCount","box","avatarBox","reconnected","videoSizes","large","small","DtlsSrtpKeyAgreement","sdpConstraints","OfferToReceiveAudio","OfferToReceiveVideo","remoteStream","callQueue","enlargedVideos","Set","localVideoElement","sizes","_pad","audioVideoInputChange","changeAudioDestination","hangupAll","payload","receiveMessage","appendInterfaceLayout","werc_toolbar","$wrtc_modal","$parent","videoBox","userID","$this","isActive","$modal","bytesToSize","floor","pow","toPrecision","statistic","send.codecs","$btnInfo","siblings","gState","hangup","handleClientMessage_RTC_MESSAGE","reason","sendErrorStat","hostname","toggleMuted","audioTrack","toggleVideo","videoTrack","setStream","isLocal","videoContainer","max-height","loadedmetadata","addInterface","autoplay","muted","attachMediaStream","$video","$mute","click","videoEnabled","$disableVideo","videoEnlarged","$largeVideo","delete","videoSize","$networkLatancy","statName","json","sendMessage","to","from","createPeerConnection","cleanupSdp","logError","_headerId","notify","webrtcDetectedBrowser","cons1","cons2","merged","mergeConstraints","attachSinkId","element","sinkId","setSinkId","errorMessage","selectedIndex","audioDestination","videoElement","audioSource","videoSource","audioOutput","mediaConstraints","setItem","srcObject","mozSrcObject","minVideo","maxVideo"],"mappings":"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","file":"wrtc.heading.mini.js","sourcesContent":["(function (f) { if (typeof exports === 'object' && typeof module !== 'undefined') { module.exports = f(); } else if (typeof define === 'function' && define.amd) { define([], f); } else { let g; if (typeof window !== 'undefined') { g = window; } else if (typeof global !== 'undefined') { g = global; } else if (typeof self !== 'undefined') { g = self; } else { g = this; }g.adapter = f(); } })(() => {\r\n  let define, module, exports; return (function () { function r(e, n, t) { function o(i, f) { if (!n[i]) { if (!e[i]) { const c = 'function' === typeof require && require; if (!f && c) return c(i, !0); if (u) return u(i, !0); const a = new Error(`Cannot find module '${i}'`); throw a.code = 'MODULE_NOT_FOUND', a; } const p = n[i] = {exports: {}}; e[i][0].call(p.exports, (r) => { const n = e[i][1][r]; return o(n || r); }, p, p.exports, r, e, n, t); } return n[i].exports; } for (var u = 'function' === typeof require && require, i = 0; i < t.length; i++)o(t[i]); return o; } return r; })()({1: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n\r\n    'use strict';\r\n\r\n    const _adapter_factory = require('./adapter_factory.js');\r\n\r\n    const adapter = (0, _adapter_factory.adapterFactory)({window});\r\n    module.exports = adapter; // this is the difference from adapter_core.\r\n  }, {'./adapter_factory.js': 2}], 2: [function (require, module, exports) {\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n    exports.adapterFactory = adapterFactory;\r\n\r\n    const _utils = require('./utils');\r\n\r\n    const utils = _interopRequireWildcard(_utils);\r\n\r\n    const _chrome_shim = require('./chrome/chrome_shim');\r\n\r\n    const chromeShim = _interopRequireWildcard(_chrome_shim);\r\n\r\n    const _edge_shim = require('./edge/edge_shim');\r\n\r\n    const edgeShim = _interopRequireWildcard(_edge_shim);\r\n\r\n    const _firefox_shim = require('./firefox/firefox_shim');\r\n\r\n    const firefoxShim = _interopRequireWildcard(_firefox_shim);\r\n\r\n    const _safari_shim = require('./safari/safari_shim');\r\n\r\n    const safariShim = _interopRequireWildcard(_safari_shim);\r\n\r\n    const _common_shim = require('./common_shim');\r\n\r\n    const commonShim = _interopRequireWildcard(_common_shim);\r\n\r\n    function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { const newObj = {}; if (obj != null) { for (const key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\r\n    // Shimming starts here.\r\n    /*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    function adapterFactory() {\r\n      const _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\r\n      const window = _ref.window;\r\n\r\n      const options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\r\n        shimChrome: true,\r\n        shimFirefox: true,\r\n        shimEdge: true,\r\n        shimSafari: true,\r\n      };\r\n\r\n      // Utils.\r\n      const logging = utils.log;\r\n      const browserDetails = utils.detectBrowser(window);\r\n\r\n      const adapter = {\r\n        browserDetails,\r\n        commonShim,\r\n        extractVersion: utils.extractVersion,\r\n        disableLog: utils.disableLog,\r\n        disableWarnings: utils.disableWarnings,\r\n      };\r\n\r\n      // Shim browser if found.\r\n      switch (browserDetails.browser) {\r\n        case 'chrome':\r\n          if (!chromeShim || !chromeShim.shimPeerConnection || !options.shimChrome) {\r\n            logging('Chrome shim is not included in this adapter release.');\r\n            return adapter;\r\n          }\r\n          logging('adapter.js shimming chrome.');\r\n          // Export to the adapter global object visible in the browser.\r\n          adapter.browserShim = chromeShim;\r\n\r\n          chromeShim.shimGetUserMedia(window);\r\n          chromeShim.shimMediaStream(window);\r\n          chromeShim.shimPeerConnection(window);\r\n          chromeShim.shimOnTrack(window);\r\n          chromeShim.shimAddTrackRemoveTrack(window);\r\n          chromeShim.shimGetSendersWithDtmf(window);\r\n          chromeShim.shimGetStats(window);\r\n          chromeShim.shimSenderReceiverGetStats(window);\r\n          chromeShim.fixNegotiationNeeded(window);\r\n\r\n          commonShim.shimRTCIceCandidate(window);\r\n          commonShim.shimConnectionState(window);\r\n          commonShim.shimMaxMessageSize(window);\r\n          commonShim.shimSendThrowTypeError(window);\r\n          commonShim.removeAllowExtmapMixed(window);\r\n          break;\r\n        case 'firefox':\r\n          if (!firefoxShim || !firefoxShim.shimPeerConnection || !options.shimFirefox) {\r\n            logging('Firefox shim is not included in this adapter release.');\r\n            return adapter;\r\n          }\r\n          logging('adapter.js shimming firefox.');\r\n          // Export to the adapter global object visible in the browser.\r\n          adapter.browserShim = firefoxShim;\r\n\r\n          firefoxShim.shimGetUserMedia(window);\r\n          firefoxShim.shimPeerConnection(window);\r\n          firefoxShim.shimOnTrack(window);\r\n          firefoxShim.shimRemoveStream(window);\r\n          firefoxShim.shimSenderGetStats(window);\r\n          firefoxShim.shimReceiverGetStats(window);\r\n          firefoxShim.shimRTCDataChannel(window);\r\n\r\n          commonShim.shimRTCIceCandidate(window);\r\n          commonShim.shimConnectionState(window);\r\n          commonShim.shimMaxMessageSize(window);\r\n          commonShim.shimSendThrowTypeError(window);\r\n          break;\r\n        case 'edge':\r\n          if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\r\n            logging('MS edge shim is not included in this adapter release.');\r\n            return adapter;\r\n          }\r\n          logging('adapter.js shimming edge.');\r\n          // Export to the adapter global object visible in the browser.\r\n          adapter.browserShim = edgeShim;\r\n\r\n          edgeShim.shimGetUserMedia(window);\r\n          edgeShim.shimGetDisplayMedia(window);\r\n          edgeShim.shimPeerConnection(window);\r\n          edgeShim.shimReplaceTrack(window);\r\n\r\n          // the edge shim implements the full RTCIceCandidate object.\r\n\r\n          commonShim.shimMaxMessageSize(window);\r\n          commonShim.shimSendThrowTypeError(window);\r\n          break;\r\n        case 'safari':\r\n          if (!safariShim || !options.shimSafari) {\r\n            logging('Safari shim is not included in this adapter release.');\r\n            return adapter;\r\n          }\r\n          logging('adapter.js shimming safari.');\r\n          // Export to the adapter global object visible in the browser.\r\n          adapter.browserShim = safariShim;\r\n\r\n          safariShim.shimRTCIceServerUrls(window);\r\n          safariShim.shimCreateOfferLegacy(window);\r\n          safariShim.shimCallbacksAPI(window);\r\n          safariShim.shimLocalStreamsAPI(window);\r\n          safariShim.shimRemoteStreamsAPI(window);\r\n          safariShim.shimTrackEventTransceiver(window);\r\n          safariShim.shimGetUserMedia(window);\r\n\r\n          commonShim.shimRTCIceCandidate(window);\r\n          commonShim.shimMaxMessageSize(window);\r\n          commonShim.shimSendThrowTypeError(window);\r\n          commonShim.removeAllowExtmapMixed(window);\r\n          break;\r\n        default:\r\n          logging('Unsupported browser!');\r\n          break;\r\n      }\r\n\r\n      return adapter;\r\n    }\r\n\r\n  // Browser shims.\r\n  }, {'./chrome/chrome_shim': 3, './common_shim': 6, './edge/edge_shim': 7, './firefox/firefox_shim': 11, './safari/safari_shim': 14, './utils': 15}], 3: [function (require, module, exports) {\r\n    /*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n    exports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\r\n\r\n    const _typeof = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj; };\r\n\r\n    const _getusermedia = require('./getusermedia');\r\n\r\n    Object.defineProperty(exports, 'shimGetUserMedia', {\r\n      enumerable: true,\r\n      get: function get() {\r\n        return _getusermedia.shimGetUserMedia;\r\n      },\r\n    });\r\n\r\n    const _getdisplaymedia = require('./getdisplaymedia');\r\n\r\n    Object.defineProperty(exports, 'shimGetDisplayMedia', {\r\n      enumerable: true,\r\n      get: function get() {\r\n        return _getdisplaymedia.shimGetDisplayMedia;\r\n      },\r\n    });\r\n    exports.shimMediaStream = shimMediaStream;\r\n    exports.shimOnTrack = shimOnTrack;\r\n    exports.shimGetSendersWithDtmf = shimGetSendersWithDtmf;\r\n    exports.shimGetStats = shimGetStats;\r\n    exports.shimSenderReceiverGetStats = shimSenderReceiverGetStats;\r\n    exports.shimAddTrackRemoveTrackWithNative = shimAddTrackRemoveTrackWithNative;\r\n    exports.shimAddTrackRemoveTrack = shimAddTrackRemoveTrack;\r\n    exports.shimPeerConnection = shimPeerConnection;\r\n    exports.fixNegotiationNeeded = fixNegotiationNeeded;\r\n\r\n    const _utils = require('../utils.js');\r\n\r\n    const utils = _interopRequireWildcard(_utils);\r\n\r\n    function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { const newObj = {}; if (obj != null) { for (const key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\r\n    function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, {value, enumerable: true, configurable: true, writable: true}); } else { obj[key] = value; } return obj; }\r\n\r\n    function shimMediaStream(window) {\r\n      window.MediaStream = window.MediaStream || window.webkitMediaStream;\r\n    }\r\n\r\n    function shimOnTrack(window) {\r\n      if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && !('ontrack' in window.RTCPeerConnection.prototype)) {\r\n        Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\r\n          get: function get() {\r\n            return this._ontrack;\r\n          },\r\n          set: function set(f) {\r\n            if (this._ontrack) {\r\n              this.removeEventListener('track', this._ontrack);\r\n            }\r\n            this.addEventListener('track', this._ontrack = f);\r\n          },\r\n\r\n          enumerable: true,\r\n          configurable: true,\r\n        });\r\n        const origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\r\n        window.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {\r\n          const _this = this;\r\n\r\n          if (!this._ontrackpoly) {\r\n            this._ontrackpoly = function (e) {\r\n            // onaddstream does not fire when a track is added to an existing\r\n            // stream. But stream.onaddtrack is implemented so we use that.\r\n              e.stream.addEventListener('addtrack', (te) => {\r\n                let receiver = void 0;\r\n                if (window.RTCPeerConnection.prototype.getReceivers) {\r\n                  receiver = _this.getReceivers().find((r) => r.track && r.track.id === te.track.id);\r\n                } else {\r\n                  receiver = {track: te.track};\r\n                }\r\n\r\n                const event = new Event('track');\r\n                event.track = te.track;\r\n                event.receiver = receiver;\r\n                event.transceiver = {receiver};\r\n                event.streams = [e.stream];\r\n                _this.dispatchEvent(event);\r\n              });\r\n              e.stream.getTracks().forEach((track) => {\r\n                let receiver = void 0;\r\n                if (window.RTCPeerConnection.prototype.getReceivers) {\r\n                  receiver = _this.getReceivers().find((r) => r.track && r.track.id === track.id);\r\n                } else {\r\n                  receiver = {track};\r\n                }\r\n                const event = new Event('track');\r\n                event.track = track;\r\n                event.receiver = receiver;\r\n                event.transceiver = {receiver};\r\n                event.streams = [e.stream];\r\n                _this.dispatchEvent(event);\r\n              });\r\n            };\r\n            this.addEventListener('addstream', this._ontrackpoly);\r\n          }\r\n          return origSetRemoteDescription.apply(this, arguments);\r\n        };\r\n      } else {\r\n      // even if RTCRtpTransceiver is in window, it is only used and\r\n      // emitted in unified-plan. Unfortunately this means we need\r\n      // to unconditionally wrap the event.\r\n        utils.wrapPeerConnectionEvent(window, 'track', (e) => {\r\n          if (!e.transceiver) {\r\n            Object.defineProperty(e, 'transceiver', {value: {receiver: e.receiver}});\r\n          }\r\n          return e;\r\n        });\r\n      }\r\n    }\r\n\r\n    function shimGetSendersWithDtmf(window) {\r\n    // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\r\n      if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && !('getSenders' in window.RTCPeerConnection.prototype) && 'createDTMFSender' in window.RTCPeerConnection.prototype) {\r\n        const shimSenderWithDtmf = function shimSenderWithDtmf(pc, track) {\r\n          return {\r\n            track,\r\n            get dtmf() {\r\n              if (this._dtmf === undefined) {\r\n                if (track.kind === 'audio') {\r\n                  this._dtmf = pc.createDTMFSender(track);\r\n                } else {\r\n                  this._dtmf = null;\r\n                }\r\n              }\r\n              return this._dtmf;\r\n            },\r\n            _pc: pc,\r\n          };\r\n        };\r\n\r\n        // augment addTrack when getSenders is not available.\r\n        if (!window.RTCPeerConnection.prototype.getSenders) {\r\n          window.RTCPeerConnection.prototype.getSenders = function getSenders() {\r\n            this._senders = this._senders || [];\r\n            return this._senders.slice(); // return a copy of the internal state.\r\n          };\r\n          const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\r\n          window.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\r\n            let sender = origAddTrack.apply(this, arguments);\r\n            if (!sender) {\r\n              sender = shimSenderWithDtmf(this, track);\r\n              this._senders.push(sender);\r\n            }\r\n            return sender;\r\n          };\r\n\r\n          const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\r\n          window.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\r\n            origRemoveTrack.apply(this, arguments);\r\n            const idx = this._senders.indexOf(sender);\r\n            if (idx !== -1) {\r\n              this._senders.splice(idx, 1);\r\n            }\r\n          };\r\n        }\r\n        const origAddStream = window.RTCPeerConnection.prototype.addStream;\r\n        window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\r\n          const _this2 = this;\r\n\r\n          this._senders = this._senders || [];\r\n          origAddStream.apply(this, [stream]);\r\n          stream.getTracks().forEach((track) => {\r\n            _this2._senders.push(shimSenderWithDtmf(_this2, track));\r\n          });\r\n        };\r\n\r\n        const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\r\n        window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n          const _this3 = this;\r\n\r\n          this._senders = this._senders || [];\r\n          origRemoveStream.apply(this, [stream]);\r\n\r\n          stream.getTracks().forEach((track) => {\r\n            const sender = _this3._senders.find((s) => s.track === track);\r\n            if (sender) {\r\n            // remove sender\r\n              _this3._senders.splice(_this3._senders.indexOf(sender), 1);\r\n            }\r\n          });\r\n        };\r\n      } else if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && 'getSenders' in window.RTCPeerConnection.prototype && 'createDTMFSender' in window.RTCPeerConnection.prototype && window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\r\n        const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\r\n        window.RTCPeerConnection.prototype.getSenders = function getSenders() {\r\n          const _this4 = this;\r\n\r\n          const senders = origGetSenders.apply(this, []);\r\n          senders.forEach((sender) => sender._pc = _this4);\r\n          return senders;\r\n        };\r\n\r\n        Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\r\n          get: function get() {\r\n            if (this._dtmf === undefined) {\r\n              if (this.track.kind === 'audio') {\r\n                this._dtmf = this._pc.createDTMFSender(this.track);\r\n              } else {\r\n                this._dtmf = null;\r\n              }\r\n            }\r\n            return this._dtmf;\r\n          },\r\n        });\r\n      }\r\n    }\r\n\r\n    function shimGetStats(window) {\r\n      if (!window.RTCPeerConnection) {\r\n        return;\r\n      }\r\n\r\n      const origGetStats = window.RTCPeerConnection.prototype.getStats;\r\n      window.RTCPeerConnection.prototype.getStats = function getStats() {\r\n        const _this5 = this;\r\n\r\n        const _arguments = Array.prototype.slice.call(arguments);\r\n        const selector = _arguments[0];\r\n        const onSucc = _arguments[1];\r\n        const onErr = _arguments[2];\r\n\r\n        // If selector is a function then we are in the old style stats so just\r\n        // pass back the original getStats format to avoid breaking old users.\r\n\r\n\r\n        if (arguments.length > 0 && typeof selector === 'function') {\r\n          return origGetStats.apply(this, arguments);\r\n        }\r\n\r\n        // When spec-style getStats is supported, return those when called with\r\n        // either no arguments or the selector argument is null.\r\n        if (origGetStats.length === 0 && (arguments.length === 0 || typeof selector !== 'function')) {\r\n          return origGetStats.apply(this, []);\r\n        }\r\n\r\n        const fixChromeStats_ = function fixChromeStats_(response) {\r\n          const standardReport = {};\r\n          const reports = response.result();\r\n          reports.forEach((report) => {\r\n            const standardStats = {\r\n              id: report.id,\r\n              timestamp: report.timestamp,\r\n              type: {\r\n                localcandidate: 'local-candidate',\r\n                remotecandidate: 'remote-candidate',\r\n              }[report.type] || report.type,\r\n            };\r\n            report.names().forEach((name) => {\r\n              standardStats[name] = report.stat(name);\r\n            });\r\n            standardReport[standardStats.id] = standardStats;\r\n          });\r\n\r\n          return standardReport;\r\n        };\r\n\r\n        // shim getStats with maplike support\r\n        const makeMapStats = function makeMapStats(stats) {\r\n          return new Map(Object.keys(stats).map((key) => [key, stats[key]]));\r\n        };\r\n\r\n        if (arguments.length >= 2) {\r\n          const successCallbackWrapper_ = function successCallbackWrapper_(response) {\r\n            onSucc(makeMapStats(fixChromeStats_(response)));\r\n          };\r\n\r\n          return origGetStats.apply(this, [successCallbackWrapper_, selector]);\r\n        }\r\n\r\n        // promise-support\r\n        return new Promise((resolve, reject) => {\r\n          origGetStats.apply(_this5, [function (response) {\r\n            resolve(makeMapStats(fixChromeStats_(response)));\r\n          }, reject]);\r\n        }).then(onSucc, onErr);\r\n      };\r\n    }\r\n\r\n    function shimSenderReceiverGetStats(window) {\r\n      if (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender && window.RTCRtpReceiver)) {\r\n        return;\r\n      }\r\n\r\n      // shim sender stats.\r\n      if (!('getStats' in window.RTCRtpSender.prototype)) {\r\n        const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\r\n        if (origGetSenders) {\r\n          window.RTCPeerConnection.prototype.getSenders = function getSenders() {\r\n            const _this6 = this;\r\n\r\n            const senders = origGetSenders.apply(this, []);\r\n            senders.forEach((sender) => sender._pc = _this6);\r\n            return senders;\r\n          };\r\n        }\r\n\r\n        const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\r\n        if (origAddTrack) {\r\n          window.RTCPeerConnection.prototype.addTrack = function addTrack() {\r\n            const sender = origAddTrack.apply(this, arguments);\r\n            sender._pc = this;\r\n            return sender;\r\n          };\r\n        }\r\n        window.RTCRtpSender.prototype.getStats = function getStats() {\r\n          const sender = this;\r\n          return this._pc.getStats().then((result) => (\r\n            /* Note: this will include stats of all senders that\r\n\t\t\t\t\t\t *   send a track with the same id as sender.track as\r\n\t\t\t\t\t\t *   it is not possible to identify the RTCRtpSender.\r\n\t\t\t\t\t\t */\r\n            utils.filterStats(result, sender.track, true)\r\n          ));\r\n        };\r\n      }\r\n\r\n      // shim receiver stats.\r\n      if (!('getStats' in window.RTCRtpReceiver.prototype)) {\r\n        const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\r\n        if (origGetReceivers) {\r\n          window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\r\n            const _this7 = this;\r\n\r\n            const receivers = origGetReceivers.apply(this, []);\r\n            receivers.forEach((receiver) => receiver._pc = _this7);\r\n            return receivers;\r\n          };\r\n        }\r\n        utils.wrapPeerConnectionEvent(window, 'track', (e) => {\r\n          e.receiver._pc = e.srcElement;\r\n          return e;\r\n        });\r\n        window.RTCRtpReceiver.prototype.getStats = function getStats() {\r\n          const receiver = this;\r\n          return this._pc.getStats().then((result) => utils.filterStats(result, receiver.track, false));\r\n        };\r\n      }\r\n\r\n      if (!('getStats' in window.RTCRtpSender.prototype && 'getStats' in window.RTCRtpReceiver.prototype)) {\r\n        return;\r\n      }\r\n\r\n      // shim RTCPeerConnection.getStats(track).\r\n      const origGetStats = window.RTCPeerConnection.prototype.getStats;\r\n      window.RTCPeerConnection.prototype.getStats = function getStats() {\r\n        if (arguments.length > 0 && arguments[0] instanceof window.MediaStreamTrack) {\r\n          const track = arguments[0];\r\n          let sender = void 0;\r\n          let receiver = void 0;\r\n          let err = void 0;\r\n          this.getSenders().forEach((s) => {\r\n            if (s.track === track) {\r\n              if (sender) {\r\n                err = true;\r\n              } else {\r\n                sender = s;\r\n              }\r\n            }\r\n          });\r\n          this.getReceivers().forEach((r) => {\r\n            if (r.track === track) {\r\n              if (receiver) {\r\n                err = true;\r\n              } else {\r\n                receiver = r;\r\n              }\r\n            }\r\n            return r.track === track;\r\n          });\r\n          if (err || sender && receiver) {\r\n            return Promise.reject(new DOMException('There are more than one sender or receiver for the track.', 'InvalidAccessError'));\r\n          } else if (sender) {\r\n            return sender.getStats();\r\n          } else if (receiver) {\r\n            return receiver.getStats();\r\n          }\r\n          return Promise.reject(new DOMException('There is no sender or receiver for the track.', 'InvalidAccessError'));\r\n        }\r\n        return origGetStats.apply(this, arguments);\r\n      };\r\n    }\r\n\r\n    function shimAddTrackRemoveTrackWithNative(window) {\r\n    // shim addTrack/removeTrack with native variants in order to make\r\n    // the interactions with legacy getLocalStreams behave as in other browsers.\r\n    // Keeps a mapping stream.id => [stream, rtpsenders...]\r\n      window.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\r\n        const _this8 = this;\r\n\r\n        this._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n        return Object.keys(this._shimmedLocalStreams).map((streamId) => _this8._shimmedLocalStreams[streamId][0]);\r\n      };\r\n\r\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\r\n      window.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\r\n        if (!stream) {\r\n          return origAddTrack.apply(this, arguments);\r\n        }\r\n        this._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n\r\n        const sender = origAddTrack.apply(this, arguments);\r\n        if (!this._shimmedLocalStreams[stream.id]) {\r\n          this._shimmedLocalStreams[stream.id] = [stream, sender];\r\n        } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\r\n          this._shimmedLocalStreams[stream.id].push(sender);\r\n        }\r\n        return sender;\r\n      };\r\n\r\n      const origAddStream = window.RTCPeerConnection.prototype.addStream;\r\n      window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\r\n        const _this9 = this;\r\n\r\n        this._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n\r\n        stream.getTracks().forEach((track) => {\r\n          const alreadyExists = _this9.getSenders().find((s) => s.track === track);\r\n          if (alreadyExists) {\r\n            throw new DOMException('Track already exists.', 'InvalidAccessError');\r\n          }\r\n        });\r\n        const existingSenders = this.getSenders();\r\n        origAddStream.apply(this, arguments);\r\n        const newSenders = this.getSenders().filter((newSender) => existingSenders.indexOf(newSender) === -1);\r\n        this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\r\n      };\r\n\r\n      const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\r\n      window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n        this._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n        delete this._shimmedLocalStreams[stream.id];\r\n        return origRemoveStream.apply(this, arguments);\r\n      };\r\n\r\n      const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\r\n      window.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\r\n        const _this10 = this;\r\n\r\n        this._shimmedLocalStreams = this._shimmedLocalStreams || {};\r\n        if (sender) {\r\n          Object.keys(this._shimmedLocalStreams).forEach((streamId) => {\r\n            const idx = _this10._shimmedLocalStreams[streamId].indexOf(sender);\r\n            if (idx !== -1) {\r\n              _this10._shimmedLocalStreams[streamId].splice(idx, 1);\r\n            }\r\n            if (_this10._shimmedLocalStreams[streamId].length === 1) {\r\n              delete _this10._shimmedLocalStreams[streamId];\r\n            }\r\n          });\r\n        }\r\n        return origRemoveTrack.apply(this, arguments);\r\n      };\r\n    }\r\n\r\n    function shimAddTrackRemoveTrack(window) {\r\n      if (!window.RTCPeerConnection) {\r\n        return;\r\n      }\r\n      const browserDetails = utils.detectBrowser(window);\r\n      // shim addTrack and removeTrack.\r\n      if (window.RTCPeerConnection.prototype.addTrack && browserDetails.version >= 65) {\r\n        return shimAddTrackRemoveTrackWithNative(window);\r\n      }\r\n\r\n      // also shim pc.getLocalStreams when addTrack is shimmed\r\n      // to return the original streams.\r\n      const origGetLocalStreams = window.RTCPeerConnection.prototype.getLocalStreams;\r\n      window.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\r\n        const _this11 = this;\r\n\r\n        const nativeStreams = origGetLocalStreams.apply(this);\r\n        this._reverseStreams = this._reverseStreams || {};\r\n        return nativeStreams.map((stream) => _this11._reverseStreams[stream.id]);\r\n      };\r\n\r\n      const origAddStream = window.RTCPeerConnection.prototype.addStream;\r\n      window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\r\n        const _this12 = this;\r\n\r\n        this._streams = this._streams || {};\r\n        this._reverseStreams = this._reverseStreams || {};\r\n\r\n        stream.getTracks().forEach((track) => {\r\n          const alreadyExists = _this12.getSenders().find((s) => s.track === track);\r\n          if (alreadyExists) {\r\n            throw new DOMException('Track already exists.', 'InvalidAccessError');\r\n          }\r\n        });\r\n        // Add identity mapping for consistency with addTrack.\r\n        // Unless this is being used with a stream from addTrack.\r\n        if (!this._reverseStreams[stream.id]) {\r\n          const newStream = new window.MediaStream(stream.getTracks());\r\n          this._streams[stream.id] = newStream;\r\n          this._reverseStreams[newStream.id] = stream;\r\n          stream = newStream;\r\n        }\r\n        origAddStream.apply(this, [stream]);\r\n      };\r\n\r\n      const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\r\n      window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n        this._streams = this._streams || {};\r\n        this._reverseStreams = this._reverseStreams || {};\r\n\r\n        origRemoveStream.apply(this, [this._streams[stream.id] || stream]);\r\n        delete this._reverseStreams[this._streams[stream.id] ? this._streams[stream.id].id : stream.id];\r\n        delete this._streams[stream.id];\r\n      };\r\n\r\n      window.RTCPeerConnection.prototype.addTrack = function addTrack(track, stream) {\r\n        const _this13 = this;\r\n\r\n        if (this.signalingState === 'closed') {\r\n          throw new DOMException('The RTCPeerConnection\\'s signalingState is \\'closed\\'.', 'InvalidStateError');\r\n        }\r\n        const streams = [].slice.call(arguments, 1);\r\n        if (streams.length !== 1 || !streams[0].getTracks().find((t) => t === track)) {\r\n        // this is not fully correct but all we can manage without\r\n        // [[associated MediaStreams]] internal slot.\r\n          throw new DOMException('The adapter.js addTrack polyfill only supports a single ' + ' stream which is associated with the specified track.', 'NotSupportedError');\r\n        }\r\n\r\n        const alreadyExists = this.getSenders().find((s) => s.track === track);\r\n        if (alreadyExists) {\r\n          throw new DOMException('Track already exists.', 'InvalidAccessError');\r\n        }\r\n\r\n        this._streams = this._streams || {};\r\n        this._reverseStreams = this._reverseStreams || {};\r\n        const oldStream = this._streams[stream.id];\r\n        if (oldStream) {\r\n        // this is using odd Chrome behaviour, use with caution:\r\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\r\n        // Note: we rely on the high-level addTrack/dtmf shim to\r\n        // create the sender with a dtmf sender.\r\n          oldStream.addTrack(track);\r\n\r\n          // Trigger ONN async.\r\n          Promise.resolve().then(() => {\r\n            _this13.dispatchEvent(new Event('negotiationneeded'));\r\n          });\r\n        } else {\r\n          const newStream = new window.MediaStream([track]);\r\n          this._streams[stream.id] = newStream;\r\n          this._reverseStreams[newStream.id] = stream;\r\n          this.addStream(newStream);\r\n        }\r\n        return this.getSenders().find((s) => s.track === track);\r\n      };\r\n\r\n      // replace the internal stream id with the external one and\r\n      // vice versa.\r\n      function replaceInternalStreamId(pc, description) {\r\n        let sdp = description.sdp;\r\n        Object.keys(pc._reverseStreams || []).forEach((internalId) => {\r\n          const externalStream = pc._reverseStreams[internalId];\r\n          const internalStream = pc._streams[externalStream.id];\r\n          sdp = sdp.replace(new RegExp(internalStream.id, 'g'), externalStream.id);\r\n        });\r\n        return new RTCSessionDescription({\r\n          type: description.type,\r\n          sdp,\r\n        });\r\n      }\r\n      function replaceExternalStreamId(pc, description) {\r\n        let sdp = description.sdp;\r\n        Object.keys(pc._reverseStreams || []).forEach((internalId) => {\r\n          const externalStream = pc._reverseStreams[internalId];\r\n          const internalStream = pc._streams[externalStream.id];\r\n          sdp = sdp.replace(new RegExp(externalStream.id, 'g'), internalStream.id);\r\n        });\r\n        return new RTCSessionDescription({\r\n          type: description.type,\r\n          sdp,\r\n        });\r\n      }\r\n      ['createOffer', 'createAnswer'].forEach((method) => {\r\n        const nativeMethod = window.RTCPeerConnection.prototype[method];\r\n        const methodObj = _defineProperty({}, method, function () {\r\n          const _this14 = this;\r\n\r\n          const args = arguments;\r\n          const isLegacyCall = arguments.length && typeof arguments[0] === 'function';\r\n          if (isLegacyCall) {\r\n            return nativeMethod.apply(this, [function (description) {\r\n              const desc = replaceInternalStreamId(_this14, description);\r\n              args[0].apply(null, [desc]);\r\n            }, function (err) {\r\n              if (args[1]) {\r\n                args[1].apply(null, err);\r\n              }\r\n            }, arguments[2]]);\r\n          }\r\n          return nativeMethod.apply(this, arguments).then((description) => replaceInternalStreamId(_this14, description));\r\n        });\r\n        window.RTCPeerConnection.prototype[method] = methodObj[method];\r\n      });\r\n\r\n      const origSetLocalDescription = window.RTCPeerConnection.prototype.setLocalDescription;\r\n      window.RTCPeerConnection.prototype.setLocalDescription = function setLocalDescription() {\r\n        if (!arguments.length || !arguments[0].type) {\r\n          return origSetLocalDescription.apply(this, arguments);\r\n        }\r\n        arguments[0] = replaceExternalStreamId(this, arguments[0]);\r\n        return origSetLocalDescription.apply(this, arguments);\r\n      };\r\n\r\n      // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\r\n\r\n      const origLocalDescription = Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype, 'localDescription');\r\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'localDescription', {\r\n        get: function get() {\r\n          const description = origLocalDescription.get.apply(this);\r\n          if (description.type === '') {\r\n            return description;\r\n          }\r\n          return replaceInternalStreamId(this, description);\r\n        },\r\n      });\r\n\r\n      window.RTCPeerConnection.prototype.removeTrack = function removeTrack(sender) {\r\n        const _this15 = this;\r\n\r\n        if (this.signalingState === 'closed') {\r\n          throw new DOMException('The RTCPeerConnection\\'s signalingState is \\'closed\\'.', 'InvalidStateError');\r\n        }\r\n        // We can not yet check for sender instanceof RTCRtpSender\r\n        // since we shim RTPSender. So we check if sender._pc is set.\r\n        if (!sender._pc) {\r\n          throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' + 'does not implement interface RTCRtpSender.', 'TypeError');\r\n        }\r\n        const isLocal = sender._pc === this;\r\n        if (!isLocal) {\r\n          throw new DOMException('Sender was not created by this connection.', 'InvalidAccessError');\r\n        }\r\n\r\n        // Search for the native stream the senders track belongs to.\r\n        this._streams = this._streams || {};\r\n        let stream = void 0;\r\n        Object.keys(this._streams).forEach((streamid) => {\r\n          const hasTrack = _this15._streams[streamid].getTracks().find((track) => sender.track === track);\r\n          if (hasTrack) {\r\n            stream = _this15._streams[streamid];\r\n          }\r\n        });\r\n\r\n        if (stream) {\r\n          if (stream.getTracks().length === 1) {\r\n          // if this is the last track of the stream, remove the stream. This\r\n          // takes care of any shimmed _senders.\r\n            this.removeStream(this._reverseStreams[stream.id]);\r\n          } else {\r\n          // relying on the same odd chrome behaviour as above.\r\n            stream.removeTrack(sender.track);\r\n          }\r\n          this.dispatchEvent(new Event('negotiationneeded'));\r\n        }\r\n      };\r\n    }\r\n\r\n    function shimPeerConnection(window) {\r\n      const browserDetails = utils.detectBrowser(window);\r\n\r\n      if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\r\n      // very basic support for old versions.\r\n        window.RTCPeerConnection = window.webkitRTCPeerConnection;\r\n      }\r\n      if (!window.RTCPeerConnection) {\r\n        return;\r\n      }\r\n\r\n      // shim implicit creation of RTCSessionDescription/RTCIceCandidate\r\n      if (browserDetails.version < 53) {\r\n        ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach((method) => {\r\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\r\n          const methodObj = _defineProperty({}, method, function () {\r\n            arguments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);\r\n            return nativeMethod.apply(this, arguments);\r\n          });\r\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\r\n        });\r\n      }\r\n\r\n      // support for addIceCandidate(null or undefined)\r\n      const nativeAddIceCandidate = window.RTCPeerConnection.prototype.addIceCandidate;\r\n      window.RTCPeerConnection.prototype.addIceCandidate = function addIceCandidate() {\r\n        if (!arguments[0]) {\r\n          if (arguments[1]) {\r\n            arguments[1].apply(null);\r\n          }\r\n          return Promise.resolve();\r\n        }\r\n        // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\r\n        // in older versions. Native support planned for Chrome M77.\r\n        if (browserDetails.version < 78 && arguments[0] && arguments[0].candidate === '') {\r\n          return Promise.resolve();\r\n        }\r\n        return nativeAddIceCandidate.apply(this, arguments);\r\n      };\r\n    }\r\n\r\n    function fixNegotiationNeeded(window) {\r\n      utils.wrapPeerConnectionEvent(window, 'negotiationneeded', (e) => {\r\n        const pc = e.target;\r\n        if (pc.signalingState !== 'stable') {\r\n          return;\r\n        }\r\n        return e;\r\n      });\r\n    }\r\n  }, {'../utils.js': 15, './getdisplaymedia': 4, './getusermedia': 5}], 4: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n    exports.shimGetDisplayMedia = shimGetDisplayMedia;\r\n    function shimGetDisplayMedia(window, getSourceId) {\r\n      if (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {\r\n        return;\r\n      }\r\n      if (!window.navigator.mediaDevices) {\r\n        return;\r\n      }\r\n      // getSourceId is a function that returns a promise resolving with\r\n      // the sourceId of the screen/window/tab to be shared.\r\n      if (typeof getSourceId !== 'function') {\r\n        console.error('shimGetDisplayMedia: getSourceId argument is not ' + 'a function');\r\n        return;\r\n      }\r\n      window.navigator.mediaDevices.getDisplayMedia = function getDisplayMedia(constraints) {\r\n        return getSourceId(constraints).then((sourceId) => {\r\n          const widthSpecified = constraints.video && constraints.video.width;\r\n          const heightSpecified = constraints.video && constraints.video.height;\r\n          const frameRateSpecified = constraints.video && constraints.video.frameRate;\r\n          constraints.video = {\r\n            mandatory: {\r\n              chromeMediaSource: 'desktop',\r\n              chromeMediaSourceId: sourceId,\r\n              maxFrameRate: frameRateSpecified || 3,\r\n            },\r\n          };\r\n          if (widthSpecified) {\r\n            constraints.video.mandatory.maxWidth = widthSpecified;\r\n          }\r\n          if (heightSpecified) {\r\n            constraints.video.mandatory.maxHeight = heightSpecified;\r\n          }\r\n          return window.navigator.mediaDevices.getUserMedia(constraints);\r\n        });\r\n      };\r\n    }\r\n  }, {}], 5: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n\r\n    const _typeof = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj; };\r\n\r\n    exports.shimGetUserMedia = shimGetUserMedia;\r\n\r\n    const _utils = require('../utils.js');\r\n\r\n    const utils = _interopRequireWildcard(_utils);\r\n\r\n    function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { const newObj = {}; if (obj != null) { for (const key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\r\n    const logging = utils.log;\r\n\r\n    function shimGetUserMedia(window) {\r\n      const navigator = window && window.navigator;\r\n\r\n      if (!navigator.mediaDevices) {\r\n        return;\r\n      }\r\n\r\n      const browserDetails = utils.detectBrowser(window);\r\n\r\n      const constraintsToChrome_ = function constraintsToChrome_(c) {\r\n        if ((typeof c === 'undefined' ? 'undefined' : _typeof(c)) !== 'object' || c.mandatory || c.optional) {\r\n          return c;\r\n        }\r\n        const cc = {};\r\n        Object.keys(c).forEach((key) => {\r\n          if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\r\n            return;\r\n          }\r\n          const r = _typeof(c[key]) === 'object' ? c[key] : {ideal: c[key]};\r\n          if (r.exact !== undefined && typeof r.exact === 'number') {\r\n            r.min = r.max = r.exact;\r\n          }\r\n          const oldname_ = function oldname_(prefix, name) {\r\n            if (prefix) {\r\n              return prefix + name.charAt(0).toUpperCase() + name.slice(1);\r\n            }\r\n            return name === 'deviceId' ? 'sourceId' : name;\r\n          };\r\n          if (r.ideal !== undefined) {\r\n            cc.optional = cc.optional || [];\r\n            let oc = {};\r\n            if (typeof r.ideal === 'number') {\r\n              oc[oldname_('min', key)] = r.ideal;\r\n              cc.optional.push(oc);\r\n              oc = {};\r\n              oc[oldname_('max', key)] = r.ideal;\r\n              cc.optional.push(oc);\r\n            } else {\r\n              oc[oldname_('', key)] = r.ideal;\r\n              cc.optional.push(oc);\r\n            }\r\n          }\r\n          if (r.exact !== undefined && typeof r.exact !== 'number') {\r\n            cc.mandatory = cc.mandatory || {};\r\n            cc.mandatory[oldname_('', key)] = r.exact;\r\n          } else {\r\n            ['min', 'max'].forEach((mix) => {\r\n              if (r[mix] !== undefined) {\r\n                cc.mandatory = cc.mandatory || {};\r\n                cc.mandatory[oldname_(mix, key)] = r[mix];\r\n              }\r\n            });\r\n          }\r\n        });\r\n        if (c.advanced) {\r\n          cc.optional = (cc.optional || []).concat(c.advanced);\r\n        }\r\n        return cc;\r\n      };\r\n\r\n      const shimConstraints_ = function shimConstraints_(constraints, func) {\r\n        if (browserDetails.version >= 61) {\r\n          return func(constraints);\r\n        }\r\n        constraints = JSON.parse(JSON.stringify(constraints));\r\n        if (constraints && _typeof(constraints.audio) === 'object') {\r\n          const remap = function remap(obj, a, b) {\r\n            if (a in obj && !(b in obj)) {\r\n              obj[b] = obj[a];\r\n              delete obj[a];\r\n            }\r\n          };\r\n          constraints = JSON.parse(JSON.stringify(constraints));\r\n          remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\r\n          remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\r\n          constraints.audio = constraintsToChrome_(constraints.audio);\r\n        }\r\n        if (constraints && _typeof(constraints.video) === 'object') {\r\n        // Shim facingMode for mobile & surface pro.\r\n          let face = constraints.video.facingMode;\r\n          face = face && ((typeof face === 'undefined' ? 'undefined' : _typeof(face)) === 'object' ? face : {ideal: face});\r\n          const getSupportedFacingModeLies = browserDetails.version < 66;\r\n\r\n          if (face && (face.exact === 'user' || face.exact === 'environment' || face.ideal === 'user' || face.ideal === 'environment') && !(navigator.mediaDevices.getSupportedConstraints && navigator.mediaDevices.getSupportedConstraints().facingMode && !getSupportedFacingModeLies)) {\r\n            delete constraints.video.facingMode;\r\n            let matches = void 0;\r\n            if (face.exact === 'environment' || face.ideal === 'environment') {\r\n              matches = ['back', 'rear'];\r\n            } else if (face.exact === 'user' || face.ideal === 'user') {\r\n              matches = ['front'];\r\n            }\r\n            if (matches) {\r\n            // Look for matches in label, or use last cam for back (typical).\r\n              return navigator.mediaDevices.enumerateDevices().then((devices) => {\r\n                devices = devices.filter((d) => d.kind === 'videoinput');\r\n                let dev = devices.find((d) => matches.some((match) => d.label.toLowerCase().includes(match)));\r\n                if (!dev && devices.length && matches.includes('back')) {\r\n                  dev = devices[devices.length - 1]; // more likely the back cam\r\n                }\r\n                if (dev) {\r\n                  constraints.video.deviceId = face.exact ? {exact: dev.deviceId} : {ideal: dev.deviceId};\r\n                }\r\n                constraints.video = constraintsToChrome_(constraints.video);\r\n                logging(`chrome: ${JSON.stringify(constraints)}`);\r\n                return func(constraints);\r\n              });\r\n            }\r\n          }\r\n          constraints.video = constraintsToChrome_(constraints.video);\r\n        }\r\n        logging(`chrome: ${JSON.stringify(constraints)}`);\r\n        return func(constraints);\r\n      };\r\n\r\n      const shimError_ = function shimError_(e) {\r\n        if (browserDetails.version >= 64) {\r\n          return e;\r\n        }\r\n        return {\r\n          name: {\r\n            PermissionDeniedError: 'NotAllowedError',\r\n            PermissionDismissedError: 'NotAllowedError',\r\n            InvalidStateError: 'NotAllowedError',\r\n            DevicesNotFoundError: 'NotFoundError',\r\n            ConstraintNotSatisfiedError: 'OverconstrainedError',\r\n            TrackStartError: 'NotReadableError',\r\n            MediaDeviceFailedDueToShutdown: 'NotAllowedError',\r\n            MediaDeviceKillSwitchOn: 'NotAllowedError',\r\n            TabCaptureError: 'AbortError',\r\n            ScreenCaptureError: 'AbortError',\r\n            DeviceCaptureError: 'AbortError',\r\n          }[e.name] || e.name,\r\n          message: e.message,\r\n          constraint: e.constraint || e.constraintName,\r\n          toString: function toString() {\r\n            return this.name + (this.message && ': ') + this.message;\r\n          },\r\n        };\r\n      };\r\n\r\n      const getUserMedia_ = function getUserMedia_(constraints, onSuccess, onError) {\r\n        shimConstraints_(constraints, (c) => {\r\n          navigator.webkitGetUserMedia(c, onSuccess, (e) => {\r\n            if (onError) {\r\n              onError(shimError_(e));\r\n            }\r\n          });\r\n        });\r\n      };\r\n      navigator.getUserMedia = getUserMedia_.bind(navigator);\r\n\r\n      // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\r\n      // function which returns a Promise, it does not accept spec-style\r\n      // constraints.\r\n      if (navigator.mediaDevices.getUserMedia) {\r\n        const origGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\r\n        navigator.mediaDevices.getUserMedia = function (cs) {\r\n          return shimConstraints_(cs, (c) => origGetUserMedia(c).then((stream) => {\r\n            if (c.audio && !stream.getAudioTracks().length || c.video && !stream.getVideoTracks().length) {\r\n              stream.getTracks().forEach((track) => {\r\n                track.stop();\r\n              });\r\n              throw new DOMException('', 'NotFoundError');\r\n            }\r\n            return stream;\r\n          }, (e) => Promise.reject(shimError_(e))));\r\n        };\r\n      }\r\n    }\r\n  }, {'../utils.js': 15}], 6: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n\r\n    const _typeof = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj; };\r\n\r\n    exports.shimRTCIceCandidate = shimRTCIceCandidate;\r\n    exports.shimMaxMessageSize = shimMaxMessageSize;\r\n    exports.shimSendThrowTypeError = shimSendThrowTypeError;\r\n    exports.shimConnectionState = shimConnectionState;\r\n    exports.removeAllowExtmapMixed = removeAllowExtmapMixed;\r\n\r\n    const _sdp = require('sdp');\r\n\r\n    const _sdp2 = _interopRequireDefault(_sdp);\r\n\r\n    const _utils = require('./utils');\r\n\r\n    const utils = _interopRequireWildcard(_utils);\r\n\r\n    function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { const newObj = {}; if (obj != null) { for (const key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\r\n    function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : {default: obj}; }\r\n\r\n    function shimRTCIceCandidate(window) {\r\n    // foundation is arbitrarily chosen as an indicator for full support for\r\n    // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\r\n      if (!window.RTCIceCandidate || window.RTCIceCandidate && 'foundation' in window.RTCIceCandidate.prototype) {\r\n        return;\r\n      }\r\n\r\n      const NativeRTCIceCandidate = window.RTCIceCandidate;\r\n      window.RTCIceCandidate = function RTCIceCandidate(args) {\r\n      // Remove the a= which shouldn't be part of the candidate string.\r\n        if ((typeof args === 'undefined' ? 'undefined' : _typeof(args)) === 'object' && args.candidate && args.candidate.indexOf('a=') === 0) {\r\n          args = JSON.parse(JSON.stringify(args));\r\n          args.candidate = args.candidate.substr(2);\r\n        }\r\n\r\n        if (args.candidate && args.candidate.length) {\r\n        // Augment the native candidate with the parsed fields.\r\n          const nativeCandidate = new NativeRTCIceCandidate(args);\r\n          const parsedCandidate = _sdp2.default.parseCandidate(args.candidate);\r\n          const augmentedCandidate = Object.assign(nativeCandidate, parsedCandidate);\r\n\r\n          // Add a serializer that does not serialize the extra attributes.\r\n          augmentedCandidate.toJSON = function toJSON() {\r\n            return {\r\n              candidate: augmentedCandidate.candidate,\r\n              sdpMid: augmentedCandidate.sdpMid,\r\n              sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\r\n              usernameFragment: augmentedCandidate.usernameFragment,\r\n            };\r\n          };\r\n          return augmentedCandidate;\r\n        }\r\n        return new NativeRTCIceCandidate(args);\r\n      };\r\n      window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\r\n\r\n      // Hook up the augmented candidate in onicecandidate and\r\n      // addEventListener('icecandidate', ...)\r\n      utils.wrapPeerConnectionEvent(window, 'icecandidate', (e) => {\r\n        if (e.candidate) {\r\n          Object.defineProperty(e, 'candidate', {\r\n            value: new window.RTCIceCandidate(e.candidate),\r\n            writable: 'false',\r\n          });\r\n        }\r\n        return e;\r\n      });\r\n    }\r\n\r\n    function shimMaxMessageSize(window) {\r\n      if (!window.RTCPeerConnection) {\r\n        return;\r\n      }\r\n      const browserDetails = utils.detectBrowser(window);\r\n\r\n      if (!('sctp' in window.RTCPeerConnection.prototype)) {\r\n        Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\r\n          get: function get() {\r\n            return typeof this._sctp === 'undefined' ? null : this._sctp;\r\n          },\r\n        });\r\n      }\r\n\r\n      const sctpInDescription = function sctpInDescription(description) {\r\n        if (!description || !description.sdp) {\r\n          return false;\r\n        }\r\n        const sections = _sdp2.default.splitSections(description.sdp);\r\n        sections.shift();\r\n        return sections.some((mediaSection) => {\r\n          const mLine = _sdp2.default.parseMLine(mediaSection);\r\n          return mLine && mLine.kind === 'application' && mLine.protocol.indexOf('SCTP') !== -1;\r\n        });\r\n      };\r\n\r\n      const getRemoteFirefoxVersion = function getRemoteFirefoxVersion(description) {\r\n      // TODO: Is there a better solution for detecting Firefox?\r\n        const match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\r\n        if (match === null || match.length < 2) {\r\n          return -1;\r\n        }\r\n        const version = parseInt(match[1], 10);\r\n        // Test for NaN (yes, this is ugly)\r\n        return version !== version ? -1 : version;\r\n      };\r\n\r\n      const getCanSendMaxMessageSize = function getCanSendMaxMessageSize(remoteIsFirefox) {\r\n      // Every implementation we know can send at least 64 KiB.\r\n      // Note: Although Chrome is technically able to send up to 256 KiB, the\r\n      //       data does not reach the other peer reliably.\r\n      //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\r\n        let canSendMaxMessageSize = 65536;\r\n        if (browserDetails.browser === 'firefox') {\r\n          if (browserDetails.version < 57) {\r\n            if (remoteIsFirefox === -1) {\r\n            // FF < 57 will send in 16 KiB chunks using the deprecated PPID\r\n            // fragmentation.\r\n              canSendMaxMessageSize = 16384;\r\n            } else {\r\n            // However, other FF (and RAWRTC) can reassemble PPID-fragmented\r\n            // messages. Thus, supporting ~2 GiB when sending.\r\n              canSendMaxMessageSize = 2147483637;\r\n            }\r\n          } else if (browserDetails.version < 60) {\r\n          // Currently, all FF >= 57 will reset the remote maximum message size\r\n          // to the default value when a data channel is created at a later\r\n          // stage. :(\r\n          // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\r\n            canSendMaxMessageSize = browserDetails.version === 57 ? 65535 : 65536;\r\n          } else {\r\n          // FF >= 60 supports sending ~2 GiB\r\n            canSendMaxMessageSize = 2147483637;\r\n          }\r\n        }\r\n        return canSendMaxMessageSize;\r\n      };\r\n\r\n      const getMaxMessageSize = function getMaxMessageSize(description, remoteIsFirefox) {\r\n      // Note: 65536 bytes is the default value from the SDP spec. Also,\r\n      //       every implementation we know supports receiving 65536 bytes.\r\n        let maxMessageSize = 65536;\r\n\r\n        // FF 57 has a slightly incorrect default remote max message size, so\r\n        // we need to adjust it here to avoid a failure when sending.\r\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\r\n        if (browserDetails.browser === 'firefox' && browserDetails.version === 57) {\r\n          maxMessageSize = 65535;\r\n        }\r\n\r\n        const match = _sdp2.default.matchPrefix(description.sdp, 'a=max-message-size:');\r\n        if (match.length > 0) {\r\n          maxMessageSize = parseInt(match[0].substr(19), 10);\r\n        } else if (browserDetails.browser === 'firefox' && remoteIsFirefox !== -1) {\r\n        // If the maximum message size is not present in the remote SDP and\r\n        // both local and remote are Firefox, the remote peer can receive\r\n        // ~2 GiB.\r\n          maxMessageSize = 2147483637;\r\n        }\r\n        return maxMessageSize;\r\n      };\r\n\r\n      const origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\r\n      window.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {\r\n        this._sctp = null;\r\n        // Chrome decided to not expose .sctp in plan-b mode.\r\n        // As usual, adapter.js has to do an 'ugly worakaround'\r\n        // to cover up the mess.\r\n        if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\r\n          const _getConfiguration = this.getConfiguration();\r\n          const sdpSemantics = _getConfiguration.sdpSemantics;\r\n\r\n          if (sdpSemantics === 'plan-b') {\r\n            Object.defineProperty(this, 'sctp', {\r\n              get: function get() {\r\n                return typeof this._sctp === 'undefined' ? null : this._sctp;\r\n              },\r\n\r\n              enumerable: true,\r\n              configurable: true,\r\n            });\r\n          }\r\n        }\r\n\r\n        if (sctpInDescription(arguments[0])) {\r\n        // Check if the remote is FF.\r\n          const isFirefox = getRemoteFirefoxVersion(arguments[0]);\r\n\r\n          // Get the maximum message size the local peer is capable of sending\r\n          const canSendMMS = getCanSendMaxMessageSize(isFirefox);\r\n\r\n          // Get the maximum message size of the remote peer.\r\n          const remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\r\n\r\n          // Determine final maximum message size\r\n          let maxMessageSize = void 0;\r\n          if (canSendMMS === 0 && remoteMMS === 0) {\r\n            maxMessageSize = Number.POSITIVE_INFINITY;\r\n          } else if (canSendMMS === 0 || remoteMMS === 0) {\r\n            maxMessageSize = Math.max(canSendMMS, remoteMMS);\r\n          } else {\r\n            maxMessageSize = Math.min(canSendMMS, remoteMMS);\r\n          }\r\n\r\n          // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\r\n          // attribute.\r\n          const sctp = {};\r\n          Object.defineProperty(sctp, 'maxMessageSize', {\r\n            get: function get() {\r\n              return maxMessageSize;\r\n            },\r\n          });\r\n          this._sctp = sctp;\r\n        }\r\n\r\n        return origSetRemoteDescription.apply(this, arguments);\r\n      };\r\n    }\r\n\r\n    function shimSendThrowTypeError(window) {\r\n      if (!(window.RTCPeerConnection && 'createDataChannel' in window.RTCPeerConnection.prototype)) {\r\n        return;\r\n      }\r\n\r\n      // Note: Although Firefox >= 57 has a native implementation, the maximum\r\n      //       message size can be reset for all data channels at a later stage.\r\n      //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\r\n\r\n      function wrapDcSend(dc, pc) {\r\n        const origDataChannelSend = dc.send;\r\n        dc.send = function send() {\r\n          const data = arguments[0];\r\n          const length = data.length || data.size || data.byteLength;\r\n          if (dc.readyState === 'open' && pc.sctp && length > pc.sctp.maxMessageSize) {\r\n            throw new TypeError(`Message too large (can send a maximum of ${pc.sctp.maxMessageSize} bytes)`);\r\n          }\r\n          return origDataChannelSend.apply(dc, arguments);\r\n        };\r\n      }\r\n      const origCreateDataChannel = window.RTCPeerConnection.prototype.createDataChannel;\r\n      window.RTCPeerConnection.prototype.createDataChannel = function createDataChannel() {\r\n        const dataChannel = origCreateDataChannel.apply(this, arguments);\r\n        wrapDcSend(dataChannel, this);\r\n        return dataChannel;\r\n      };\r\n      utils.wrapPeerConnectionEvent(window, 'datachannel', (e) => {\r\n        wrapDcSend(e.channel, e.target);\r\n        return e;\r\n      });\r\n    }\r\n\r\n    /* shims RTCConnectionState by pretending it is the same as iceConnectionState.\r\n\t * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\r\n\t * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\r\n\t * since DTLS failures would be hidden. See\r\n\t * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\r\n\t * for the Firefox tracking bug.\r\n\t */\r\n    function shimConnectionState(window) {\r\n      if (!window.RTCPeerConnection || 'connectionState' in window.RTCPeerConnection.prototype) {\r\n        return;\r\n      }\r\n      const proto = window.RTCPeerConnection.prototype;\r\n      Object.defineProperty(proto, 'connectionState', {\r\n        get: function get() {\r\n          return {\r\n            completed: 'connected',\r\n            checking: 'connecting',\r\n          }[this.iceConnectionState] || this.iceConnectionState;\r\n        },\r\n\r\n        enumerable: true,\r\n        configurable: true,\r\n      });\r\n      Object.defineProperty(proto, 'onconnectionstatechange', {\r\n        get: function get() {\r\n          return this._onconnectionstatechange || null;\r\n        },\r\n        set: function set(cb) {\r\n          if (this._onconnectionstatechange) {\r\n            this.removeEventListener('connectionstatechange', this._onconnectionstatechange);\r\n            delete this._onconnectionstatechange;\r\n          }\r\n          if (cb) {\r\n            this.addEventListener('connectionstatechange', this._onconnectionstatechange = cb);\r\n          }\r\n        },\r\n\r\n        enumerable: true,\r\n        configurable: true,\r\n      });\r\n\r\n      ['setLocalDescription', 'setRemoteDescription'].forEach((method) => {\r\n        const origMethod = proto[method];\r\n        proto[method] = function () {\r\n          if (!this._connectionstatechangepoly) {\r\n            this._connectionstatechangepoly = function (e) {\r\n              const pc = e.target;\r\n              if (pc._lastConnectionState !== pc.connectionState) {\r\n                pc._lastConnectionState = pc.connectionState;\r\n                const newEvent = new Event('connectionstatechange', e);\r\n                pc.dispatchEvent(newEvent);\r\n              }\r\n              return e;\r\n            };\r\n            this.addEventListener('iceconnectionstatechange', this._connectionstatechangepoly);\r\n          }\r\n          return origMethod.apply(this, arguments);\r\n        };\r\n      });\r\n    }\r\n\r\n    function removeAllowExtmapMixed(window) {\r\n    /* remove a=extmap-allow-mixed for Chrome < M71 */\r\n      if (!window.RTCPeerConnection) {\r\n        return;\r\n      }\r\n      const browserDetails = utils.detectBrowser(window);\r\n      if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\r\n        return;\r\n      }\r\n      const nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\r\n      window.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription(desc) {\r\n        if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\r\n          desc.sdp = desc.sdp.split('\\n').filter((line) => line.trim() !== 'a=extmap-allow-mixed').join('\\n');\r\n        }\r\n        return nativeSRD.apply(this, arguments);\r\n      };\r\n    }\r\n  }, {'./utils': 15, 'sdp': 17}], 7: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n    exports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\r\n\r\n    const _getusermedia = require('./getusermedia');\r\n\r\n    Object.defineProperty(exports, 'shimGetUserMedia', {\r\n      enumerable: true,\r\n      get: function get() {\r\n        return _getusermedia.shimGetUserMedia;\r\n      },\r\n    });\r\n\r\n    const _getdisplaymedia = require('./getdisplaymedia');\r\n\r\n    Object.defineProperty(exports, 'shimGetDisplayMedia', {\r\n      enumerable: true,\r\n      get: function get() {\r\n        return _getdisplaymedia.shimGetDisplayMedia;\r\n      },\r\n    });\r\n    exports.shimPeerConnection = shimPeerConnection;\r\n    exports.shimReplaceTrack = shimReplaceTrack;\r\n\r\n    const _utils = require('../utils');\r\n\r\n    const utils = _interopRequireWildcard(_utils);\r\n\r\n    const _filtericeservers = require('./filtericeservers');\r\n\r\n    const _rtcpeerconnectionShim = require('rtcpeerconnection-shim');\r\n\r\n    const _rtcpeerconnectionShim2 = _interopRequireDefault(_rtcpeerconnectionShim);\r\n\r\n    function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : {default: obj}; }\r\n\r\n    function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { const newObj = {}; if (obj != null) { for (const key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\r\n    function shimPeerConnection(window) {\r\n      const browserDetails = utils.detectBrowser(window);\r\n\r\n      if (window.RTCIceGatherer) {\r\n        if (!window.RTCIceCandidate) {\r\n          window.RTCIceCandidate = function RTCIceCandidate(args) {\r\n            return args;\r\n          };\r\n        }\r\n        if (!window.RTCSessionDescription) {\r\n          window.RTCSessionDescription = function RTCSessionDescription(args) {\r\n            return args;\r\n          };\r\n        }\r\n        // this adds an additional event listener to MediaStrackTrack that signals\r\n        // when a tracks enabled property was changed. Workaround for a bug in\r\n        // addStream, see below. No longer required in 15025+\r\n        if (browserDetails.version < 15025) {\r\n          const origMSTEnabled = Object.getOwnPropertyDescriptor(window.MediaStreamTrack.prototype, 'enabled');\r\n          Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\r\n            set: function set(value) {\r\n              origMSTEnabled.set.call(this, value);\r\n              const ev = new Event('enabled');\r\n              ev.enabled = value;\r\n              this.dispatchEvent(ev);\r\n            },\r\n          });\r\n        }\r\n      }\r\n\r\n      // ORTC defines the DTMF sender a bit different.\r\n      // https://github.com/w3c/ortc/issues/714\r\n      if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\r\n        Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\r\n          get: function get() {\r\n            if (this._dtmf === undefined) {\r\n              if (this.track.kind === 'audio') {\r\n                this._dtmf = new window.RTCDtmfSender(this);\r\n              } else if (this.track.kind === 'video') {\r\n                this._dtmf = null;\r\n              }\r\n            }\r\n            return this._dtmf;\r\n          },\r\n        });\r\n      }\r\n      // Edge currently only implements the RTCDtmfSender, not the\r\n      // RTCDTMFSender alias. See http://draft.ortc.org/#rtcdtmfsender2*\r\n      if (window.RTCDtmfSender && !window.RTCDTMFSender) {\r\n        window.RTCDTMFSender = window.RTCDtmfSender;\r\n      }\r\n\r\n      const RTCPeerConnectionShim = (0, _rtcpeerconnectionShim2.default)(window, browserDetails.version);\r\n      window.RTCPeerConnection = function RTCPeerConnection(config) {\r\n        if (config && config.iceServers) {\r\n          config.iceServers = (0, _filtericeservers.filterIceServers)(config.iceServers, browserDetails.version);\r\n          utils.log('ICE servers after filtering:', config.iceServers);\r\n        }\r\n        return new RTCPeerConnectionShim(config);\r\n      };\r\n      window.RTCPeerConnection.prototype = RTCPeerConnectionShim.prototype;\r\n    }\r\n\r\n    function shimReplaceTrack(window) {\r\n    // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\r\n      if (window.RTCRtpSender && !('replaceTrack' in window.RTCRtpSender.prototype)) {\r\n        window.RTCRtpSender.prototype.replaceTrack = window.RTCRtpSender.prototype.setTrack;\r\n      }\r\n    }\r\n  }, {'../utils': 15, './filtericeservers': 8, './getdisplaymedia': 9, './getusermedia': 10, 'rtcpeerconnection-shim': 16}], 8: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n    exports.filterIceServers = filterIceServers;\r\n\r\n    const _utils = require('../utils');\r\n\r\n    const utils = _interopRequireWildcard(_utils);\r\n\r\n    function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { const newObj = {}; if (obj != null) { for (const key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\r\n    // Edge does not like\r\n    // 1) stun: filtered after 14393 unless ?transport=udp is present\r\n    // 2) turn: that does not have all of turn:host:port?transport=udp\r\n    // 3) turn: with ipv6 addresses\r\n    // 4) turn: occurring muliple times\r\n    function filterIceServers(iceServers, edgeVersion) {\r\n      let hasTurn = false;\r\n      iceServers = JSON.parse(JSON.stringify(iceServers));\r\n      return iceServers.filter((server) => {\r\n        if (server && (server.urls || server.url)) {\r\n          let urls = server.urls || server.url;\r\n          if (server.url && !server.urls) {\r\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\r\n          }\r\n          const isString = typeof urls === 'string';\r\n          if (isString) {\r\n            urls = [urls];\r\n          }\r\n          urls = urls.filter((url) => {\r\n          // filter STUN unconditionally.\r\n            if (url.indexOf('stun:') === 0) {\r\n              return false;\r\n            }\r\n\r\n            const validTurn = url.startsWith('turn') && !url.startsWith('turn:[') && url.includes('transport=udp');\r\n            if (validTurn && !hasTurn) {\r\n              hasTurn = true;\r\n              return true;\r\n            }\r\n            return validTurn && !hasTurn;\r\n          });\r\n\r\n          delete server.url;\r\n          server.urls = isString ? urls[0] : urls;\r\n          return !!urls.length;\r\n        }\r\n      });\r\n    }\r\n  }, {'../utils': 15}], 9: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n    exports.shimGetDisplayMedia = shimGetDisplayMedia;\r\n    function shimGetDisplayMedia(window) {\r\n      if (!('getDisplayMedia' in window.navigator)) {\r\n        return;\r\n      }\r\n      if (!window.navigator.mediaDevices) {\r\n        return;\r\n      }\r\n      if (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {\r\n        return;\r\n      }\r\n      window.navigator.mediaDevices.getDisplayMedia = window.navigator.getDisplayMedia.bind(window.navigator);\r\n    }\r\n  }, {}], 10: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n    exports.shimGetUserMedia = shimGetUserMedia;\r\n    function shimGetUserMedia(window) {\r\n      const navigator = window && window.navigator;\r\n\r\n      const shimError_ = function shimError_(e) {\r\n        return {\r\n          name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\r\n          message: e.message,\r\n          constraint: e.constraint,\r\n          toString: function toString() {\r\n            return this.name;\r\n          },\r\n        };\r\n      };\r\n\r\n      // getUserMedia error shim.\r\n      const origGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\r\n      navigator.mediaDevices.getUserMedia = function (c) {\r\n        return origGetUserMedia(c).catch((e) => Promise.reject(shimError_(e)));\r\n      };\r\n    }\r\n  }, {}], 11: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n    exports.shimGetDisplayMedia = exports.shimGetUserMedia = undefined;\r\n\r\n    const _typeof = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj; };\r\n\r\n    const _getusermedia = require('./getusermedia');\r\n\r\n    Object.defineProperty(exports, 'shimGetUserMedia', {\r\n      enumerable: true,\r\n      get: function get() {\r\n        return _getusermedia.shimGetUserMedia;\r\n      },\r\n    });\r\n\r\n    const _getdisplaymedia = require('./getdisplaymedia');\r\n\r\n    Object.defineProperty(exports, 'shimGetDisplayMedia', {\r\n      enumerable: true,\r\n      get: function get() {\r\n        return _getdisplaymedia.shimGetDisplayMedia;\r\n      },\r\n    });\r\n    exports.shimOnTrack = shimOnTrack;\r\n    exports.shimPeerConnection = shimPeerConnection;\r\n    exports.shimSenderGetStats = shimSenderGetStats;\r\n    exports.shimReceiverGetStats = shimReceiverGetStats;\r\n    exports.shimRemoveStream = shimRemoveStream;\r\n    exports.shimRTCDataChannel = shimRTCDataChannel;\r\n\r\n    const _utils = require('../utils');\r\n\r\n    const utils = _interopRequireWildcard(_utils);\r\n\r\n    function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { const newObj = {}; if (obj != null) { for (const key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\r\n    function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, {value, enumerable: true, configurable: true, writable: true}); } else { obj[key] = value; } return obj; }\r\n\r\n    function shimOnTrack(window) {\r\n      if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCTrackEvent && 'receiver' in window.RTCTrackEvent.prototype && !('transceiver' in window.RTCTrackEvent.prototype)) {\r\n        Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\r\n          get: function get() {\r\n            return {receiver: this.receiver};\r\n          },\r\n        });\r\n      }\r\n    }\r\n\r\n    function shimPeerConnection(window) {\r\n      const browserDetails = utils.detectBrowser(window);\r\n\r\n      if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\r\n        return; // probably media.peerconnection.enabled=false in about:config\r\n      }\r\n      if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\r\n      // very basic support for old versions.\r\n        window.RTCPeerConnection = window.mozRTCPeerConnection;\r\n      }\r\n\r\n      if (browserDetails.version < 53) {\r\n      // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\r\n        ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach((method) => {\r\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\r\n          const methodObj = _defineProperty({}, method, function () {\r\n            arguments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);\r\n            return nativeMethod.apply(this, arguments);\r\n          });\r\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\r\n        });\r\n      }\r\n\r\n      // support for addIceCandidate(null or undefined)\r\n      const nativeAddIceCandidate = window.RTCPeerConnection.prototype.addIceCandidate;\r\n      window.RTCPeerConnection.prototype.addIceCandidate = function addIceCandidate() {\r\n        if (!arguments[0]) {\r\n          if (arguments[1]) {\r\n            arguments[1].apply(null);\r\n          }\r\n          return Promise.resolve();\r\n        }\r\n        // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\r\n        // in older versions.\r\n        if (browserDetails.version < 68 && arguments[0] && arguments[0].candidate === '') {\r\n          return Promise.resolve();\r\n        }\r\n        return nativeAddIceCandidate.apply(this, arguments);\r\n      };\r\n\r\n      const modernStatsTypes = {\r\n        inboundrtp: 'inbound-rtp',\r\n        outboundrtp: 'outbound-rtp',\r\n        candidatepair: 'candidate-pair',\r\n        localcandidate: 'local-candidate',\r\n        remotecandidate: 'remote-candidate',\r\n      };\r\n\r\n      const nativeGetStats = window.RTCPeerConnection.prototype.getStats;\r\n      window.RTCPeerConnection.prototype.getStats = function getStats() {\r\n        const _arguments = Array.prototype.slice.call(arguments);\r\n        const selector = _arguments[0];\r\n        const onSucc = _arguments[1];\r\n        const onErr = _arguments[2];\r\n\r\n        return nativeGetStats.apply(this, [selector || null]).then((stats) => {\r\n          if (browserDetails.version < 53 && !onSucc) {\r\n          // Shim only promise getStats with spec-hyphens in type names\r\n          // Leave callback version alone; misc old uses of forEach before Map\r\n            try {\r\n              stats.forEach((stat) => {\r\n                stat.type = modernStatsTypes[stat.type] || stat.type;\r\n              });\r\n            } catch (e) {\r\n              if (e.name !== 'TypeError') {\r\n                throw e;\r\n              }\r\n              // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\r\n              stats.forEach((stat, i) => {\r\n                stats.set(i, Object.assign({}, stat, {\r\n                  type: modernStatsTypes[stat.type] || stat.type,\r\n                }));\r\n              });\r\n            }\r\n          }\r\n          return stats;\r\n        }).then(onSucc, onErr);\r\n      };\r\n    }\r\n\r\n    function shimSenderGetStats(window) {\r\n      if (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender)) {\r\n        return;\r\n      }\r\n      if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\r\n        return;\r\n      }\r\n      const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\r\n      if (origGetSenders) {\r\n        window.RTCPeerConnection.prototype.getSenders = function getSenders() {\r\n          const _this = this;\r\n\r\n          const senders = origGetSenders.apply(this, []);\r\n          senders.forEach((sender) => sender._pc = _this);\r\n          return senders;\r\n        };\r\n      }\r\n\r\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\r\n      if (origAddTrack) {\r\n        window.RTCPeerConnection.prototype.addTrack = function addTrack() {\r\n          const sender = origAddTrack.apply(this, arguments);\r\n          sender._pc = this;\r\n          return sender;\r\n        };\r\n      }\r\n      window.RTCRtpSender.prototype.getStats = function getStats() {\r\n        return this.track ? this._pc.getStats(this.track) : Promise.resolve(new Map());\r\n      };\r\n    }\r\n\r\n    function shimReceiverGetStats(window) {\r\n      if (!((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCPeerConnection && window.RTCRtpSender)) {\r\n        return;\r\n      }\r\n      if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\r\n        return;\r\n      }\r\n      const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\r\n      if (origGetReceivers) {\r\n        window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\r\n          const _this2 = this;\r\n\r\n          const receivers = origGetReceivers.apply(this, []);\r\n          receivers.forEach((receiver) => receiver._pc = _this2);\r\n          return receivers;\r\n        };\r\n      }\r\n      utils.wrapPeerConnectionEvent(window, 'track', (e) => {\r\n        e.receiver._pc = e.srcElement;\r\n        return e;\r\n      });\r\n      window.RTCRtpReceiver.prototype.getStats = function getStats() {\r\n        return this._pc.getStats(this.track);\r\n      };\r\n    }\r\n\r\n    function shimRemoveStream(window) {\r\n      if (!window.RTCPeerConnection || 'removeStream' in window.RTCPeerConnection.prototype) {\r\n        return;\r\n      }\r\n      window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n        const _this3 = this;\r\n\r\n        utils.deprecated('removeStream', 'removeTrack');\r\n        this.getSenders().forEach((sender) => {\r\n          if (sender.track && stream.getTracks().includes(sender.track)) {\r\n            _this3.removeTrack(sender);\r\n          }\r\n        });\r\n      };\r\n    }\r\n\r\n    function shimRTCDataChannel(window) {\r\n    // rename DataChannel to RTCDataChannel (native fix in FF60):\r\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\r\n      if (window.DataChannel && !window.RTCDataChannel) {\r\n        window.RTCDataChannel = window.DataChannel;\r\n      }\r\n    }\r\n  }, {'../utils': 15, './getdisplaymedia': 12, './getusermedia': 13}], 12: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n    exports.shimGetDisplayMedia = shimGetDisplayMedia;\r\n    function shimGetDisplayMedia(window, preferredMediaSource) {\r\n      if (window.navigator.mediaDevices && 'getDisplayMedia' in window.navigator.mediaDevices) {\r\n        return;\r\n      }\r\n      if (!window.navigator.mediaDevices) {\r\n        return;\r\n      }\r\n      window.navigator.mediaDevices.getDisplayMedia = function getDisplayMedia(constraints) {\r\n        if (!(constraints && constraints.video)) {\r\n          const err = new DOMException('getDisplayMedia without video ' + 'constraints is undefined');\r\n          err.name = 'NotFoundError';\r\n          // from https://heycam.github.io/webidl/#idl-DOMException-error-names\r\n          err.code = 8;\r\n          return Promise.reject(err);\r\n        }\r\n        if (constraints.video === true) {\r\n          constraints.video = {mediaSource: preferredMediaSource};\r\n        } else {\r\n          constraints.video.mediaSource = preferredMediaSource;\r\n        }\r\n        return window.navigator.mediaDevices.getUserMedia(constraints);\r\n      };\r\n    }\r\n  }, {}], 13: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n\r\n    const _typeof = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj; };\r\n\r\n    exports.shimGetUserMedia = shimGetUserMedia;\r\n\r\n    const _utils = require('../utils');\r\n\r\n    const utils = _interopRequireWildcard(_utils);\r\n\r\n    function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { const newObj = {}; if (obj != null) { for (const key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\r\n    function shimGetUserMedia(window) {\r\n      const browserDetails = utils.detectBrowser(window);\r\n      const navigator = window && window.navigator;\r\n      const MediaStreamTrack = window && window.MediaStreamTrack;\r\n\r\n      navigator.getUserMedia = function (constraints, onSuccess, onError) {\r\n      // Replace Firefox 44+'s deprecation warning with unprefixed version.\r\n        utils.deprecated('navigator.getUserMedia', 'navigator.mediaDevices.getUserMedia');\r\n        navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\r\n      };\r\n\r\n      if (!(browserDetails.version > 55 && 'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\r\n        const remap = function remap(obj, a, b) {\r\n          if (a in obj && !(b in obj)) {\r\n            obj[b] = obj[a];\r\n            delete obj[a];\r\n          }\r\n        };\r\n\r\n        const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\r\n        navigator.mediaDevices.getUserMedia = function (c) {\r\n          if ((typeof c === 'undefined' ? 'undefined' : _typeof(c)) === 'object' && _typeof(c.audio) === 'object') {\r\n            c = JSON.parse(JSON.stringify(c));\r\n            remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\r\n            remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\r\n          }\r\n          return nativeGetUserMedia(c);\r\n        };\r\n\r\n        if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\r\n          const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\r\n          MediaStreamTrack.prototype.getSettings = function () {\r\n            const obj = nativeGetSettings.apply(this, arguments);\r\n            remap(obj, 'mozAutoGainControl', 'autoGainControl');\r\n            remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\r\n            return obj;\r\n          };\r\n        }\r\n\r\n        if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\r\n          const nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\r\n          MediaStreamTrack.prototype.applyConstraints = function (c) {\r\n            if (this.kind === 'audio' && (typeof c === 'undefined' ? 'undefined' : _typeof(c)) === 'object') {\r\n              c = JSON.parse(JSON.stringify(c));\r\n              remap(c, 'autoGainControl', 'mozAutoGainControl');\r\n              remap(c, 'noiseSuppression', 'mozNoiseSuppression');\r\n            }\r\n            return nativeApplyConstraints.apply(this, [c]);\r\n          };\r\n        }\r\n      }\r\n    }\r\n  }, {'../utils': 15}], 14: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n\r\n    const _typeof = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj; };\r\n\r\n    exports.shimLocalStreamsAPI = shimLocalStreamsAPI;\r\n    exports.shimRemoteStreamsAPI = shimRemoteStreamsAPI;\r\n    exports.shimCallbacksAPI = shimCallbacksAPI;\r\n    exports.shimGetUserMedia = shimGetUserMedia;\r\n    exports.shimConstraints = shimConstraints;\r\n    exports.shimRTCIceServerUrls = shimRTCIceServerUrls;\r\n    exports.shimTrackEventTransceiver = shimTrackEventTransceiver;\r\n    exports.shimCreateOfferLegacy = shimCreateOfferLegacy;\r\n\r\n    const _utils = require('../utils');\r\n\r\n    const utils = _interopRequireWildcard(_utils);\r\n\r\n    function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { const newObj = {}; if (obj != null) { for (const key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\r\n\r\n    function shimLocalStreamsAPI(window) {\r\n      if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !window.RTCPeerConnection) {\r\n        return;\r\n      }\r\n      if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\r\n        window.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\r\n          if (!this._localStreams) {\r\n            this._localStreams = [];\r\n          }\r\n          return this._localStreams;\r\n        };\r\n      }\r\n      if (!('addStream' in window.RTCPeerConnection.prototype)) {\r\n        const _addTrack = window.RTCPeerConnection.prototype.addTrack;\r\n        window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\r\n          const _this = this;\r\n\r\n          if (!this._localStreams) {\r\n            this._localStreams = [];\r\n          }\r\n          if (!this._localStreams.includes(stream)) {\r\n            this._localStreams.push(stream);\r\n          }\r\n          // Try to emulate Chrome's behaviour of adding in audio-video order.\r\n          // Safari orders by track id.\r\n          stream.getAudioTracks().forEach((track) => _addTrack.call(_this, track, stream));\r\n          stream.getVideoTracks().forEach((track) => _addTrack.call(_this, track, stream));\r\n        };\r\n\r\n        window.RTCPeerConnection.prototype.addTrack = function addTrack(track) {\r\n          const stream = arguments[1];\r\n          if (stream) {\r\n            if (!this._localStreams) {\r\n              this._localStreams = [stream];\r\n            } else if (!this._localStreams.includes(stream)) {\r\n              this._localStreams.push(stream);\r\n            }\r\n          }\r\n          return _addTrack.apply(this, arguments);\r\n        };\r\n      }\r\n      if (!('removeStream' in window.RTCPeerConnection.prototype)) {\r\n        window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\r\n          const _this2 = this;\r\n\r\n          if (!this._localStreams) {\r\n            this._localStreams = [];\r\n          }\r\n          const index = this._localStreams.indexOf(stream);\r\n          if (index === -1) {\r\n            return;\r\n          }\r\n          this._localStreams.splice(index, 1);\r\n          const tracks = stream.getTracks();\r\n          this.getSenders().forEach((sender) => {\r\n            if (tracks.includes(sender.track)) {\r\n              _this2.removeTrack(sender);\r\n            }\r\n          });\r\n        };\r\n      }\r\n    }\r\n\r\n    function shimRemoteStreamsAPI(window) {\r\n      if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !window.RTCPeerConnection) {\r\n        return;\r\n      }\r\n      if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\r\n        window.RTCPeerConnection.prototype.getRemoteStreams = function getRemoteStreams() {\r\n          return this._remoteStreams ? this._remoteStreams : [];\r\n        };\r\n      }\r\n      if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\r\n        Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\r\n          get: function get() {\r\n            return this._onaddstream;\r\n          },\r\n          set: function set(f) {\r\n            const _this3 = this;\r\n\r\n            if (this._onaddstream) {\r\n              this.removeEventListener('addstream', this._onaddstream);\r\n              this.removeEventListener('track', this._onaddstreampoly);\r\n            }\r\n            this.addEventListener('addstream', this._onaddstream = f);\r\n            this.addEventListener('track', this._onaddstreampoly = function (e) {\r\n              e.streams.forEach((stream) => {\r\n                if (!_this3._remoteStreams) {\r\n                  _this3._remoteStreams = [];\r\n                }\r\n                if (_this3._remoteStreams.includes(stream)) {\r\n                  return;\r\n                }\r\n                _this3._remoteStreams.push(stream);\r\n                const event = new Event('addstream');\r\n                event.stream = stream;\r\n                _this3.dispatchEvent(event);\r\n              });\r\n            });\r\n          },\r\n        });\r\n        const origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\r\n        window.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {\r\n          const pc = this;\r\n          if (!this._onaddstreampoly) {\r\n            this.addEventListener('track', this._onaddstreampoly = function (e) {\r\n              e.streams.forEach((stream) => {\r\n                if (!pc._remoteStreams) {\r\n                  pc._remoteStreams = [];\r\n                }\r\n                if (pc._remoteStreams.indexOf(stream) >= 0) {\r\n                  return;\r\n                }\r\n                pc._remoteStreams.push(stream);\r\n                const event = new Event('addstream');\r\n                event.stream = stream;\r\n                pc.dispatchEvent(event);\r\n              });\r\n            });\r\n          }\r\n          return origSetRemoteDescription.apply(pc, arguments);\r\n        };\r\n      }\r\n    }\r\n\r\n    function shimCallbacksAPI(window) {\r\n      if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) !== 'object' || !window.RTCPeerConnection) {\r\n        return;\r\n      }\r\n      const prototype = window.RTCPeerConnection.prototype;\r\n      const origCreateOffer = prototype.createOffer;\r\n      const origCreateAnswer = prototype.createAnswer;\r\n      const setLocalDescription = prototype.setLocalDescription;\r\n      const setRemoteDescription = prototype.setRemoteDescription;\r\n      const addIceCandidate = prototype.addIceCandidate;\r\n\r\n      prototype.createOffer = function createOffer(successCallback, failureCallback) {\r\n        const options = arguments.length >= 2 ? arguments[2] : arguments[0];\r\n        const promise = origCreateOffer.apply(this, [options]);\r\n        if (!failureCallback) {\r\n          return promise;\r\n        }\r\n        promise.then(successCallback, failureCallback);\r\n        return Promise.resolve();\r\n      };\r\n\r\n      prototype.createAnswer = function createAnswer(successCallback, failureCallback) {\r\n        const options = arguments.length >= 2 ? arguments[2] : arguments[0];\r\n        const promise = origCreateAnswer.apply(this, [options]);\r\n        if (!failureCallback) {\r\n          return promise;\r\n        }\r\n        promise.then(successCallback, failureCallback);\r\n        return Promise.resolve();\r\n      };\r\n\r\n      let withCallback = function withCallback(description, successCallback, failureCallback) {\r\n        const promise = setLocalDescription.apply(this, [description]);\r\n        if (!failureCallback) {\r\n          return promise;\r\n        }\r\n        promise.then(successCallback, failureCallback);\r\n        return Promise.resolve();\r\n      };\r\n      prototype.setLocalDescription = withCallback;\r\n\r\n      withCallback = function withCallback(description, successCallback, failureCallback) {\r\n        const promise = setRemoteDescription.apply(this, [description]);\r\n        if (!failureCallback) {\r\n          return promise;\r\n        }\r\n        promise.then(successCallback, failureCallback);\r\n        return Promise.resolve();\r\n      };\r\n      prototype.setRemoteDescription = withCallback;\r\n\r\n      withCallback = function withCallback(candidate, successCallback, failureCallback) {\r\n        const promise = addIceCandidate.apply(this, [candidate]);\r\n        if (!failureCallback) {\r\n          return promise;\r\n        }\r\n        promise.then(successCallback, failureCallback);\r\n        return Promise.resolve();\r\n      };\r\n      prototype.addIceCandidate = withCallback;\r\n    }\r\n\r\n    function shimGetUserMedia(window) {\r\n      const navigator = window && window.navigator;\r\n\r\n      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n      // shim not needed in Safari 12.1\r\n        const mediaDevices = navigator.mediaDevices;\r\n        const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\r\n        navigator.mediaDevices.getUserMedia = function (constraints) {\r\n          return _getUserMedia(shimConstraints(constraints));\r\n        };\r\n      }\r\n\r\n      if (!navigator.getUserMedia && navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n        navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\r\n          navigator.mediaDevices.getUserMedia(constraints).then(cb, errcb);\r\n        }.bind(navigator);\r\n      }\r\n    }\r\n\r\n    function shimConstraints(constraints) {\r\n      if (constraints && constraints.video !== undefined) {\r\n        return Object.assign({}, constraints, {video: utils.compactObject(constraints.video)});\r\n      }\r\n\r\n      return constraints;\r\n    }\r\n\r\n    function shimRTCIceServerUrls(window) {\r\n    // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\r\n      const OrigPeerConnection = window.RTCPeerConnection;\r\n      window.RTCPeerConnection = function RTCPeerConnection(pcConfig, pcConstraints) {\r\n        if (pcConfig && pcConfig.iceServers) {\r\n          const newIceServers = [];\r\n          for (let i = 0; i < pcConfig.iceServers.length; i++) {\r\n            let server = pcConfig.iceServers[i];\r\n            if (!server.hasOwnProperty('urls') && server.hasOwnProperty('url')) {\r\n              utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\r\n              server = JSON.parse(JSON.stringify(server));\r\n              server.urls = server.url;\r\n              delete server.url;\r\n              newIceServers.push(server);\r\n            } else {\r\n              newIceServers.push(pcConfig.iceServers[i]);\r\n            }\r\n          }\r\n          pcConfig.iceServers = newIceServers;\r\n        }\r\n        return new OrigPeerConnection(pcConfig, pcConstraints);\r\n      };\r\n      window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\r\n      // wrap static methods. Currently just generateCertificate.\r\n      if ('generateCertificate' in window.RTCPeerConnection) {\r\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\r\n          get: function get() {\r\n            return OrigPeerConnection.generateCertificate;\r\n          },\r\n        });\r\n      }\r\n    }\r\n\r\n    function shimTrackEventTransceiver(window) {\r\n    // Add event.transceiver member over deprecated event.receiver\r\n      if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object' && window.RTCTrackEvent && 'receiver' in window.RTCTrackEvent.prototype && !('transceiver' in window.RTCTrackEvent.prototype)) {\r\n        Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\r\n          get: function get() {\r\n            return {receiver: this.receiver};\r\n          },\r\n        });\r\n      }\r\n    }\r\n\r\n    function shimCreateOfferLegacy(window) {\r\n      const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\r\n      window.RTCPeerConnection.prototype.createOffer = function createOffer(offerOptions) {\r\n        if (offerOptions) {\r\n          if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\r\n          // support bit values\r\n            offerOptions.offerToReceiveAudio = !!offerOptions.offerToReceiveAudio;\r\n          }\r\n          const audioTransceiver = this.getTransceivers().find((transceiver) => transceiver.receiver.track.kind === 'audio');\r\n          if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\r\n            if (audioTransceiver.direction === 'sendrecv') {\r\n              if (audioTransceiver.setDirection) {\r\n                audioTransceiver.setDirection('sendonly');\r\n              } else {\r\n                audioTransceiver.direction = 'sendonly';\r\n              }\r\n            } else if (audioTransceiver.direction === 'recvonly') {\r\n              if (audioTransceiver.setDirection) {\r\n                audioTransceiver.setDirection('inactive');\r\n              } else {\r\n                audioTransceiver.direction = 'inactive';\r\n              }\r\n            }\r\n          } else if (offerOptions.offerToReceiveAudio === true && !audioTransceiver) {\r\n            this.addTransceiver('audio');\r\n          }\r\n\r\n          if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\r\n          // support bit values\r\n            offerOptions.offerToReceiveVideo = !!offerOptions.offerToReceiveVideo;\r\n          }\r\n          const videoTransceiver = this.getTransceivers().find((transceiver) => transceiver.receiver.track.kind === 'video');\r\n          if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\r\n            if (videoTransceiver.direction === 'sendrecv') {\r\n              if (videoTransceiver.setDirection) {\r\n                videoTransceiver.setDirection('sendonly');\r\n              } else {\r\n                videoTransceiver.direction = 'sendonly';\r\n              }\r\n            } else if (videoTransceiver.direction === 'recvonly') {\r\n              if (videoTransceiver.setDirection) {\r\n                videoTransceiver.setDirection('inactive');\r\n              } else {\r\n                videoTransceiver.direction = 'inactive';\r\n              }\r\n            }\r\n          } else if (offerOptions.offerToReceiveVideo === true && !videoTransceiver) {\r\n            this.addTransceiver('video');\r\n          }\r\n        }\r\n        return origCreateOffer.apply(this, arguments);\r\n      };\r\n    }\r\n  }, {'../utils': 15}], 15: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n    /* eslint-env node */\r\n    'use strict';\r\n\r\n    Object.defineProperty(exports, '__esModule', {\r\n      value: true,\r\n    });\r\n\r\n    const _typeof = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj; };\r\n\r\n    exports.extractVersion = extractVersion;\r\n    exports.wrapPeerConnectionEvent = wrapPeerConnectionEvent;\r\n    exports.disableLog = disableLog;\r\n    exports.disableWarnings = disableWarnings;\r\n    exports.log = log;\r\n    exports.deprecated = deprecated;\r\n    exports.detectBrowser = detectBrowser;\r\n    exports.compactObject = compactObject;\r\n    exports.walkStats = walkStats;\r\n    exports.filterStats = filterStats;\r\n\r\n    function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, {value, enumerable: true, configurable: true, writable: true}); } else { obj[key] = value; } return obj; }\r\n\r\n    let logDisabled_ = true;\r\n    let deprecationWarnings_ = true;\r\n\r\n    /**\r\n\t * Extract browser version out of the provided user agent string.\r\n\t *\r\n\t * @param {!string} uastring userAgent string.\r\n\t * @param {!string} expr Regular expression used as match criteria.\r\n\t * @param {!number} pos position in the version string to be returned.\r\n\t * @return {!number} browser version.\r\n\t */\r\n    function extractVersion(uastring, expr, pos) {\r\n      const match = uastring.match(expr);\r\n      return match && match.length >= pos && parseInt(match[pos], 10);\r\n    }\r\n\r\n    // Wraps the peerconnection event eventNameToWrap in a function\r\n    // which returns the modified event object (or false to prevent\r\n    // the event).\r\n    function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\r\n      if (!window.RTCPeerConnection) {\r\n        return;\r\n      }\r\n      const proto = window.RTCPeerConnection.prototype;\r\n      const nativeAddEventListener = proto.addEventListener;\r\n      proto.addEventListener = function (nativeEventName, cb) {\r\n        if (nativeEventName !== eventNameToWrap) {\r\n          return nativeAddEventListener.apply(this, arguments);\r\n        }\r\n        const wrappedCallback = function wrappedCallback(e) {\r\n          const modifiedEvent = wrapper(e);\r\n          if (modifiedEvent) {\r\n            cb(modifiedEvent);\r\n          }\r\n        };\r\n        this._eventMap = this._eventMap || {};\r\n        this._eventMap[cb] = wrappedCallback;\r\n        return nativeAddEventListener.apply(this, [nativeEventName, wrappedCallback]);\r\n      };\r\n\r\n      const nativeRemoveEventListener = proto.removeEventListener;\r\n      proto.removeEventListener = function (nativeEventName, cb) {\r\n        if (nativeEventName !== eventNameToWrap || !this._eventMap || !this._eventMap[cb]) {\r\n          return nativeRemoveEventListener.apply(this, arguments);\r\n        }\r\n        const unwrappedCb = this._eventMap[cb];\r\n        delete this._eventMap[cb];\r\n        return nativeRemoveEventListener.apply(this, [nativeEventName, unwrappedCb]);\r\n      };\r\n\r\n      Object.defineProperty(proto, `on${eventNameToWrap}`, {\r\n        get: function get() {\r\n          return this[`_on${eventNameToWrap}`];\r\n        },\r\n        set: function set(cb) {\r\n          if (this[`_on${eventNameToWrap}`]) {\r\n            this.removeEventListener(eventNameToWrap, this[`_on${eventNameToWrap}`]);\r\n            delete this[`_on${eventNameToWrap}`];\r\n          }\r\n          if (cb) {\r\n            this.addEventListener(eventNameToWrap, this[`_on${eventNameToWrap}`] = cb);\r\n          }\r\n        },\r\n\r\n        enumerable: true,\r\n        configurable: true,\r\n      });\r\n    }\r\n\r\n    function disableLog(bool) {\r\n      if (typeof bool !== 'boolean') {\r\n        return new Error(`Argument type: ${typeof bool === 'undefined' ? 'undefined' : _typeof(bool)}. Please use a boolean.`);\r\n      }\r\n      logDisabled_ = bool;\r\n      return bool ? 'adapter.js logging disabled' : 'adapter.js logging enabled';\r\n    }\r\n\r\n    /**\r\n\t * Disable or enable deprecation warnings\r\n\t * @param {!boolean} bool set to true to disable warnings.\r\n\t */\r\n    function disableWarnings(bool) {\r\n      if (typeof bool !== 'boolean') {\r\n        return new Error(`Argument type: ${typeof bool === 'undefined' ? 'undefined' : _typeof(bool)}. Please use a boolean.`);\r\n      }\r\n      deprecationWarnings_ = !bool;\r\n      return `adapter.js deprecation warnings ${bool ? 'disabled' : 'enabled'}`;\r\n    }\r\n\r\n    function log() {\r\n      if ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object') {\r\n        if (logDisabled_) {\r\n          return;\r\n        }\r\n        if (typeof console !== 'undefined' && typeof console.log === 'function') {\r\n          console.log.apply(console, arguments);\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n\t * Shows a deprecation warning suggesting the modern and spec-compatible API.\r\n\t */\r\n    function deprecated(oldMethod, newMethod) {\r\n      if (!deprecationWarnings_) {\r\n        return;\r\n      }\r\n      console.warn(`${oldMethod} is deprecated, please use ${newMethod} instead.`);\r\n    }\r\n\r\n    /**\r\n\t * Browser detector.\r\n\t *\r\n\t * @return {object} result containing browser and version\r\n\t *     properties.\r\n\t */\r\n    function detectBrowser(window) {\r\n      const navigator = window.navigator;\r\n\r\n      // Returned result object.\r\n\r\n      const result = {browser: null, version: null};\r\n\r\n      // Fail early if it's not a browser\r\n      if (typeof window === 'undefined' || !window.navigator) {\r\n        result.browser = 'Not a browser.';\r\n        return result;\r\n      }\r\n\r\n      if (navigator.mozGetUserMedia) {\r\n      // Firefox.\r\n        result.browser = 'firefox';\r\n        result.version = extractVersion(navigator.userAgent, /Firefox\\/(\\d+)\\./, 1);\r\n      } else if (navigator.webkitGetUserMedia || window.isSecureContext === false && window.webkitRTCPeerConnection && !window.RTCIceGatherer) {\r\n      // Chrome, Chromium, Webview, Opera.\r\n      // Version matches Chrome/WebRTC version.\r\n      // Chrome 74 removed webkitGetUserMedia on http as well so we need the\r\n      // more complicated fallback to webkitRTCPeerConnection.\r\n        result.browser = 'chrome';\r\n        result.version = extractVersion(navigator.userAgent, /Chrom(e|ium)\\/(\\d+)\\./, 2);\r\n      } else if (navigator.mediaDevices && navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) {\r\n      // Edge.\r\n        result.browser = 'edge';\r\n        result.version = extractVersion(navigator.userAgent, /Edge\\/(\\d+).(\\d+)$/, 2);\r\n      } else if (window.RTCPeerConnection && navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) {\r\n      // Safari.\r\n        result.browser = 'safari';\r\n        result.version = extractVersion(navigator.userAgent, /AppleWebKit\\/(\\d+)\\./, 1);\r\n        result.supportsUnifiedPlan = window.RTCRtpTransceiver && 'currentDirection' in window.RTCRtpTransceiver.prototype;\r\n      } else {\r\n      // Default fallthrough: not supported.\r\n        result.browser = 'Not a supported browser.';\r\n        return result;\r\n      }\r\n\r\n      return result;\r\n    }\r\n\r\n    /**\r\n\t * Checks if something is an object.\r\n\t *\r\n\t * @param {*} val The something you want to check.\r\n\t * @return true if val is an object, false otherwise.\r\n\t */\r\n    function isObject(val) {\r\n      return Object.prototype.toString.call(val) === '[object Object]';\r\n    }\r\n\r\n    /**\r\n\t * Remove all empty objects and undefined values\r\n\t * from a nested object -- an enhanced and vanilla version\r\n\t * of Lodash's `compact`.\r\n\t */\r\n    function compactObject(data) {\r\n      if (!isObject(data)) {\r\n        return data;\r\n      }\r\n\r\n      return Object.keys(data).reduce((accumulator, key) => {\r\n        const isObj = isObject(data[key]);\r\n        const value = isObj ? compactObject(data[key]) : data[key];\r\n        const isEmptyObject = isObj && !Object.keys(value).length;\r\n        if (value === undefined || isEmptyObject) {\r\n          return accumulator;\r\n        }\r\n        return Object.assign(accumulator, _defineProperty({}, key, value));\r\n      }, {});\r\n    }\r\n\r\n    /* iterates the stats graph recursively. */\r\n    function walkStats(stats, base, resultSet) {\r\n      if (!base || resultSet.has(base.id)) {\r\n        return;\r\n      }\r\n      resultSet.set(base.id, base);\r\n      Object.keys(base).forEach((name) => {\r\n        if (name.endsWith('Id')) {\r\n          walkStats(stats, stats.get(base[name]), resultSet);\r\n        } else if (name.endsWith('Ids')) {\r\n          base[name].forEach((id) => {\r\n            walkStats(stats, stats.get(id), resultSet);\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    /* filter getStats for a sender/receiver track. */\r\n    function filterStats(result, track, outbound) {\r\n      const streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\r\n      const filteredResult = new Map();\r\n      if (track === null) {\r\n        return filteredResult;\r\n      }\r\n      const trackStats = [];\r\n      result.forEach((value) => {\r\n        if (value.type === 'track' && value.trackIdentifier === track.id) {\r\n          trackStats.push(value);\r\n        }\r\n      });\r\n      trackStats.forEach((trackStat) => {\r\n        result.forEach((stats) => {\r\n          if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\r\n            walkStats(result, stats, filteredResult);\r\n          }\r\n        });\r\n      });\r\n      return filteredResult;\r\n    }\r\n  }, {}], 16: [function (require, module, exports) {\r\n  /*\r\n\t *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\r\n\t *\r\n\t *  Use of this source code is governed by a BSD-style license\r\n\t *  that can be found in the LICENSE file in the root of the source\r\n\t *  tree.\r\n\t */\r\n\t /* eslint-env node */\r\n    'use strict';\r\n\r\n    const SDPUtils = require('sdp');\r\n\r\n    function fixStatsType(stat) {\r\n      return {\r\n        inboundrtp: 'inbound-rtp',\r\n        outboundrtp: 'outbound-rtp',\r\n        candidatepair: 'candidate-pair',\r\n        localcandidate: 'local-candidate',\r\n        remotecandidate: 'remote-candidate',\r\n      }[stat.type] || stat.type;\r\n    }\r\n\r\n    function writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\r\n      let sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\r\n\r\n      // Map ICE parameters (ufrag, pwd) to SDP.\r\n      sdp += SDPUtils.writeIceParameters(\r\n          transceiver.iceGatherer.getLocalParameters());\r\n\r\n      // Map DTLS parameters to SDP.\r\n      sdp += SDPUtils.writeDtlsParameters(\r\n          transceiver.dtlsTransport.getLocalParameters(),\r\n          type === 'offer' ? 'actpass' : dtlsRole || 'active');\r\n\r\n      sdp += `a=mid:${transceiver.mid}\\r\\n`;\r\n\r\n      if (transceiver.rtpSender && transceiver.rtpReceiver) {\r\n        sdp += 'a=sendrecv\\r\\n';\r\n      } else if (transceiver.rtpSender) {\r\n        sdp += 'a=sendonly\\r\\n';\r\n      } else if (transceiver.rtpReceiver) {\r\n        sdp += 'a=recvonly\\r\\n';\r\n      } else {\r\n        sdp += 'a=inactive\\r\\n';\r\n      }\r\n\r\n      if (transceiver.rtpSender) {\r\n        const trackId = transceiver.rtpSender._initialTrackId ||\r\n\t\t\t\t\ttransceiver.rtpSender.track.id;\r\n        transceiver.rtpSender._initialTrackId = trackId;\r\n        // spec.\r\n        const msid = `msid:${stream ? stream.id : '-'} ${\r\n          trackId}\\r\\n`;\r\n        sdp += `a=${msid}`;\r\n        // for Chrome. Legacy should no longer be required.\r\n        sdp += `a=ssrc:${transceiver.sendEncodingParameters[0].ssrc\r\n        } ${msid}`;\r\n\r\n        // RTX\r\n        if (transceiver.sendEncodingParameters[0].rtx) {\r\n          sdp += `a=ssrc:${transceiver.sendEncodingParameters[0].rtx.ssrc\r\n          } ${msid}`;\r\n          sdp += `a=ssrc-group:FID ${\r\n            transceiver.sendEncodingParameters[0].ssrc} ${\r\n            transceiver.sendEncodingParameters[0].rtx.ssrc\r\n          }\\r\\n`;\r\n        }\r\n      }\r\n      // FIXME: this should be written by writeRtpDescription.\r\n      sdp += `a=ssrc:${transceiver.sendEncodingParameters[0].ssrc\r\n      } cname:${SDPUtils.localCName}\\r\\n`;\r\n      if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\r\n        sdp += `a=ssrc:${transceiver.sendEncodingParameters[0].rtx.ssrc\r\n        } cname:${SDPUtils.localCName}\\r\\n`;\r\n      }\r\n      return sdp;\r\n    }\r\n\r\n    // Edge does not like\r\n    // 1) stun: filtered after 14393 unless ?transport=udp is present\r\n    // 2) turn: that does not have all of turn:host:port?transport=udp\r\n    // 3) turn: with ipv6 addresses\r\n    // 4) turn: occurring muliple times\r\n    function filterIceServers(iceServers, edgeVersion) {\r\n      let hasTurn = false;\r\n      iceServers = JSON.parse(JSON.stringify(iceServers));\r\n      return iceServers.filter((server) => {\r\n        if (server && (server.urls || server.url)) {\r\n          let urls = server.urls || server.url;\r\n          if (server.url && !server.urls) {\r\n            console.warn('RTCIceServer.url is deprecated! Use urls instead.');\r\n          }\r\n          const isString = typeof urls === 'string';\r\n          if (isString) {\r\n            urls = [urls];\r\n          }\r\n          urls = urls.filter((url) => {\r\n            const validTurn = url.indexOf('turn:') === 0 &&\r\n\t\t\t\t\t\t\turl.indexOf('transport=udp') !== -1 &&\r\n\t\t\t\t\t\t\turl.indexOf('turn:[') === -1 &&\r\n\t\t\t\t\t\t\t!hasTurn;\r\n\r\n            if (validTurn) {\r\n              hasTurn = true;\r\n              return true;\r\n            }\r\n            return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\r\n\t\t\t\t\t\t\turl.indexOf('?transport=udp') === -1;\r\n          });\r\n\r\n          delete server.url;\r\n          server.urls = isString ? urls[0] : urls;\r\n          return !!urls.length;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Determines the intersection of local and remote capabilities.\r\n    function getCommonCapabilities(localCapabilities, remoteCapabilities) {\r\n      const commonCapabilities = {\r\n        codecs: [],\r\n        headerExtensions: [],\r\n        fecMechanisms: [],\r\n      };\r\n\r\n      const findCodecByPayloadType = function (pt, codecs) {\r\n        pt = parseInt(pt, 10);\r\n        for (let i = 0; i < codecs.length; i++) {\r\n          if (codecs[i].payloadType === pt ||\r\n\t\t\t\t\t\tcodecs[i].preferredPayloadType === pt) {\r\n            return codecs[i];\r\n          }\r\n        }\r\n      };\r\n\r\n      const rtxCapabilityMatches = function (lRtx, rRtx, lCodecs, rCodecs) {\r\n        const lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\r\n        const rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\r\n        return lCodec && rCodec &&\r\n\t\t\t\t\tlCodec.name.toLowerCase() === rCodec.name.toLowerCase();\r\n      };\r\n\r\n      localCapabilities.codecs.forEach((lCodec) => {\r\n        for (let i = 0; i < remoteCapabilities.codecs.length; i++) {\r\n          let rCodec = remoteCapabilities.codecs[i];\r\n          if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\r\n\t\t\t\t\t\tlCodec.clockRate === rCodec.clockRate) {\r\n            if (lCodec.name.toLowerCase() === 'rtx' &&\r\n\t\t\t\t\t\t\tlCodec.parameters && rCodec.parameters.apt) {\r\n            // for RTX we need to find the local rtx that has a apt\r\n            // which points to the same local codec as the remote one.\r\n              if (!rtxCapabilityMatches(lCodec, rCodec,\r\n                  localCapabilities.codecs, remoteCapabilities.codecs)) {\r\n                continue;\r\n              }\r\n            }\r\n            rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\r\n            // number of channels is the highest common number of channels\r\n            rCodec.numChannels = Math.min(lCodec.numChannels,\r\n                rCodec.numChannels);\r\n            // push rCodec so we reply with offerer payload type\r\n            commonCapabilities.codecs.push(rCodec);\r\n\r\n            // determine common feedback mechanisms\r\n            rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter((fb) => {\r\n              for (let j = 0; j < lCodec.rtcpFeedback.length; j++) {\r\n                if (lCodec.rtcpFeedback[j].type === fb.type &&\r\n\t\t\t\t\t\t\t\t\tlCodec.rtcpFeedback[j].parameter === fb.parameter) {\r\n                  return true;\r\n                }\r\n              }\r\n              return false;\r\n            });\r\n            // FIXME: also need to determine .parameters\r\n            //  see https://github.com/openpeer/ortc/issues/569\r\n            break;\r\n          }\r\n        }\r\n      });\r\n\r\n      localCapabilities.headerExtensions.forEach((lHeaderExtension) => {\r\n        for (let i = 0; i < remoteCapabilities.headerExtensions.length;\r\n\t\t\t\t\t i++) {\r\n          const rHeaderExtension = remoteCapabilities.headerExtensions[i];\r\n          if (lHeaderExtension.uri === rHeaderExtension.uri) {\r\n            commonCapabilities.headerExtensions.push(rHeaderExtension);\r\n            break;\r\n          }\r\n        }\r\n      });\r\n\r\n      // FIXME: fecMechanisms\r\n      return commonCapabilities;\r\n    }\r\n\r\n    // is action=setLocalDescription with type allowed in signalingState\r\n    function isActionAllowedInSignalingState(action, type, signalingState) {\r\n      return {\r\n        offer: {\r\n          setLocalDescription: ['stable', 'have-local-offer'],\r\n          setRemoteDescription: ['stable', 'have-remote-offer'],\r\n        },\r\n        answer: {\r\n          setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\r\n          setRemoteDescription: ['have-local-offer', 'have-remote-pranswer'],\r\n        },\r\n      }[type][action].indexOf(signalingState) !== -1;\r\n    }\r\n\r\n    function maybeAddCandidate(iceTransport, candidate) {\r\n    // Edge's internal representation adds some fields therefore\r\n    // not all field are taken into account.\r\n      const alreadyAdded = iceTransport.getRemoteCandidates()\r\n          .find((remoteCandidate) => candidate.foundation === remoteCandidate.foundation &&\r\n\t\t\t\t\t\t\tcandidate.ip === remoteCandidate.ip &&\r\n\t\t\t\t\t\t\tcandidate.port === remoteCandidate.port &&\r\n\t\t\t\t\t\t\tcandidate.priority === remoteCandidate.priority &&\r\n\t\t\t\t\t\t\tcandidate.protocol === remoteCandidate.protocol &&\r\n\t\t\t\t\t\t\tcandidate.type === remoteCandidate.type);\r\n      if (!alreadyAdded) {\r\n        iceTransport.addRemoteCandidate(candidate);\r\n      }\r\n      return !alreadyAdded;\r\n    }\r\n\r\n\r\n    function makeError(name, description) {\r\n      const e = new Error(description);\r\n      e.name = name;\r\n      // legacy error codes from https://heycam.github.io/webidl/#idl-DOMException-error-names\r\n      e.code = {\r\n        NotSupportedError: 9,\r\n        InvalidStateError: 11,\r\n        InvalidAccessError: 15,\r\n        TypeError: undefined,\r\n        OperationError: undefined,\r\n      }[name];\r\n      return e;\r\n    }\r\n\r\n    module.exports = function (window, edgeVersion) {\r\n    // https://w3c.github.io/mediacapture-main/#mediastream\r\n    // Helper function to add the track to the stream and\r\n    // dispatch the event ourselves.\r\n      function addTrackToStreamAndFireEvent(track, stream) {\r\n        stream.addTrack(track);\r\n        stream.dispatchEvent(new window.MediaStreamTrackEvent('addtrack',\r\n            {track}));\r\n      }\r\n\r\n      function removeTrackFromStreamAndFireEvent(track, stream) {\r\n        stream.removeTrack(track);\r\n        stream.dispatchEvent(new window.MediaStreamTrackEvent('removetrack',\r\n            {track}));\r\n      }\r\n\r\n      function fireAddTrack(pc, track, receiver, streams) {\r\n        const trackEvent = new Event('track');\r\n        trackEvent.track = track;\r\n        trackEvent.receiver = receiver;\r\n        trackEvent.transceiver = {receiver};\r\n        trackEvent.streams = streams;\r\n        window.setTimeout(() => {\r\n          pc._dispatchEvent('track', trackEvent);\r\n        });\r\n      }\r\n\r\n      const RTCPeerConnection = function (config) {\r\n        const pc = this;\r\n\r\n        const _eventTarget = document.createDocumentFragment();\r\n        ['addEventListener', 'removeEventListener', 'dispatchEvent']\r\n            .forEach((method) => {\r\n              pc[method] = _eventTarget[method].bind(_eventTarget);\r\n            });\r\n\r\n        this.canTrickleIceCandidates = null;\r\n\r\n        this.needNegotiation = false;\r\n\r\n        this.localStreams = [];\r\n        this.remoteStreams = [];\r\n\r\n        this._localDescription = null;\r\n        this._remoteDescription = null;\r\n\r\n        this.signalingState = 'stable';\r\n        this.iceConnectionState = 'new';\r\n        this.connectionState = 'new';\r\n        this.iceGatheringState = 'new';\r\n\r\n        config = JSON.parse(JSON.stringify(config || {}));\r\n\r\n        this.usingBundle = config.bundlePolicy === 'max-bundle';\r\n        if (config.rtcpMuxPolicy === 'negotiate') {\r\n          throw (makeError('NotSupportedError',\r\n              'rtcpMuxPolicy \\'negotiate\\' is not supported'));\r\n        } else if (!config.rtcpMuxPolicy) {\r\n          config.rtcpMuxPolicy = 'require';\r\n        }\r\n\r\n        switch (config.iceTransportPolicy) {\r\n          case 'all':\r\n          case 'relay':\r\n            break;\r\n          default:\r\n            config.iceTransportPolicy = 'all';\r\n            break;\r\n        }\r\n\r\n        switch (config.bundlePolicy) {\r\n          case 'balanced':\r\n          case 'max-compat':\r\n          case 'max-bundle':\r\n            break;\r\n          default:\r\n            config.bundlePolicy = 'balanced';\r\n            break;\r\n        }\r\n\r\n        config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\r\n\r\n        this._iceGatherers = [];\r\n        if (config.iceCandidatePoolSize) {\r\n          for (let i = config.iceCandidatePoolSize; i > 0; i--) {\r\n            this._iceGatherers.push(new window.RTCIceGatherer({\r\n              iceServers: config.iceServers,\r\n              gatherPolicy: config.iceTransportPolicy,\r\n            }));\r\n          }\r\n        } else {\r\n          config.iceCandidatePoolSize = 0;\r\n        }\r\n\r\n        this._config = config;\r\n\r\n        // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\r\n        // everything that is needed to describe a SDP m-line.\r\n        this.transceivers = [];\r\n\r\n        this._sdpSessionId = SDPUtils.generateSessionId();\r\n        this._sdpSessionVersion = 0;\r\n\r\n        this._dtlsRole = undefined; // role for a=setup to use in answers.\r\n\r\n        this._isClosed = false;\r\n      };\r\n\r\n      Object.defineProperty(RTCPeerConnection.prototype, 'localDescription', {\r\n        configurable: true,\r\n        get() {\r\n          return this._localDescription;\r\n        },\r\n      });\r\n      Object.defineProperty(RTCPeerConnection.prototype, 'remoteDescription', {\r\n        configurable: true,\r\n        get() {\r\n          return this._remoteDescription;\r\n        },\r\n      });\r\n\r\n      // set up event handlers on prototype\r\n      RTCPeerConnection.prototype.onicecandidate = null;\r\n      RTCPeerConnection.prototype.onaddstream = null;\r\n      RTCPeerConnection.prototype.ontrack = null;\r\n      RTCPeerConnection.prototype.onremovestream = null;\r\n      RTCPeerConnection.prototype.onsignalingstatechange = null;\r\n      RTCPeerConnection.prototype.oniceconnectionstatechange = null;\r\n      RTCPeerConnection.prototype.onconnectionstatechange = null;\r\n      RTCPeerConnection.prototype.onicegatheringstatechange = null;\r\n      RTCPeerConnection.prototype.onnegotiationneeded = null;\r\n      RTCPeerConnection.prototype.ondatachannel = null;\r\n\r\n      RTCPeerConnection.prototype._dispatchEvent = function (name, event) {\r\n        if (this._isClosed) {\r\n          return;\r\n        }\r\n        this.dispatchEvent(event);\r\n        if (typeof this[`on${name}`] === 'function') {\r\n          this[`on${name}`](event);\r\n        }\r\n      };\r\n\r\n      RTCPeerConnection.prototype._emitGatheringStateChange = function () {\r\n        const event = new Event('icegatheringstatechange');\r\n        this._dispatchEvent('icegatheringstatechange', event);\r\n      };\r\n\r\n      RTCPeerConnection.prototype.getConfiguration = function () {\r\n        return this._config;\r\n      };\r\n\r\n      RTCPeerConnection.prototype.getLocalStreams = function () {\r\n        return this.localStreams;\r\n      };\r\n\r\n      RTCPeerConnection.prototype.getRemoteStreams = function () {\r\n        return this.remoteStreams;\r\n      };\r\n\r\n      // internal helper to create a transceiver object.\r\n      // (which is not yet the same as the WebRTC 1.0 transceiver)\r\n      RTCPeerConnection.prototype._createTransceiver = function (kind, doNotAdd) {\r\n        const hasBundleTransport = this.transceivers.length > 0;\r\n        const transceiver = {\r\n          track: null,\r\n          iceGatherer: null,\r\n          iceTransport: null,\r\n          dtlsTransport: null,\r\n          localCapabilities: null,\r\n          remoteCapabilities: null,\r\n          rtpSender: null,\r\n          rtpReceiver: null,\r\n          kind,\r\n          mid: null,\r\n          sendEncodingParameters: null,\r\n          recvEncodingParameters: null,\r\n          stream: null,\r\n          associatedRemoteMediaStreams: [],\r\n          wantReceive: true,\r\n        };\r\n        if (this.usingBundle && hasBundleTransport) {\r\n          transceiver.iceTransport = this.transceivers[0].iceTransport;\r\n          transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\r\n        } else {\r\n          const transports = this._createIceAndDtlsTransports();\r\n          transceiver.iceTransport = transports.iceTransport;\r\n          transceiver.dtlsTransport = transports.dtlsTransport;\r\n        }\r\n        if (!doNotAdd) {\r\n          this.transceivers.push(transceiver);\r\n        }\r\n        return transceiver;\r\n      };\r\n\r\n      RTCPeerConnection.prototype.addTrack = function (track, stream) {\r\n        if (this._isClosed) {\r\n          throw makeError('InvalidStateError',\r\n              'Attempted to call addTrack on a closed peerconnection.');\r\n        }\r\n\r\n        const alreadyExists = this.transceivers.find((s) => s.track === track);\r\n\r\n        if (alreadyExists) {\r\n          throw makeError('InvalidAccessError', 'Track already exists.');\r\n        }\r\n\r\n        let transceiver;\r\n        for (let i = 0; i < this.transceivers.length; i++) {\r\n          if (!this.transceivers[i].track &&\r\n\t\t\t\t\t\tthis.transceivers[i].kind === track.kind) {\r\n            transceiver = this.transceivers[i];\r\n          }\r\n        }\r\n        if (!transceiver) {\r\n          transceiver = this._createTransceiver(track.kind);\r\n        }\r\n\r\n        this._maybeFireNegotiationNeeded();\r\n\r\n        if (this.localStreams.indexOf(stream) === -1) {\r\n          this.localStreams.push(stream);\r\n        }\r\n\r\n        transceiver.track = track;\r\n        transceiver.stream = stream;\r\n        transceiver.rtpSender = new window.RTCRtpSender(track,\r\n            transceiver.dtlsTransport);\r\n        return transceiver.rtpSender;\r\n      };\r\n\r\n      RTCPeerConnection.prototype.addStream = function (stream) {\r\n        const pc = this;\r\n        if (edgeVersion >= 15025) {\r\n          stream.getTracks().forEach((track) => {\r\n            pc.addTrack(track, stream);\r\n          });\r\n        } else {\r\n        // Clone is necessary for local demos mostly, attaching directly\r\n        // to two different senders does not work (build 10547).\r\n        // Fixed in 15025 (or earlier)\r\n          const clonedStream = stream.clone();\r\n          stream.getTracks().forEach((track, idx) => {\r\n            const clonedTrack = clonedStream.getTracks()[idx];\r\n            track.addEventListener('enabled', (event) => {\r\n              clonedTrack.enabled = event.enabled;\r\n            });\r\n          });\r\n          clonedStream.getTracks().forEach((track) => {\r\n            pc.addTrack(track, clonedStream);\r\n          });\r\n        }\r\n      };\r\n\r\n      RTCPeerConnection.prototype.removeTrack = function (sender) {\r\n        if (this._isClosed) {\r\n          throw makeError('InvalidStateError',\r\n              'Attempted to call removeTrack on a closed peerconnection.');\r\n        }\r\n\r\n        if (!(sender instanceof window.RTCRtpSender)) {\r\n          throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\r\n\t\t\t\t\t\t'does not implement interface RTCRtpSender.');\r\n        }\r\n\r\n        const transceiver = this.transceivers.find((t) => t.rtpSender === sender);\r\n\r\n        if (!transceiver) {\r\n          throw makeError('InvalidAccessError',\r\n              'Sender was not created by this connection.');\r\n        }\r\n        const stream = transceiver.stream;\r\n\r\n        transceiver.rtpSender.stop();\r\n        transceiver.rtpSender = null;\r\n        transceiver.track = null;\r\n        transceiver.stream = null;\r\n\r\n        // remove the stream from the set of local streams\r\n        const localStreams = this.transceivers.map((t) => t.stream);\r\n        if (localStreams.indexOf(stream) === -1 &&\r\n\t\t\t\t\tthis.localStreams.indexOf(stream) > -1) {\r\n          this.localStreams.splice(this.localStreams.indexOf(stream), 1);\r\n        }\r\n\r\n        this._maybeFireNegotiationNeeded();\r\n      };\r\n\r\n      RTCPeerConnection.prototype.removeStream = function (stream) {\r\n        const pc = this;\r\n        stream.getTracks().forEach((track) => {\r\n          const sender = pc.getSenders().find((s) => s.track === track);\r\n          if (sender) {\r\n            pc.removeTrack(sender);\r\n          }\r\n        });\r\n      };\r\n\r\n      RTCPeerConnection.prototype.getSenders = function () {\r\n        return this.transceivers.filter((transceiver) => !!transceiver.rtpSender)\r\n            .map((transceiver) => transceiver.rtpSender);\r\n      };\r\n\r\n      RTCPeerConnection.prototype.getReceivers = function () {\r\n        return this.transceivers.filter((transceiver) => !!transceiver.rtpReceiver)\r\n            .map((transceiver) => transceiver.rtpReceiver);\r\n      };\r\n\r\n\r\n      RTCPeerConnection.prototype._createIceGatherer = function (sdpMLineIndex,\r\n          usingBundle) {\r\n        const pc = this;\r\n        if (usingBundle && sdpMLineIndex > 0) {\r\n          return this.transceivers[0].iceGatherer;\r\n        } else if (this._iceGatherers.length) {\r\n          return this._iceGatherers.shift();\r\n        }\r\n        const iceGatherer = new window.RTCIceGatherer({\r\n          iceServers: this._config.iceServers,\r\n          gatherPolicy: this._config.iceTransportPolicy,\r\n        });\r\n        Object.defineProperty(iceGatherer, 'state',\r\n            {value: 'new', writable: true}\r\n        );\r\n\r\n        this.transceivers[sdpMLineIndex].bufferedCandidateEvents = [];\r\n        this.transceivers[sdpMLineIndex].bufferCandidates = function (event) {\r\n          const end = !event.candidate || Object.keys(event.candidate).length === 0;\r\n          // polyfill since RTCIceGatherer.state is not implemented in\r\n          // Edge 10547 yet.\r\n          iceGatherer.state = end ? 'completed' : 'gathering';\r\n          if (pc.transceivers[sdpMLineIndex].bufferedCandidateEvents !== null) {\r\n            pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event);\r\n          }\r\n        };\r\n        iceGatherer.addEventListener('localcandidate',\r\n            this.transceivers[sdpMLineIndex].bufferCandidates);\r\n        return iceGatherer;\r\n      };\r\n\r\n      // start gathering from an RTCIceGatherer.\r\n      RTCPeerConnection.prototype._gather = function (mid, sdpMLineIndex) {\r\n        const pc = this;\r\n        const iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\r\n        if (iceGatherer.onlocalcandidate) {\r\n          return;\r\n        }\r\n        const bufferedCandidateEvents =\r\n\t\t\t\tthis.transceivers[sdpMLineIndex].bufferedCandidateEvents;\r\n        this.transceivers[sdpMLineIndex].bufferedCandidateEvents = null;\r\n        iceGatherer.removeEventListener('localcandidate',\r\n            this.transceivers[sdpMLineIndex].bufferCandidates);\r\n        iceGatherer.onlocalcandidate = function (evt) {\r\n          if (pc.usingBundle && sdpMLineIndex > 0) {\r\n          // if we know that we use bundle we can drop candidates with\r\n          // dpMLineIndex > 0. If we don't do this then our state gets\r\n          // confused since we dispose the extra ice gatherer.\r\n            return;\r\n          }\r\n          const event = new Event('icecandidate');\r\n          event.candidate = {sdpMid: mid, sdpMLineIndex};\r\n\r\n          const cand = evt.candidate;\r\n          // Edge emits an empty object for RTCIceCandidateComplete\r\n          const end = !cand || Object.keys(cand).length === 0;\r\n          if (end) {\r\n          // polyfill since RTCIceGatherer.state is not implemented in\r\n          // Edge 10547 yet.\r\n            if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\r\n              iceGatherer.state = 'completed';\r\n            }\r\n          } else {\r\n            if (iceGatherer.state === 'new') {\r\n              iceGatherer.state = 'gathering';\r\n            }\r\n            // RTCIceCandidate doesn't have a component, needs to be added\r\n            cand.component = 1;\r\n            // also the usernameFragment. TODO: update SDP to take both variants.\r\n            cand.ufrag = iceGatherer.getLocalParameters().usernameFragment;\r\n\r\n            const serializedCandidate = SDPUtils.writeCandidate(cand);\r\n            event.candidate = Object.assign(event.candidate,\r\n                SDPUtils.parseCandidate(serializedCandidate));\r\n\r\n            event.candidate.candidate = serializedCandidate;\r\n            event.candidate.toJSON = function () {\r\n              return {\r\n                candidate: event.candidate.candidate,\r\n                sdpMid: event.candidate.sdpMid,\r\n                sdpMLineIndex: event.candidate.sdpMLineIndex,\r\n                usernameFragment: event.candidate.usernameFragment,\r\n              };\r\n            };\r\n          }\r\n\r\n          // update local description.\r\n          const sections = SDPUtils.getMediaSections(pc._localDescription.sdp);\r\n          if (!end) {\r\n            sections[event.candidate.sdpMLineIndex] +=\r\n\t\t\t\t\t\t\t`a=${event.candidate.candidate}\\r\\n`;\r\n          } else {\r\n            sections[event.candidate.sdpMLineIndex] +=\r\n\t\t\t\t\t\t\t'a=end-of-candidates\\r\\n';\r\n          }\r\n          pc._localDescription.sdp =\r\n\t\t\t\t\t\tSDPUtils.getDescription(pc._localDescription.sdp) +\r\n\t\t\t\t\t\tsections.join('');\r\n          const complete = pc.transceivers.every((transceiver) => transceiver.iceGatherer &&\r\n\t\t\t\t\t\t\ttransceiver.iceGatherer.state === 'completed');\r\n\r\n          if (pc.iceGatheringState !== 'gathering') {\r\n            pc.iceGatheringState = 'gathering';\r\n            pc._emitGatheringStateChange();\r\n          }\r\n\r\n          // Emit candidate. Also emit null candidate when all gatherers are\r\n          // complete.\r\n          if (!end) {\r\n            pc._dispatchEvent('icecandidate', event);\r\n          }\r\n          if (complete) {\r\n            pc._dispatchEvent('icecandidate', new Event('icecandidate'));\r\n            pc.iceGatheringState = 'complete';\r\n            pc._emitGatheringStateChange();\r\n          }\r\n        };\r\n\r\n        // emit already gathered candidates.\r\n        window.setTimeout(() => {\r\n          bufferedCandidateEvents.forEach((e) => {\r\n            iceGatherer.onlocalcandidate(e);\r\n          });\r\n        }, 0);\r\n      };\r\n\r\n      // Create ICE transport and DTLS transport.\r\n      RTCPeerConnection.prototype._createIceAndDtlsTransports = function () {\r\n        const pc = this;\r\n        const iceTransport = new window.RTCIceTransport(null);\r\n        iceTransport.onicestatechange = function () {\r\n          pc._updateIceConnectionState();\r\n          pc._updateConnectionState();\r\n        };\r\n\r\n        const dtlsTransport = new window.RTCDtlsTransport(iceTransport);\r\n        dtlsTransport.ondtlsstatechange = function () {\r\n          pc._updateConnectionState();\r\n        };\r\n        dtlsTransport.onerror = function () {\r\n        // onerror does not set state to failed by itself.\r\n          Object.defineProperty(dtlsTransport, 'state',\r\n              {value: 'failed', writable: true});\r\n          pc._updateConnectionState();\r\n        };\r\n\r\n        return {\r\n          iceTransport,\r\n          dtlsTransport,\r\n        };\r\n      };\r\n\r\n      // Destroy ICE gatherer, ICE transport and DTLS transport.\r\n      // Without triggering the callbacks.\r\n      RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function (\r\n          sdpMLineIndex) {\r\n        const iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\r\n        if (iceGatherer) {\r\n          delete iceGatherer.onlocalcandidate;\r\n          delete this.transceivers[sdpMLineIndex].iceGatherer;\r\n        }\r\n        const iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\r\n        if (iceTransport) {\r\n          delete iceTransport.onicestatechange;\r\n          delete this.transceivers[sdpMLineIndex].iceTransport;\r\n        }\r\n        const dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\r\n        if (dtlsTransport) {\r\n          delete dtlsTransport.ondtlsstatechange;\r\n          delete dtlsTransport.onerror;\r\n          delete this.transceivers[sdpMLineIndex].dtlsTransport;\r\n        }\r\n      };\r\n\r\n      // Start the RTP Sender and Receiver for a transceiver.\r\n      RTCPeerConnection.prototype._transceive = function (transceiver,\r\n          send, recv) {\r\n        const params = getCommonCapabilities(transceiver.localCapabilities,\r\n            transceiver.remoteCapabilities);\r\n        if (send && transceiver.rtpSender) {\r\n          params.encodings = transceiver.sendEncodingParameters;\r\n          params.rtcp = {\r\n            cname: SDPUtils.localCName,\r\n            compound: transceiver.rtcpParameters.compound,\r\n          };\r\n          if (transceiver.recvEncodingParameters.length) {\r\n            params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\r\n          }\r\n          transceiver.rtpSender.send(params);\r\n        }\r\n        if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\r\n        // remove RTX field in Edge 14942\r\n          if (transceiver.kind === 'video' &&\r\n\t\t\t\t\t\ttransceiver.recvEncodingParameters &&\r\n\t\t\t\t\t\tedgeVersion < 15019) {\r\n            transceiver.recvEncodingParameters.forEach((p) => {\r\n              delete p.rtx;\r\n            });\r\n          }\r\n          if (transceiver.recvEncodingParameters.length) {\r\n            params.encodings = transceiver.recvEncodingParameters;\r\n          } else {\r\n            params.encodings = [{}];\r\n          }\r\n          params.rtcp = {\r\n            compound: transceiver.rtcpParameters.compound,\r\n          };\r\n          if (transceiver.rtcpParameters.cname) {\r\n            params.rtcp.cname = transceiver.rtcpParameters.cname;\r\n          }\r\n          if (transceiver.sendEncodingParameters.length) {\r\n            params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\r\n          }\r\n          transceiver.rtpReceiver.receive(params);\r\n        }\r\n      };\r\n\r\n      RTCPeerConnection.prototype.setLocalDescription = function (description) {\r\n        const pc = this;\r\n\r\n        // Note: pranswer is not supported.\r\n        if (['offer', 'answer'].indexOf(description.type) === -1) {\r\n          return Promise.reject(makeError('TypeError',\r\n              `Unsupported type \"${description.type}\"`));\r\n        }\r\n\r\n        if (!isActionAllowedInSignalingState('setLocalDescription',\r\n            description.type, pc.signalingState) || pc._isClosed) {\r\n          return Promise.reject(makeError('InvalidStateError',\r\n              `Can not set local ${description.type\r\n              } in state ${pc.signalingState}`));\r\n        }\r\n\r\n        let sections;\r\n        let sessionpart;\r\n        if (description.type === 'offer') {\r\n        // VERY limited support for SDP munging. Limited to:\r\n        // * changing the order of codecs\r\n          sections = SDPUtils.splitSections(description.sdp);\r\n          sessionpart = sections.shift();\r\n          sections.forEach((mediaSection, sdpMLineIndex) => {\r\n            const caps = SDPUtils.parseRtpParameters(mediaSection);\r\n            pc.transceivers[sdpMLineIndex].localCapabilities = caps;\r\n          });\r\n\r\n          pc.transceivers.forEach((transceiver, sdpMLineIndex) => {\r\n            pc._gather(transceiver.mid, sdpMLineIndex);\r\n          });\r\n        } else if (description.type === 'answer') {\r\n          sections = SDPUtils.splitSections(pc._remoteDescription.sdp);\r\n          sessionpart = sections.shift();\r\n          const isIceLite = SDPUtils.matchPrefix(sessionpart,\r\n              'a=ice-lite').length > 0;\r\n          sections.forEach((mediaSection, sdpMLineIndex) => {\r\n            const transceiver = pc.transceivers[sdpMLineIndex];\r\n            const iceGatherer = transceiver.iceGatherer;\r\n            const iceTransport = transceiver.iceTransport;\r\n            const dtlsTransport = transceiver.dtlsTransport;\r\n            const localCapabilities = transceiver.localCapabilities;\r\n            const remoteCapabilities = transceiver.remoteCapabilities;\r\n\r\n            // treat bundle-only as not-rejected.\r\n            const rejected = SDPUtils.isRejected(mediaSection) &&\r\n\t\t\t\t\t\t\tSDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\r\n\r\n            if (!rejected && !transceiver.rejected) {\r\n              const remoteIceParameters = SDPUtils.getIceParameters(\r\n                  mediaSection, sessionpart);\r\n              const remoteDtlsParameters = SDPUtils.getDtlsParameters(\r\n                  mediaSection, sessionpart);\r\n              if (isIceLite) {\r\n                remoteDtlsParameters.role = 'server';\r\n              }\r\n\r\n              if (!pc.usingBundle || sdpMLineIndex === 0) {\r\n                pc._gather(transceiver.mid, sdpMLineIndex);\r\n                if (iceTransport.state === 'new') {\r\n                  iceTransport.start(iceGatherer, remoteIceParameters,\r\n                      isIceLite ? 'controlling' : 'controlled');\r\n                }\r\n                if (dtlsTransport.state === 'new') {\r\n                  dtlsTransport.start(remoteDtlsParameters);\r\n                }\r\n              }\r\n\r\n              // Calculate intersection of capabilities.\r\n              const params = getCommonCapabilities(localCapabilities,\r\n                  remoteCapabilities);\r\n\r\n              // Start the RTCRtpSender. The RTCRtpReceiver for this\r\n              // transceiver has already been started in setRemoteDescription.\r\n              pc._transceive(transceiver,\r\n                  params.codecs.length > 0,\r\n                  false);\r\n            }\r\n          });\r\n        }\r\n\r\n        pc._localDescription = {\r\n          type: description.type,\r\n          sdp: description.sdp,\r\n        };\r\n        if (description.type === 'offer') {\r\n          pc._updateSignalingState('have-local-offer');\r\n        } else {\r\n          pc._updateSignalingState('stable');\r\n        }\r\n\r\n        return Promise.resolve();\r\n      };\r\n\r\n      RTCPeerConnection.prototype.setRemoteDescription = function (description) {\r\n        const pc = this;\r\n\r\n        // Note: pranswer is not supported.\r\n        if (['offer', 'answer'].indexOf(description.type) === -1) {\r\n          return Promise.reject(makeError('TypeError',\r\n              `Unsupported type \"${description.type}\"`));\r\n        }\r\n\r\n        if (!isActionAllowedInSignalingState('setRemoteDescription',\r\n            description.type, pc.signalingState) || pc._isClosed) {\r\n          return Promise.reject(makeError('InvalidStateError',\r\n              `Can not set remote ${description.type\r\n              } in state ${pc.signalingState}`));\r\n        }\r\n\r\n        const streams = {};\r\n        pc.remoteStreams.forEach((stream) => {\r\n          streams[stream.id] = stream;\r\n        });\r\n        const receiverList = [];\r\n        const sections = SDPUtils.splitSections(description.sdp);\r\n        const sessionpart = sections.shift();\r\n        const isIceLite = SDPUtils.matchPrefix(sessionpart,\r\n            'a=ice-lite').length > 0;\r\n        const usingBundle = SDPUtils.matchPrefix(sessionpart,\r\n            'a=group:BUNDLE ').length > 0;\r\n        pc.usingBundle = usingBundle;\r\n        const iceOptions = SDPUtils.matchPrefix(sessionpart,\r\n            'a=ice-options:')[0];\r\n        if (iceOptions) {\r\n          pc.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\r\n              .indexOf('trickle') >= 0;\r\n        } else {\r\n          pc.canTrickleIceCandidates = false;\r\n        }\r\n\r\n        sections.forEach((mediaSection, sdpMLineIndex) => {\r\n          const lines = SDPUtils.splitLines(mediaSection);\r\n          const kind = SDPUtils.getKind(mediaSection);\r\n          // treat bundle-only as not-rejected.\r\n          const rejected = SDPUtils.isRejected(mediaSection) &&\r\n\t\t\t\t\t\tSDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\r\n          const protocol = lines[0].substr(2).split(' ')[2];\r\n\r\n          const direction = SDPUtils.getDirection(mediaSection, sessionpart);\r\n          const remoteMsid = SDPUtils.parseMsid(mediaSection);\r\n\r\n          const mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\r\n\r\n          // Reject datachannels which are not implemented yet.\r\n          if (rejected || (kind === 'application' && (protocol === 'DTLS/SCTP' ||\r\n\t\t\t\t\t\tprotocol === 'UDP/DTLS/SCTP'))) {\r\n          // TODO: this is dangerous in the case where a non-rejected m-line\r\n          //     becomes rejected.\r\n            pc.transceivers[sdpMLineIndex] = {\r\n              mid,\r\n              kind,\r\n              protocol,\r\n              rejected: true,\r\n            };\r\n            return;\r\n          }\r\n\r\n          if (!rejected && pc.transceivers[sdpMLineIndex] &&\r\n\t\t\t\t\t\tpc.transceivers[sdpMLineIndex].rejected) {\r\n          // recycle a rejected transceiver.\r\n            pc.transceivers[sdpMLineIndex] = pc._createTransceiver(kind, true);\r\n          }\r\n\r\n          let transceiver;\r\n          let iceGatherer;\r\n          let iceTransport;\r\n          let dtlsTransport;\r\n          let rtpReceiver;\r\n          let sendEncodingParameters;\r\n          let recvEncodingParameters;\r\n          let localCapabilities;\r\n\r\n          let track;\r\n          // FIXME: ensure the mediaSection has rtcp-mux set.\r\n          const remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\r\n          let remoteIceParameters;\r\n          let remoteDtlsParameters;\r\n          if (!rejected) {\r\n            remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\r\n                sessionpart);\r\n            remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\r\n                sessionpart);\r\n            remoteDtlsParameters.role = 'client';\r\n          }\r\n          recvEncodingParameters =\r\n\t\t\t\t\t\tSDPUtils.parseRtpEncodingParameters(mediaSection);\r\n\r\n          const rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\r\n\r\n          const isComplete = SDPUtils.matchPrefix(mediaSection,\r\n              'a=end-of-candidates', sessionpart).length > 0;\r\n          const cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\r\n              .map((cand) => SDPUtils.parseCandidate(cand))\r\n              .filter((cand) => cand.component === 1);\r\n\r\n          // Check if we can use BUNDLE and dispose transports.\r\n          if ((description.type === 'offer' || description.type === 'answer') &&\r\n\t\t\t\t\t\t!rejected && usingBundle && sdpMLineIndex > 0 &&\r\n\t\t\t\t\t\tpc.transceivers[sdpMLineIndex]) {\r\n            pc._disposeIceAndDtlsTransports(sdpMLineIndex);\r\n            pc.transceivers[sdpMLineIndex].iceGatherer =\r\n\t\t\t\t\t\t\tpc.transceivers[0].iceGatherer;\r\n            pc.transceivers[sdpMLineIndex].iceTransport =\r\n\t\t\t\t\t\t\tpc.transceivers[0].iceTransport;\r\n            pc.transceivers[sdpMLineIndex].dtlsTransport =\r\n\t\t\t\t\t\t\tpc.transceivers[0].dtlsTransport;\r\n            if (pc.transceivers[sdpMLineIndex].rtpSender) {\r\n              pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\r\n                  pc.transceivers[0].dtlsTransport);\r\n            }\r\n            if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\r\n              pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\r\n                  pc.transceivers[0].dtlsTransport);\r\n            }\r\n          }\r\n          if (description.type === 'offer' && !rejected) {\r\n            transceiver = pc.transceivers[sdpMLineIndex] ||\r\n\t\t\t\t\t\t\tpc._createTransceiver(kind);\r\n            transceiver.mid = mid;\r\n\r\n            if (!transceiver.iceGatherer) {\r\n              transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\r\n                  usingBundle);\r\n            }\r\n\r\n            if (cands.length && transceiver.iceTransport.state === 'new') {\r\n              if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\r\n                transceiver.iceTransport.setRemoteCandidates(cands);\r\n              } else {\r\n                cands.forEach((candidate) => {\r\n                  maybeAddCandidate(transceiver.iceTransport, candidate);\r\n                });\r\n              }\r\n            }\r\n\r\n            localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\r\n\r\n            // filter RTX until additional stuff needed for RTX is implemented\r\n            // in adapter.js\r\n            if (edgeVersion < 15019) {\r\n              localCapabilities.codecs = localCapabilities.codecs.filter(\r\n                  (codec) => codec.name !== 'rtx');\r\n            }\r\n\r\n            sendEncodingParameters = transceiver.sendEncodingParameters || [{\r\n              ssrc: (2 * sdpMLineIndex + 2) * 1001,\r\n            }];\r\n\r\n            // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\r\n            let isNewTrack = false;\r\n            if (direction === 'sendrecv' || direction === 'sendonly') {\r\n              isNewTrack = !transceiver.rtpReceiver;\r\n              rtpReceiver = transceiver.rtpReceiver ||\r\n\t\t\t\t\t\t\t\tnew window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\r\n\r\n              if (isNewTrack) {\r\n                let stream;\r\n                track = rtpReceiver.track;\r\n                // FIXME: does not work with Plan B.\r\n                if (remoteMsid && remoteMsid.stream === '-') {\r\n                // no-op. a stream id of '-' means: no associated stream.\r\n                } else if (remoteMsid) {\r\n                  if (!streams[remoteMsid.stream]) {\r\n                    streams[remoteMsid.stream] = new window.MediaStream();\r\n                    Object.defineProperty(streams[remoteMsid.stream], 'id', {\r\n                      get() {\r\n                        return remoteMsid.stream;\r\n                      },\r\n                    });\r\n                  }\r\n                  Object.defineProperty(track, 'id', {\r\n                    get() {\r\n                      return remoteMsid.track;\r\n                    },\r\n                  });\r\n                  stream = streams[remoteMsid.stream];\r\n                } else {\r\n                  if (!streams.default) {\r\n                    streams.default = new window.MediaStream();\r\n                  }\r\n                  stream = streams.default;\r\n                }\r\n                if (stream) {\r\n                  addTrackToStreamAndFireEvent(track, stream);\r\n                  transceiver.associatedRemoteMediaStreams.push(stream);\r\n                }\r\n                receiverList.push([track, rtpReceiver, stream]);\r\n              }\r\n            } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\r\n              transceiver.associatedRemoteMediaStreams.forEach((s) => {\r\n                const nativeTrack = s.getTracks().find((t) => t.id === transceiver.rtpReceiver.track.id);\r\n                if (nativeTrack) {\r\n                  removeTrackFromStreamAndFireEvent(nativeTrack, s);\r\n                }\r\n              });\r\n              transceiver.associatedRemoteMediaStreams = [];\r\n            }\r\n\r\n            transceiver.localCapabilities = localCapabilities;\r\n            transceiver.remoteCapabilities = remoteCapabilities;\r\n            transceiver.rtpReceiver = rtpReceiver;\r\n            transceiver.rtcpParameters = rtcpParameters;\r\n            transceiver.sendEncodingParameters = sendEncodingParameters;\r\n            transceiver.recvEncodingParameters = recvEncodingParameters;\r\n\r\n            // Start the RTCRtpReceiver now. The RTPSender is started in\r\n            // setLocalDescription.\r\n            pc._transceive(pc.transceivers[sdpMLineIndex],\r\n                false,\r\n                isNewTrack);\r\n          } else if (description.type === 'answer' && !rejected) {\r\n            transceiver = pc.transceivers[sdpMLineIndex];\r\n            iceGatherer = transceiver.iceGatherer;\r\n            iceTransport = transceiver.iceTransport;\r\n            dtlsTransport = transceiver.dtlsTransport;\r\n            rtpReceiver = transceiver.rtpReceiver;\r\n            sendEncodingParameters = transceiver.sendEncodingParameters;\r\n            localCapabilities = transceiver.localCapabilities;\r\n\r\n            pc.transceivers[sdpMLineIndex].recvEncodingParameters =\r\n\t\t\t\t\t\t\trecvEncodingParameters;\r\n            pc.transceivers[sdpMLineIndex].remoteCapabilities =\r\n\t\t\t\t\t\t\tremoteCapabilities;\r\n            pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\r\n\r\n            if (cands.length && iceTransport.state === 'new') {\r\n              if ((isIceLite || isComplete) &&\r\n\t\t\t\t\t\t\t\t(!usingBundle || sdpMLineIndex === 0)) {\r\n                iceTransport.setRemoteCandidates(cands);\r\n              } else {\r\n                cands.forEach((candidate) => {\r\n                  maybeAddCandidate(transceiver.iceTransport, candidate);\r\n                });\r\n              }\r\n            }\r\n\r\n            if (!usingBundle || sdpMLineIndex === 0) {\r\n              if (iceTransport.state === 'new') {\r\n                iceTransport.start(iceGatherer, remoteIceParameters,\r\n                    'controlling');\r\n              }\r\n              if (dtlsTransport.state === 'new') {\r\n                dtlsTransport.start(remoteDtlsParameters);\r\n              }\r\n            }\r\n\r\n            // If the offer contained RTX but the answer did not,\r\n            // remove RTX from sendEncodingParameters.\r\n            const commonCapabilities = getCommonCapabilities(\r\n                transceiver.localCapabilities,\r\n                transceiver.remoteCapabilities);\r\n\r\n            const hasRtx = commonCapabilities.codecs.filter((c) => c.name.toLowerCase() === 'rtx').length;\r\n            if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\r\n              delete transceiver.sendEncodingParameters[0].rtx;\r\n            }\r\n\r\n            pc._transceive(transceiver,\r\n                direction === 'sendrecv' || direction === 'recvonly',\r\n                direction === 'sendrecv' || direction === 'sendonly');\r\n\r\n            // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\r\n            if (rtpReceiver &&\r\n\t\t\t\t\t\t\t(direction === 'sendrecv' || direction === 'sendonly')) {\r\n              track = rtpReceiver.track;\r\n              if (remoteMsid) {\r\n                if (!streams[remoteMsid.stream]) {\r\n                  streams[remoteMsid.stream] = new window.MediaStream();\r\n                }\r\n                addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\r\n                receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\r\n              } else {\r\n                if (!streams.default) {\r\n                  streams.default = new window.MediaStream();\r\n                }\r\n                addTrackToStreamAndFireEvent(track, streams.default);\r\n                receiverList.push([track, rtpReceiver, streams.default]);\r\n              }\r\n            } else {\r\n            // FIXME: actually the receiver should be created later.\r\n              delete transceiver.rtpReceiver;\r\n            }\r\n          }\r\n        });\r\n\r\n        if (pc._dtlsRole === undefined) {\r\n          pc._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\r\n        }\r\n\r\n        pc._remoteDescription = {\r\n          type: description.type,\r\n          sdp: description.sdp,\r\n        };\r\n        if (description.type === 'offer') {\r\n          pc._updateSignalingState('have-remote-offer');\r\n        } else {\r\n          pc._updateSignalingState('stable');\r\n        }\r\n        Object.keys(streams).forEach((sid) => {\r\n          const stream = streams[sid];\r\n          if (stream.getTracks().length) {\r\n            if (pc.remoteStreams.indexOf(stream) === -1) {\r\n              pc.remoteStreams.push(stream);\r\n              const event = new Event('addstream');\r\n              event.stream = stream;\r\n              window.setTimeout(() => {\r\n                pc._dispatchEvent('addstream', event);\r\n              });\r\n            }\r\n\r\n            receiverList.forEach((item) => {\r\n              const track = item[0];\r\n              const receiver = item[1];\r\n              if (stream.id !== item[2].id) {\r\n                return;\r\n              }\r\n              fireAddTrack(pc, track, receiver, [stream]);\r\n            });\r\n          }\r\n        });\r\n        receiverList.forEach((item) => {\r\n          if (item[2]) {\r\n            return;\r\n          }\r\n          fireAddTrack(pc, item[0], item[1], []);\r\n        });\r\n\r\n        // check whether addIceCandidate({}) was called within four seconds after\r\n        // setRemoteDescription.\r\n        window.setTimeout(() => {\r\n          if (!(pc && pc.transceivers)) {\r\n            return;\r\n          }\r\n          pc.transceivers.forEach((transceiver) => {\r\n            if (transceiver.iceTransport &&\r\n\t\t\t\t\t\t\ttransceiver.iceTransport.state === 'new' &&\r\n\t\t\t\t\t\t\ttransceiver.iceTransport.getRemoteCandidates().length > 0) {\r\n              console.warn('Timeout for addRemoteCandidate. Consider sending ' +\r\n\t\t\t\t\t\t\t\t'an end-of-candidates notification');\r\n              transceiver.iceTransport.addRemoteCandidate({});\r\n            }\r\n          });\r\n        }, 4000);\r\n\r\n        return Promise.resolve();\r\n      };\r\n\r\n      RTCPeerConnection.prototype.close = function () {\r\n        this.transceivers.forEach((transceiver) => {\r\n        /* not yet\r\n\t\t\t\tif (transceiver.iceGatherer) {\r\n\t\t\t\t\ttransceiver.iceGatherer.close();\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n          if (transceiver.iceTransport) {\r\n            transceiver.iceTransport.stop();\r\n          }\r\n          if (transceiver.dtlsTransport) {\r\n            transceiver.dtlsTransport.stop();\r\n          }\r\n          if (transceiver.rtpSender) {\r\n            transceiver.rtpSender.stop();\r\n          }\r\n          if (transceiver.rtpReceiver) {\r\n            transceiver.rtpReceiver.stop();\r\n          }\r\n        });\r\n        // FIXME: clean up tracks, local streams, remote streams, etc\r\n        this._isClosed = true;\r\n        this._updateSignalingState('closed');\r\n      };\r\n\r\n      // Update the signaling state.\r\n      RTCPeerConnection.prototype._updateSignalingState = function (newState) {\r\n        this.signalingState = newState;\r\n        const event = new Event('signalingstatechange');\r\n        this._dispatchEvent('signalingstatechange', event);\r\n      };\r\n\r\n      // Determine whether to fire the negotiationneeded event.\r\n      RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function () {\r\n        const pc = this;\r\n        if (this.signalingState !== 'stable' || this.needNegotiation === true) {\r\n          return;\r\n        }\r\n        this.needNegotiation = true;\r\n        window.setTimeout(() => {\r\n          if (pc.needNegotiation) {\r\n            pc.needNegotiation = false;\r\n            const event = new Event('negotiationneeded');\r\n            pc._dispatchEvent('negotiationneeded', event);\r\n          }\r\n        }, 0);\r\n      };\r\n\r\n      // Update the ice connection state.\r\n      RTCPeerConnection.prototype._updateIceConnectionState = function () {\r\n        let newState;\r\n        const states = {\r\n          new: 0,\r\n          closed: 0,\r\n          checking: 0,\r\n          connected: 0,\r\n          completed: 0,\r\n          disconnected: 0,\r\n          failed: 0,\r\n        };\r\n        this.transceivers.forEach((transceiver) => {\r\n          if (transceiver.iceTransport && !transceiver.rejected) {\r\n            states[transceiver.iceTransport.state]++;\r\n          }\r\n        });\r\n\r\n        newState = 'new';\r\n        if (states.failed > 0) {\r\n          newState = 'failed';\r\n        } else if (states.checking > 0) {\r\n          newState = 'checking';\r\n        } else if (states.disconnected > 0) {\r\n          newState = 'disconnected';\r\n        } else if (states.new > 0) {\r\n          newState = 'new';\r\n        } else if (states.connected > 0) {\r\n          newState = 'connected';\r\n        } else if (states.completed > 0) {\r\n          newState = 'completed';\r\n        }\r\n\r\n        if (newState !== this.iceConnectionState) {\r\n          this.iceConnectionState = newState;\r\n          const event = new Event('iceconnectionstatechange');\r\n          this._dispatchEvent('iceconnectionstatechange', event);\r\n        }\r\n      };\r\n\r\n      // Update the connection state.\r\n      RTCPeerConnection.prototype._updateConnectionState = function () {\r\n        let newState;\r\n        const states = {\r\n          new: 0,\r\n          closed: 0,\r\n          connecting: 0,\r\n          connected: 0,\r\n          completed: 0,\r\n          disconnected: 0,\r\n          failed: 0,\r\n        };\r\n        this.transceivers.forEach((transceiver) => {\r\n          if (transceiver.iceTransport && transceiver.dtlsTransport &&\r\n\t\t\t\t\t\t!transceiver.rejected) {\r\n            states[transceiver.iceTransport.state]++;\r\n            states[transceiver.dtlsTransport.state]++;\r\n          }\r\n        });\r\n        // ICETransport.completed and connected are the same for this purpose.\r\n        states.connected += states.completed;\r\n\r\n        newState = 'new';\r\n        if (states.failed > 0) {\r\n          newState = 'failed';\r\n        } else if (states.connecting > 0) {\r\n          newState = 'connecting';\r\n        } else if (states.disconnected > 0) {\r\n          newState = 'disconnected';\r\n        } else if (states.new > 0) {\r\n          newState = 'new';\r\n        } else if (states.connected > 0) {\r\n          newState = 'connected';\r\n        }\r\n\r\n        if (newState !== this.connectionState) {\r\n          this.connectionState = newState;\r\n          const event = new Event('connectionstatechange');\r\n          this._dispatchEvent('connectionstatechange', event);\r\n        }\r\n      };\r\n\r\n      RTCPeerConnection.prototype.createOffer = function () {\r\n        const pc = this;\r\n\r\n        if (pc._isClosed) {\r\n          return Promise.reject(makeError('InvalidStateError',\r\n              'Can not call createOffer after close'));\r\n        }\r\n\r\n        let numAudioTracks = pc.transceivers.filter((t) => t.kind === 'audio').length;\r\n        let numVideoTracks = pc.transceivers.filter((t) => t.kind === 'video').length;\r\n\r\n        // Determine number of audio and video tracks we need to send/recv.\r\n        const offerOptions = arguments[0];\r\n        if (offerOptions) {\r\n        // Reject Chrome legacy constraints.\r\n          if (offerOptions.mandatory || offerOptions.optional) {\r\n            throw new TypeError(\r\n                'Legacy mandatory/optional constraints not supported.');\r\n          }\r\n          if (offerOptions.offerToReceiveAudio !== undefined) {\r\n            if (offerOptions.offerToReceiveAudio === true) {\r\n              numAudioTracks = 1;\r\n            } else if (offerOptions.offerToReceiveAudio === false) {\r\n              numAudioTracks = 0;\r\n            } else {\r\n              numAudioTracks = offerOptions.offerToReceiveAudio;\r\n            }\r\n          }\r\n          if (offerOptions.offerToReceiveVideo !== undefined) {\r\n            if (offerOptions.offerToReceiveVideo === true) {\r\n              numVideoTracks = 1;\r\n            } else if (offerOptions.offerToReceiveVideo === false) {\r\n              numVideoTracks = 0;\r\n            } else {\r\n              numVideoTracks = offerOptions.offerToReceiveVideo;\r\n            }\r\n          }\r\n        }\r\n\r\n        pc.transceivers.forEach((transceiver) => {\r\n          if (transceiver.kind === 'audio') {\r\n            numAudioTracks--;\r\n            if (numAudioTracks < 0) {\r\n              transceiver.wantReceive = false;\r\n            }\r\n          } else if (transceiver.kind === 'video') {\r\n            numVideoTracks--;\r\n            if (numVideoTracks < 0) {\r\n              transceiver.wantReceive = false;\r\n            }\r\n          }\r\n        });\r\n\r\n        // Create M-lines for recvonly streams.\r\n        while (numAudioTracks > 0 || numVideoTracks > 0) {\r\n          if (numAudioTracks > 0) {\r\n            pc._createTransceiver('audio');\r\n            numAudioTracks--;\r\n          }\r\n          if (numVideoTracks > 0) {\r\n            pc._createTransceiver('video');\r\n            numVideoTracks--;\r\n          }\r\n        }\r\n\r\n        let sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\r\n            pc._sdpSessionVersion++);\r\n        pc.transceivers.forEach((transceiver, sdpMLineIndex) => {\r\n        // For each track, create an ice gatherer, ice transport,\r\n        // dtls transport, potentially rtpsender and rtpreceiver.\r\n          const track = transceiver.track;\r\n          const kind = transceiver.kind;\r\n          const mid = transceiver.mid || SDPUtils.generateIdentifier();\r\n          transceiver.mid = mid;\r\n\r\n          if (!transceiver.iceGatherer) {\r\n            transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\r\n                pc.usingBundle);\r\n          }\r\n\r\n          const localCapabilities = window.RTCRtpSender.getCapabilities(kind);\r\n          // filter RTX until additional stuff needed for RTX is implemented\r\n          // in adapter.js\r\n          if (edgeVersion < 15019) {\r\n            localCapabilities.codecs = localCapabilities.codecs.filter(\r\n                (codec) => codec.name !== 'rtx');\r\n          }\r\n          localCapabilities.codecs.forEach((codec) => {\r\n          // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\r\n          // by adding level-asymmetry-allowed=1\r\n            if (codec.name === 'H264' &&\r\n\t\t\t\t\t\t\tcodec.parameters['level-asymmetry-allowed'] === undefined) {\r\n              codec.parameters['level-asymmetry-allowed'] = '1';\r\n            }\r\n\r\n            // for subsequent offers, we might have to re-use the payload\r\n            // type of the last offer.\r\n            if (transceiver.remoteCapabilities &&\r\n\t\t\t\t\t\t\ttransceiver.remoteCapabilities.codecs) {\r\n              transceiver.remoteCapabilities.codecs.forEach((remoteCodec) => {\r\n                if (codec.name.toLowerCase() === remoteCodec.name.toLowerCase() &&\r\n\t\t\t\t\t\t\t\t\tcodec.clockRate === remoteCodec.clockRate) {\r\n                  codec.preferredPayloadType = remoteCodec.payloadType;\r\n                }\r\n              });\r\n            }\r\n          });\r\n          localCapabilities.headerExtensions.forEach((hdrExt) => {\r\n            const remoteExtensions = transceiver.remoteCapabilities &&\r\n\t\t\t\t\t\t\ttransceiver.remoteCapabilities.headerExtensions || [];\r\n            remoteExtensions.forEach((rHdrExt) => {\r\n              if (hdrExt.uri === rHdrExt.uri) {\r\n                hdrExt.id = rHdrExt.id;\r\n              }\r\n            });\r\n          });\r\n\r\n          // generate an ssrc now, to be used later in rtpSender.send\r\n          const sendEncodingParameters = transceiver.sendEncodingParameters || [{\r\n            ssrc: (2 * sdpMLineIndex + 1) * 1001,\r\n          }];\r\n          if (track) {\r\n          // add RTX\r\n            if (edgeVersion >= 15019 && kind === 'video' &&\r\n\t\t\t\t\t\t\t!sendEncodingParameters[0].rtx) {\r\n              sendEncodingParameters[0].rtx = {\r\n                ssrc: sendEncodingParameters[0].ssrc + 1,\r\n              };\r\n            }\r\n          }\r\n\r\n          if (transceiver.wantReceive) {\r\n            transceiver.rtpReceiver = new window.RTCRtpReceiver(\r\n                transceiver.dtlsTransport, kind);\r\n          }\r\n\r\n          transceiver.localCapabilities = localCapabilities;\r\n          transceiver.sendEncodingParameters = sendEncodingParameters;\r\n        });\r\n\r\n        // always offer BUNDLE and dispose on return if not supported.\r\n        if (pc._config.bundlePolicy !== 'max-compat') {\r\n          sdp += `a=group:BUNDLE ${pc.transceivers.map((t) => t.mid).join(' ')}\\r\\n`;\r\n        }\r\n        sdp += 'a=ice-options:trickle\\r\\n';\r\n\r\n        pc.transceivers.forEach((transceiver, sdpMLineIndex) => {\r\n          sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\r\n              'offer', transceiver.stream, pc._dtlsRole);\r\n          sdp += 'a=rtcp-rsize\\r\\n';\r\n\r\n          if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\r\n\t\t\t\t\t\t(sdpMLineIndex === 0 || !pc.usingBundle)) {\r\n            transceiver.iceGatherer.getLocalCandidates().forEach((cand) => {\r\n              cand.component = 1;\r\n              sdp += `a=${SDPUtils.writeCandidate(cand)}\\r\\n`;\r\n            });\r\n\r\n            if (transceiver.iceGatherer.state === 'completed') {\r\n              sdp += 'a=end-of-candidates\\r\\n';\r\n            }\r\n          }\r\n        });\r\n\r\n        const desc = new window.RTCSessionDescription({\r\n          type: 'offer',\r\n          sdp,\r\n        });\r\n        return Promise.resolve(desc);\r\n      };\r\n\r\n      RTCPeerConnection.prototype.createAnswer = function () {\r\n        const pc = this;\r\n\r\n        if (pc._isClosed) {\r\n          return Promise.reject(makeError('InvalidStateError',\r\n              'Can not call createAnswer after close'));\r\n        }\r\n\r\n        if (!(pc.signalingState === 'have-remote-offer' ||\r\n\t\t\t\t\tpc.signalingState === 'have-local-pranswer')) {\r\n          return Promise.reject(makeError('InvalidStateError',\r\n              `Can not call createAnswer in signalingState ${pc.signalingState}`));\r\n        }\r\n\r\n        let sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\r\n            pc._sdpSessionVersion++);\r\n        if (pc.usingBundle) {\r\n          sdp += `a=group:BUNDLE ${pc.transceivers.map((t) => t.mid).join(' ')}\\r\\n`;\r\n        }\r\n        sdp += 'a=ice-options:trickle\\r\\n';\r\n\r\n        const mediaSectionsInOffer = SDPUtils.getMediaSections(\r\n            pc._remoteDescription.sdp).length;\r\n        pc.transceivers.forEach((transceiver, sdpMLineIndex) => {\r\n          if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\r\n            return;\r\n          }\r\n          if (transceiver.rejected) {\r\n            if (transceiver.kind === 'application') {\r\n              if (transceiver.protocol === 'DTLS/SCTP') { // legacy fmt\r\n                sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n';\r\n              } else {\r\n                sdp += `m=application 0 ${transceiver.protocol\r\n                } webrtc-datachannel\\r\\n`;\r\n              }\r\n            } else if (transceiver.kind === 'audio') {\r\n              sdp += 'm=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\n' +\r\n\t\t\t\t\t\t\t\t'a=rtpmap:0 PCMU/8000\\r\\n';\r\n            } else if (transceiver.kind === 'video') {\r\n              sdp += 'm=video 0 UDP/TLS/RTP/SAVPF 120\\r\\n' +\r\n\t\t\t\t\t\t\t\t'a=rtpmap:120 VP8/90000\\r\\n';\r\n            }\r\n            sdp += `${'c=IN IP4 0.0.0.0\\r\\n' +\r\n\t\t\t\t\t\t\t'a=inactive\\r\\n' +\r\n\t\t\t\t\t\t\t'a=mid:'}${transceiver.mid}\\r\\n`;\r\n            return;\r\n          }\r\n\r\n          // FIXME: look at direction.\r\n          if (transceiver.stream) {\r\n            let localTrack;\r\n            if (transceiver.kind === 'audio') {\r\n              localTrack = transceiver.stream.getAudioTracks()[0];\r\n            } else if (transceiver.kind === 'video') {\r\n              localTrack = transceiver.stream.getVideoTracks()[0];\r\n            }\r\n            if (localTrack) {\r\n            // add RTX\r\n              if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\r\n\t\t\t\t\t\t\t\t!transceiver.sendEncodingParameters[0].rtx) {\r\n                transceiver.sendEncodingParameters[0].rtx = {\r\n                  ssrc: transceiver.sendEncodingParameters[0].ssrc + 1,\r\n                };\r\n              }\r\n            }\r\n          }\r\n\r\n          // Calculate intersection of capabilities.\r\n          const commonCapabilities = getCommonCapabilities(\r\n              transceiver.localCapabilities,\r\n              transceiver.remoteCapabilities);\r\n\r\n          const hasRtx = commonCapabilities.codecs.filter((c) => c.name.toLowerCase() === 'rtx').length;\r\n          if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\r\n            delete transceiver.sendEncodingParameters[0].rtx;\r\n          }\r\n\r\n          sdp += writeMediaSection(transceiver, commonCapabilities,\r\n              'answer', transceiver.stream, pc._dtlsRole);\r\n          if (transceiver.rtcpParameters &&\r\n\t\t\t\t\t\ttransceiver.rtcpParameters.reducedSize) {\r\n            sdp += 'a=rtcp-rsize\\r\\n';\r\n          }\r\n        });\r\n\r\n        const desc = new window.RTCSessionDescription({\r\n          type: 'answer',\r\n          sdp,\r\n        });\r\n        return Promise.resolve(desc);\r\n      };\r\n\r\n      RTCPeerConnection.prototype.addIceCandidate = function (candidate) {\r\n        const pc = this;\r\n        let sections;\r\n        if (candidate && !(candidate.sdpMLineIndex !== undefined ||\r\n\t\t\t\t\tcandidate.sdpMid)) {\r\n          return Promise.reject(new TypeError('sdpMLineIndex or sdpMid required'));\r\n        }\r\n\r\n        // TODO: needs to go into ops queue.\r\n        return new Promise((resolve, reject) => {\r\n          if (!pc._remoteDescription) {\r\n            return reject(makeError('InvalidStateError',\r\n                'Can not add ICE candidate without a remote description'));\r\n          } else if (!candidate || candidate.candidate === '') {\r\n            for (let j = 0; j < pc.transceivers.length; j++) {\r\n              if (pc.transceivers[j].rejected) {\r\n                continue;\r\n              }\r\n              pc.transceivers[j].iceTransport.addRemoteCandidate({});\r\n              sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\r\n              sections[j] += 'a=end-of-candidates\\r\\n';\r\n              pc._remoteDescription.sdp =\r\n\t\t\t\t\t\t\t\tSDPUtils.getDescription(pc._remoteDescription.sdp) +\r\n\t\t\t\t\t\t\t\tsections.join('');\r\n              if (pc.usingBundle) {\r\n                break;\r\n              }\r\n            }\r\n          } else {\r\n            let sdpMLineIndex = candidate.sdpMLineIndex;\r\n            if (candidate.sdpMid) {\r\n              for (let i = 0; i < pc.transceivers.length; i++) {\r\n                if (pc.transceivers[i].mid === candidate.sdpMid) {\r\n                  sdpMLineIndex = i;\r\n                  break;\r\n                }\r\n              }\r\n            }\r\n            const transceiver = pc.transceivers[sdpMLineIndex];\r\n            if (transceiver) {\r\n              if (transceiver.rejected) {\r\n                return resolve();\r\n              }\r\n              const cand = Object.keys(candidate.candidate).length > 0\r\n                ? SDPUtils.parseCandidate(candidate.candidate) : {};\r\n              // Ignore Chrome's invalid candidates since Edge does not like them.\r\n              if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\r\n                return resolve();\r\n              }\r\n              // Ignore RTCP candidates, we assume RTCP-MUX.\r\n              if (cand.component && cand.component !== 1) {\r\n                return resolve();\r\n              }\r\n              // when using bundle, avoid adding candidates to the wrong\r\n              // ice transport. And avoid adding candidates added in the SDP.\r\n              if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\r\n\t\t\t\t\t\t\t\ttransceiver.iceTransport !== pc.transceivers[0].iceTransport)) {\r\n                if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\r\n                  return reject(makeError('OperationError',\r\n                      'Can not add ICE candidate'));\r\n                }\r\n              }\r\n\r\n              // update the remoteDescription.\r\n              let candidateString = candidate.candidate.trim();\r\n              if (candidateString.indexOf('a=') === 0) {\r\n                candidateString = candidateString.substr(2);\r\n              }\r\n              sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\r\n              sections[sdpMLineIndex] += `a=${\r\n                cand.type ? candidateString : 'end-of-candidates'\r\n\t\t\t\t\t\t\t\t }\\r\\n`;\r\n              pc._remoteDescription.sdp =\r\n\t\t\t\t\t\t\t\tSDPUtils.getDescription(pc._remoteDescription.sdp) +\r\n\t\t\t\t\t\t\t\tsections.join('');\r\n            } else {\r\n              return reject(makeError('OperationError',\r\n                  'Can not add ICE candidate'));\r\n            }\r\n          }\r\n          resolve();\r\n        });\r\n      };\r\n\r\n      RTCPeerConnection.prototype.getStats = function (selector) {\r\n        if (selector && selector instanceof window.MediaStreamTrack) {\r\n          let senderOrReceiver = null;\r\n          this.transceivers.forEach((transceiver) => {\r\n            if (transceiver.rtpSender &&\r\n\t\t\t\t\t\t\ttransceiver.rtpSender.track === selector) {\r\n              senderOrReceiver = transceiver.rtpSender;\r\n            } else if (transceiver.rtpReceiver &&\r\n\t\t\t\t\t\t\ttransceiver.rtpReceiver.track === selector) {\r\n              senderOrReceiver = transceiver.rtpReceiver;\r\n            }\r\n          });\r\n          if (!senderOrReceiver) {\r\n            throw makeError('InvalidAccessError', 'Invalid selector.');\r\n          }\r\n          return senderOrReceiver.getStats();\r\n        }\r\n\r\n        const promises = [];\r\n        this.transceivers.forEach((transceiver) => {\r\n          ['rtpSender',\r\n            'rtpReceiver',\r\n            'iceGatherer',\r\n            'iceTransport',\r\n            'dtlsTransport'].forEach((method) => {\r\n            if (transceiver[method]) {\r\n              promises.push(transceiver[method].getStats());\r\n            }\r\n          });\r\n        });\r\n        return Promise.all(promises).then((allStats) => {\r\n          const results = new Map();\r\n          allStats.forEach((stats) => {\r\n            stats.forEach((stat) => {\r\n              results.set(stat.id, stat);\r\n            });\r\n          });\r\n          return results;\r\n        });\r\n      };\r\n\r\n      // fix low-level stat names and return Map instead of object.\r\n      const ortcObjects = ['RTCRtpSender',\r\n        'RTCRtpReceiver',\r\n        'RTCIceGatherer',\r\n        'RTCIceTransport',\r\n        'RTCDtlsTransport'];\r\n      ortcObjects.forEach((ortcObjectName) => {\r\n        const obj = window[ortcObjectName];\r\n        if (obj && obj.prototype && obj.prototype.getStats) {\r\n          const nativeGetstats = obj.prototype.getStats;\r\n          obj.prototype.getStats = function () {\r\n            return nativeGetstats.apply(this)\r\n                .then((nativeStats) => {\r\n                  const mapStats = new Map();\r\n                  Object.keys(nativeStats).forEach((id) => {\r\n                    nativeStats[id].type = fixStatsType(nativeStats[id]);\r\n                    mapStats.set(id, nativeStats[id]);\r\n                  });\r\n                  return mapStats;\r\n                });\r\n          };\r\n        }\r\n      });\r\n\r\n      // legacy callback shims. Should be moved to adapter.js some days.\r\n      let methods = ['createOffer', 'createAnswer'];\r\n      methods.forEach((method) => {\r\n        const nativeMethod = RTCPeerConnection.prototype[method];\r\n        RTCPeerConnection.prototype[method] = function () {\r\n          const args = arguments;\r\n          if (typeof args[0] === 'function' ||\r\n\t\t\t\t\t\ttypeof args[1] === 'function') { // legacy\r\n            return nativeMethod.apply(this, [arguments[2]])\r\n                .then((description) => {\r\n                  if (typeof args[0] === 'function') {\r\n                    args[0].apply(null, [description]);\r\n                  }\r\n                }, (error) => {\r\n                  if (typeof args[1] === 'function') {\r\n                    args[1].apply(null, [error]);\r\n                  }\r\n                });\r\n          }\r\n          return nativeMethod.apply(this, arguments);\r\n        };\r\n      });\r\n\r\n      methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\r\n      methods.forEach((method) => {\r\n        const nativeMethod = RTCPeerConnection.prototype[method];\r\n        RTCPeerConnection.prototype[method] = function () {\r\n          const args = arguments;\r\n          if (typeof args[1] === 'function' ||\r\n\t\t\t\t\t\ttypeof args[2] === 'function') { // legacy\r\n            return nativeMethod.apply(this, arguments)\r\n                .then(() => {\r\n                  if (typeof args[1] === 'function') {\r\n                    args[1].apply(null);\r\n                  }\r\n                }, (error) => {\r\n                  if (typeof args[2] === 'function') {\r\n                    args[2].apply(null, [error]);\r\n                  }\r\n                });\r\n          }\r\n          return nativeMethod.apply(this, arguments);\r\n        };\r\n      });\r\n\r\n      // getStats is special. It doesn't have a spec legacy method yet we support\r\n      // getStats(something, cb) without error callbacks.\r\n      ['getStats'].forEach((method) => {\r\n        const nativeMethod = RTCPeerConnection.prototype[method];\r\n        RTCPeerConnection.prototype[method] = function () {\r\n          const args = arguments;\r\n          if (typeof args[1] === 'function') {\r\n            return nativeMethod.apply(this, arguments)\r\n                .then(() => {\r\n                  if (typeof args[1] === 'function') {\r\n                    args[1].apply(null);\r\n                  }\r\n                });\r\n          }\r\n          return nativeMethod.apply(this, arguments);\r\n        };\r\n      });\r\n\r\n      return RTCPeerConnection;\r\n    };\r\n  }, {sdp: 17}], 17: [function (require, module, exports) {\r\n\t /* eslint-env node */\r\n    'use strict';\r\n\r\n    // SDP helpers.\r\n    const SDPUtils = {};\r\n\r\n    // Generate an alphanumeric identifier for cname or mids.\r\n    // TODO: use UUIDs instead? https://gist.github.com/jed/982883\r\n    SDPUtils.generateIdentifier = function () {\r\n      return Math.random().toString(36).substr(2, 10);\r\n    };\r\n\r\n    // The RTCP CNAME used by all peerconnections from the same JS.\r\n    SDPUtils.localCName = SDPUtils.generateIdentifier();\r\n\r\n    // Splits SDP into lines, dealing with both CRLF and LF.\r\n    SDPUtils.splitLines = function (blob) {\r\n      return blob.trim().split('\\n').map((line) => line.trim());\r\n    };\r\n    // Splits SDP into sessionpart and mediasections. Ensures CRLF.\r\n    SDPUtils.splitSections = function (blob) {\r\n      const parts = blob.split('\\nm=');\r\n      return parts.map((part, index) => `${(index > 0 ? `m=${part}` : part).trim()}\\r\\n`);\r\n    };\r\n\r\n    // returns the session description.\r\n    SDPUtils.getDescription = function (blob) {\r\n      const sections = SDPUtils.splitSections(blob);\r\n      return sections && sections[0];\r\n    };\r\n\r\n    // returns the individual media sections.\r\n    SDPUtils.getMediaSections = function (blob) {\r\n      const sections = SDPUtils.splitSections(blob);\r\n      sections.shift();\r\n      return sections;\r\n    };\r\n\r\n    // Returns lines that start with a certain prefix.\r\n    SDPUtils.matchPrefix = function (blob, prefix) {\r\n      return SDPUtils.splitLines(blob).filter((line) => line.indexOf(prefix) === 0);\r\n    };\r\n\r\n    // Parses an ICE candidate line. Sample input:\r\n    // candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\r\n    // rport 55996\"\r\n    SDPUtils.parseCandidate = function (line) {\r\n      let parts;\r\n      // Parse both variants.\r\n      if (line.indexOf('a=candidate:') === 0) {\r\n        parts = line.substring(12).split(' ');\r\n      } else {\r\n        parts = line.substring(10).split(' ');\r\n      }\r\n\r\n      const candidate = {\r\n        foundation: parts[0],\r\n        component: parseInt(parts[1], 10),\r\n        protocol: parts[2].toLowerCase(),\r\n        priority: parseInt(parts[3], 10),\r\n        ip: parts[4],\r\n        address: parts[4], // address is an alias for ip.\r\n        port: parseInt(parts[5], 10),\r\n        // skip parts[6] == 'typ'\r\n        type: parts[7],\r\n      };\r\n\r\n      for (let i = 8; i < parts.length; i += 2) {\r\n        switch (parts[i]) {\r\n          case 'raddr':\r\n            candidate.relatedAddress = parts[i + 1];\r\n            break;\r\n          case 'rport':\r\n            candidate.relatedPort = parseInt(parts[i + 1], 10);\r\n            break;\r\n          case 'tcptype':\r\n            candidate.tcpType = parts[i + 1];\r\n            break;\r\n          case 'ufrag':\r\n            candidate.ufrag = parts[i + 1]; // for backward compability.\r\n            candidate.usernameFragment = parts[i + 1];\r\n            break;\r\n          default: // extension handling, in particular ufrag\r\n            candidate[parts[i]] = parts[i + 1];\r\n            break;\r\n        }\r\n      }\r\n      return candidate;\r\n    };\r\n\r\n    // Translates a candidate object into SDP candidate attribute.\r\n    SDPUtils.writeCandidate = function (candidate) {\r\n      const sdp = [];\r\n      sdp.push(candidate.foundation);\r\n      sdp.push(candidate.component);\r\n      sdp.push(candidate.protocol.toUpperCase());\r\n      sdp.push(candidate.priority);\r\n      sdp.push(candidate.address || candidate.ip);\r\n      sdp.push(candidate.port);\r\n\r\n      const type = candidate.type;\r\n      sdp.push('typ');\r\n      sdp.push(type);\r\n      if (type !== 'host' && candidate.relatedAddress &&\r\n\t\t\t\tcandidate.relatedPort) {\r\n        sdp.push('raddr');\r\n        sdp.push(candidate.relatedAddress);\r\n        sdp.push('rport');\r\n        sdp.push(candidate.relatedPort);\r\n      }\r\n      if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\r\n        sdp.push('tcptype');\r\n        sdp.push(candidate.tcpType);\r\n      }\r\n      if (candidate.usernameFragment || candidate.ufrag) {\r\n        sdp.push('ufrag');\r\n        sdp.push(candidate.usernameFragment || candidate.ufrag);\r\n      }\r\n      return `candidate:${sdp.join(' ')}`;\r\n    };\r\n\r\n    // Parses an ice-options line, returns an array of option tags.\r\n    // a=ice-options:foo bar\r\n    SDPUtils.parseIceOptions = function (line) {\r\n      return line.substr(14).split(' ');\r\n    };\r\n\r\n    // Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\r\n    // a=rtpmap:111 opus/48000/2\r\n    SDPUtils.parseRtpMap = function (line) {\r\n      let parts = line.substr(9).split(' ');\r\n      const parsed = {\r\n        payloadType: parseInt(parts.shift(), 10), // was: id\r\n      };\r\n\r\n      parts = parts[0].split('/');\r\n\r\n      parsed.name = parts[0];\r\n      parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\r\n      parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\r\n      // legacy alias, got renamed back to channels in ORTC.\r\n      parsed.numChannels = parsed.channels;\r\n      return parsed;\r\n    };\r\n\r\n    // Generate an a=rtpmap line from RTCRtpCodecCapability or\r\n    // RTCRtpCodecParameters.\r\n    SDPUtils.writeRtpMap = function (codec) {\r\n      let pt = codec.payloadType;\r\n      if (codec.preferredPayloadType !== undefined) {\r\n        pt = codec.preferredPayloadType;\r\n      }\r\n      const channels = codec.channels || codec.numChannels || 1;\r\n      return `a=rtpmap:${pt} ${codec.name}/${codec.clockRate\r\n      }${channels !== 1 ? `/${channels}` : ''}\\r\\n`;\r\n    };\r\n\r\n    // Parses an a=extmap line (headerextension from RFC 5285). Sample input:\r\n    // a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\r\n    // a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\r\n    SDPUtils.parseExtmap = function (line) {\r\n      const parts = line.substr(9).split(' ');\r\n      return {\r\n        id: parseInt(parts[0], 10),\r\n        direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\r\n        uri: parts[1],\r\n      };\r\n    };\r\n\r\n    // Generates a=extmap line from RTCRtpHeaderExtensionParameters or\r\n    // RTCRtpHeaderExtension.\r\n    SDPUtils.writeExtmap = function (headerExtension) {\r\n      return `a=extmap:${headerExtension.id || headerExtension.preferredId\r\n      }${headerExtension.direction && headerExtension.direction !== 'sendrecv'\r\n        ? `/${headerExtension.direction}`\r\n        : ''\r\n      } ${headerExtension.uri}\\r\\n`;\r\n    };\r\n\r\n    // Parses an ftmp line, returns dictionary. Sample input:\r\n    // a=fmtp:96 vbr=on;cng=on\r\n    // Also deals with vbr=on; cng=on\r\n    SDPUtils.parseFmtp = function (line) {\r\n      const parsed = {};\r\n      let kv;\r\n      const parts = line.substr(line.indexOf(' ') + 1).split(';');\r\n      for (let j = 0; j < parts.length; j++) {\r\n        kv = parts[j].trim().split('=');\r\n        parsed[kv[0].trim()] = kv[1];\r\n      }\r\n      return parsed;\r\n    };\r\n\r\n    // Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\r\n    SDPUtils.writeFmtp = function (codec) {\r\n      let line = '';\r\n      let pt = codec.payloadType;\r\n      if (codec.preferredPayloadType !== undefined) {\r\n        pt = codec.preferredPayloadType;\r\n      }\r\n      if (codec.parameters && Object.keys(codec.parameters).length) {\r\n        const params = [];\r\n        Object.keys(codec.parameters).forEach((param) => {\r\n          if (codec.parameters[param]) {\r\n            params.push(`${param}=${codec.parameters[param]}`);\r\n          } else {\r\n            params.push(param);\r\n          }\r\n        });\r\n        line += `a=fmtp:${pt} ${params.join(';')}\\r\\n`;\r\n      }\r\n      return line;\r\n    };\r\n\r\n    // Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\r\n    // a=rtcp-fb:98 nack rpsi\r\n    SDPUtils.parseRtcpFb = function (line) {\r\n      const parts = line.substr(line.indexOf(' ') + 1).split(' ');\r\n      return {\r\n        type: parts.shift(),\r\n        parameter: parts.join(' '),\r\n      };\r\n    };\r\n    // Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\r\n    SDPUtils.writeRtcpFb = function (codec) {\r\n      let lines = '';\r\n      let pt = codec.payloadType;\r\n      if (codec.preferredPayloadType !== undefined) {\r\n        pt = codec.preferredPayloadType;\r\n      }\r\n      if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\r\n      // FIXME: special handling for trr-int?\r\n        codec.rtcpFeedback.forEach((fb) => {\r\n          lines += `a=rtcp-fb:${pt} ${fb.type\r\n          }${fb.parameter && fb.parameter.length ? ` ${fb.parameter}` : ''\r\n          }\\r\\n`;\r\n        });\r\n      }\r\n      return lines;\r\n    };\r\n\r\n    // Parses an RFC 5576 ssrc media attribute. Sample input:\r\n    // a=ssrc:3735928559 cname:something\r\n    SDPUtils.parseSsrcMedia = function (line) {\r\n      const sp = line.indexOf(' ');\r\n      const parts = {\r\n        ssrc: parseInt(line.substr(7, sp - 7), 10),\r\n      };\r\n      const colon = line.indexOf(':', sp);\r\n      if (colon > -1) {\r\n        parts.attribute = line.substr(sp + 1, colon - sp - 1);\r\n        parts.value = line.substr(colon + 1);\r\n      } else {\r\n        parts.attribute = line.substr(sp + 1);\r\n      }\r\n      return parts;\r\n    };\r\n\r\n    SDPUtils.parseSsrcGroup = function (line) {\r\n      const parts = line.substr(13).split(' ');\r\n      return {\r\n        semantics: parts.shift(),\r\n        ssrcs: parts.map((ssrc) => parseInt(ssrc, 10)),\r\n      };\r\n    };\r\n\r\n    // Extracts the MID (RFC 5888) from a media section.\r\n    // returns the MID or undefined if no mid line was found.\r\n    SDPUtils.getMid = function (mediaSection) {\r\n      const mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\r\n      if (mid) {\r\n        return mid.substr(6);\r\n      }\r\n    };\r\n\r\n    SDPUtils.parseFingerprint = function (line) {\r\n      const parts = line.substr(14).split(' ');\r\n      return {\r\n        algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\r\n        value: parts[1],\r\n      };\r\n    };\r\n\r\n    // Extracts DTLS parameters from SDP media section or sessionpart.\r\n    // FIXME: for consistency with other functions this should only\r\n    //   get the fingerprint line as input. See also getIceParameters.\r\n    SDPUtils.getDtlsParameters = function (mediaSection, sessionpart) {\r\n      const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\r\n          'a=fingerprint:');\r\n      // Note: a=setup line is ignored since we use the 'auto' role.\r\n      // Note2: 'algorithm' is not case sensitive except in Edge.\r\n      return {\r\n        role: 'auto',\r\n        fingerprints: lines.map(SDPUtils.parseFingerprint),\r\n      };\r\n    };\r\n\r\n    // Serializes DTLS parameters to SDP.\r\n    SDPUtils.writeDtlsParameters = function (params, setupType) {\r\n      let sdp = `a=setup:${setupType}\\r\\n`;\r\n      params.fingerprints.forEach((fp) => {\r\n        sdp += `a=fingerprint:${fp.algorithm} ${fp.value}\\r\\n`;\r\n      });\r\n      return sdp;\r\n    };\r\n    // Parses ICE information from SDP media section or sessionpart.\r\n    // FIXME: for consistency with other functions this should only\r\n    //   get the ice-ufrag and ice-pwd lines as input.\r\n    SDPUtils.getIceParameters = function (mediaSection, sessionpart) {\r\n      let lines = SDPUtils.splitLines(mediaSection);\r\n      // Search in session part, too.\r\n      lines = lines.concat(SDPUtils.splitLines(sessionpart));\r\n      const iceParameters = {\r\n        usernameFragment: lines.filter((line) => line.indexOf('a=ice-ufrag:') === 0)[0].substr(12),\r\n        password: lines.filter((line) => line.indexOf('a=ice-pwd:') === 0)[0].substr(10),\r\n      };\r\n      return iceParameters;\r\n    };\r\n\r\n    // Serializes ICE parameters to SDP.\r\n    SDPUtils.writeIceParameters = function (params) {\r\n      return `a=ice-ufrag:${params.usernameFragment}\\r\\n` +\r\n\t\t\t\t`a=ice-pwd:${params.password}\\r\\n`;\r\n    };\r\n\r\n    // Parses the SDP media section and returns RTCRtpParameters.\r\n    SDPUtils.parseRtpParameters = function (mediaSection) {\r\n      const description = {\r\n        codecs: [],\r\n        headerExtensions: [],\r\n        fecMechanisms: [],\r\n        rtcp: [],\r\n      };\r\n      const lines = SDPUtils.splitLines(mediaSection);\r\n      const mline = lines[0].split(' ');\r\n      for (let i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\r\n        const pt = mline[i];\r\n        const rtpmapline = SDPUtils.matchPrefix(\r\n            mediaSection, `a=rtpmap:${pt} `)[0];\r\n        if (rtpmapline) {\r\n          const codec = SDPUtils.parseRtpMap(rtpmapline);\r\n          const fmtps = SDPUtils.matchPrefix(\r\n              mediaSection, `a=fmtp:${pt} `);\r\n          // Only the first a=fmtp:<pt> is considered.\r\n          codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\r\n          codec.rtcpFeedback = SDPUtils.matchPrefix(\r\n              mediaSection, `a=rtcp-fb:${pt} `)\r\n              .map(SDPUtils.parseRtcpFb);\r\n          description.codecs.push(codec);\r\n          // parse FEC mechanisms from rtpmap lines.\r\n          switch (codec.name.toUpperCase()) {\r\n            case 'RED':\r\n            case 'ULPFEC':\r\n              description.fecMechanisms.push(codec.name.toUpperCase());\r\n              break;\r\n            default: // only RED and ULPFEC are recognized as FEC mechanisms.\r\n              break;\r\n          }\r\n        }\r\n      }\r\n      SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach((line) => {\r\n        description.headerExtensions.push(SDPUtils.parseExtmap(line));\r\n      });\r\n      // FIXME: parse rtcp.\r\n      return description;\r\n    };\r\n\r\n    // Generates parts of the SDP media section describing the capabilities /\r\n    // parameters.\r\n    SDPUtils.writeRtpDescription = function (kind, caps) {\r\n      let sdp = '';\r\n\r\n      // Build the mline.\r\n      sdp += `m=${kind} `;\r\n      sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\r\n      sdp += ' UDP/TLS/RTP/SAVPF ';\r\n      sdp += `${caps.codecs.map((codec) => {\r\n        if (codec.preferredPayloadType !== undefined) {\r\n          return codec.preferredPayloadType;\r\n        }\r\n        return codec.payloadType;\r\n      }).join(' ')}\\r\\n`;\r\n\r\n      sdp += 'c=IN IP4 0.0.0.0\\r\\n';\r\n      sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\r\n\r\n      // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\r\n      caps.codecs.forEach((codec) => {\r\n        sdp += SDPUtils.writeRtpMap(codec);\r\n        sdp += SDPUtils.writeFmtp(codec);\r\n        sdp += SDPUtils.writeRtcpFb(codec);\r\n      });\r\n      let maxptime = 0;\r\n      caps.codecs.forEach((codec) => {\r\n        if (codec.maxptime > maxptime) {\r\n          maxptime = codec.maxptime;\r\n        }\r\n      });\r\n      if (maxptime > 0) {\r\n        sdp += `a=maxptime:${maxptime}\\r\\n`;\r\n      }\r\n      sdp += 'a=rtcp-mux\\r\\n';\r\n\r\n      if (caps.headerExtensions) {\r\n        caps.headerExtensions.forEach((extension) => {\r\n          sdp += SDPUtils.writeExtmap(extension);\r\n        });\r\n      }\r\n      // FIXME: write fecMechanisms.\r\n      return sdp;\r\n    };\r\n\r\n    // Parses the SDP media section and returns an array of\r\n    // RTCRtpEncodingParameters.\r\n    SDPUtils.parseRtpEncodingParameters = function (mediaSection) {\r\n      const encodingParameters = [];\r\n      const description = SDPUtils.parseRtpParameters(mediaSection);\r\n      const hasRed = description.fecMechanisms.indexOf('RED') !== -1;\r\n      const hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\r\n\r\n      // filter a=ssrc:... cname:, ignore PlanB-msid\r\n      const ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\r\n          .map((line) => SDPUtils.parseSsrcMedia(line))\r\n          .filter((parts) => parts.attribute === 'cname');\r\n      const primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\r\n      let secondarySsrc;\r\n\r\n      const flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\r\n          .map((line) => {\r\n            const parts = line.substr(17).split(' ');\r\n            return parts.map((part) => parseInt(part, 10));\r\n          });\r\n      if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\r\n        secondarySsrc = flows[0][1];\r\n      }\r\n\r\n      description.codecs.forEach((codec) => {\r\n        if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\r\n          let encParam = {\r\n            ssrc: primarySsrc,\r\n            codecPayloadType: parseInt(codec.parameters.apt, 10),\r\n          };\r\n          if (primarySsrc && secondarySsrc) {\r\n            encParam.rtx = {ssrc: secondarySsrc};\r\n          }\r\n          encodingParameters.push(encParam);\r\n          if (hasRed) {\r\n            encParam = JSON.parse(JSON.stringify(encParam));\r\n            encParam.fec = {\r\n              ssrc: primarySsrc,\r\n              mechanism: hasUlpfec ? 'red+ulpfec' : 'red',\r\n            };\r\n            encodingParameters.push(encParam);\r\n          }\r\n        }\r\n      });\r\n      if (encodingParameters.length === 0 && primarySsrc) {\r\n        encodingParameters.push({\r\n          ssrc: primarySsrc,\r\n        });\r\n      }\r\n\r\n      // we support both b=AS and b=TIAS but interpret AS as TIAS.\r\n      let bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\r\n      if (bandwidth.length) {\r\n        if (bandwidth[0].indexOf('b=TIAS:') === 0) {\r\n          bandwidth = parseInt(bandwidth[0].substr(7), 10);\r\n        } else if (bandwidth[0].indexOf('b=AS:') === 0) {\r\n        // use formula from JSEP to convert b=AS to TIAS value.\r\n          bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95 -\r\n\t\t\t\t\t\t(50 * 40 * 8);\r\n        } else {\r\n          bandwidth = undefined;\r\n        }\r\n        encodingParameters.forEach((params) => {\r\n          params.maxBitrate = bandwidth;\r\n        });\r\n      }\r\n      return encodingParameters;\r\n    };\r\n\r\n    // parses http://draft.ortc.org/#rtcrtcpparameters*\r\n    SDPUtils.parseRtcpParameters = function (mediaSection) {\r\n      const rtcpParameters = {};\r\n\r\n      // Gets the first SSRC. Note tha with RTX there might be multiple\r\n      // SSRCs.\r\n      const remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\r\n          .map((line) => SDPUtils.parseSsrcMedia(line))\r\n          .filter((obj) => obj.attribute === 'cname')[0];\r\n      if (remoteSsrc) {\r\n        rtcpParameters.cname = remoteSsrc.value;\r\n        rtcpParameters.ssrc = remoteSsrc.ssrc;\r\n      }\r\n\r\n      // Edge uses the compound attribute instead of reducedSize\r\n      // compound is !reducedSize\r\n      const rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\r\n      rtcpParameters.reducedSize = rsize.length > 0;\r\n      rtcpParameters.compound = rsize.length === 0;\r\n\r\n      // parses the rtcp-mux attrbute.\r\n      // Note that Edge does not support unmuxed RTCP.\r\n      const mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\r\n      rtcpParameters.mux = mux.length > 0;\r\n\r\n      return rtcpParameters;\r\n    };\r\n\r\n    // parses either a=msid: or a=ssrc:... msid lines and returns\r\n    // the id of the MediaStream and MediaStreamTrack.\r\n    SDPUtils.parseMsid = function (mediaSection) {\r\n      let parts;\r\n      const spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\r\n      if (spec.length === 1) {\r\n        parts = spec[0].substr(7).split(' ');\r\n        return {stream: parts[0], track: parts[1]};\r\n      }\r\n      const planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\r\n          .map((line) => SDPUtils.parseSsrcMedia(line))\r\n          .filter((msidParts) => msidParts.attribute === 'msid');\r\n      if (planB.length > 0) {\r\n        parts = planB[0].value.split(' ');\r\n        return {stream: parts[0], track: parts[1]};\r\n      }\r\n    };\r\n\r\n    // Generate a session ID for SDP.\r\n    // https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\r\n    // recommends using a cryptographically random +ve 64-bit value\r\n    // but right now this should be acceptable and within the right range\r\n    SDPUtils.generateSessionId = function () {\r\n      return Math.random().toString().substr(2, 21);\r\n    };\r\n\r\n    // Write boilder plate for start of SDP\r\n    // sessId argument is optional - if not supplied it will\r\n    // be generated randomly\r\n    // sessVersion is optional and defaults to 2\r\n    // sessUser is optional and defaults to 'thisisadapterortc'\r\n    SDPUtils.writeSessionBoilerplate = function (sessId, sessVer, sessUser) {\r\n      let sessionId;\r\n      const version = sessVer !== undefined ? sessVer : 2;\r\n      if (sessId) {\r\n        sessionId = sessId;\r\n      } else {\r\n        sessionId = SDPUtils.generateSessionId();\r\n      }\r\n      const user = sessUser || 'thisisadapterortc';\r\n      // FIXME: sess-id should be an NTP timestamp.\r\n      return `${'v=0\\r\\n' +\r\n\t\t\t\t'o='}${user} ${sessionId} ${version\r\n      } IN IP4 127.0.0.1\\r\\n` +\r\n\t\t\t\t's=-\\r\\n' +\r\n\t\t\t\t't=0 0\\r\\n';\r\n    };\r\n\r\n    SDPUtils.writeMediaSection = function (transceiver, caps, type, stream) {\r\n      let sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\r\n\r\n      // Map ICE parameters (ufrag, pwd) to SDP.\r\n      sdp += SDPUtils.writeIceParameters(\r\n          transceiver.iceGatherer.getLocalParameters());\r\n\r\n      // Map DTLS parameters to SDP.\r\n      sdp += SDPUtils.writeDtlsParameters(\r\n          transceiver.dtlsTransport.getLocalParameters(),\r\n          type === 'offer' ? 'actpass' : 'active');\r\n\r\n      sdp += `a=mid:${transceiver.mid}\\r\\n`;\r\n\r\n      if (transceiver.direction) {\r\n        sdp += `a=${transceiver.direction}\\r\\n`;\r\n      } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\r\n        sdp += 'a=sendrecv\\r\\n';\r\n      } else if (transceiver.rtpSender) {\r\n        sdp += 'a=sendonly\\r\\n';\r\n      } else if (transceiver.rtpReceiver) {\r\n        sdp += 'a=recvonly\\r\\n';\r\n      } else {\r\n        sdp += 'a=inactive\\r\\n';\r\n      }\r\n\r\n      if (transceiver.rtpSender) {\r\n      // spec.\r\n        const msid = `msid:${stream.id} ${\r\n          transceiver.rtpSender.track.id}\\r\\n`;\r\n        sdp += `a=${msid}`;\r\n\r\n        // for Chrome.\r\n        sdp += `a=ssrc:${transceiver.sendEncodingParameters[0].ssrc\r\n        } ${msid}`;\r\n        if (transceiver.sendEncodingParameters[0].rtx) {\r\n          sdp += `a=ssrc:${transceiver.sendEncodingParameters[0].rtx.ssrc\r\n          } ${msid}`;\r\n          sdp += `a=ssrc-group:FID ${\r\n            transceiver.sendEncodingParameters[0].ssrc} ${\r\n            transceiver.sendEncodingParameters[0].rtx.ssrc\r\n          }\\r\\n`;\r\n        }\r\n      }\r\n      // FIXME: this should be written by writeRtpDescription.\r\n      sdp += `a=ssrc:${transceiver.sendEncodingParameters[0].ssrc\r\n      } cname:${SDPUtils.localCName}\\r\\n`;\r\n      if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\r\n        sdp += `a=ssrc:${transceiver.sendEncodingParameters[0].rtx.ssrc\r\n        } cname:${SDPUtils.localCName}\\r\\n`;\r\n      }\r\n      return sdp;\r\n    };\r\n\r\n    // Gets the direction from the mediaSection or the sessionpart.\r\n    SDPUtils.getDirection = function (mediaSection, sessionpart) {\r\n    // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\r\n      const lines = SDPUtils.splitLines(mediaSection);\r\n      for (let i = 0; i < lines.length; i++) {\r\n        switch (lines[i]) {\r\n          case 'a=sendrecv':\r\n          case 'a=sendonly':\r\n          case 'a=recvonly':\r\n          case 'a=inactive':\r\n            return lines[i].substr(2);\r\n          default:\r\n\t\t\t\t\t// FIXME: What should happen here?\r\n        }\r\n      }\r\n      if (sessionpart) {\r\n        return SDPUtils.getDirection(sessionpart);\r\n      }\r\n      return 'sendrecv';\r\n    };\r\n\r\n    SDPUtils.getKind = function (mediaSection) {\r\n      const lines = SDPUtils.splitLines(mediaSection);\r\n      const mline = lines[0].split(' ');\r\n      return mline[0].substr(2);\r\n    };\r\n\r\n    SDPUtils.isRejected = function (mediaSection) {\r\n      return mediaSection.split(' ', 2)[1] === '0';\r\n    };\r\n\r\n    SDPUtils.parseMLine = function (mediaSection) {\r\n      const lines = SDPUtils.splitLines(mediaSection);\r\n      const parts = lines[0].substr(2).split(' ');\r\n      return {\r\n        kind: parts[0],\r\n        port: parseInt(parts[1], 10),\r\n        protocol: parts[2],\r\n        fmt: parts.slice(3).join(' '),\r\n      };\r\n    };\r\n\r\n    SDPUtils.parseOLine = function (mediaSection) {\r\n      const line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\r\n      const parts = line.substr(2).split(' ');\r\n      return {\r\n        username: parts[0],\r\n        sessionId: parts[1],\r\n        sessionVersion: parseInt(parts[2], 10),\r\n        netType: parts[3],\r\n        addressType: parts[4],\r\n        address: parts[5],\r\n      };\r\n    };\r\n\r\n    // a very naive interpretation of a valid SDP.\r\n    SDPUtils.isValidSDP = function (blob) {\r\n      if (typeof blob !== 'string' || blob.length === 0) {\r\n        return false;\r\n      }\r\n      const lines = SDPUtils.splitLines(blob);\r\n      for (let i = 0; i < lines.length; i++) {\r\n        if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\r\n          return false;\r\n        }\r\n      // TODO: check the modifier a bit more.\r\n      }\r\n      return true;\r\n    };\r\n\r\n    // Expose public methods.\r\n    if (typeof module === 'object') {\r\n      module.exports = SDPUtils;\r\n    }\r\n  }, {}]}, {}, [1])(1);\r\n});\r\n","(function() {\r\n  if (!navigator.mediaDevices) navigator.mediaDevices = {};\r\n  if (!navigator.mediaDevices.getUserMedia) {\r\n    var getUserMedia =\r\n      navigator.webkitGetUserMedia ||\r\n      navigator.mozGetUserMedia ||\r\n      navigator.msGetUserMedia ||\r\n      navigator.getUserMedia;\r\n\r\n    if (getUserMedia) {\r\n      navigator.mediaDevices.getUserMedia = function(constraints) {\r\n        return new Promise(function(resolve, reject) {\r\n          getUserMedia(\r\n            constraints,\r\n            function(stream) {\r\n              resolve(stream);\r\n            },\r\n            function(error) {\r\n              reject(error);\r\n            }\r\n          );\r\n        });\r\n      };\r\n    } else {\r\n      navigator.mediaDevices.getUserMedia = function() {\r\n        // A missing `getUserMedia` seemingly can mean one of two things:\r\n        //\r\n        // 1) WebRTC is unsupported or disabled on this browser\r\n        // 2) This is an insecure connection\r\n        //   * This handling of insecure connections happens only on certain browsers.\r\n        //     It was observed in Chromium 80 and Firefox 75, but not Firefox 68. I suspect it's the new behavior.\r\n        //   * In other browsers, it handles insecure connections by throwing `NotAllowedError`.\r\n        //     We still handle this case in the calling function.\r\n        //   * See: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\r\n        //     As of this writing, this claims that the browser does *both* of these things for\r\n        //     insecure connections, which is of course impossible and thus confusing.\r\n        //\r\n        // We will attempt to distinguish these two cases by checking for various webrtc-related fields on\r\n        // `window` (inspired by github.com/muaz-khan/DetectRTC). If none of those fields exist, we assume\r\n        // that WebRTC is not supported on this browser.\r\n        return new Promise(function(resolve, reject) {\r\n          if (!(window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection || window.RTCIceGatherer)) {\r\n            var e = new Error(\"getUserMedia is not supported in this browser.\");\r\n            // I'd use NotSupportedError but I'm afraid they'll change the spec on us again\r\n            e.name = 'CustomNotSupportedError';\r\n            reject(e);\r\n          } else {\r\n            var e = new Error(\"insecure connection\");\r\n            // I'd use NotAllowedError but I'm afraid they'll change the spec on us again\r\n            e.name = 'CustomSecureConnectionError';\r\n            reject(e);\r\n          }\r\n        });\r\n      };\r\n    }\r\n  }\r\n})();","(function(a){var r=a.fn.domManip,d=\"_tmplitem\",q=/^[^<]*(<[\\w\\W]+>)[^>]*$|\\{\\{\\! /,b={},f={},e,p={key:0,data:{}},h=0,c=0,l=[];function g(e,d,g,i){var c={data:i||(d?d.data:{}),_wrap:d?d._wrap:null,tmpl:null,parent:d||null,nodes:[],calls:u,nest:w,wrap:x,html:v,update:t};e&&a.extend(c,e,{nodes:[],parent:d});if(g){c.tmpl=g;c._ctnt=c._ctnt||c.tmpl(a,c);c.key=++h;(l.length?f:b)[h]=c}return c}a.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(f,d){a.fn[f]=function(n){var g=[],i=a(n),k,h,m,l,j=this.length===1&&this[0].parentNode;e=b||{};if(j&&j.nodeType===11&&j.childNodes.length===1&&i.length===1){i[d](this[0]);g=this}else{for(h=0,m=i.length;h<m;h++){c=h;k=(h>0?this.clone(true):this).get();a.fn[d].apply(a(i[h]),k);g=g.concat(k)}c=0;g=this.pushStack(g,f,i.selector)}l=e;e=null;a.tmpl.complete(l);return g}});a.fn.extend({tmpl:function(d,c,b){return a.tmpl(this[0],d,c,b)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(d,l,j){if(d[0]&&d[0].nodeType){var f=a.makeArray(arguments),g=d.length,i=0,h;while(i<g&&!(h=a.data(d[i++],\"tmplItem\")));if(g>1)f[0]=[a.makeArray(d)];if(h&&c)f[2]=function(b){a.tmpl.afterManip(this,b,j)};r.apply(this,f)}else r.apply(this,arguments);c=0;!e&&a.tmpl.complete(b);return this}});a.extend({tmpl:function(d,h,e,c){var j,k=!c;if(k){c=p;d=a.template[d]||a.template(null,d);f={}}else if(!d){d=c.tmpl;b[c.key]=c;c.nodes=[];c.wrapped&&n(c,c.wrapped);return a(i(c,null,c.tmpl(a,c)))}if(!d)return[];if(typeof h===\"function\")h=h.call(c||{});e&&e.wrapped&&n(e,e.wrapped);j=a.isArray(h)?a.map(h,function(a){return a?g(e,c,d,a):null}):[g(e,c,d,h)];return k?a(i(c,null,j)):j},tmplItem:function(b){var c;if(b instanceof a)b=b[0];while(b&&b.nodeType===1&&!(c=a.data(b,\"tmplItem\"))&&(b=b.parentNode));return c||p},template:function(c,b){if(b){if(typeof b===\"string\")b=o(b);else if(b instanceof a)b=b[0]||{};if(b.nodeType)b=a.data(b,\"tmpl\")||a.data(b,\"tmpl\",o(b.innerHTML));return typeof c===\"string\"?(a.template[c]=b):b}return c?typeof c!==\"string\"?a.template(null,c):a.template[c]||a.template(null,q.test(c)?c:a(c)):null},encode:function(a){return(\"\"+a).split(\"<\").join(\"&lt;\").split(\">\").join(\"&gt;\").split('\"').join(\"&#34;\").split(\"'\").join(\"&#39;\")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:\"null\"},open:\"if($notnull_1){_=_.concat($item.nest($1,$2));}\"},wrap:{_default:{$2:\"null\"},open:\"$item.calls(_,$1,$2);_=[];\",close:\"call=$item.calls();_=call._.concat($item.wrap(call,_));\"},each:{_default:{$2:\"$index, $value\"},open:\"if($notnull_1){$.each($1a,function($2){with(this){\",close:\"}});}\"},\"if\":{open:\"if(($notnull_1) && $1a){\",close:\"}\"},\"else\":{_default:{$1:\"true\"},open:\"}else if(($notnull_1) && $1a){\"},html:{open:\"if($notnull_1){_.push($1a);}\"},\"=\":{_default:{$1:\"$data\"},open:\"if($notnull_1){_.push($.encode($1a));}\"},\"!\":{open:\"\"}},complete:function(){b={}},afterManip:function(f,b,d){var e=b.nodeType===11?a.makeArray(b.childNodes):b.nodeType===1?[b]:[];d.call(f,b);m(e);c++}});function i(e,g,f){var b,c=f?a.map(f,function(a){return typeof a===\"string\"?e.key?a.replace(/(<\\w+)(?=[\\s>])(?![^>]*_tmplitem)([^>]*)/g,\"$1 \"+d+'=\"'+e.key+'\" $2'):a:i(a,e,a._ctnt)}):e;if(g)return c;c=c.join(\"\");c.replace(/^\\s*([^<\\s][^<]*)?(<[\\w\\W]+>)([^>]*[^>\\s])?\\s*$/,function(f,c,e,d){b=a(e).get();m(b);if(c)b=j(c).concat(b);if(d)b=b.concat(j(d))});return b?b:j(c)}function j(c){var b=document.createElement(\"div\");b.innerHTML=c;return a.makeArray(b.childNodes)}function o(b){return new Function(\"jQuery\",\"$item\",\"var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('\"+a.trim(b).replace(/([\\\\'])/g,\"\\\\$1\").replace(/[\\r\\t\\n]/g,\" \").replace(/\\$\\{([^\\}]*)\\}/g,\"{{= $1}}\").replace(/\\{\\{(\\/?)(\\w+|.)(?:\\(((?:[^\\}]|\\}(?!\\}))*?)?\\))?(?:\\s+(.*?)?)?(\\(((?:[^\\}]|\\}(?!\\}))*?)\\))?\\s*\\}\\}/g,function(m,l,j,d,b,c,e){var i=a.tmpl.tag[j],h,f,g;if(!i)throw\"Template command not found: \"+j;h=i._default||[];if(c&&!/\\w$/.test(b)){b+=c;c=\"\"}if(b){b=k(b);e=e?\",\"+k(e)+\")\":c?\")\":\"\";f=c?b.indexOf(\".\")>-1?b+c:\"(\"+b+\").call($item\"+e:b;g=c?f:\"(typeof(\"+b+\")==='function'?(\"+b+\").call($item):(\"+b+\"))\"}else g=f=h.$1||\"null\";d=k(d);return\"');\"+i[l?\"close\":\"open\"].split(\"$notnull_1\").join(b?\"typeof(\"+b+\")!=='undefined' && (\"+b+\")!=null\":\"true\").split(\"$1a\").join(g).split(\"$1\").join(f).split(\"$2\").join(d?d.replace(/\\s*([^\\(]+)\\s*(\\((.*?)\\))?/g,function(d,c,b,a){a=a?\",\"+a+\")\":b?\")\":\"\";return a?\"(\"+c+\").call($item\"+a:d}):h.$2||\"\")+\"_.push('\"})+\"');}return _;\")}function n(c,b){c._wrap=i(c,true,a.isArray(b)?b:[q.test(b)?b:a(b).html()]).join(\"\")}function k(a){return a?a.replace(/\\\\'/g,\"'\").replace(/\\\\\\\\/g,\"\\\\\"):null}function s(b){var a=document.createElement(\"div\");a.appendChild(b.cloneNode(true));return a.innerHTML}function m(o){var n=\"_\"+c,k,j,l={},e,p,i;for(e=0,p=o.length;e<p;e++){if((k=o[e]).nodeType!==1)continue;j=k.getElementsByTagName(\"*\");for(i=j.length-1;i>=0;i--)m(j[i]);m(k)}function m(j){var p,i=j,k,e,m;if(m=j.getAttribute(d)){while(i.parentNode&&(i=i.parentNode).nodeType===1&&!(p=i.getAttribute(d)));if(p!==m){i=i.parentNode?i.nodeType===11?0:i.getAttribute(d)||0:0;if(!(e=b[m])){e=f[m];e=g(e,b[i]||f[i],null,true);e.key=++h;b[h]=e}c&&o(m)}j.removeAttribute(d)}else if(c&&(e=a.data(j,\"tmplItem\"))){o(e.key);b[e.key]=e;i=a.data(j.parentNode,\"tmplItem\");i=i?i.key:0}if(e){k=e;while(k&&k.key!=i){k.nodes.push(j);k=k.parent}delete e._ctnt;delete e._wrap;a.data(j,\"tmplItem\",e)}function o(a){a=a+n;e=l[a]=l[a]||g(e,b[e.parent.key+n]||e.parent,null,true)}}}function u(a,d,c,b){if(!a)return l.pop();l.push({_:a,tmpl:d,item:this,data:c,options:b})}function w(d,c,b){return a.tmpl(a.template(d),c,b,this)}function x(b,d){var c=b.options||{};c.wrapped=d;return a.tmpl(a.template(b.tmpl),b.data,c,b.item)}function v(d,c){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(\"\"):b).filter(d||\"*\"),function(a){return c?a.innerText||a.textContent:a.outerHTML||s(a)})}function t(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}})(jQuery)","'use strict';\r\n\r\n// Last time updated: 2019-02-20 3:31:30 PM UTC\r\n\r\n// _______________\r\n// getStats v1.2.0\r\n\r\n// Open-Sourced: https://github.com/muaz-khan/getStats\r\n\r\n// --------------------------------------------------\r\n// Muaz Khan     - www.MuazKhan.com\r\n// MIT License   - www.WebRTC-Experiment.com/licence\r\n// --------------------------------------------------\r\n\r\n\"use strict\";var getStats=function(mediaStreamTrack,callback,interval){function getStatsLooper(){getStatsWrapper(function(results){if(results&&results.forEach){results.forEach(function(result){Object.keys(getStatsParser).forEach(function(key){if(\"function\"==typeof getStatsParser[key])try{getStatsParser[key](result)}catch(e){console.error(e.message,e.stack,e)}})});try{peer.iceConnectionState.search(/failed|closed|disconnected/gi)!==-1&&(nomore=!0)}catch(e){nomore=!0}nomore===!0&&(getStatsResult.datachannel&&(getStatsResult.datachannel.state=\"close\"),getStatsResult.ended=!0),getStatsResult.results=results,getStatsResult.audio&&getStatsResult.video&&(getStatsResult.bandwidth.speed=getStatsResult.audio.bytesSent-getStatsResult.bandwidth.helper.audioBytesSent+(getStatsResult.video.bytesSent-getStatsResult.bandwidth.helper.videoBytesSent),getStatsResult.bandwidth.helper.audioBytesSent=getStatsResult.audio.bytesSent,getStatsResult.bandwidth.helper.videoBytesSent=getStatsResult.video.bytesSent),callback(getStatsResult),nomore||void 0!=typeof interval&&interval&&setTimeout(getStatsLooper,interval||1e3)}})}function getStatsWrapper(cb){\"undefined\"!=typeof window.InstallTrigger||isSafari?peer.getStats(window.mediaStreamTrack||null).then(function(res){var items=[];res.forEach(function(r){items.push(r)}),cb(items)})[\"catch\"](cb):peer.getStats(function(res){var items=[];res.result().forEach(function(res){var item={};res.names().forEach(function(name){item[name]=res.stat(name)}),item.id=res.id,item.type=res.type,item.timestamp=res.timestamp,items.push(item)}),cb(items)})}var browserFakeUserAgent=\"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45\";!function(that){that&&\"undefined\"==typeof window&&\"undefined\"!=typeof global&&(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},global.console||(global.console={}),\"undefined\"!=typeof global.console.log&&\"undefined\"!=typeof global.console.error||(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),\"undefined\"==typeof document&&(that.document={documentElement:{appendChild:function(){return\"\"}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var obj={getContext:function(){return obj},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return\"\"}};return obj},that.HTMLVideoElement=function(){}),\"undefined\"==typeof location&&(that.location={protocol:\"file:\",href:\"\",hash:\"\"}),\"undefined\"==typeof screen&&(that.screen={width:0,height:0}),\"undefined\"==typeof URL&&(that.URL={createObjectURL:function(){return\"\"},revokeObjectURL:function(){return\"\"}}),\"undefined\"==typeof MediaStreamTrack&&(that.MediaStreamTrack=function(){}),\"undefined\"==typeof RTCPeerConnection&&(that.RTCPeerConnection=function(){}),that.window=global)}(\"undefined\"!=typeof global?global:null);var RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;\"undefined\"==typeof MediaStreamTrack&&(MediaStreamTrack={});var systemNetworkType=((navigator.connection||{}).type||\"unknown\").toString().toLowerCase(),getStatsResult={encryption:\"sha-256\",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{audioBytesSent:0,videoBytestSent:0},speed:0},results:{},connectionType:{systemNetworkType:systemNetworkType,systemIpAddress:\"192.168.1.2\",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(){nomore=!0}},getStatsParser={checkIfOfferer:function(result){\"googLibjingleSession\"===result.type&&(getStatsResult.isOfferer=result.googInitiator)}},isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),peer=this;if(!(arguments[0]instanceof RTCPeerConnection))throw\"1st argument is not instance of RTCPeerConnection.\";peer=arguments[0],arguments[1]instanceof MediaStreamTrack&&(mediaStreamTrack=arguments[1],callback=arguments[2],interval=arguments[3]);var nomore=!1;getStatsParser.datachannel=function(result){\"datachannel\"===result.type&&(getStatsResult.datachannel={state:result.state})},getStatsParser.googCertificate=function(result){\"googCertificate\"==result.type&&(getStatsResult.encryption=result.googFingerprintAlgorithm),\"certificate\"==result.type&&(getStatsResult.encryption=result.fingerprintAlgorithm)},getStatsParser.checkAudioTracks=function(result){if(\"audio\"===result.mediaType){var sendrecvType=result.id.split(\"_\").pop();if(result.isRemote===!0&&(sendrecvType=\"recv\"),result.isRemote===!1&&(sendrecvType=\"send\"),sendrecvType){if(getStatsResult.audio[sendrecvType].codecs.indexOf(result.googCodecName||\"opus\")===-1&&getStatsResult.audio[sendrecvType].codecs.push(result.googCodecName||\"opus\"),result.bytesSent){var kilobytes=0;getStatsResult.internal.audio[sendrecvType].prevBytesSent||(getStatsResult.internal.audio[sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal.audio[sendrecvType].prevBytesSent;getStatsResult.internal.audio[sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult.audio[sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult.audio.bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal.audio[sendrecvType].prevBytesReceived||(getStatsResult.internal.audio[sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal.audio[sendrecvType].prevBytesReceived;getStatsResult.internal.audio[sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult.audio.bytesReceived=kilobytes.toFixed(1)}if(result.googTrackId&&getStatsResult.audio[sendrecvType].tracks.indexOf(result.googTrackId)===-1&&getStatsResult.audio[sendrecvType].tracks.push(result.googTrackId),result.googCurrentDelayMs){var kilobytes=0;getStatsResult.internal.audio.prevGoogCurrentDelayMs||(getStatsResult.internal.audio.prevGoogCurrentDelayMs=result.googCurrentDelayMs);var bytes=result.googCurrentDelayMs-getStatsResult.internal.audio.prevGoogCurrentDelayMs;getStatsResult.internal.audio.prevGoogCurrentDelayMs=result.googCurrentDelayMs,getStatsResult.audio.latency=bytes.toFixed(1),getStatsResult.audio.latency<0&&(getStatsResult.audio.latency=0)}if(result.packetsLost){var kilobytes=0;getStatsResult.internal.audio.prevPacketsLost||(getStatsResult.internal.audio.prevPacketsLost=result.packetsLost);var bytes=result.packetsLost-getStatsResult.internal.audio.prevPacketsLost;getStatsResult.internal.audio.prevPacketsLost=result.packetsLost,getStatsResult.audio.packetsLost=bytes.toFixed(1),getStatsResult.audio.packetsLost<0&&(getStatsResult.audio.packetsLost=0)}}}},getStatsParser.checkVideoTracks=function(result){if(\"video\"===result.mediaType){var sendrecvType=result.id.split(\"_\").pop();if(result.isRemote===!0&&(sendrecvType=\"recv\"),result.isRemote===!1&&(sendrecvType=\"send\"),sendrecvType){if(getStatsResult.video[sendrecvType].codecs.indexOf(result.googCodecName||\"VP8\")===-1&&getStatsResult.video[sendrecvType].codecs.push(result.googCodecName||\"VP8\"),result.bytesSent){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBytesSent||(getStatsResult.internal.video[sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal.video[sendrecvType].prevBytesSent;getStatsResult.internal.video[sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult.video[sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult.video.bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBytesReceived||(getStatsResult.internal.video[sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal.video[sendrecvType].prevBytesReceived;getStatsResult.internal.video[sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult.video.bytesReceived=kilobytes.toFixed(1)}if(result.googFrameHeightReceived&&result.googFrameWidthReceived&&(getStatsResult.resolutions[sendrecvType].width=result.googFrameWidthReceived,getStatsResult.resolutions[sendrecvType].height=result.googFrameHeightReceived),result.googFrameHeightSent&&result.googFrameWidthSent&&(getStatsResult.resolutions[sendrecvType].width=result.googFrameWidthSent,getStatsResult.resolutions[sendrecvType].height=result.googFrameHeightSent),result.googTrackId&&getStatsResult.video[sendrecvType].tracks.indexOf(result.googTrackId)===-1&&getStatsResult.video[sendrecvType].tracks.push(result.googTrackId),result.framerateMean){getStatsResult.bandwidth.framerateMean=result.framerateMean;var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevFramerateMean||(getStatsResult.internal.video[sendrecvType].prevFramerateMean=result.bitrateMean);var bytes=result.bytesSent-getStatsResult.internal.video[sendrecvType].prevFramerateMean;getStatsResult.internal.video[sendrecvType].prevFramerateMean=result.framerateMean,kilobytes=bytes/1024,getStatsResult.video[sendrecvType].framerateMean=bytes.toFixed(1)}if(result.bitrateMean){getStatsResult.bandwidth.bitrateMean=result.bitrateMean;var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBitrateMean||(getStatsResult.internal.video[sendrecvType].prevBitrateMean=result.bitrateMean);var bytes=result.bytesSent-getStatsResult.internal.video[sendrecvType].prevBitrateMean;getStatsResult.internal.video[sendrecvType].prevBitrateMean=result.bitrateMean,kilobytes=bytes/1024,getStatsResult.video[sendrecvType].bitrateMean=bytes.toFixed(1)}if(result.googCurrentDelayMs){var kilobytes=0;getStatsResult.internal.video.prevGoogCurrentDelayMs||(getStatsResult.internal.video.prevGoogCurrentDelayMs=result.googCurrentDelayMs);var bytes=result.googCurrentDelayMs-getStatsResult.internal.video.prevGoogCurrentDelayMs;getStatsResult.internal.video.prevGoogCurrentDelayMs=result.googCurrentDelayMs,getStatsResult.video.latency=bytes.toFixed(1),getStatsResult.video.latency<0&&(getStatsResult.video.latency=0)}if(result.packetsLost){var kilobytes=0;getStatsResult.internal.video.prevPacketsLost||(getStatsResult.internal.video.prevPacketsLost=result.packetsLost);var bytes=result.packetsLost-getStatsResult.internal.video.prevPacketsLost;getStatsResult.internal.video.prevPacketsLost=result.packetsLost,getStatsResult.video.packetsLost=bytes.toFixed(1),getStatsResult.video.packetsLost<0&&(getStatsResult.video.packetsLost=0)}}}},getStatsParser.bweforvideo=function(result){\"VideoBwe\"===result.type&&(getStatsResult.bandwidth.availableSendBandwidth=result.googAvailableSendBandwidth,getStatsResult.bandwidth.googActualEncBitrate=result.googActualEncBitrate,getStatsResult.bandwidth.googAvailableSendBandwidth=result.googAvailableSendBandwidth,getStatsResult.bandwidth.googAvailableReceiveBandwidth=result.googAvailableReceiveBandwidth,getStatsResult.bandwidth.googRetransmitBitrate=result.googRetransmitBitrate,getStatsResult.bandwidth.googTargetEncBitrate=result.googTargetEncBitrate,getStatsResult.bandwidth.googBucketDelay=result.googBucketDelay,getStatsResult.bandwidth.googTransmitBitrate=result.googTransmitBitrate)},getStatsParser.candidatePair=function(result){if(\"googCandidatePair\"===result.type||\"candidate-pair\"===result.type||\"local-candidate\"===result.type||\"remote-candidate\"===result.type){if(\"true\"==result.googActiveConnection){Object.keys(getStatsResult.internal.candidates).forEach(function(cid){var candidate=getStatsResult.internal.candidates[cid];candidate.ipAddress.indexOf(result.googLocalAddress)!==-1&&(getStatsResult.connectionType.local.candidateType=candidate.candidateType,getStatsResult.connectionType.local.ipAddress=candidate.ipAddress,getStatsResult.connectionType.local.networkType=candidate.networkType,getStatsResult.connectionType.local.transport=candidate.transport),candidate.ipAddress.indexOf(result.googRemoteAddress)!==-1&&(getStatsResult.connectionType.remote.candidateType=candidate.candidateType,getStatsResult.connectionType.remote.ipAddress=candidate.ipAddress,getStatsResult.connectionType.remote.networkType=candidate.networkType,getStatsResult.connectionType.remote.transport=candidate.transport)}),getStatsResult.connectionType.transport=result.googTransportType;var localCandidate=getStatsResult.internal.candidates[result.localCandidateId];localCandidate&&localCandidate.ipAddress&&(getStatsResult.connectionType.systemIpAddress=localCandidate.ipAddress);var remoteCandidate=getStatsResult.internal.candidates[result.remoteCandidateId];remoteCandidate&&remoteCandidate.ipAddress&&(getStatsResult.connectionType.systemIpAddress=remoteCandidate.ipAddress)}if(\"candidate-pair\"===result.type&&result.selected===!0&&result.nominated===!0&&\"succeeded\"===result.state)var localCandidate=getStatsResult.internal.candidates[result.remoteCandidateId],remoteCandidate=getStatsResult.internal.candidates[result.remoteCandidateId];if(\"local-candidate\"===result.type&&(getStatsResult.connectionType.local.candidateType=result.candidateType,getStatsResult.connectionType.local.ipAddress=result.ipAddress,getStatsResult.connectionType.local.networkType=result.networkType,getStatsResult.connectionType.local.transport=result.mozLocalTransport||result.transport),\"remote-candidate\"===result.type&&(getStatsResult.connectionType.remote.candidateType=result.candidateType,getStatsResult.connectionType.remote.ipAddress=result.ipAddress,getStatsResult.connectionType.remote.networkType=result.networkType,getStatsResult.connectionType.remote.transport=result.mozRemoteTransport||result.transport),isSafari){var sendrecvType=result.localCandidateId?\"send\":\"recv\";if(!sendrecvType)return;if(result.bytesSent){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBytesSent||(getStatsResult.internal.video[sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal.video[sendrecvType].prevBytesSent;getStatsResult.internal.video[sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult.video[sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult.video.bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevBytesReceived||(getStatsResult.internal.video[sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal.video[sendrecvType].prevBytesReceived;getStatsResult.internal.video[sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult.video.bytesReceived=kilobytes.toFixed(1)}if(result.availableOutgoingBitrate){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevAvailableOutgoingBitrate||(getStatsResult.internal.video[sendrecvType].prevAvailableOutgoingBitrate=result.availableOutgoingBitrate);var bytes=result.availableOutgoingBitrate-getStatsResult.internal.video[sendrecvType].prevAvailableOutgoingBitrate;getStatsResult.internal.video[sendrecvType].prevAvailableOutgoingBitrate=result.availableOutgoingBitrate,kilobytes=bytes/1024,getStatsResult.video.availableOutgoingBitrate=kilobytes.toFixed(1)}if(result.availableIncomingBitrate){var kilobytes=0;getStatsResult.internal.video[sendrecvType].prevAvailableIncomingBitrate||(getStatsResult.internal.video[sendrecvType].prevAvailableIncomingBitrate=result.availableIncomingBitrate);var bytes=result.availableIncomingBitrate-getStatsResult.internal.video[sendrecvType].prevAvailableIncomingBitrate;getStatsResult.internal.video[sendrecvType].prevAvailableIncomingBitrate=result.availableIncomingBitrate,kilobytes=bytes/1024,getStatsResult.video.availableIncomingBitrate=kilobytes.toFixed(1)}}}};var LOCAL_candidateType={},LOCAL_transport={},LOCAL_ipAddress={},LOCAL_networkType={};getStatsParser.localcandidate=function(result){\"localcandidate\"!==result.type&&\"local-candidate\"!==result.type||result.id&&(LOCAL_candidateType[result.id]||(LOCAL_candidateType[result.id]=[]),LOCAL_transport[result.id]||(LOCAL_transport[result.id]=[]),LOCAL_ipAddress[result.id]||(LOCAL_ipAddress[result.id]=[]),LOCAL_networkType[result.id]||(LOCAL_networkType[result.id]=[]),result.candidateType&&LOCAL_candidateType[result.id].indexOf(result.candidateType)===-1&&LOCAL_candidateType[result.id].push(result.candidateType),result.transport&&LOCAL_transport[result.id].indexOf(result.transport)===-1&&LOCAL_transport[result.id].push(result.transport),result.ipAddress&&LOCAL_ipAddress[result.id].indexOf(result.ipAddress+\":\"+result.portNumber)===-1&&LOCAL_ipAddress[result.id].push(result.ipAddress+\":\"+result.portNumber),result.networkType&&LOCAL_networkType[result.id].indexOf(result.networkType)===-1&&LOCAL_networkType[result.id].push(result.networkType),getStatsResult.internal.candidates[result.id]={candidateType:LOCAL_candidateType[result.id],ipAddress:LOCAL_ipAddress[result.id],portNumber:result.portNumber,networkType:LOCAL_networkType[result.id],priority:result.priority,transport:LOCAL_transport[result.id],timestamp:result.timestamp,id:result.id,type:result.type},getStatsResult.connectionType.local.candidateType=LOCAL_candidateType[result.id],getStatsResult.connectionType.local.ipAddress=LOCAL_ipAddress[result.id],getStatsResult.connectionType.local.networkType=LOCAL_networkType[result.id],getStatsResult.connectionType.local.transport=LOCAL_transport[result.id])};var REMOTE_candidateType={},REMOTE_transport={},REMOTE_ipAddress={},REMOTE_networkType={};getStatsParser.remotecandidate=function(result){\"remotecandidate\"!==result.type&&\"remote-candidate\"!==result.type||result.id&&(REMOTE_candidateType[result.id]||(REMOTE_candidateType[result.id]=[]),REMOTE_transport[result.id]||(REMOTE_transport[result.id]=[]),REMOTE_ipAddress[result.id]||(REMOTE_ipAddress[result.id]=[]),REMOTE_networkType[result.id]||(REMOTE_networkType[result.id]=[]),result.candidateType&&REMOTE_candidateType[result.id].indexOf(result.candidateType)===-1&&REMOTE_candidateType[result.id].push(result.candidateType),result.transport&&REMOTE_transport[result.id].indexOf(result.transport)===-1&&REMOTE_transport[result.id].push(result.transport),result.ipAddress&&REMOTE_ipAddress[result.id].indexOf(result.ipAddress+\":\"+result.portNumber)===-1&&REMOTE_ipAddress[result.id].push(result.ipAddress+\":\"+result.portNumber),result.networkType&&REMOTE_networkType[result.id].indexOf(result.networkType)===-1&&REMOTE_networkType[result.id].push(result.networkType),getStatsResult.internal.candidates[result.id]={candidateType:REMOTE_candidateType[result.id],ipAddress:REMOTE_ipAddress[result.id],portNumber:result.portNumber,networkType:REMOTE_networkType[result.id],priority:result.priority,transport:REMOTE_transport[result.id],timestamp:result.timestamp,id:result.id,type:result.type},getStatsResult.connectionType.remote.candidateType=REMOTE_candidateType[result.id],getStatsResult.connectionType.remote.ipAddress=REMOTE_ipAddress[result.id],getStatsResult.connectionType.remote.networkType=REMOTE_networkType[result.id],getStatsResult.connectionType.remote.transport=REMOTE_transport[result.id])},getStatsParser.dataSentReceived=function(result){!result.googCodecName||\"video\"!==result.mediaType&&\"audio\"!==result.mediaType||(result.bytesSent&&(getStatsResult[result.mediaType].bytesSent=parseInt(result.bytesSent)),result.bytesReceived&&(getStatsResult[result.mediaType].bytesReceived=parseInt(result.bytesReceived)))},getStatsParser.inboundrtp=function(result){if(isSafari&&\"inbound-rtp\"===result.type){var mediaType=result.mediaType||\"audio\",sendrecvType=result.isRemote?\"recv\":\"send\";if(sendrecvType){if(result.bytesSent){var kilobytes=0;getStatsResult.internal[mediaType][sendrecvType].prevBytesSent||(getStatsResult.internal[mediaType][sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal[mediaType][sendrecvType].prevBytesSent;getStatsResult.internal[mediaType][sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult[mediaType][sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult[mediaType].bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived||(getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived;getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult[mediaType].bytesReceived=kilobytes.toFixed(1)}}}},getStatsParser.outboundrtp=function(result){if(isSafari&&\"outbound-rtp\"===result.type){var mediaType=result.mediaType||\"audio\",sendrecvType=result.isRemote?\"recv\":\"send\";if(sendrecvType){if(result.bytesSent){var kilobytes=0;getStatsResult.internal[mediaType][sendrecvType].prevBytesSent||(getStatsResult.internal[mediaType][sendrecvType].prevBytesSent=result.bytesSent);var bytes=result.bytesSent-getStatsResult.internal[mediaType][sendrecvType].prevBytesSent;getStatsResult.internal[mediaType][sendrecvType].prevBytesSent=result.bytesSent,kilobytes=bytes/1024,getStatsResult[mediaType][sendrecvType].availableBandwidth=kilobytes.toFixed(1),getStatsResult[mediaType].bytesSent=kilobytes.toFixed(1)}if(result.bytesReceived){var kilobytes=0;getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived||(getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived=result.bytesReceived);var bytes=result.bytesReceived-getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived;getStatsResult.internal[mediaType][sendrecvType].prevBytesReceived=result.bytesReceived,kilobytes=bytes/1024,getStatsResult[mediaType].bytesReceived=kilobytes.toFixed(1)}}}},getStatsParser.track=function(result){if(isSafari&&\"track\"===result.type){var sendrecvType=result.remoteSource===!0?\"send\":\"recv\";result.frameWidth&&result.frameHeight&&(getStatsResult.resolutions[sendrecvType].width=result.frameWidth,getStatsResult.resolutions[sendrecvType].height=result.frameHeight)}};var SSRC={audio:{send:[],recv:[]},video:{send:[],recv:[]}};getStatsParser.ssrc=function(result){if(result.googCodecName&&(\"video\"===result.mediaType||\"audio\"===result.mediaType)&&\"ssrc\"===result.type){var sendrecvType=result.id.split(\"_\").pop();SSRC[result.mediaType][sendrecvType].indexOf(result.ssrc)===-1&&SSRC[result.mediaType][sendrecvType].push(result.ssrc),getStatsResult[result.mediaType][sendrecvType].streams=SSRC[result.mediaType][sendrecvType].length}},getStatsLooper()};\"undefined\"!=typeof module&&(module.exports=getStats),\"function\"==typeof define&&define.amd&&define(\"getStats\",[],function(){return getStats});","'use strict';\r\n\r\nvar share = (function share() {\r\n  const avatarUrl = '../static/plugins/ep_profile_modal/static/img/user.png';\r\n  const hElements = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', '.h1', '.h2', '.h3', '.h4', '.h5', '.h6'];\r\n\r\n  const getAvatarUrl = function getAvatarUrl(userId) {\r\n    if (!userId) return avatarUrl;\r\n    return `/p/getUserProfileImage/${userId}/${window.pad.getPadId()}?t=${new Date().getTime()}`;\r\n  };\r\n\r\n  const getValidUrl = function getValidUrl() {\r\n    const url = arguments.length <= 0 || arguments[0] === undefined ? '' : arguments[0];\r\n\r\n    if (url == '') return '';\r\n    let newUrl = window.decodeURIComponent(url);\r\n    newUrl = newUrl.trim().replace(/\\s/g, '');\r\n\r\n    if (/^(:\\/\\/)/.test(newUrl)) {\r\n      return `http${newUrl}`;\r\n    }\r\n    if (!/^(f|ht)tps?:\\/\\//i.test(newUrl)) {\r\n      return `http://${newUrl}`;\r\n    }\r\n\r\n    return newUrl;\r\n  };\r\n\r\n  const getUserId = function getUserId() {\r\n    return clientVars.userId || window.pad.getUserId();\r\n  };\r\n\r\n  function stopStreaming(stream) {\r\n    if (stream) {\r\n      stream.getTracks().forEach((track) => {\r\n        track.stop();\r\n        stream.removeTrack(track);\r\n      });\r\n      stream = null;\r\n    }\r\n  }\r\n\r\n  const scrollDownToLastChatText = function scrollDownToLastChatText(selector) {\r\n    const $element = $(selector);\r\n    if ($element.length <= 0 || !$element[0]) return true;\r\n    $element.animate({scrollTop: $element[0].scrollHeight}, {duration: 400, queue: false});\r\n  };\r\n\r\n  const getUserFromId = function getUserFromId(userId) {\r\n    if (!window.pad || !window.pad.collabClient) return null;\r\n    const result = window.pad.collabClient.getConnectedUsers().filter((user) => user.userId === userId);\r\n    const user = result.length > 0 ? result[0] : null;\r\n    return user;\r\n  };\r\n\r\n  const slugify = function slugify(text) {\r\n    return text.toString().toLowerCase().trim().replace(/\\s+/g, '-') // Replace spaces with -\r\n        .replace(/&/g, '-and-') // Replace & with 'and'\r\n        .replace(/[^\\w\\-]+/g, '') // Remove all non-word chars\r\n        .replace(/\\--+/g, '-') // Replace multiple - with single -\r\n        .replace(/^-+/, '') // Trim - from start of text\r\n        .replace(/-+$/, ''); // Trim - from end of text\r\n  };\r\n\r\n  const $body_ace_outer = function $body_ace_outer() {\r\n    return $(document).find('iframe[name=\"ace_outer\"]').contents();\r\n  };\r\n\r\n  const createShareLink = function createShareLink(headingTagId, headerText) {\r\n    return `${window.location.origin + window.location.pathname}?header=${slugify(headerText)}&headerId=${headingTagId}&joinvideo=true`;\r\n  };\r\n\r\n  function addTextChatMessage(msg) {\r\n    const authorClass = `author-${msg.userId.replace(/[^a-y0-9]/g, (c) => {\r\n      if (c === '.') return '-';\r\n      return `z${c.charCodeAt(0)}z`;\r\n    })}`;\r\n\r\n    // create the time string\r\n    let minutes = `${new Date(msg.time).getMinutes()}`;\r\n    let hours = `${new Date(msg.time).getHours()}`;\r\n    if (minutes.length === 1) minutes = `0${minutes}`;\r\n    if (hours.length === 1) hours = `0${hours}`;\r\n    const timeStr = `${hours}:${minutes}`;\r\n\r\n    const html = `<p data-target='${msg.target}' data-id='${msg.headerId}' data-authorId='${msg.userId}' class='wrtc_text ${msg.headId} ${authorClass}'><b>${msg.userName}</b><span class='time ${authorClass}'>${timeStr}</span> ${msg.text}</p>`;\r\n\r\n    $(document).find('#chatbox #chattext').append(html);\r\n    scrollDownToLastChatText('#chatbox #chattext');\r\n  }\r\n\r\n  const notifyNewUserJoined = function notifyNewUserJoined(target, msg, action) {\r\n    const videoIcon = '<span class=\"videoIcon\"><svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"video\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\" class=\"svg-inline--fa fa-video fa-w-18 fa-2x\"><path fill=\"currentColor\" d=\"M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z\" class=\"\"></path></svg></span>';\r\n    const textIcon = '<span class=\"textIcon\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\"><path fill=\"currentColor\" d=\"M416 224V64c0-35.3-28.7-64-64-64H64C28.7 0 0 28.7 0 64v160c0 35.3 28.7 64 64 64v54.2c0 8 9.1 12.6 15.5 7.8l82.8-62.1H352c35.3.1 64-28.6 64-63.9zm96-64h-64v64c0 52.9-43.1 96-96 96H192v64c0 35.3 28.7 64 64 64h125.7l82.8 62.1c6.4 4.8 15.5.2 15.5-7.8V448h32c35.3 0 64-28.7 64-64V224c0-35.3-28.7-64-64-64z\"></path></svg></span>';\r\n    const btnJoin = `<span class='wrtc_roomLink' data-join='${target}' data-action='JOIN' data-id='${msg.headerId}' title='Join'>${msg.headerTitle}</span>`;\r\n\r\n    const text = action === 'JOIN' ? 'joins' : 'leaves';\r\n\r\n    if (target === 'VIDEO') {\r\n      const roomCounter = `<span class='userCount'>(${msg.userCount}/${msg.VIDEOCHATLIMIT})</span>`;\r\n      msg.text = `<span>${text}</span>${videoIcon}${btnJoin}${roomCounter}`;\r\n    } else if (target === 'TEXT') {\r\n      msg.text = `<span>${text}</span>${textIcon}${btnJoin}`;\r\n    }\r\n\r\n    msg.target = target;\r\n\r\n    addTextChatMessage(msg);\r\n  };\r\n\r\n  const roomBoxIconActive = function roomBoxIconActive() {\r\n    $body_ace_outer().find('.wbrtc_roomBox').each((index, val) => {\r\n      const textActive = $(val).attr('data-text');\r\n      const videoActive = $(val).attr('data-video');\r\n      if (textActive || videoActive) {\r\n        $(val).find('.btn_joinChat_chatRoom').addClass('active');\r\n      } else {\r\n        $(val).find('.btn_joinChat_chatRoom').removeClass('active');\r\n      }\r\n    });\r\n  };\r\n\r\n  const appendUserList = function appendUserList(roomInfo, selector) {\r\n    if (!roomInfo.list) return true;\r\n    const $element = typeof selector === 'string' ? $(document).find(selector) : selector;\r\n    $element.empty();\r\n    roomInfo.list.forEach((el) => {\r\n      const userInList = getUserFromId(el.userId) || {colorId: '', name: 'anonymous', userId: '0000000'};\r\n      $element.append(`<li data-id=${el.userId} style='border-color: ${userInList.colorId}'><div class='avatar'><div title='${userInList.name}' style=\"background: url('${getAvatarUrl(el.userId)}') no-repeat 50% 50% ; background-size : cover;\"></div></div>${userInList.name}</li>`);\r\n    });\r\n  };\r\n\r\n  // socketState: 'CLOSED', 'OPEND', 'DISCONNECTED'\r\n  const wrtcStore = {\r\n    userInRoom: false,\r\n    socketState: 'CLOSED',\r\n    components: {\r\n      text: {active: false},\r\n      video: {active: false},\r\n      room: {active: false},\r\n    },\r\n  };\r\n\r\n  const wrtcPubsub = {\r\n    events: {},\r\n    on: function on(eventName, fn) {\r\n      this.events[eventName] = this.events[eventName] || [];\r\n      this.events[eventName].push(fn);\r\n    },\r\n    off: function off(eventName, fn) {\r\n      if (this.events[eventName]) {\r\n        for (let i = 0; i < this.events[eventName].length; i++) {\r\n          if (this.events[eventName][i] === fn) {\r\n            this.events[eventName].splice(i, 1);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    },\r\n    emit: function emit(eventName) {\r\n      for (var _len = arguments.length, data = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\r\n        data[_key - 1] = arguments[_key];\r\n      }\r\n\r\n      if (this.events[eventName]) {\r\n        this.events[eventName].forEach((fn) => {\r\n          fn.apply(undefined, data);\r\n        });\r\n      }\r\n    },\r\n  };\r\n\r\n  const inlineAvatar = {\r\n    ROOM: function ROOM(headerId, room) {\r\n      const inlineAvatarLimit = clientVars.webrtc.inlineAvatarLimit || 4;\r\n      const $element = $body_ace_outer().find(`#wbrtc_avatarCol .${headerId} .wrtc_inlineAvatars`);\r\n      $element.find('.avatar').remove();\r\n      $element.parent().css({left: `${WRTC_Room.getHeaderRoomX($element.parent())}px`});\r\n      Object.keys(room).forEach((key, index) => {\r\n        const userInList = getUserFromId(room[key].userId) || {colorId: '', name: 'anonymous'};\r\n        if (userInList.userId) {\r\n          if (index < inlineAvatarLimit) {\r\n            $element.find('.avatarMore').hide();\r\n            $element.append(`<div class=\"avatar\" data-id=\"${userInList.userId}\"><div title='${userInList.name}' style=\"background: url('${getAvatarUrl(userInList.userId)}') no-repeat 50% 50% ; background-size : cover;\"></div></div>`);\r\n          } else {\r\n            $element.find('.avatarMore').show().text(`+${index + 1 - inlineAvatarLimit}`);\r\n          }\r\n        }\r\n      });\r\n    },\r\n    TEXT: function TEXT(headerId, room) {\r\n      const $element = $(document).find('#wrtc_textChatWrapper .wrtc_inlineAvatars');\r\n      $element.find('.avatar').remove();\r\n      this.append(room.list, $element);\r\n    },\r\n    VIDEO: function VIDEO(headerId, room) {\r\n      const $element = $(document).find('#werc_toolbar .wrtc_inlineAvatars');\r\n      $element.find('.avatar').remove();\r\n      this.append(room.list, $element);\r\n    },\r\n    append: function appendAvatart(list, $element) {\r\n      const inlineAvatarLimit = clientVars.webrtc.inlineAvatarLimit || 4;\r\n      list.forEach((el, index) => {\r\n        const userInList = getUserFromId(el.userId) || {colorId: '', name: 'anonymous'};\r\n        if (userInList.userId) {\r\n          if (index < inlineAvatarLimit) {\r\n            $element.find('.avatarMore').hide();\r\n            $element.append(`<div class=\"avatar\" data-id=\"${userInList.userId}\"><div title='${userInList.name}' style=\"background: url('${getAvatarUrl(userInList.userId)}') no-repeat 50% 50% ; background-size : cover;\"></div></div>`);\r\n          } else {\r\n            $element.find('.avatarMore').show().text(`+${index + 1 - inlineAvatarLimit}`);\r\n          }\r\n        }\r\n      });\r\n    },\r\n    update: function updateInfo(userId, data) {\r\n      const $roomBox = $body_ace_outer().find('#wbrtc_avatarCol .wrtc_inlineAvatars');\r\n      const $textBox = $(document).find('#wrtc_textChatWrapper .wrtc_inlineAvatars');\r\n      const $videoBox = $(document).find('#werc_toolbar .wrtc_inlineAvatars');\r\n\r\n      if ($roomBox) {\r\n        $roomBox.find(`.avatar[data-id=\"${userId}\"] img`).attr({\r\n          src: data.imageUrl,\r\n          title: data.userName,\r\n        });\r\n      }\r\n\r\n      if ($videoBox) {\r\n        $videoBox.find('.avatar img').attr({\r\n          src: data.imageUrl,\r\n          title: data.userName,\r\n        });\r\n      }\r\n\r\n      if ($textBox) {\r\n        $textBox.find('.avatar img').attr({\r\n          src: data.imageUrl,\r\n          title: data.userName,\r\n        });\r\n      }\r\n    },\r\n  };\r\n\r\n  wrtcPubsub.on('update network information', () => {});\r\n\r\n  wrtcPubsub.on('socket state', (state) => {\r\n    wrtcStore.socketState = state;\r\n    // console.info('[wrtc]: socket state has been change, new state:', state, wrtcStore.userInRoom, window.headerId);\r\n    if (state === 'OPEND' && wrtcStore.userInRoom) {\r\n      console.info('Try reconnecting...');\r\n      WRTC.attemptToReconnect();\r\n    }\r\n  });\r\n\r\n  wrtcPubsub.on('component status', (componentName, status) => {\r\n    wrtcStore.components[componentName].active = status;\r\n  });\r\n\r\n  wrtcPubsub.on('update inlineAvater info', (userId, data) => {\r\n    inlineAvatar.update(userId, data);\r\n  });\r\n\r\n  wrtcPubsub.on('update store', (requestUser, headerId, action, target, roomInfo, callback) => {\r\n    if (!requestUser || !headerId || !action || !roomInfo || !target) return false;\r\n\r\n    if (!wrtcStore[headerId]) wrtcStore[headerId] = {};\r\n    if (!wrtcStore[headerId].USERS) wrtcStore[headerId].USERS = {};\r\n\r\n    let users = wrtcStore[headerId].USERS;\r\n    wrtcStore[headerId][target] = roomInfo;\r\n    // if(action === \"JOIN\"){}\r\n    // if(action === \"LEAVE\"){}\r\n    // remove all users\r\n    users = {};\r\n\r\n    if (wrtcStore[headerId].TEXT.list) {\r\n      wrtcStore[headerId].TEXT.list.forEach((el) => {\r\n        if (!users[el.userId]) users[el.userId] = {};\r\n        users[el.userId] = el;\r\n      });\r\n    }\r\n\r\n    if (wrtcStore[headerId].VIDEO.list) {\r\n      wrtcStore[headerId].VIDEO.list.forEach((el) => {\r\n        if (!users[el.userId]) users[el.userId] = {};\r\n        users[el.userId] = el;\r\n      });\r\n    }\r\n\r\n    inlineAvatar[target](headerId, wrtcStore[headerId][target]);\r\n    inlineAvatar.ROOM(headerId, users);\r\n\r\n    if (callback) callback(wrtcStore[headerId]);\r\n  });\r\n\r\n  wrtcPubsub.on('disable room buttons', (headerId, actions, target) => {\r\n    const $headingRoom = $body_ace_outer().find(`#${headerId}`);\r\n\r\n    const $btnVideo = $headingRoom.find('.btn_icon[data-join=\"VIDEO\"]');\r\n    const $btnText = $headingRoom.find('.btn_icon[data-join=\"TEXT\"]');\r\n    const $btnPlus = $headingRoom.find('.btn_icon[data-join=\"PLUS\"]');\r\n\r\n    $btnPlus.find('.loader').remove();\r\n    $btnPlus.append('<div class=\"loader\"></div>');\r\n\r\n    if (target === 'TEXT' || target === 'VIDEO') {\r\n      // disable target and plus buttton\r\n      $headingRoom.find(`.btn_icon[data-join=\"${target}\"]`).prop('disabled', true);\r\n      $btnPlus.prop('disabled', true);\r\n    }\r\n\r\n    if (target === 'PLUS') {\r\n      // disable all buttons\r\n      $btnText.prop('disabled', true);\r\n      $btnVideo.prop('disabled', true);\r\n      $btnPlus.prop('disabled', true);\r\n    }\r\n  });\r\n\r\n  wrtcPubsub.on('enable room buttons', (headerId, action, target) => {\r\n    const $headingRoom = $body_ace_outer().find(`#${headerId}`);\r\n    const newAction = action === 'JOIN' ? 'LEAVE' : 'JOIN';\r\n\r\n    const $btnVideo = $headingRoom.find('.btn_icon[data-join=\"VIDEO\"]');\r\n    const $btnText = $headingRoom.find('.btn_icon[data-join=\"TEXT\"]');\r\n    const $btnPlus = $headingRoom.find('.btn_icon[data-join=\"PLUS\"]');\r\n\r\n    $btnPlus.find('.loader').remove();\r\n\r\n    if (target === 'TEXT' || target === 'VIDEO') {\r\n      // enable target and plus buttton\r\n      $headingRoom.find(`.btn_icon[data-join=\"${target}\"]`).attr({'data-action': newAction}).prop('disabled', false);\r\n\r\n      $btnPlus.attr({'data-action': newAction}).prop('disabled', false);\r\n    }\r\n\r\n    if (target === 'TEXTPLUS') {\r\n      // enable text button\r\n      $btnText.attr({'data-action': newAction}).prop('disabled', false);\r\n      $btnVideo.attr({'data-action': newAction});\r\n    }\r\n\r\n    if (target === 'PLUS') {\r\n      // make enable and action toggle all buttons\r\n      $btnText.attr({'data-action': newAction}).prop('disabled', false);\r\n      $btnVideo.attr({'data-action': newAction}).prop('disabled', false);\r\n      $btnPlus.attr({'data-action': newAction}).prop('disabled', false);\r\n    }\r\n  });\r\n\r\n  return {\r\n    hElements,\r\n    scrollDownToLastChatText,\r\n    getUserFromId,\r\n    slugify,\r\n    $body_ace_outer,\r\n    createShareLink,\r\n    notifyNewUserJoined,\r\n    roomBoxIconActive,\r\n    appendUserList,\r\n    wrtcStore,\r\n    wrtcPubsub,\r\n    getUserId,\r\n    stopStreaming,\r\n    getValidUrl,\r\n\r\n  };\r\n})();\r\n","// inspired by ep_comments_page plugin, used and modified copyPasteEvents.js\r\n\r\n'use strict';\r\nvar _ = require('ep_etherpad-lite/static/js/underscore');\r\nvar randomString = require('ep_etherpad-lite/static/js/pad_utils').randomString;\r\n\r\nvar events = (function () {\r\n  let padInner = null;\r\n\r\n  const getFirstColumnOfSelection = function getFirstColumnOfSelection(line, rep, firstLineOfSelection) {\r\n    return line !== firstLineOfSelection ? 0 : rep.selStart[1];\r\n  };\r\n\r\n  const getLength = function getLength(line, rep) {\r\n    const nextLine = line + 1;\r\n    const startLineOffset = rep.lines.offsetOfIndex(line);\r\n    const endLineOffset = rep.lines.offsetOfIndex(nextLine);\r\n\r\n    // lineLength without \\n\r\n    const lineLength = endLineOffset - startLineOffset - 1;\r\n\r\n    return lineLength;\r\n  };\r\n\r\n  const getLastColumnOfSelection = function getLastColumnOfSelection(line, rep, lastLineOfSelection) {\r\n    let lastColumnOfSelection;\r\n    if (line !== lastLineOfSelection) {\r\n      lastColumnOfSelection = getLength(line, rep); // length of line\r\n    } else {\r\n      lastColumnOfSelection = rep.selEnd[1] - 1; // position of last character selected\r\n    }\r\n    return lastColumnOfSelection;\r\n  };\r\n\r\n  const hasHeaderOnLine = function hasHeaderOnLine(lineNumber, firstColumn, lastColumn, attributeManager) {\r\n    let foundHeadOnLine = false;\r\n    let headId = null;\r\n    for (let column = firstColumn; column <= lastColumn && !foundHeadOnLine; column++) {\r\n\t\t\theadId = _.object(attributeManager.getAttributesOnLine(lineNumber)).headingTagId;\r\n\r\n      if (headId) {\r\n        foundHeadOnLine = true;\r\n      }\r\n\t\t}\r\n    return {foundHeadOnLine, headId};\r\n  };\r\n\r\n  const hasHeaderOnMultipleLineSelection = function hasHeaderOnMultipleLineSelection(firstLineOfSelection, lastLineOfSelection, rep, attributeManager) {\r\n    let foundLineWithHeader = false;\r\n    for (let line = firstLineOfSelection; line <= lastLineOfSelection && !foundLineWithHeader; line++) {\r\n      const firstColumn = getFirstColumnOfSelection(line, rep, firstLineOfSelection);\r\n      const lastColumn = getLastColumnOfSelection(line, rep, lastLineOfSelection);\r\n      const hasHeader = hasHeaderOnLine(line, firstColumn, lastColumn, attributeManager);\r\n      if (hasHeader.foundHeadOnLine) {\r\n        foundLineWithHeader = true;\r\n      }\r\n    }\r\n    return {foundHeadOnLine: foundLineWithHeader};\r\n  };\r\n\r\n  const hasMultipleLineSelected = function hasMultipleLineSelected(firstLineOfSelection, lastLineOfSelection) {\r\n    return firstLineOfSelection !== lastLineOfSelection;\r\n  };\r\n\r\n  const hasHeaderOnSelection = function hasHeaderOnSelection() {\r\n    let hasVideoHeader;\r\n    const attributeManager = this.documentAttributeManager;\r\n    const rep = this.rep;\r\n    const firstLineOfSelection = rep.selStart[0];\r\n    const firstColumn = rep.selStart[1];\r\n    const lastColumn = rep.selEnd[1];\r\n    const lastLineOfSelection = rep.selEnd[0];\r\n    const selectionOfMultipleLine = hasMultipleLineSelected(firstLineOfSelection, lastLineOfSelection);\r\n    if (selectionOfMultipleLine) {\r\n      hasVideoHeader = hasHeaderOnMultipleLineSelection(firstLineOfSelection, lastLineOfSelection, rep, attributeManager);\r\n    } else {\r\n      hasVideoHeader = hasHeaderOnLine(firstLineOfSelection, firstColumn, lastColumn, attributeManager);\r\n    }\r\n    return {\r\n      hasVideoHeader: hasVideoHeader.foundHeadOnLine,\r\n      headId: hasVideoHeader.headId,\r\n      hasMultipleLine: selectionOfMultipleLine,\r\n    };\r\n  };\r\n\r\n  function getSelectionHtml() {\r\n    let html = '';\r\n    if (typeof window.getSelection !== 'undefined') {\r\n      const sel = padInner.contents()[0].getSelection();\r\n      if (sel.rangeCount) {\r\n        const container = document.createElement('div');\r\n        for (let i = 0, len = sel.rangeCount; i < len; ++i) {\r\n          container.appendChild(sel.getRangeAt(i).cloneContents());\r\n        }\r\n        html = container.innerHTML;\r\n      }\r\n    } else if (typeof document.selection !== 'undefined') {\r\n      if (document.selection.type === 'Text') {\r\n        html = document.selection.createRange().htmlText;\r\n      }\r\n    }\r\n    return html;\r\n  }\r\n\r\n  function selectionMultipleLine() {\r\n    let rawHtml = getSelectionHtml();\r\n    rawHtml = $('<div></div>').append(rawHtml);\r\n    rawHtml.find(':header nd-video').each(function () {\r\n      $(this).attr({class: `nd-video ${randomString(16)}`});\r\n    });\r\n    return rawHtml.html();\r\n  }\r\n\r\n  function selectionOneLine(headerId) {\r\n    const hTag = padInner.contents()\r\n        .find(`.videoHeader.${headerId}`)\r\n        .attr('data-htag');\r\n\r\n    const content = padInner.contents()\r\n        .find(`.videoHeader.${headerId}`)\r\n        .html();\r\n\r\n    if (!hTag && !content) return false;\r\n    const rawHtml = $('<div></div>').append(`<${hTag}><nd-video class=\"videoHeader ${randomString(16)}\">${content}</nd-video></${hTag}>`);\r\n    return rawHtml.html();\r\n  }\r\n\r\n  const addTextOnClipboard = function addTextOnClipboard(e, aces, inner, removeSelection) {\r\n    padInner = inner;\r\n\r\n    let selection;\r\n    aces.callWithAce((ace) => {\r\n      selection = ace.ace_hasHeaderOnSelection();\r\n    });\r\n\r\n    if (selection.hasVideoHeader || selection.hasMultipleLine) {\r\n      let rawHtml;\r\n      if (selection.hasMultipleLine) {\r\n        const htmlSelection = getSelectionHtml();\r\n        rawHtml = selectionMultipleLine(htmlSelection);\r\n      } else {\r\n        if (!selection.headId) return false;\r\n        rawHtml = selectionOneLine(selection.headId);\r\n\t\t\t}\r\n\r\n      if (rawHtml && selection.hasVideoHeader) {\r\n        e.originalEvent.clipboardData.setData('text/wrtc', JSON.stringify({type: \"wrtcHeading\",raw: rawHtml, multiLine: selection.hasMultipleLine}));\r\n        e.preventDefault();\r\n        return false;\r\n      }\r\n\r\n      // if it is a cut event we have to remove the selection\r\n      if (removeSelection) {\r\n        padInner.contents()[0].execCommand('delete');\r\n      }\r\n    }\r\n  };\r\n\r\n\r\n  const pastOnSelection = (event, padInner) => {\r\n    const hasWrtcObject = event.originalEvent.clipboardData.getData('text/wrtc');\r\n\r\n    if (hasWrtcObject) {\r\n\t\t\tlet rawHtml = JSON.parse(hasWrtcObject);\r\n\t\t\tif(rawHtml.type !== 'wrtcHeading' && !rawHtml.raw) return false;\r\n\r\n      rawHtml = $('<div></div>').append(rawHtml.raw);\r\n      rawHtml.find('nd-video').each(function () {\r\n        $(this).attr({class: `nd-video ${randomString(16)}`});\r\n      });\r\n\r\n      let selection = padInner.contents()[0].getSelection();\r\n\t\t\tif (!selection.rangeCount) return false;\r\n\r\n\t\t\tlet range = selection.getRangeAt(0);\r\n\t\t\trange.insertNode(rawHtml[0]);\r\n\t\t\trange.collapse(false);\r\n\t\t\tselection.removeAllRanges();\r\n\t\t\tselection.addRange(range);\r\n\r\n\t\t\tWRTC_Room.findTags();\r\n      event.preventDefault();\r\n    }\r\n  };\r\n\r\n  return {\r\n    hasHeaderOnSelection,\r\n    addTextOnClipboard,\r\n    pastOnSelection,\r\n  };\r\n})();\r\n","// CodecsHandler.js\r\n'use strict';\r\n\r\nvar CodecsHandler = (function () {\r\n  function preferCodec(sdp, codecName) {\r\n    const info = splitLines(sdp);\r\n\r\n    codecName = codecName.toLowerCase();\r\n\r\n    if (!info.videoCodecNumbers) {\r\n      return sdp;\r\n    }\r\n\r\n    if (codecName === 'vp8' && info.vp8LineNumber === info.videoCodecNumbers[0]) {\r\n      return sdp;\r\n    }\r\n\r\n    if (codecName === 'vp9' && info.vp9LineNumber === info.videoCodecNumbers[0]) {\r\n      return sdp;\r\n    }\r\n\r\n    if (codecName === 'h264' && info.h264LineNumber === info.videoCodecNumbers[0]) {\r\n      return sdp;\r\n    }\r\n\r\n    sdp = preferCodecHelper(sdp, codecName, info);\r\n\r\n    return sdp;\r\n  }\r\n\r\n  function preferCodecHelper(sdp, codec, info, ignore) {\r\n    let preferCodecNumber = '';\r\n\r\n    if (codec === 'vp8') {\r\n      if (!info.vp8LineNumber) {\r\n        return sdp;\r\n      }\r\n      preferCodecNumber = info.vp8LineNumber;\r\n    }\r\n\r\n    if (codec === 'vp9') {\r\n      if (!info.vp9LineNumber) {\r\n        return sdp;\r\n      }\r\n      preferCodecNumber = info.vp9LineNumber;\r\n    }\r\n\r\n    if (codec === 'h264') {\r\n      if (!info.h264LineNumber) {\r\n        return sdp;\r\n      }\r\n\r\n      preferCodecNumber = info.h264LineNumber;\r\n    }\r\n\r\n    let newLine = `${info.videoCodecNumbersOriginal.split('SAVPF')[0]}SAVPF `;\r\n\r\n    let newOrder = [preferCodecNumber];\r\n\r\n    if (ignore) {\r\n      newOrder = [];\r\n    }\r\n\r\n    info.videoCodecNumbers.forEach((codecNumber) => {\r\n      if (codecNumber === preferCodecNumber) return;\r\n      newOrder.push(codecNumber);\r\n    });\r\n\r\n    newLine += newOrder.join(' ');\r\n\r\n    sdp = sdp.replace(info.videoCodecNumbersOriginal, newLine);\r\n    return sdp;\r\n  }\r\n\r\n  function splitLines(sdp) {\r\n    const info = {};\r\n    sdp.split('\\n').forEach((line) => {\r\n      if (line.indexOf('m=video') === 0) {\r\n        info.videoCodecNumbers = [];\r\n        line.split('SAVPF')[1].split(' ').forEach((codecNumber) => {\r\n          codecNumber = codecNumber.trim();\r\n          if (!codecNumber || !codecNumber.length) return;\r\n          info.videoCodecNumbers.push(codecNumber);\r\n          info.videoCodecNumbersOriginal = line;\r\n        });\r\n      }\r\n\r\n      if (line.indexOf('VP8/90000') !== -1 && !info.vp8LineNumber) {\r\n        info.vp8LineNumber = line.replace('a=rtpmap:', '').split(' ')[0];\r\n      }\r\n\r\n      if (line.indexOf('VP9/90000') !== -1 && !info.vp9LineNumber) {\r\n        info.vp9LineNumber = line.replace('a=rtpmap:', '').split(' ')[0];\r\n      }\r\n\r\n      if (line.indexOf('H264/90000') !== -1 && !info.h264LineNumber) {\r\n        info.h264LineNumber = line.replace('a=rtpmap:', '').split(' ')[0];\r\n      }\r\n    });\r\n\r\n    return info;\r\n  }\r\n\r\n  function removeVPX(sdp) {\r\n    const info = splitLines(sdp);\r\n\r\n    // last parameter below means: ignore these codecs\r\n    sdp = preferCodecHelper(sdp, 'vp9', info, true);\r\n    sdp = preferCodecHelper(sdp, 'vp8', info, true);\r\n\r\n    return sdp;\r\n  }\r\n\r\n  function disableNACK(sdp) {\r\n    if (!sdp || typeof sdp !== 'string') {\r\n      throw 'Invalid arguments.';\r\n    }\r\n\r\n    sdp = sdp.replace('a=rtcp-fb:126 nack\\r\\n', '');\r\n    sdp = sdp.replace('a=rtcp-fb:126 nack pli\\r\\n', 'a=rtcp-fb:126 pli\\r\\n');\r\n    sdp = sdp.replace('a=rtcp-fb:97 nack\\r\\n', '');\r\n    sdp = sdp.replace('a=rtcp-fb:97 nack pli\\r\\n', 'a=rtcp-fb:97 pli\\r\\n');\r\n\r\n    return sdp;\r\n  }\r\n\r\n  function prioritize(codecMimeType, peer) {\r\n    if (!peer || !peer.getSenders || !peer.getSenders().length) {\r\n      return;\r\n    }\r\n\r\n    if (!codecMimeType || typeof codecMimeType !== 'string') {\r\n      throw 'Invalid arguments.';\r\n    }\r\n\r\n    peer.getSenders().forEach((sender) => {\r\n      const params = sender.getParameters();\r\n      for (let i = 0; i < params.codecs.length; i++) {\r\n        if (params.codecs[i].mimeType == codecMimeType) {\r\n          params.codecs.unshift(params.codecs.splice(i, 1));\r\n          break;\r\n        }\r\n      }\r\n      sender.setParameters(params);\r\n    });\r\n  }\r\n\r\n  function removeNonG722(sdp) {\r\n    return sdp.replace(/m=audio ([0-9]+) RTP\\/SAVPF ([0-9 ]*)/g, 'm=audio $1 RTP/SAVPF 9');\r\n  }\r\n\r\n  function setBAS(sdp, bandwidth, isScreen) {\r\n    if (!!navigator.mozGetUserMedia || !bandwidth) {\r\n      return sdp;\r\n    }\r\n\r\n    if (isScreen) {\r\n      if (!bandwidth.screen) {\r\n        console.warn('It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.');\r\n      } else if (bandwidth.screen < 300) {\r\n        console.warn('It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail.');\r\n      }\r\n    }\r\n\r\n    // if screen; must use at least 300kbs\r\n    if (bandwidth.screen && isScreen) {\r\n      sdp = sdp.replace(/b=AS([^\\r\\n]+\\r\\n)/g, '');\r\n      sdp = sdp.replace(/a=mid:video\\r\\n/g, `a=mid:video\\r\\nb=AS:${bandwidth.screen}\\r\\n`);\r\n    }\r\n\r\n    // remove existing bandwidth lines\r\n    if (bandwidth.audio || bandwidth.video || bandwidth.data) {\r\n      sdp = sdp.replace(/b=AS([^\\r\\n]+\\r\\n)/g, '');\r\n    }\r\n\r\n    if (bandwidth.audio) {\r\n      sdp = sdp.replace(/a=mid:audio\\r\\n/g, `a=mid:audio\\r\\nb=AS:${bandwidth.audio}\\r\\n`);\r\n    }\r\n\r\n    if (bandwidth.video) {\r\n      sdp = sdp.replace(/a=mid:video\\r\\n/g, `a=mid:video\\r\\nb=AS:${isScreen ? bandwidth.screen : bandwidth.video}\\r\\n`);\r\n    }\r\n\r\n    return sdp;\r\n  }\r\n\r\n  // Find the line in sdpLines that starts with |prefix|, and, if specified,\r\n  // contains |substr| (case-insensitive search).\r\n  function findLine(sdpLines, prefix, substr) {\r\n    return findLineInRange(sdpLines, 0, -1, prefix, substr);\r\n  }\r\n\r\n  // Find the line in sdpLines[startLine...endLine - 1] that starts with |prefix|\r\n  // and, if specified, contains |substr| (case-insensitive search).\r\n  function findLineInRange(sdpLines, startLine, endLine, prefix, substr) {\r\n    const realEndLine = endLine !== -1 ? endLine : sdpLines.length;\r\n    for (let i = startLine; i < realEndLine; ++i) {\r\n      if (sdpLines[i].indexOf(prefix) === 0) {\r\n        if (!substr || sdpLines[i].toLowerCase().indexOf(substr.toLowerCase()) !== -1) {\r\n          return i;\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  // Gets the codec payload type from an a=rtpmap:X line.\r\n  function getCodecPayloadType(sdpLine) {\r\n    const pattern = new RegExp('a=rtpmap:(\\\\d+) \\\\w+\\\\/\\\\d+');\r\n    const result = sdpLine.match(pattern);\r\n    return result && result.length === 2 ? result[1] : null;\r\n  }\r\n\r\n  function _setVideoBitrates(sdp, params) {\r\n    params = params || {};\r\n    const xgoogle_min_bitrate = params.min;\r\n    const xgoogle_max_bitrate = params.max;\r\n    const videoCodec = params.codec.toUpperCase() || 'VP8';\r\n\r\n    const sdpLines = sdp.split('\\r\\n');\r\n\r\n    // VP8\r\n    const vp8Index = findLine(sdpLines, 'a=rtpmap', `${videoCodec}/90000`);\r\n    let vp8Payload;\r\n    if (vp8Index) {\r\n      vp8Payload = getCodecPayloadType(sdpLines[vp8Index]);\r\n    }\r\n\r\n    if (!vp8Payload) {\r\n      return sdp;\r\n    }\r\n\r\n    const rtxIndex = findLine(sdpLines, 'a=rtpmap', 'rtx/90000');\r\n    let rtxPayload;\r\n    if (rtxIndex) {\r\n      rtxPayload = getCodecPayloadType(sdpLines[rtxIndex]);\r\n    }\r\n\r\n    if (!rtxIndex) {\r\n      return sdp;\r\n    }\r\n\r\n    const rtxFmtpLineIndex = findLine(sdpLines, `a=fmtp:${rtxPayload.toString()}`);\r\n    if (rtxFmtpLineIndex !== null) {\r\n      let appendrtxNext = '\\r\\n';\r\n      appendrtxNext += `a=fmtp:${vp8Payload} x-google-min-bitrate=${xgoogle_min_bitrate || '228'}; x-google-max-bitrate=${xgoogle_max_bitrate || '228'}`;\r\n      sdpLines[rtxFmtpLineIndex] = sdpLines[rtxFmtpLineIndex].concat(appendrtxNext);\r\n      sdp = sdpLines.join('\\r\\n');\r\n    }\r\n\r\n    return sdp;\r\n  }\r\n\r\n  function _setOpusAttributes(sdp, params) {\r\n    params = params || {};\r\n\r\n    const sdpLines = sdp.split('\\r\\n');\r\n\r\n    // Opus\r\n    const opusIndex = findLine(sdpLines, 'a=rtpmap', 'opus/48000');\r\n    let opusPayload;\r\n    if (opusIndex) {\r\n      opusPayload = getCodecPayloadType(sdpLines[opusIndex]);\r\n    }\r\n\r\n    if (!opusPayload) {\r\n      return sdp;\r\n    }\r\n\r\n    const opusFmtpLineIndex = findLine(sdpLines, `a=fmtp:${opusPayload.toString()}`);\r\n    if (opusFmtpLineIndex === null) {\r\n      return sdp;\r\n    }\r\n\r\n    let appendOpusNext = '';\r\n    appendOpusNext += `; stereo=${typeof params.stereo !== 'undefined' ? params.stereo : '1'}`;\r\n    appendOpusNext += `; sprop-stereo=${typeof params['sprop-stereo'] !== 'undefined' ? params['sprop-stereo'] : '1'}`;\r\n\r\n    if (typeof params.maxaveragebitrate !== 'undefined') {\r\n      appendOpusNext += `; maxaveragebitrate=${params.maxaveragebitrate || 128 * 1024 * 8}`;\r\n    }\r\n\r\n    if (typeof params.maxplaybackrate !== 'undefined') {\r\n      appendOpusNext += `; maxplaybackrate=${params.maxplaybackrate || 128 * 1024 * 8}`;\r\n    }\r\n\r\n    if (typeof params.cbr !== 'undefined') {\r\n      appendOpusNext += `; cbr=${typeof params.cbr !== 'undefined' ? params.cbr : '1'}`;\r\n    }\r\n\r\n    if (typeof params.useinbandfec !== 'undefined') {\r\n      appendOpusNext += `; useinbandfec=${params.useinbandfec}`;\r\n    }\r\n\r\n    if (typeof params.usedtx !== 'undefined') {\r\n      appendOpusNext += `; usedtx=${params.usedtx}`;\r\n    }\r\n\r\n    if (typeof params.maxptime !== 'undefined') {\r\n      appendOpusNext += `\\r\\na=maxptime:${params.maxptime}`;\r\n    }\r\n\r\n    sdpLines[opusFmtpLineIndex] = sdpLines[opusFmtpLineIndex].concat(appendOpusNext);\r\n\r\n    sdp = sdpLines.join('\\r\\n');\r\n    return sdp;\r\n  }\r\n\r\n  // forceStereoAudio => via webrtcexample.com\r\n  // requires getUserMedia => echoCancellation:false\r\n  function forceStereoAudio(sdp) {\r\n    const sdpLines = sdp.split('\\r\\n');\r\n    let fmtpLineIndex = null;\r\n    for (var i = 0; i < sdpLines.length; i++) {\r\n      if (sdpLines[i].search('opus/48000') !== -1) {\r\n        var opusPayload = extractSdp(sdpLines[i], /:(\\d+) opus\\/48000/i);\r\n        break;\r\n      }\r\n    }\r\n    for (var i = 0; i < sdpLines.length; i++) {\r\n      if (sdpLines[i].search('a=fmtp') !== -1) {\r\n        const payload = extractSdp(sdpLines[i], /a=fmtp:(\\d+)/);\r\n        if (payload === opusPayload) {\r\n          fmtpLineIndex = i;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    if (fmtpLineIndex === null) return sdp;\r\n    sdpLines[fmtpLineIndex] = sdpLines[fmtpLineIndex].concat('; stereo=1; sprop-stereo=1');\r\n    sdp = sdpLines.join('\\r\\n');\r\n    return sdp;\r\n  }\r\n\r\n  return {\r\n    removeVPX,\r\n    disableNACK,\r\n    prioritize,\r\n    removeNonG722,\r\n    setApplicationSpecificBandwidth: function setApplicationSpecificBandwidth(sdp, bandwidth, isScreen) {\r\n      return setBAS(sdp, bandwidth, isScreen);\r\n    },\r\n    setVideoBitrates: function setVideoBitrates(sdp, params) {\r\n      return _setVideoBitrates(sdp, params);\r\n    },\r\n    setOpusAttributes: function setOpusAttributes(sdp, params) {\r\n      return _setOpusAttributes(sdp, params);\r\n    },\r\n    preferVP9: function preferVP9(sdp) {\r\n      return preferCodec(sdp, 'vp9');\r\n    },\r\n    preferCodec,\r\n    forceStereoAudio,\r\n  };\r\n})();\r\n","'use strict';\r\nvar padutils = require('ep_etherpad-lite/static/js/pad_utils').padutils;\r\n\r\nvar textChat = (function textChat() {\r\n  let socket = null;\r\n  let padId = null;\r\n  let currentRoom = {};\r\n  let $joinBtn = null;\r\n\r\n  function createAndAppendMessage(msg) {\r\n    if (!msg || !currentRoom.userId) return true;\r\n\r\n    // correct the time\r\n    // msg.time += window.clientTimeOffset;\r\n\r\n    let minutes = `${new Date(msg.time).getMinutes()}`;\r\n    let hours = `${new Date(msg.time).getHours()}`;\r\n    if (minutes.length === 1) minutes = `0${minutes}`;\r\n    if (hours.length === 1) hours = `0${hours}`;\r\n    const timeStr = `${hours}:${minutes}`;\r\n\r\n    const userName = $('<b>').text(`${msg.userName}: `);\r\n    const tim = $('<span>').attr({class: 'time'}).text(timeStr);\r\n\r\n    const text = padutils.escapeHtmlWithClickableLinks(msg.text, '_blank');\r\n\r\n    // var urlParams = new URLSearchParams(msg.text.split(\"?\")[1]);\r\n\r\n    // if(urlParams.get('id')) {\r\n    // \tvar headerId = urlParams.get('id');\r\n    // \tvar target = urlParams.get('target');\r\n    // \tvar join = urlParams.get('join');\r\n    // \ttext = $(text).attr({\r\n    // \t\t\"data-join\": join,\r\n    // \t\t\"data-action\":\"JOIN\",\r\n    // \t\t\"data-id\": headerId\r\n    // \t}).addClass('btn_roomHandler')\r\n    // }\r\n\r\n    const message = $('<p>').attr({\r\n      'data-authorid': msg.author,\r\n    }).append(userName).append(tim).append(text);\r\n\r\n    $('#wrtc_textChat').append(message);\r\n    share.scrollDownToLastChatText('#wrtc_textChat');\r\n  }\r\n\r\n  // function privateNotifyNewUserJoined(target, msg, action) {\r\n  // \tvar textIcon = '<span class=\"textIcon\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\"><path fill=\"currentColor\" d=\"M416 224V64c0-35.3-28.7-64-64-64H64C28.7 0 0 28.7 0 64v160c0 35.3 28.7 64 64 64v54.2c0 8 9.1 12.6 15.5 7.8l82.8-62.1H352c35.3.1 64-28.6 64-63.9zm96-64h-64v64c0 52.9-43.1 96-96 96H192v64c0 35.3 28.7 64 64 64h125.7l82.8 62.1c6.4 4.8 15.5.2 15.5-7.8V448h32c35.3 0 64-28.7 64-64V224c0-35.3-28.7-64-64-64z\"></path></svg></span>';\r\n  // \tvar btnJoin = \"<span class='wrtc_roomLink' data-join='\" + target + \"' data-action='JOIN' data-id='\" + msg.headerId + \"' title='Join'>\" + msg.headerTitle + '</span>';\r\n\r\n  // \tvar text = action === 'JOIN' ? 'joins' : 'leaves';\r\n\r\n  // \tmsg.text = '<span>' + text + '</span>' + textIcon + btnJoin;\r\n\r\n  // \tmsg.target = target;\r\n\r\n  // \tcreateAndAppendMessage(msg);\r\n  // }\r\n\r\n  function eventTextChatInput() {\r\n    const keycode = event.keyCode || event.which;\r\n    // when press Enter key\r\n    if (keycode === 13) {\r\n      const textMessage = $(this).val();\r\n      if (!textMessage) return true;\r\n      $(this).val('');\r\n      const user = share.getUserFromId(clientVars.userId);\r\n      if (!user) return true;\r\n      const msg = {text: textMessage, userName: user.name, author: user.userId, time: new Date().getTime()};\r\n      socket.emit('sendTextMessage', padId, currentRoom.headerId, msg, (incomMsg) => {\r\n        createAndAppendMessage(incomMsg);\r\n      });\r\n    }\r\n  }\r\n\r\n  function eventListers() {\r\n    $(document).on('keypress', '#wrtc_textChatInputBox input', eventTextChatInput);\r\n\r\n    $(document).on('click', '#wrtc_textChatWrapper .btn_toggle_modal', function click() {\r\n      const action = $(this).attr('data-action');\r\n      const chatBox = $('#wrtc_textChat').innerHeight() + $('#wrtc_textChatInputBox').innerHeight() + 1;\r\n\r\n      $(this).find('.fa_arrow-from-top').toggle();\r\n      $(this).find('.fa_arrow-to-top').toggle();\r\n\r\n      if (action === 'collapse') {\r\n        $(this).attr({'data-action': 'expand'});\r\n        $('#wrtc_textChatWrapper').css({\r\n          transform: `translate(-50%, ${chatBox}px)`,\r\n        });\r\n      } else {\r\n        $(this).attr({'data-action': 'collapse'});\r\n        $('#wrtc_textChatWrapper').css({\r\n          transform: 'translate(-50%, 0)',\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  function deactivateModal(headerId, roomInfo) {\r\n    const $TextChatWrapper = $(document).find('#wrtc_textChatWrapper');\r\n\r\n    $TextChatWrapper.removeClass('active').removeAttr('style');\r\n    $TextChatWrapper.find('#wrtc_textChat p').remove();\r\n    // socket.removeListener('receiveTextMessage:' + headerId);\r\n\r\n    const $btn = $(document).find('#wrtc_textChatWrapper .btn_toggle_modal');\r\n    $btn.attr({'data-action': 'collapse'});\r\n    $btn.find('.fa_arrow-from-top').toggle();\r\n    $btn.find('.fa_arrow-to-top').toggle();\r\n  }\r\n\r\n  function activateModal(headerId, headTitle, userCount, roomInfo) {\r\n    if (!headerId) return false;\r\n    const existTextChat = $(document).find('#wrtc_textChatWrapper');\r\n    if (!existTextChat.length) {\r\n      const textChatBox = $('#wrtc_textChatBox').tmpl({\r\n        headerId,\r\n        headTitle,\r\n      });\r\n      $('body').append(textChatBox);\r\n    } else {\r\n      // TODO: change this to template\r\n      existTextChat.attr({'data-id': headerId}).find('.textChatToolbar b, .btn_leave').attr({'data-id': headerId});\r\n      existTextChat.find('.nd_title b').text(headTitle);\r\n    }\r\n\r\n    // for animation pop up\r\n    setTimeout(() => {\r\n      $(document).find('#wrtc_textChatWrapper').addClass('active');\r\n    }, 250);\r\n\r\n    socket.on(`receiveTextMessage:${headerId}`, (headingId, msg) => {\r\n      if (headingId === headerId) {\r\n        createAndAppendMessage(msg);\r\n      }\r\n    });\r\n\r\n    socket.emit('getTextMessages', padId, headerId, {}, (data) => {\r\n      data.forEach((el) => {\r\n        createAndAppendMessage(el);\r\n      });\r\n    });\r\n\r\n    share.appendUserList(roomInfo, '#wrtc_textChatWrapper  #textChatUserModal ul');\r\n  }\r\n\r\n  function addUserToRoom(data, roomInfo) {\r\n    if (!data || !data.userId) return true;\r\n    const headerId = data.headerId;\r\n    const $headingRoom = share.$body_ace_outer().find(`#${headerId}`);\r\n    const headTitle = $headingRoom.find('.wrtc_header b.titleRoom').text();\r\n    const userCount = roomInfo.present;\r\n    $headingRoom.find('.textChatCount').text(userCount);\r\n\r\n    const user = share.getUserFromId(data.userId);\r\n    // some user may session does exist but the user info does not available in all over the current pad\r\n    if (!user) return true;\r\n\r\n    // TODO: this is not good idea, use global state\r\n    // if incoming user has already in the room don't persuade the request\r\n    const IsUserInRooms = $headingRoom.find(`.wrtc_content.textChat ul li[data-id='${user.userId}']`).text();\r\n    if (IsUserInRooms) return false;\r\n\r\n    share.appendUserList(roomInfo, $headingRoom.find('.wrtc_content.textChat ul'));\r\n    share.appendUserList(roomInfo, '#wrtc_textChatWrapper  #textChatUserModal ul');\r\n\r\n    // notify, a user join the video-chat room\r\n    // var msg = {\r\n    // \ttime: new Date(),\r\n    // \tuserId: data.userId || user.userId,\r\n    // \tuserName: user.name || data.name || 'anonymous',\r\n    // \theaderId: data.headerId,\r\n    // \tuserCount: userCount,\r\n    // \theaderTitle: headTitle\r\n    // };\r\n    // share.notifyNewUserJoined('TEXT', msg, 'JOIN');\r\n\r\n    // if (data.headerId === currentRoom.headerId) {\r\n    // \tvar privateMsg = {\r\n    // \t\tuserName: user.name,\r\n    // \t\tauthor: user.userId,\r\n    // \t\theaderTitle: headTitle,\r\n    // \t\ttime: new Date().getTime()\r\n    // \t};\r\n    // \tprivateNotifyNewUserJoined('TEXT', privateMsg, 'JOIN');\r\n    // }\r\n\r\n    // if (data.headerId === currentRoom.headerId && data.userId !== clientVars.userId) {\r\n    // \t$.gritter.add({\r\n    // \t\ttext: '<span class=\"author-name\">' + user.name + '</span>' + 'has joined the text-chat, <b><i> \"' + headTitle + '\"</b></i>',\r\n    // \t\tsticky: false,\r\n    // \t\ttime: 3000,\r\n    // \t\tposition: 'center',\r\n    // \t\tclass_name: 'chat-gritter-msg'\r\n    // \t});\r\n    // }\r\n\r\n    if (data.userId === clientVars.userId) {\r\n      currentRoom = data;\r\n      $headingRoom.attr({'data-text': true});\r\n      share.roomBoxIconActive();\r\n      activateModal(headerId, headTitle, userCount, roomInfo);\r\n      share.wrtcPubsub.emit('enable room buttons', headerId, 'JOIN', $joinBtn);\r\n    }\r\n\r\n    share.wrtcPubsub.emit('update store', data, headerId, 'JOIN', 'TEXT', roomInfo, () => {});\r\n  }\r\n\r\n  function removeUserFromRoom(data, roomInfo, target, cb) {\r\n    if (!data || !data.userId) return true;\r\n    const headerId = data.headerId;\r\n    const $headingRoom = share.$body_ace_outer().find(`#${headerId}`);\r\n    const headTitle = $headingRoom.find('.wrtc_header b.titleRoom').text();\r\n\r\n    const userCount = roomInfo.present;\r\n    $headingRoom.find('.textChatCount').text(userCount);\r\n\r\n    const $textChatUserList = $headingRoom.find('.wrtc_content.textChat ul');\r\n\r\n    share.appendUserList(roomInfo, $textChatUserList);\r\n    share.appendUserList(roomInfo, '#wrtc_textChatWrapper #textChatUserModal ul');\r\n\r\n    if (userCount === 0) {\r\n      $textChatUserList.append(`<li class=\"empty\">Be the first to join the <button class=\"btn_joinChat_text\" data-action=\"JOIN\" data-id=\"${headerId}\" data-join=\"TEXT\"><b>text-chat</b></button></li>`);\r\n    }\r\n\r\n    // var user = share.getUserFromId(data.userId);\r\n\r\n    // notify, a user join the text-chat room\r\n    // var msg = {\r\n    // \ttime: new Date(),\r\n    // \tuserId: user.userId || data.userId,\r\n    // \tuserName: user.name || data.name || 'anonymous',\r\n    // \theaderId: data.headerId,\r\n    // \tuserCount: userCount,\r\n    // \theaderTitle: headTitle\r\n    // };\r\n    // share.notifyNewUserJoined('TEXT', msg, 'LEAVE');\r\n\r\n    // if (data.headerId === currentRoom.headerId) {\r\n    // \tvar privateMsg = {\r\n    // \t\tuserName: user.name,\r\n    // \t\tauthor: user.userId,\r\n    // \t\theaderTitle: headTitle,\r\n    // \t\ttime: new Date().getTime()\r\n    // \t};\r\n    // \tprivateNotifyNewUserJoined('TEXT', privateMsg, 'LEAVE');\r\n    // }\r\n\r\n    if (data.userId === clientVars.userId) {\r\n      $headingRoom.removeAttr('data-text');\r\n      share.roomBoxIconActive();\r\n      currentRoom = {};\r\n      deactivateModal(data.headerId, roomInfo);\r\n      share.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n    }\r\n\r\n    share.wrtcPubsub.emit('update store', data, headerId, 'LEAVE', 'TEXT', roomInfo, () => {});\r\n\r\n    if (cb && typeof cb === 'function') cb();\r\n  }\r\n\r\n  function userJoin(headerId, userData, $joinButton) {\r\n    if (!userData || !userData.userId) {\r\n      share.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n      return false;\r\n    }\r\n\r\n    // check if user already in that room\r\n    if (currentRoom && currentRoom.headerId === headerId) {\r\n      share.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n      return false;\r\n    }\r\n\r\n    $joinBtn = $joinButton;\r\n\r\n    share.$body_ace_outer().find('button.btn_joinChat_chatRoom').removeClass('active');\r\n\r\n    if (!currentRoom.userId) {\r\n      socket.emit('userJoin', padId, userData, 'text', addUserToRoom);\r\n    } else {\r\n      socket.emit('userLeave', padId, currentRoom, 'text', (data, roomInfo, target) => {\r\n        removeUserFromRoom(data, roomInfo, 'text', () => {\r\n          socket.emit('userJoin', padId, userData, 'text', addUserToRoom);\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  function userLeave(headerId, userData, $joinButton) {\r\n    $joinBtn = $joinButton;\r\n    socket.emit('userLeave', padId, userData, 'text', removeUserFromRoom);\r\n  }\r\n\r\n  function socketBulkUpdateRooms(rooms, info, target) {\r\n    const roomsInfo = {};\r\n    // create a roomInfo for each individual room\r\n    Object.keys(rooms).forEach((headerId) => {\r\n      const roomInfo = {\r\n        present: rooms[headerId].length,\r\n        list: rooms[headerId],\r\n      };\r\n      roomsInfo[headerId] = roomInfo;\r\n    });\r\n\r\n    // bind roomInfo and send user to gateway_userJoin\r\n    Object.keys(rooms).forEach((headerId) => {\r\n      rooms[headerId].forEach((user) => {\r\n        addUserToRoom(user, roomsInfo[headerId], 'text');\r\n      });\r\n    });\r\n  }\r\n\r\n  function bulkUpdateRooms(hTagList) {\r\n    socket.emit('bulkUpdateRooms', padId, hTagList, 'text', socketBulkUpdateRooms);\r\n  }\r\n\r\n  function postAceInit(hook, context, webSocket, docId) {\r\n    socket = webSocket;\r\n    padId = docId;\r\n    share.wrtcPubsub.emit('component status', 'text', true);\r\n    eventListers();\r\n  }\r\n\r\n  return {\r\n    postAceInit,\r\n    activateModal,\r\n    deactivateModal,\r\n    userJoin,\r\n    userLeave,\r\n    removeUserFromRoom,\r\n    addUserToRoom,\r\n    bulkUpdateRooms,\r\n  };\r\n})();\r\n","'use strict';\r\n\r\nvar videoChat = (function videoChat() {\r\n  let socket = null;\r\n  let padId = null;\r\n  let currentRoom = {};\r\n  let localStream = null;\r\n  let VIDEOCHATLIMIT = 0;\r\n  let $joinBtn = null;\r\n  let networkInterval = null;\r\n  const pingos = {\r\n    startTime: 0,\r\n    latency: 0,\r\n    LMin: 0,\r\n    LMax: 0,\r\n    avg: 0,\r\n    LineAvg: [],\r\n    colors: {\r\n      normal: '#fff',\r\n      warning: '#ffcc00',\r\n      danger: '#cc3300',\r\n    },\r\n    interavCheck: 1000,\r\n  };\r\n\r\n  const startWatchNetwork = function startWatchNetwork() {\r\n    networkInterval = setInterval(() => {\r\n      pingos.startTime = Date.now();\r\n      socket.emit('pingil', padId, window.headerId, share.getUserId(), pingos.avg);\r\n    }, pingos.interavCheck);\r\n  };\r\n\r\n  const stopWatchNetwork = function stopWatchNetwork() {\r\n    clearInterval(networkInterval);\r\n  };\r\n\r\n  function mediaDevices() {\r\n    navigator.mediaDevices.enumerateDevices().then((data) => {\r\n      let videoSettings = localStorage.getItem('videoSettings') || {microphone: null, speaker: null, camera: null};\r\n\r\n      if (typeof videoSettings === 'string') {\r\n        videoSettings = JSON.parse(videoSettings);\r\n      }\r\n\r\n      const audioInputSelect = document.querySelector('select#audioSource');\r\n      const audioOutputSelect = document.querySelector('select#audioOutput');\r\n      const videoSelect = document.querySelector('select#videoSource');\r\n\r\n      for (let i = 0; i !== data.length; ++i) {\r\n        const deviceInfo = data[i];\r\n        const option = document.createElement('option');\r\n        option.value = deviceInfo.deviceId;\r\n        if (deviceInfo.kind === 'audioinput') {\r\n          option.text = deviceInfo.label || `microphone ${audioInputSelect.length + 1}`;\r\n          if (videoSettings.microphone === deviceInfo.deviceId) option.selected = true;\r\n          audioInputSelect.appendChild(option);\r\n        } else if (deviceInfo.kind === 'audiooutput') {\r\n          option.text = deviceInfo.label || `speaker ${audioOutputSelect.length + 1}`;\r\n          if (videoSettings.speaker === deviceInfo.deviceId) option.selected = true;\r\n          audioOutputSelect.appendChild(option);\r\n        } else if (deviceInfo.kind === 'videoinput') {\r\n          option.text = deviceInfo.label || `camera ${videoSelect.length + 1}`;\r\n          if (videoSettings.camera === deviceInfo.deviceId) option.selected = true;\r\n          videoSelect.appendChild(option);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  function isUserMediaAvailable() {\r\n    return window.navigator.mediaDevices.getUserMedia({audio: true, video: true});\r\n  }\r\n\r\n  function removeUserFromRoom(data, roomInfo, cb) {\r\n    if (!data || !roomInfo || !data.userId) return false;\r\n    const headerId = data.headerId;\r\n    const $headingRoom = share.$body_ace_outer().find(`#${headerId}`);\r\n    const headerTitle = $headingRoom.find('.wrtc_header b.titleRoom').text();\r\n    const $videoChatUserList = $headingRoom.find('.wrtc_content.videoChat ul');\r\n\r\n    share.appendUserList(roomInfo, $videoChatUserList);\r\n\r\n    const userCount = roomInfo.present;\r\n    $headingRoom.find('.videoChatCount').text(userCount);\r\n\r\n    if (userCount === 0) {\r\n      $videoChatUserList.append(`<li class=\"empty\">Be the first to join the <button class=\"btn_joinChat_video\" data-action=\"JOIN\" data-id=\"${headerId}\" data-join=\"VIDEO\"><b>video-chat</b></button></li>`);\r\n    }\r\n\r\n    const user = share.getUserFromId(data.userId);\r\n\r\n    if (user && data.action !== 'JOIN' && data.action !== 'RELOAD') {\r\n      // notify, a user join the video-chat room\r\n      const msg = {\r\n        time: new Date(),\r\n        userId: data.userId || user.userId,\r\n        userName: data.name || user.name || 'anonymous',\r\n        headerId: data.headerId,\r\n        userCount,\r\n        headerTitle,\r\n        VIDEOCHATLIMIT,\r\n      };\r\n      share.notifyNewUserJoined('VIDEO', msg, 'LEAVE');\r\n    }\r\n\r\n    if (data.userId === clientVars.userId) {\r\n      $headingRoom.removeAttr('data-video');\r\n      share.roomBoxIconActive();\r\n      WRTC.deactivate(data.userId, data.headerId);\r\n      stopWatchNetwork();\r\n      window.headerId = null;\r\n\r\n      currentRoom = {};\r\n\r\n      $('#wrtc_modal').css({\r\n        transform: 'translate(-50%, -100%)',\r\n        opacity: 0,\r\n      }).attr({'data-active': false});\r\n\r\n      // WRTC.deactivate(data.userId, data.headerId);\r\n      share.stopStreaming(localStream);\r\n      localStream = null;\r\n      socket.removeListener(`receiveTextMessage:${data.headerId}`);\r\n    }\r\n\r\n    if (cb && typeof cb === 'function') cb();\r\n\r\n    share.wrtcPubsub.emit('update store', data, headerId, 'LEAVE', 'VIDEO', roomInfo, () => {});\r\n\r\n    share.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n\r\n    WRTC.userLeave(data.userId);\r\n  }\r\n\r\n  function addUserToRoom(data, roomInfo) {\r\n    if (!data || !data.userId) return false;\r\n    const headerId = data.headerId;\r\n    const $headingRoom = share.$body_ace_outer().find(`#${headerId}`);\r\n    const headerTitle = $headingRoom.find('.wrtc_header b.titleRoom').text();\r\n\r\n    const user = share.getUserFromId(data.userId);\r\n    // some user may session does exist but the user info does not available in all over the current pad\r\n    if (!user) return true;\r\n\r\n    // TODO: this is not good idea, use global state\r\n    // if incoming user has already in the room don't persuade the request\r\n    const IsUserInRooms = $headingRoom.find(`.wrtc_content.videoChat ul li[data-id='${user.userId}']`).text();\r\n    if (IsUserInRooms) return false;\r\n\r\n    const userCount = roomInfo.present;\r\n    $headingRoom.find('.videoChatCount').text(userCount);\r\n\r\n    $(document).find('#wrtc_textChatWrapper .textChatToolbar .userCount').text(userCount);\r\n\r\n    share.appendUserList(roomInfo, $headingRoom.find('.wrtc_content.videoChat ul'));\r\n\r\n    if (data.action == 'JOIN') {\r\n      // notify, a user join the video-chat room\r\n      const msg = {\r\n        time: new Date(),\r\n        userId: data.userId,\r\n        userName: user.name || data.name || 'anonymous',\r\n        headerId: data.headerId,\r\n        userCount,\r\n        headerTitle,\r\n        VIDEOCHATLIMIT,\r\n      };\r\n\r\n      share.notifyNewUserJoined('VIDEO', msg, 'JOIN');\r\n\r\n      // if (data.headerId === currentRoom.headerId && data.userId !== clientVars.userId) {\r\n      // \t$.gritter.add({\r\n      // \t\ttext: '<span class=\"author-name\">' + user.name + '</span>' + 'has joined the video-chat, <b><i> \"' + headerTitle + '\"</b></i>',\r\n      // \t\tsticky: false,\r\n      // \t\ttime: 3000,\r\n      // \t\tposition: 'center',\r\n      // \t\tclass_name: 'chat-gritter-msg'\r\n      // \t});\r\n      // }\r\n    }\r\n\r\n    if (data.userId === clientVars.userId) {\r\n      $headingRoom.attr({'data-video': true});\r\n      share.roomBoxIconActive();\r\n      startWatchNetwork();\r\n\r\n      $('#werc_toolbar p').attr({'data-id': data.headerId}).text(headerTitle);\r\n      $('#werc_toolbar .btn_roomHandler').attr({'data-id': data.headerId});\r\n\r\n      window.headerId = data.headerId;\r\n      WRTC.activate(data.headerId, user.userId);\r\n      currentRoom = data;\r\n\r\n      $('#rtcbox').prepend(`<h4 class=\"chatTitle\">${headerTitle}</h4>`);\r\n\r\n      $('#wrtc_modal').css({\r\n        transform: 'translate(-50%, 0)',\r\n        opacity: 1,\r\n      }).attr({'data-active': true});\r\n\r\n      share.wrtcPubsub.emit('enable room buttons', headerId, 'JOIN', $joinBtn);\r\n      socket.emit('acceptNewCall', padId, window.headerId);\r\n\r\n      socket.on(`receiveTextMessage:${headerId}`, (headingId, msg) => {\r\n        const active = $(document).find('#wrtc_textChatWrapper').hasClass('active');\r\n        if (headingId === headerId && !active) {\r\n          textChat.userJoin(headerId, data, 'TEXT');\r\n        }\r\n      });\r\n    }\r\n\r\n    share.wrtcPubsub.emit('update store', data, headerId, 'JOIN', 'VIDEO', roomInfo, () => {});\r\n  }\r\n\r\n  function createSession(headerId, userInfo, $joinButton) {\r\n    share.$body_ace_outer().find('button.btn_joinChat_chatRoom').removeClass('active');\r\n    $joinBtn = $joinButton;\r\n    isUserMediaAvailable().then((stream) => {\r\n      // stop last stream\r\n      share.stopStreaming(localStream);\r\n      localStream = stream;\r\n\r\n      if (!currentRoom.userId) {\r\n        return socket.emit('userJoin', padId, userInfo, 'video', gateway_userJoin);\r\n      }\r\n      // If the user has already joined the video chat, make suer leave that room then join to the new chat room\r\n      socket.emit('userLeave', padId, currentRoom, 'video', (_userData, roomInfo) => {\r\n        gateway_userLeave(_userData, roomInfo, () => {\r\n          socket.emit('userJoin', padId, userInfo, 'video', gateway_userJoin);\r\n        });\r\n      });\r\n    }).catch((err) => {\r\n      console.error(err);\r\n      share.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n      socket.emit('userLeave', padId, currentRoom, 'video', (_userData, roomInfo) => {\r\n        gateway_userLeave(_userData, roomInfo);\r\n      });\r\n      WRTC.showUserMediaError(err, share.getUserId(), headerId);\r\n    });\r\n  }\r\n\r\n  function userJoin(headerId, userInfo, $joinButton) {\r\n    if (!userInfo || !userInfo.userId) {\r\n      share.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n      return false;\r\n    }\r\n\r\n    // check if has user already in that room\r\n    if (currentRoom && currentRoom.headerId === headerId) {\r\n      share.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n      return false;\r\n    }\r\n\r\n    createSession(headerId, userInfo, $joinButton);\r\n  }\r\n  // depricate\r\n  function reloadCurrentSession(headerId, userInfo, $joinButton) {\r\n    if (!userInfo || !userInfo.userId) {\r\n      share.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n      return false;\r\n    }\r\n\r\n    createSession(headerId, userInfo, $joinButton, 'RELOAD');\r\n  }\r\n\r\n  function reloadSession(headerId, userInfo, $joinButton) {\r\n    if (!userInfo || !userInfo.userId) {\r\n      share.wrtcPubsub.emit('enable room buttons', headerId, 'LEAVE', $joinBtn);\r\n      return false;\r\n    }\r\n    socket.emit('reloadVideoSession', padId, headerId);\r\n  }\r\n\r\n  function userLeave(headerId, data, $joinButton) {\r\n    $joinBtn = $joinButton;\r\n    socket.emit('userLeave', padId, data, 'video', gateway_userLeave);\r\n  }\r\n\r\n  function reachedVideoRoomSize(roomInfo, showAlert, isBulkUpdate) {\r\n    if (roomInfo && roomInfo.present <= VIDEOCHATLIMIT) return true;\r\n\r\n    showAlert = showAlert || true;\r\n    if (showAlert && !isBulkUpdate) {\r\n      $.gritter.add({\r\n        title: 'Video chat Limitation',\r\n        text: `The video-chat room has been reached its limitation. \\r\\n <br> The size of this video-chat room is ${VIDEOCHATLIMIT}.`,\r\n        sticky: false,\r\n        class_name: 'error',\r\n        time: '5000',\r\n      });\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  function socketBulkUpdateRooms(rooms, info, target) {\r\n    const roomsInfo = {};\r\n    // create a roomInfo for each individual room\r\n    Object.keys(rooms).forEach((headerId) => {\r\n      const roomInfo = {\r\n        present: rooms[headerId].length,\r\n        list: rooms[headerId],\r\n      };\r\n      roomsInfo[headerId] = roomInfo;\r\n    });\r\n\r\n    // bind roomInfo and send user to gateway_userJoin\r\n    Object.keys(rooms).forEach((headerId) => {\r\n      rooms[headerId].forEach((user) => {\r\n        gateway_userJoin(user, roomsInfo[headerId], true);\r\n      });\r\n    });\r\n  }\r\n\r\n  function bulkUpdateRooms(hTagList) {\r\n    socket.emit('bulkUpdateRooms', padId, hTagList, 'video', socketBulkUpdateRooms);\r\n  }\r\n\r\n  /**\r\n  *\r\n  * @param {Object} data @requires\r\n  * @param {String} data.padId @requires\r\n  * @param {String} data.userId @requires\r\n  * @param {String} data.userName @requires\r\n  * @param {String} data.headerId\r\n  *\r\n  * @param {Object} roomInfo\r\n  * @param {Boolean} showAlert\r\n  * @param {Boolean} bulkUpdate\r\n *\r\n *\t@returns\r\n  */\r\n  function gateway_userJoin(data, roomInfo, showAlert, bulkUpdate) {\r\n    if (!data) return reachedVideoRoomSize(null, true, false);\r\n\r\n    if (data && reachedVideoRoomSize(roomInfo, showAlert, bulkUpdate)) {\r\n      return addUserToRoom(data, roomInfo);\r\n    } else if (bulkUpdate) {\r\n      return addUserToRoom(data, roomInfo);\r\n    }\r\n    share.stopStreaming(localStream);\r\n    localStream = null;\r\n    return false;\r\n  }\r\n\r\n  function gateway_userLeave(data, roomInfo, cb) {\r\n    removeUserFromRoom(data, roomInfo, cb);\r\n  }\r\n\r\n  function postAceInit(hook, context, webSocket, docId) {\r\n    socket = webSocket;\r\n    padId = docId;\r\n    VIDEOCHATLIMIT = clientVars.webrtc.videoChatLimit;\r\n    share.wrtcPubsub.emit('component status', 'video', true);\r\n    // mediaDevices();\r\n\r\n    socket.on('userLatancy', (data) => {\r\n      if (share.getUserId() !== data.userId) {\r\n        const videoId = `interface_video_${data.userId.replace(/\\./g, '_')}`;\r\n\r\n        let color = pingos.colors.normal;\r\n        if (data.latency > 200 && data.latency < 300) color = pingos.colors.warning;\r\n        if (data.latency > 300) color = pingos.colors.danger;\r\n\r\n        $(document)\r\n            .find(`#${videoId} .latency`)\r\n            .css({color})\r\n            .text(`${Math.ceil(data.latency)}ms`);\r\n      }\r\n    });\r\n    socket.on('pongol', (data) => {\r\n      pingos.latency = Date.now() - pingos.startTime;\r\n\r\n      if (pingos.LMin <= pingos.latency && pingos.latency >= pingos.LMax) pingos.LMax = pingos.latency; else pingos.LMin = pingos.latency;\r\n\r\n      // console.log( 'Websocket RTT: ' + pingos.latency + ' ms', \"min:\", pingos.LMin, \"max\", pingos.LMax, \"avg:\", pingos.avg );\r\n\r\n      if (pingos.LineAvg.length < 4) { pingos.LineAvg.push((pingos.LMax + pingos.LMin) / 2); } else {\r\n        pingos.avg = pingos.LineAvg.reduce((a, b) => a + b) / pingos.LineAvg.length;\r\n        // console.log(pingos.LineAvg)\r\n        pingos.LineAvg = [];\r\n        pingos.LMax = 0;\r\n      }\r\n\r\n      let color = pingos.colors.normal;\r\n      if (pingos.avg > 200 && pingos.avg < 300) color = pingos.colors.warning;\r\n      if (pingos.avg > 300) color = pingos.colors.danger;\r\n\r\n      $(document)\r\n          .find('.video-container.local-user .latency')\r\n          .css({color})\r\n          .text(`${Math.ceil(pingos.avg)}ms`);\r\n      $(document).find('#networkStatus').html(`RTT: ${pingos.latency}ms, min: ${pingos.LMin}ms, max: ${pingos.LMax}ms, avg:${pingos.avg}ms`);\r\n\r\n      // share.wrtcPubsub.emit('update network information', pingos);\r\n    });\r\n    socket.on('reloadVideoSession', (headerId) => {\r\n      if (currentRoom.headerId !== headerId) return false;\r\n      const target = 'PLUS';\r\n      const userInfo = {\r\n        padId: clientVars.padId || window.pad.getPadId(),\r\n        userId: clientVars.userId || window.pad.getUserId(),\r\n        userName: clientVars.userName || 'anonymous',\r\n        headerId,\r\n        target,\r\n        action: 'JOIN',\r\n      };\r\n      share.wrtcPubsub.emit('disable room buttons', headerId, 'JOIN', target);\r\n      createSession(headerId, userInfo, target);\r\n    });\r\n  }\r\n\r\n  return {\r\n    postAceInit,\r\n    userJoin,\r\n    userLeave,\r\n    gateway_userJoin,\r\n    gateway_userLeave,\r\n    bulkUpdateRooms,\r\n    reloadSession,\r\n    reloadCurrentSession,\r\n    mediaDevices,\r\n  };\r\n})();\r\n","'use strict';\r\n\r\nvar WRTC_Room = (function WRTC_Room() {\r\n  let socket = null;\r\n  let padId = null;\r\n  let VIDEOCHATLIMIT = 0;\r\n  // var $lastJoinButton = null;\r\n  const prefixHeaderId = 'headingTagId_';\r\n  const hElements = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', '.h1', '.h2', '.h3', '.h4', '.h5', '.h6'];\r\n\r\n  /** --------- Helper --------- */\r\n\r\n  function link2Clipboard(text) {\r\n    const $temp = $('<input>');\r\n    $('body').append($temp);\r\n    $temp.val(text).select();\r\n    document.execCommand('copy');\r\n    $temp.remove();\r\n    $.gritter.add({\r\n      title: 'Copied',\r\n      text: 'Join link copied to clip board',\r\n      sticky: false,\r\n      class_name: 'copyLinkToClipboard',\r\n      time: '3000',\r\n    });\r\n  }\r\n\r\n  function scroll2Header(headerId) {\r\n    const padContainer = share.$body_ace_outer().find('iframe').contents().find('#innerdocbody');\r\n    padContainer.find(`.videoHeader.${headerId}`).each(function scrolling() {\r\n      this.scrollIntoView({\r\n        behavior: 'smooth',\r\n      });\r\n    });\r\n  }\r\n\r\n  function closeTextChat() {\r\n    $('#wrtc_textChatWrapper .btn_leave').trigger('click');\r\n  }\r\n\r\n  function joinChatRoom(headerId, userInfo, target) {\r\n    // textChat.userJoin(headerId, userInfo, 'TEXTPLUS');\r\n    videoChat.userJoin(headerId, userInfo, 'PLUS');\r\n    closeTextChat();\r\n  }\r\n\r\n  function leaveChatRoom(headerId, userInfo, target) {\r\n    // textChat.userLeave(headerId, userInfo, 'TEXTPLUS');\r\n    videoChat.userLeave(headerId, userInfo, 'PLUS');\r\n    closeTextChat();\r\n  }\r\n\r\n  /**\r\n  *\r\n  * @param {string} actions @enum (JOIN|LEAVE|RELOAD|SHARELINK)\r\n  * @param {string} headerId\r\n  * @param {string} target @enum (chatRoom|video|text)\r\n  */\r\n  function roomBtnHandler(actions, headerId, target) {\r\n    if (typeof actions !== 'string') {\r\n      actions.preventDefault();\r\n      // actions.stopPropagation();\r\n    }\r\n    headerId = $(this).attr('data-id') || headerId;\r\n    actions = $(this).attr('data-action') || actions;\r\n    target = $(this).attr('data-join') || target;\r\n\r\n    if (!headerId || !target) return true;\r\n\r\n    const hasHref = $(this).attr('href');\r\n    // if the link belong to the other pad.\r\n    // navigate to the new pad\r\n    // TODO: URL should be sanitize and then decided to navigate\r\n    if (hasHref) {\r\n      const url = new URL(hasHref);\r\n      if (url.pathname !== location.pathname) window.location = hasHref;\r\n    }\r\n\r\n    const userInfo = {\r\n      padId: clientVars.padId || window.pad.getPadId(),\r\n      userId: clientVars.userId || window.pad.getUserId(),\r\n      userName: clientVars.userName || 'anonymous',\r\n      headerId,\r\n      target,\r\n      action: actions,\r\n    };\r\n\r\n    // Before handel request, check socket state\r\n    if (share.wrtcStore.socketState !== 'OPEND') {\r\n      // show the alert that user must reload the page\r\n      $.gritter.add({\r\n        title: 'Video chat no longer responds',\r\n        text: 'The socket is disconnected and we can no longer make a stable call, please go to stable internet and then reload the page.',\r\n        sticky: false,\r\n        class_name: 'error',\r\n        time: '15000',\r\n      });\r\n      return false;\r\n    }\r\n\r\n    if (actions !== 'SHARELINK') { share.wrtcPubsub.emit('disable room buttons', headerId, actions, target); }\r\n\r\n    if (actions === 'JOIN') {\r\n      switch (target) {\r\n        case 'PLUS':\r\n          joinChatRoom(headerId, userInfo, target);\r\n          break;\r\n        case 'VIDEO':\r\n          videoChat.userJoin(headerId, userInfo, target);\r\n          break;\r\n        case 'TEXT':\r\n          textChat.userJoin(headerId, userInfo, target);\r\n          break;\r\n        default:\r\n          return false;\r\n      }\r\n    } else if (actions === 'LEAVE') {\r\n      switch (target) {\r\n        case 'PLUS':\r\n          leaveChatRoom(headerId, userInfo, target);\r\n          break;\r\n        case 'VIDEO':\r\n          videoChat.userLeave(headerId, userInfo, target);\r\n          break;\r\n        case 'TEXT':\r\n          textChat.userLeave(headerId, userInfo, target);\r\n          break;\r\n        default:\r\n          return false;\r\n      }\r\n    } else if (actions === 'RELOAD') {\r\n      videoChat.reloadSession(headerId, userInfo, target, actions);\r\n    } else if (actions === 'SHARELINK') {\r\n      shareRoomsLink(headerId, target);\r\n    }\r\n  }\r\n\r\n  function joinByQueryString() {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const headerId = urlParams.get('id');\r\n    let target = urlParams.get('target');\r\n    const join = urlParams.get('join');\r\n\r\n    if (!headerId) return true;\r\n\r\n    const hasThisHeader = share.wrtcStore[headerId];\r\n    if (!hasThisHeader) {\r\n      $.gritter.add({\r\n        title: 'Error',\r\n        text: 'The header seems not to exist anymore!',\r\n        time: 3000,\r\n        sticky: false,\r\n        class_name: 'error',\r\n      });\r\n      return false;\r\n    }\r\n\r\n    if (headerId) scroll2Header(headerId);\r\n\r\n    if (join === 'true') {\r\n      target = target.toUpperCase();\r\n      setTimeout(() => {\r\n        roomBtnHandler('JOIN', headerId, target);\r\n      }, 700);\r\n    }\r\n  }\r\n\r\n  function shareRoomsLink(headId, target) {\r\n    headId = $(this).attr('data-id') || headId;\r\n    target = $(this).attr('data-join') || target;\r\n    target = target.toLowerCase();\r\n    const title = share.$body_ace_outer().find(`.wbrtc_roomBox.${headId} .titleRoom`).text();\r\n\r\n    const origin = window.location.origin;\r\n    const pathName = window.location.pathname;\r\n    const link = `${origin + pathName}?header=${share.slugify(title)}&id=${headId}&target=${target}&join=true`;\r\n\r\n    const $temp = $('<input>');\r\n    $('body').append($temp);\r\n    $temp.val(link).select();\r\n    document.execCommand('copy');\r\n    $temp.remove();\r\n\r\n    $.gritter.add({\r\n      title: 'Copied',\r\n      text: 'Join link copied to clip board',\r\n      sticky: false,\r\n      class_name: 'copyLinkToClipboard',\r\n      time: '3000',\r\n    });\r\n  }\r\n\r\n  function getHeaderRoomY($element) {\r\n    const height = $element.outerHeight();\r\n    const paddingTop = share.$body_ace_outer().find('iframe[name=\"ace_inner\"]').css('padding-top');\r\n    const aceOuterPadding = parseInt(paddingTop, 10);\r\n    const offsetTop = Math.ceil($element.offset().top + aceOuterPadding);\r\n    return offsetTop + height / 2 - 31;\r\n  }\r\n\r\n  function getHeaderRoomX($element) {\r\n    const width = $element.outerWidth();\r\n    const paddingLeft = share.$body_ace_outer().find('iframe[name=\"ace_inner\"]').css('padding-left');\r\n    const aceOuterPadding = parseInt(paddingLeft, 10);\r\n    const offsetLeft = Math.ceil(share.$body_ace_outer().find('iframe[name=\"ace_inner\"]').offset().left - aceOuterPadding);\r\n    return offsetLeft - width - 10;\r\n  }\r\n\r\n  function showUserProfileModal() {\r\n    const userId = $(this).attr('data-id');\r\n    const user = window.clientVars.ep_profile_list[userId];\r\n    const imageUrl = user.imageUrl || `/p/getUserProfileImage/${userId}/${padId}?t=${new Date().getTime()}`;\r\n    if (!user) return false;\r\n    $('#ep_profile_users_profile_name').text(user.userName);\r\n    $('#ep_profile_users_profile_desc').text(user.about);\r\n    $('#ep_profile_users_profile_homepage').attr({\r\n      href: share.getValidUrl(user.homepage),\r\n      target: '_blank',\r\n    });\r\n\r\n    $('#ep_profile_users_profile').addClass('ep_profile_formModal_show');\r\n    $('#ep_profile_general_overlay').addClass('ep_profile_formModal_overlay_show');\r\n    $('#ep_profile_general_overlay').css({display: 'block'});\r\n\r\n    $('#ep_profile_users_profile_userImage').css({\r\n      'background-position': '50% 50%',\r\n      'background-image': `url(${imageUrl})`,\r\n      'background-repeat': 'no-repeat',\r\n      'background-size': '69px',\r\n      'background-color': '#485365',\r\n    });\r\n  }\r\n\r\n  function activeEventListener() {\r\n    const $wbrtc_roomBox = share.$body_ace_outer();\r\n\r\n    $wbrtc_roomBox.on('click', '.wbrtc_roomBox .btn_joinChat_text', roomBtnHandler);\r\n    $wbrtc_roomBox.on('click', '.wbrtc_roomBox .btn_joinChat_text', roomBtnHandler);\r\n    $wbrtc_roomBox.on('click', '.wbrtc_roomBox .btn_joinChat_video', roomBtnHandler);\r\n    $wbrtc_roomBox.on('click', '.wbrtc_roomBox .btn_joinChat_chatRoom', roomBtnHandler);\r\n\r\n    $wbrtc_roomBox.on('click', '#wbrtc_avatarCol .wrtc_roomInlineAvatar .avatar', showUserProfileModal);\r\n    $(document).on('click', '.wrtc_inlineAvatars > .avatar, .wrtc_inlineAvatars > .avatarMore', showUserProfileModal);\r\n\r\n    $(document).on('click', '#chattext .wrtc_roomLink', roomBtnHandler);\r\n\r\n    $(document).on('click', '#werc_toolbar .btn_roomHandler, .btn_controllers .btn_roomHandler', roomBtnHandler);\r\n\r\n    // ep_full_hyperlinks link listner\r\n    $wbrtc_roomBox.on('click', 'a.btn_roomHandler', roomBtnHandler);\r\n    $(document).on('click', 'a.btn_roomHandler', roomBtnHandler);\r\n    // share.$body_ace_outer().on('mouseenter', '.wbrtc_roomBox', function mouseenter() {\r\n    // \t$(this).parent().css({ overflow: 'initial' });\r\n    // \t$(this).addClass('active').find('.wrtc_contentBody').css({ display: 'block' });\r\n    // }).on('mouseleave', '.wbrtc_roomBox', function mouseleave() {\r\n    // \t$(this).parent().css({ overflow: 'hidden' });\r\n    // \t$(this).removeClass('active').find('.wrtc_contentBody').css({ display: 'none' });\r\n    // });\r\n\r\n    $(document).on('mouseenter', '.video-container.local-user', () => {\r\n      $(document).find('#wrtc_modal #networkStatus').addClass('active');\r\n    }).on('mouseleave', '.video-container.local-user', () => {\r\n      $(document).find('#wrtc_modal #networkStatus').removeClass('active');\r\n    });\r\n\r\n    share.$body_ace_outer().on('click', '.wbrtc_roomBoxFooter > button.btn_share', function click() {\r\n      const headerURI = $(this).find('input').val();\r\n      link2Clipboard(headerURI);\r\n    });\r\n\r\n    // share.$body_ace_outer().on('mouseenter', '.wrtc_roomInlineAvatar .avatar', function mouseenter() {\r\n    // \tvar id = $(this).parent().parent().attr('id');\r\n    // \tshare.$body_ace_outer().find('#' + id + '.wbrtc_roomBox').trigger('mouseenter');\r\n    // }).on('mouseleave', '.wrtc_roomInlineAvatar .avatar', function mouseleave() {\r\n    // \tvar id = $(this).parent().parent().attr('id');\r\n    // \tshare.$body_ace_outer().find('#' + id + '.wbrtc_roomBox').trigger('mouseleave');\r\n    // });\r\n\r\n    $(document).on('click', '#werc_toolbar p, .textChatToolbar b', function click() {\r\n      const headerId = $(this).attr('data-id');\r\n      scroll2Header(headerId);\r\n    });\r\n\r\n    $(document).on('click', '#werc_toolbar .btn_enlarge', function click() {\r\n      if (!$(this).attr('active')) return true;\r\n\r\n      $(this).toggleClass('large');\r\n\r\n      $('#wrtc_modal .video-container .enlarge-btn').each(function trigger() {\r\n        $(this).trigger('click');\r\n      });\r\n    });\r\n\r\n    // video interface settings\r\n    $(document).on('click', '#werc_toolbar .btn_videoSetting', function click() {\r\n      const offset = $(this).position();\r\n      const $box = $(document).find('#wrtc_settings');\r\n      const width = $box.outerWidth();\r\n      $box.css({left: `${offset.left - width}px`, top: `${offset.top + 4}px`}).toggleClass('active');\r\n    });\r\n  }\r\n\r\n  var self = {\r\n    getHeaderRoomX,\r\n    aceSetAuthorStyle: function aceSetAuthorStyle(context) {\r\n      if (context.author) {\r\n        const user = share.getUserFromId(context.author);\r\n        if (user) {\r\n          // sync user info\r\n          share.$body_ace_outer().find(`.wrtc_content.textChat ul li[data-id='${user.userId}']`).css({'border-color': user.colorId}).text(user.name);\r\n          share.$body_ace_outer().find(`.wrtc_content.videoChat ul li[data-id='${user.userId}']`).css({'border-color': user.colorId}).text(user.name);\r\n        }\r\n      }\r\n    },\r\n    userLeave: function userLeave(context, callback) {\r\n      // Deprecated, we use socket disconnect\r\n\r\n      callback();\r\n    },\r\n    bulkUpdateRooms: function bulkUpdateRooms(hTagList) {\r\n      videoChat.bulkUpdateRooms(hTagList);\r\n      textChat.bulkUpdateRooms(hTagList);\r\n    },\r\n    postAceInit: function postAceInit(hook, context, webSocket, docId) {\r\n      socket = webSocket;\r\n      padId = docId;\r\n      VIDEOCHATLIMIT = clientVars.webrtc.videoChatLimit;\r\n      share.wrtcPubsub.emit('component status', 'room', true);\r\n\r\n      socket.on('userJoin', (data, roomInfo, target) => {\r\n        if (target === 'video') {\r\n          videoChat.gateway_userJoin(data, roomInfo, false);\r\n        } else {\r\n          textChat.addUserToRoom(data, roomInfo, target);\r\n        }\r\n      });\r\n\r\n      socket.on('userLeave', (data, roomInfo, target) => {\r\n        if (target === 'video') {\r\n          videoChat.gateway_userLeave(data, roomInfo, target);\r\n        } else {\r\n          textChat.removeUserFromRoom(data, roomInfo, target);\r\n        }\r\n      });\r\n\r\n      activeEventListener();\r\n\r\n      // check if there is a join request in URI queryString\r\n      setTimeout(() => {\r\n        joinByQueryString();\r\n      }, 500);\r\n    },\r\n    adoptHeaderYRoom: function adoptHeaderYRoom() {\r\n      // Set all video_heading to be inline with their target REP\r\n      const $padOuter = share.$body_ace_outer();\r\n      if (!$padOuter) return;\r\n\r\n      $padOuter.find('.wbrtc_roomBox, .wrtc_roomInlineAvatar').each(function adjustHeaderIconPosition() {\r\n        const $el = $(this);\r\n        const $boxId = $el.attr('id');\r\n        const hClassId = `.videoHeader.${$boxId}`;\r\n        const $headingEl = $padOuter.find('iframe').contents().find('#innerdocbody').find(hClassId);\r\n\r\n        // if the H tags does not find, remove chatBox\r\n        // TODO: and kick out the user form the chatBox\r\n        if ($headingEl.length <= 0) {\r\n          $el.remove();\r\n          return false;\r\n        }\r\n\r\n        if ($el.attr('data-box') === 'avatar') $el.css({left: `${getHeaderRoomX($el)}px`});\r\n        $el.css({top: `${getHeaderRoomY($headingEl)}px`});\r\n      });\r\n    },\r\n    findTags: function findTags() {\r\n      const components = share.wrtcStore.components;\r\n      if (!components.text.active && !components.video.active && !components.room.active) return false;\r\n      const hTagList = [];\r\n      const hTagElements = hElements.join(',');\r\n      const hTags = share.$body_ace_outer().find('iframe')\r\n          .contents()\r\n          .find('#innerdocbody')\r\n          .children('div')\r\n          .find('.videoHeader');\r\n\r\n      const aceInnerOffset = share.$body_ace_outer().find('iframe[name=\"ace_inner\"]').offset();\r\n      const target = share.$body_ace_outer().find('#outerdocbody');\r\n      let newHTagAdded = false;\r\n      $(hTags).each(function createWrtcRoomBox() {\r\n        const $el = $(this);\r\n        // var lineNumber = $el.parent().prevAll().length;\r\n        // var tag = $(\"#title\")[0].tagName.toLowerCase();\r\n        const newY = getHeaderRoomY($el);\r\n        const newX = Math.ceil(aceInnerOffset.left);\r\n        let headingTagId = $el.attr('class');\r\n        headingTagId = headingTagId.split(' ')[1];\r\n        const content = $el.html();\r\n\r\n        // if heading Id or the h tag has no contetn\r\n        if (!headingTagId || content.length <= 0) {\r\n          console.warn(\"[wrtc]: couldn't find headingTagId.\");\r\n          return true;\r\n        }\r\n\r\n        const data = {\r\n          headingTagId,\r\n          // tag: tag,\r\n          positionTop: newY,\r\n          positionLeft: newX,\r\n          headTitle: $el.text(),\r\n          // lineNumber: lineNumber,\r\n          videoChatLimit: VIDEOCHATLIMIT,\r\n        };\r\n\r\n        if (!share.wrtcStore[data.headingTagId]) {\r\n          share.wrtcStore[data.headingTagId] = {VIDEO: {list: []}, TEXT: {list: []}, USERS: {}, headerCount: 0};\r\n        }\r\n\r\n        // if the header does not exists then adde to list\r\n        // otherwise update textHeader\r\n        // TODO: performance issue\r\n        if (target.find(`#${data.headingTagId}`).length <= 0) {\r\n          const box = $('#wertc_roomBox').tmpl(data);\r\n          target.find('#wbrtc_chatBox').append(box);\r\n          const avatarBox = $('#wertc_inlineAvatar').tmpl(data);\r\n          target.find('#wbrtc_avatarCol').append(avatarBox);\r\n          self.adoptHeaderYRoom();\r\n          newHTagAdded = true;\r\n        } else {\r\n          $(document).find(`[data-headid=${data.headingTagId}].wrtc_text .wrtc_roomLink, #werc_toolbar p[data-id=${data.headingTagId}]`).text(data.headTitle);\r\n          target.find(`.wbrtc_roomBox[id=${data.headingTagId}] .titleRoom`).text(data.headTitle);\r\n          $(document).find(`#wrtc_textChatWrapper[data-id=${data.headingTagId}] .nd_title b`).text(data.headTitle);\r\n        }\r\n\r\n        hTagList.push(data);\r\n      });\r\n      // if a new h tag addedd check all heading again!\r\n      if (newHTagAdded) {\r\n        self.bulkUpdateRooms(hTagList);\r\n        newHTagAdded = false;\r\n      }\r\n    },\r\n  };\r\n\r\n  return self;\r\n})();\r\n","/**\r\n * Copyright 2013 j <j@mailb.org>\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n'use strict';\r\n\r\nvar WRTC = (function WRTC() {\r\n  const attemptRonnect = 60;\r\n  let reconnected = 0;\r\n  const videoSizes = {large: '260px', small: '160px'};\r\n  const pcConfig = {};\r\n  let audioInputSelect = null;\r\n  let videoSelect = null;\r\n  let audioOutputSelect = null;\r\n  const pcConstraints = {\r\n    optional: [{\r\n      DtlsSrtpKeyAgreement: true,\r\n    }],\r\n  };\r\n  const sdpConstraints = {\r\n    mandatory: {\r\n      OfferToReceiveAudio: true,\r\n      OfferToReceiveVideo: true,\r\n    },\r\n  };\r\n  let localStream = null;\r\n  const remoteStream = {};\r\n  const pc = {};\r\n  const callQueue = [];\r\n  const enlargedVideos = new Set();\r\n  let localVideoElement = null;\r\n  let padId = null;\r\n  let socket = null;\r\n\r\n  var self = {\r\n    // API HOOKS\r\n    postAceInit: function postAceInit(hook, context, webSocket, docId) {\r\n      padId = docId;\r\n      socket = webSocket;\r\n\r\n      pcConfig.iceServers = clientVars.webrtc && clientVars.webrtc.iceServers ? clientVars.webrtc.iceServers : [{\r\n        urls: 'stun:stun.l.google.com:19302',\r\n      }];\r\n\r\n      if (clientVars.webrtc.video.sizes.large) {\r\n        videoSizes.large = `${clientVars.webrtc.video.sizes.large}px`;\r\n      }\r\n      if (clientVars.webrtc.video.sizes.small) {\r\n        videoSizes.small = `${clientVars.webrtc.video.sizes.small}px`;\r\n      }\r\n\r\n      self._pad = context.pad || window.pad;\r\n\r\n      $(document).on('change', 'select#audioSource', self.audioVideoInputChange);\r\n      $(document).on('change', 'select#videoSource', self.audioVideoInputChange);\r\n      $(document).on('change', 'select#audioOutput', self.changeAudioDestination);\r\n\r\n      $(window).on('unload', () => {\r\n        console.info('[wrtc]: windos unloaded, now hangupAll');\r\n        self.hangupAll();\r\n      });\r\n      socket.on('RTC_MESSAGE', (context) => {\r\n        if (context.data.payload.data.headerId === window.headerId) self.receiveMessage(context.data.payload);\r\n      });\r\n    },\r\n    appendInterfaceLayout: function appendInterfaceLayout() {\r\n      // TODO: legacy code, move it to template\r\n      const werc_toolbar = $('#wertc_modal_toolbar').tmpl({\r\n        videoChatLimit: clientVars.webrtc.videoChatLimit,\r\n        headerId: '',\r\n      });\r\n      const $wrtc_modal = $('<div id=\"wrtc_modal\"><div id=\"networkStatus\"></div><div class=\"videoWrapper\" class=\"thin-scrollbar\"></div><div id=\"networkError\"></div></div');\r\n      $wrtc_modal.append(werc_toolbar);\r\n      $('body').prepend($wrtc_modal);\r\n      $(document).on('click', '#wrtc_modal .btn_toggle_modal', function () {\r\n        const $parent = $(this).parent().parent();\r\n        const action = $(this).attr('data-action');\r\n        const videoBox = $('#wrtc_modal .videoWrapper').innerHeight();\r\n\r\n        $(this).find('.fa_arrow-from-top').toggle();\r\n        $(this).find('.fa_arrow-to-top').toggle();\r\n\r\n        if (action === 'collapse') {\r\n          $(this).attr({'data-action': 'expand'});\r\n          $parent.find('.btn_enlarge').removeAttr('active');\r\n          $('#wrtc_modal').css({\r\n            transform: `translate(-50%, -${videoBox}px)`,\r\n          });\r\n        } else {\r\n          $(this).attr({'data-action': 'collapse'});\r\n          $parent.find('.btn_enlarge').attr({active: true});\r\n          $('#wrtc_modal').css({\r\n            transform: 'translate(-50%, 0)',\r\n          });\r\n        }\r\n      });\r\n      $(document).on('click', '#wrtc_settings .btn_info', function click() {\r\n        const userID = Object.keys(pc);\r\n        const $this = $(this);\r\n        const isActive = $this.attr('data-active');\r\n        const $modal = $(document).find('#wrtc_settings .wrtc_info');\r\n\r\n        if (isActive) {\r\n          $modal.hide();\r\n          if (pc[userID[0]]) {\r\n            getStats(pc[userID[0]], (result) => {\r\n              result.nomore();\r\n            });\r\n          }\r\n          $this.removeAttr('data-active');\r\n          return true;\r\n        } else {\r\n          $this.attr({'data-active': true});\r\n          $modal.show();\r\n        }\r\n\r\n        if (pc[userID[0]] && !isActive) {\r\n          (function () {\r\n            const bytesToSize = function bytesToSize(bytes) {\r\n              const k = 1000;\r\n              const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\r\n              if (bytes <= 0) {\r\n                return '0 Bytes';\r\n              }\r\n              const i = parseInt(Math.floor(Math.log(bytes) / Math.log(k)), 10);\r\n\r\n              if (!sizes[i]) {\r\n                return '0 Bytes';\r\n              }\r\n\r\n              return `${(bytes / Math.pow(k, i)).toPrecision(3)} ${sizes[i]}`;\r\n            };\r\n\r\n            getStats(pc[userID[0]], (result) => {\r\n              const statistic = {\r\n                speed: bytesToSize(result.bandwidth.speed),\r\n                systemNetworkType: result.connectionType.systemNetworkType,\r\n                availableSendBandwidth: bytesToSize(result.bandwidth.availableSendBandwidth),\r\n                video: {\r\n                  'send.codecs': result.video.send.codecs.join(', '),\r\n                  'resolutions': `width ${result.resolutions.send.width}, height ${result.resolutions.send.height}`,\r\n                  'resolutions': `width ${result.resolutions.recv.width}, height ${result.resolutions.recv.height}`,\r\n                  'bytesSent': bytesToSize(result.video.bytesSent),\r\n                  'bytesReceived': bytesToSize(result.video.bytesReceived),\r\n                },\r\n                audio: {\r\n                  'send.codecs': result.audio.send.codecs.join(', '),\r\n                  // \"recv.codecs\": result.audio.recv.codecs.join(\", \"),\r\n                  'bytesSent': bytesToSize(result.audio.bytesSent),\r\n                  'bytesReceived': bytesToSize(result.audio.bytesReceived),\r\n                },\r\n              };\r\n              $(document).find('#wrtc_settings .wrtc_info').html(`<pre>${JSON.stringify(statistic, undefined, 2)}</pre>`);\r\n            }, 1000);\r\n          })();\r\n        }\r\n      });\r\n      $(document).on('click', '#wrtc_settings .btn_close', () => {\r\n        $('#wrtc_settings').toggleClass('active');\r\n        const $btnInfo = $('#wrtc_settings .btn_info');\r\n        if ($btnInfo.attr('data-active')) $btnInfo.trigger('click');\r\n      });\r\n    },\r\n    aceSetAuthorStyle: function aceSetAuthorStyle(context) {\r\n      if (context.author) {\r\n        const user = self.getUserFromId(context.author);\r\n        if (user) {\r\n          $(`#video_${user.userId.replace(/\\./g, '_')}`).css({\r\n            'border-color': user.colorId,\r\n          }).siblings('.user-name').text(user.name);\r\n        }\r\n      }\r\n    },\r\n    userLeave: function userLeave(userId, context, callback) {\r\n      userId = userId || context.userInfo.userId;\r\n      if (userId && pc[userId]) {\r\n        gState = 'LEAVING';\r\n        self.hide(userId);\r\n        self.hangup(userId, true);\r\n      }\r\n      share.wrtcStore.userInRoom = false;\r\n      if (callback) callback();\r\n    },\r\n    // deprecated function\r\n    handleClientMessage_RTC_MESSAGE: function handleClientMessage_RTC_MESSAGE(hook, context) {\r\n      if (context.payload.data.headerId === window.headerId) self.receiveMessage(context.payload);\r\n    },\r\n    // END OF API HOOKS\r\n    show: function show() {\r\n      $('#pad_title').addClass('f_wrtcActive');\r\n      videoChat.mediaDevices();\r\n    },\r\n    showUserMediaError: function showUserMediaError(err, userId, headerId) {\r\n      // show an error returned from getUserMedia\r\n      let reason;\r\n      // For reference on standard errors returned by getUserMedia:\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\r\n      // However keep in mind that we add our own errors in getUserMediaPolyfill\r\n      switch (err.name) {\r\n        case 'CustomNotSupportedError':\r\n          reason = 'Sorry, your browser does not support WebRTC. (or you have it disabled in your settings).<br><br>' + 'To participate in this audio/video chat you have to user a browser with WebRTC support like Chrome, Firefox or Opera.' + '<a href=\"http://www.webrtc.org/\" target=\"_new\">Find out more</a>';\r\n          self.sendErrorStat('NotSupported');\r\n          break;\r\n        case 'CustomSecureConnectionError':\r\n          reason = 'Sorry, you need to install SSL certificates for your Etherpad instance to use WebRTC';\r\n          self.sendErrorStat('SecureConnection');\r\n          break;\r\n        case 'NotAllowedError':\r\n          // For certain (I suspect older) browsers, `NotAllowedError` indicates either an insecure connection or the user rejecting camera permissions.\r\n          // The error for both cases appears to be identical, so our best guess at telling them apart is to guess whether we are in a secure context.\r\n          // (webrtc is considered secure for https connections or on localhost)\r\n          if (location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1') {\r\n            reason = 'Sorry, you need to give us permission to use your camera and microphone';\r\n            self.sendErrorStat('Permission');\r\n          } else {\r\n            reason = 'Sorry, you need to install SSL certificates for your Etherpad instance to use WebRTC';\r\n            self.sendErrorStat('SecureConnection');\r\n          }\r\n          break;\r\n        case 'NotFoundError':\r\n          reason = \"Sorry, we couldn't find a suitable camera on your device. If you have a camera, make sure it set up correctly and refresh this website to retry.\";\r\n          self.sendErrorStat('NotFound');\r\n          break;\r\n        case 'NotReadableError':\r\n          // `err.message` might give useful info to the user (not necessarily useful for other error messages)\r\n          reason = `Sorry, a hardware error occurred that prevented access to your camera and/or microphone:<br><br>${err.message}`;\r\n          self.sendErrorStat('Hardware');\r\n          break;\r\n        case 'AbortError':\r\n          // `err.message` might give useful info to the user (not necessarily useful for other error messages)\r\n          reason = `Sorry, an error occurred (probably not hardware related) that prevented access to your camera and/or microphone:<br><br>${err.message}`;\r\n          self.sendErrorStat('Abort');\r\n          break;\r\n        default:\r\n          // `err` as a string might give useful info to the user (not necessarily useful for other error messages)\r\n          reason = `Sorry, there was an unknown Error:<br><br>${err}`;\r\n          self.sendErrorStat('Unknown');\r\n      }\r\n      $.gritter.add({\r\n        title: 'Error',\r\n        text: `${reason}; try again!`,\r\n        time: 4000,\r\n        sticky: false,\r\n        class_name: 'error',\r\n      });\r\n      userId = userId || clientVars.userId;\r\n      headerId = headerId || window.headerId;\r\n      videoChat.userLeave(\r\n          headerId,\r\n          {\r\n            headerId,\r\n            padId,\r\n            userId,\r\n          }\r\n      );\r\n    },\r\n    hide: function hide(userId) {\r\n      if (!userId) return false;\r\n      userId = userId.split('.')[1];\r\n      $('#rtcbox').find(`#video_a_${userId}`).parent().remove();\r\n    },\r\n    activate: function activate(headerId) {\r\n      self.show();\r\n      self.hangupAll();\r\n      self.getUserMedia(headerId);\r\n      share.wrtcStore.userInRoom = true;\r\n    },\r\n    deactivate: function deactivate(userId, headerId) {\r\n      if (!userId) return false;\r\n      self.hide(userId);\r\n      self.hangupAll(headerId);\r\n      self.hangup(userId, true, headerId);\r\n      if (localStream) {\r\n        share.stopStreaming(localStream);\r\n        localStream = null;\r\n      }\r\n      share.wrtcStore.userInRoom = false;\r\n    },\r\n    toggleMuted: function toggleMuted() {\r\n      const audioTrack = localStream.getAudioTracks()[0];\r\n      if (audioTrack) {\r\n        audioTrack.enabled = !audioTrack.enabled;\r\n        return !audioTrack.enabled; // returning \"Muted\" state, which is !enabled\r\n      }\r\n      return true; // if there's no audio track, it's muted\r\n    },\r\n    toggleVideo: function toggleVideo() {\r\n      const videoTrack = localStream.getVideoTracks()[0];\r\n      if (videoTrack) {\r\n        videoTrack.enabled = !videoTrack.enabled;\r\n        return !videoTrack.enabled;\r\n      }\r\n    },\r\n    getUserFromId: function getUserFromId(userId) {\r\n      if (!self._pad || !self._pad.collabClient) return null;\r\n      const result = self._pad.collabClient.getConnectedUsers().filter((user) => user.userId === userId);\r\n      const user = result.length > 0 ? result[0] : null;\r\n      return user;\r\n    },\r\n    setStream: function setStream(userId, stream) {\r\n      if (!userId) return false;\r\n      const isLocal = userId === share.getUserId();\r\n      const videoId = `video_${userId.replace(/\\./g, '_')}`;\r\n      let video = $(`#${videoId}`)[0];\r\n\r\n      const user = self.getUserFromId(userId);\r\n\r\n      if (!video && stream) {\r\n        const videoContainer = $(\"<div class='video-container'>\").css({\r\n          'width': videoSizes.small,\r\n          'max-height': videoSizes.small,\r\n        }).appendTo($('#wrtc_modal .videoWrapper'));\r\n\r\n        videoContainer.append($('<div class=\"user-name\">').text(user.name));\r\n\r\n        video = $('<video playsinline>').attr('id', videoId).css({\r\n          'border-color': user.colorId,\r\n          'width': videoSizes.small,\r\n          'max-height': videoSizes.small,\r\n        }).on({\r\n          loadedmetadata: function loadedmetadata() {\r\n            self.addInterface(userId);\r\n          },\r\n        }).appendTo(videoContainer)[0];\r\n\r\n        video.autoplay = true;\r\n        if (isLocal) {\r\n          videoContainer.addClass('local-user');\r\n          video.muted = true;\r\n        }\r\n        self.addInterface(userId);\r\n      }\r\n      if (stream) {\r\n        attachMediaStream(video, stream);\r\n      } else if (video) {\r\n        $(video).parent().remove();\r\n      }\r\n    },\r\n    addInterface: function addInterface(userId) {\r\n      if (!userId) return false;\r\n      const isLocal = userId === share.getUserId();\r\n      const videoId = `video_${userId.replace(/\\./g, '_')}`;\r\n      const $video = $(`#${videoId}`);\r\n\r\n      var $mute = $(\"<span class='interface-btn audio-btn buttonicon'>\").attr('title', 'Mute').on({\r\n        click: function click() {\r\n          let muted;\r\n          if (isLocal) {\r\n            muted = self.toggleMuted();\r\n          } else {\r\n            $video[0].muted = !$video[0].muted;\r\n            muted = $video[0].muted;\r\n          }\r\n          $mute.attr('title', muted ? 'Unmute' : 'Mute').toggleClass('muted', muted);\r\n        },\r\n      });\r\n      let videoEnabled = true;\r\n      var $disableVideo = isLocal ? $(\"<span class='interface-btn video-btn buttonicon'>\").attr('title', 'Disable video').on({\r\n        click: function click() {\r\n          self.toggleVideo();\r\n          videoEnabled = !videoEnabled;\r\n          $disableVideo.attr('title', videoEnabled ? 'Disable video' : 'Enable video').toggleClass('off', !videoEnabled);\r\n        },\r\n      }) : null;\r\n\r\n      let videoEnlarged = false;\r\n      var $largeVideo = $(\"<span class='interface-btn enlarge-btn buttonicon'>\").attr('title', 'Make video larger').on({\r\n        click: function click() {\r\n          videoEnlarged = !videoEnlarged;\r\n\r\n          if (videoEnlarged) {\r\n            enlargedVideos.add(userId);\r\n          } else {\r\n            enlargedVideos.delete(userId);\r\n          }\r\n\r\n          $largeVideo.attr('title', videoEnlarged ? 'Make video smaller' : 'Make video larger').toggleClass('large', videoEnlarged);\r\n\r\n          const videoSize = $(document).find('#wrtc_modal .ndbtn.btn_enlarge').hasClass('large') ? videoSizes.large : videoSizes.small;\r\n          $video.parent().css({'width': videoSize, 'max-height': videoSize});\r\n          $video.css({'width': videoSize, 'max-height': videoSize});\r\n        },\r\n      });\r\n\r\n      if ($(document).find('#wrtc_modal .ndbtn.btn_enlarge').hasClass('large')) {\r\n        $video.parent().css({'width': videoSizes.large, 'max-height': videoSizes.large});\r\n        $video.css({'width': videoSizes.large, 'max-height': videoSizes.large});\r\n      }\r\n\r\n      if (isLocal) localVideoElement = $video;\r\n\r\n      const $networkLatancy = $(\"<div class='latency'></div>\");\r\n\r\n      $(`#interface_${videoId}`).remove();\r\n      $(\"<div class='interface-container'>\").attr('id', `interface_${videoId}`).append($mute).append($disableVideo).append($largeVideo).append($networkLatancy).insertAfter($video);\r\n      self.changeAudioDestination();\r\n    },\r\n    // Sends a stat to the back end. `statName` must be in the\r\n    // approved list on the server side.\r\n    sendErrorStat: function sendErrorStat(statName) {\r\n      const msg = {component: 'pad', type: 'STATS', data: {statName, type: 'RTC_MESSAGE'}};\r\n      socket.emit('acceptNewCall', padId, window.headerId);\r\n      self._pad.socket.json.send(msg);\r\n    },\r\n    sendMessage: function sendMessage(to, data) {\r\n      socket.emit('RTC_MESSAGE', {\r\n        type: 'RTC_MESSAGE',\r\n        payload: {data, to, padId},\r\n      }, (data) => {\r\n        // console.log('coming data', data);\r\n      });\r\n      // deprecated function\r\n      // self._pad.collabClient.sendMessage({\r\n      // \ttype: 'RTC_MESSAGE',\r\n      //   payload: {data, to},\r\n      // });\r\n    },\r\n    receiveMessage: function receiveMessage(msg) {\r\n      const peer = msg.from;\r\n      const data = msg.data;\r\n      const type = data.type;\r\n      if (peer === share.getUserId()) {\r\n        // console.info('ignore own messages');\r\n        return;\r\n      }\r\n      /*\r\n      if (type != 'icecandidate')\r\n        console.info('receivedMessage', 'peer', peer, 'type', type, 'data', data);\r\n      */\r\n      if (type === 'hangup') {\r\n        self.hangup(peer, true);\r\n      } else if (type === 'offer') {\r\n        if (pc[peer]) {\r\n          self.hangup(peer, true);\r\n          self.createPeerConnection(peer, data.headerId);\r\n        } else {\r\n          self.createPeerConnection(peer, data.headerId);\r\n        }\r\n        if (localStream) {\r\n          if (pc[peer].getLocalStreams) {\r\n            if (!pc[peer].getLocalStreams().length) {\r\n              localStream.getTracks().forEach((track) => {\r\n                pc[peer].addTrack(track, localStream);\r\n              });\r\n\r\n              // pc[peer].addStream(localStream);\r\n            }\r\n          } else if (pc[peer].localStreams) {\r\n            if (!pc[peer].localStreams.length) {\r\n              localStream.getTracks().forEach((track) => {\r\n                pc[peer].addTrack(track, localStream);\r\n              });\r\n              // pc[peer].addStream(localStream);\r\n            }\r\n          }\r\n        }\r\n        const offer = new RTCSessionDescription(data.offer);\r\n        pc[peer].setRemoteDescription(offer, () => {\r\n          pc[peer].createAnswer((desc) => {\r\n            desc.sdp = cleanupSdp(desc.sdp);\r\n            pc[peer].setLocalDescription(desc, () => {\r\n              self.sendMessage(peer, {type: 'answer', answer: desc, headerId: data.headerId});\r\n            }, logError);\r\n          }, logError, sdpConstraints);\r\n        }, logError);\r\n      } else if (type === 'answer') {\r\n        if (pc[peer]) {\r\n          const answer = new RTCSessionDescription(data.answer);\r\n          pc[peer].setRemoteDescription(answer, () => {}, logError);\r\n        }\r\n      } else if (type === 'icecandidate') {\r\n        if (pc[peer]) {\r\n          const candidate = new RTCIceCandidate(data.candidate);\r\n          const p = pc[peer].addIceCandidate(candidate);\r\n          if (p) {\r\n            p.then(() => {\r\n              // Do stuff when the candidate is successfully passed to the ICE agent\r\n            }).catch(() => {\r\n              console.error('[wrtc]: Failure during addIceCandidate()', data);\r\n            });\r\n          }\r\n        }\r\n      } else {\r\n        console.error('unknown message', data);\r\n      }\r\n    },\r\n    hangupAll: function hangupAll(_headerId) {\r\n      Object.keys(pc).forEach((userId) => {\r\n        self.hangup(userId, true, _headerId);\r\n      });\r\n    },\r\n    getUserId: function getUserId() {\r\n      return self._pad && share.getUserId();\r\n    },\r\n    hangup: function hangup(userId, notify, headerId) {\r\n      notify = arguments.length === 1 ? true : notify;\r\n      if (pc[userId] && userId !== share.getUserId()) {\r\n        self.setStream(userId, '');\r\n        pc[userId].close();\r\n        delete pc[userId];\r\n        if (notify) self.sendMessage(userId, {type: 'hangup', headerId});\r\n      }\r\n    },\r\n    call: function call(userId, headerId) {\r\n      if (!localStream) {\r\n        callQueue.push(userId);\r\n        return;\r\n      }\r\n      let constraints = {optional: [], mandatory: {}};\r\n      // temporary measure to remove Moz* constraints in Chrome\r\n      if (webrtcDetectedBrowser === 'chrome') {\r\n        for (const prop in constraints.mandatory) {\r\n          if (prop.indexOf('Moz') !== -1) {\r\n            delete constraints.mandatory[prop];\r\n          }\r\n        }\r\n      }\r\n      constraints = mergeConstraints(constraints, sdpConstraints);\r\n\r\n      if (!pc[userId]) {\r\n        self.createPeerConnection(userId, headerId);\r\n      }\r\n\r\n      // pc[userId].addStream(localStream);\r\n\r\n      localStream.getTracks().forEach((track) => {\r\n        pc[userId].addTrack(track, localStream);\r\n      });\r\n\r\n      pc[userId].createOffer((desc) => {\r\n        desc.sdp = cleanupSdp(desc.sdp);\r\n        pc[userId].setLocalDescription(desc, () => {\r\n          self.sendMessage(userId, {type: 'offer', offer: desc, headerId});\r\n        }, logError);\r\n      }, logError, constraints);\r\n    },\r\n    createPeerConnection: function createPeerConnection(userId, headerId) {\r\n      if (pc[userId]) {\r\n        console.warn('WARNING creating PC connection even though one exists', userId);\r\n      }\r\n      pc[userId] = new RTCPeerConnection(pcConfig, pcConstraints);\r\n      pc[userId].onicecandidate = function (event) {\r\n        if (event.candidate) {\r\n          self.sendMessage(userId, {\r\n            type: 'icecandidate',\r\n            headerId,\r\n            candidate: event.candidate,\r\n          });\r\n        } else {\r\n          reconnected = 0;\r\n          socket.emit('acceptNewCall', padId, window.headerId);\r\n        }\r\n      };\r\n      pc[userId].ontrack = function (event) {\r\n        remoteStream[userId] = event.streams[0];\r\n        self.setStream(userId, event.streams[0]);\r\n      };\r\n      pc[userId].onremovestream = function () {\r\n        self.setStream(userId, '');\r\n      };\r\n    },\r\n    audioVideoInputChange: function audioVideoInputChange() {\r\n      share.stopStreaming(localStream);\r\n      localStream = null;\r\n\r\n      self.getUserMedia(window.headerId);\r\n    },\r\n    attachSinkId: function attachSinkId(element, sinkId) {\r\n      // Attach audio output device to video element using device/sink ID.\r\n      if (element && element[0] && typeof element[0].sinkId !== 'undefined') {\r\n        element[0].setSinkId(sinkId).then(() => {\r\n          // console.info(`Success, audio output device attached: ${sinkId}`);\r\n        }).catch((error) => {\r\n          let errorMessage = error;\r\n          if (error.name === 'SecurityError') {\r\n            errorMessage = `You need to use HTTPS for selecting audio output device: ${error}`;\r\n          }\r\n          console.error(errorMessage);\r\n          // Jump back to first output device in the list as it's the default.\r\n          audioOutputSelect.selectedIndex = 0;\r\n        });\r\n      } else {\r\n        console.warn('Browser does not support output device selection.');\r\n        $(document).find('#wrtc_settings .select.audioOutputSec').hide();\r\n      }\r\n    },\r\n    changeAudioDestination: function changeAudioDestination() {\r\n      const audioOutputSelect = document.querySelector('select#audioOutput');\r\n      const audioDestination = audioOutputSelect.value;\r\n      const videoElement = localVideoElement;\r\n      self.attachSinkId(videoElement, audioDestination);\r\n    },\r\n    getUserMedia: function getUserMedia(headerId) {\r\n      audioInputSelect = document.querySelector('select#audioSource');\r\n      videoSelect = document.querySelector('select#videoSource');\r\n      audioOutputSelect = document.querySelector('select#audioOutput');\r\n\r\n      const audioSource = audioInputSelect.value;\r\n      const videoSource = videoSelect.value;\r\n      const audioOutput = audioOutputSelect.value;\r\n\r\n      const mediaConstraints = {\r\n        audio: true,\r\n        video: {\r\n          width: 320,\r\n          height: 240,\r\n          frameRate: {ideal: 15, max: 30},\r\n          facingMode: 'user',\r\n        },\r\n      };\r\n\r\n      if (audioSource) {\r\n        mediaConstraints.audio.deviceId = {exact: audioSource};\r\n      }\r\n      if (videoSource) {\r\n        mediaConstraints.video.deviceId = {exact: videoSource};\r\n      }\r\n\r\n      localStorage.setItem('videoSettings', JSON.stringify({microphone: audioSource, speaker: audioOutput, camera: videoSource}));\r\n      // console.log(\"joining data: videoSettings\", { microphone: audioSource, speaker: audioOutput, camera: videoSource })\r\n      $('#wrtc_modal #networkError').removeClass('active').hide();\r\n\r\n      window.navigator.mediaDevices\r\n          .getUserMedia(mediaConstraints)\r\n          .then((stream) => {\r\n            localStream = stream;\r\n            self.setStream(share.getUserId(), stream);\r\n            self._pad.collabClient.getConnectedUsers().forEach((user) => {\r\n              if (user.userId !== share.getUserId()) {\r\n                if (pc[user.userId]) {\r\n                  self.hangup(user.userId, false, headerId);\r\n                }\r\n                self.call(user.userId, headerId);\r\n              }\r\n            });\r\n          }).catch((err) => {\r\n            self.showUserMediaError(err, share.getUserId(), headerId);\r\n          });\r\n    },\r\n    attemptToReconnect: function attemptToReconnect() {\r\n      reconnected++;\r\n      console.log('[wrtc]: Try reconnecting', reconnected, attemptRonnect);\r\n      if (attemptRonnect <= reconnected) {\r\n        socket.emit('acceptNewCall', padId, window.headerId);\r\n        throw new Error('[wrtc]: please reload the video chat and try again to connect!');\r\n      }\r\n      setTimeout(() => {\r\n        console.log('[wrtc]: reconnecting...');\r\n        self.getUserMedia(window.headerId);\r\n      }, randomIntFromInterval(200, 1000));\r\n    },\r\n  };\r\n\r\n  // Normalize RTC implementation between browsers\r\n  // var getUserMedia = window.navigator.mediaDevices.getUserMedia\r\n  var attachMediaStream = function attachMediaStream(element, stream) {\r\n    if (typeof element.srcObject !== 'undefined') {\r\n      element.srcObject = stream;\r\n    } else if (typeof element.mozSrcObject !== 'undefined') {\r\n      element.mozSrcObject = stream;\r\n    } else if (typeof element.src !== 'undefined') {\r\n      element.src = URL.createObjectURL(stream);\r\n    } else {\r\n      console.error('Error attaching stream to element.', element);\r\n    }\r\n  };\r\n  var webrtcDetectedBrowser = 'chrome';\r\n\r\n  function cleanupSdp(sdp) {\r\n    const bandwidth = {\r\n      screen: 300, // 300kbits minimum\r\n      audio: 256, // 64kbits  minimum\r\n      video: 500,\r\n      minVideo: 128, // 125kbits  min\r\n      maxVideo: 2048, // 125kbits  max\r\n      videoCodec: clientVars.webrtc.video.codec,\r\n    };\r\n\r\n    const isScreenSharing = false;\r\n\r\n    sdp = CodecsHandler.setApplicationSpecificBandwidth(sdp, bandwidth, isScreenSharing);\r\n    sdp = CodecsHandler.setVideoBitrates(sdp, {\r\n      min: bandwidth.minVideo,\r\n      max: bandwidth.maxVideo,\r\n      codec: bandwidth.videoCodec,\r\n    });\r\n    sdp = CodecsHandler.setOpusAttributes(sdp);\r\n    sdp = CodecsHandler.preferCodec(sdp, bandwidth.videoCodec);\r\n\r\n    return sdp;\r\n  }\r\n\r\n  function mergeConstraints(cons1, cons2) {\r\n    const merged = cons1;\r\n    for (const name in cons2.mandatory) {\r\n      merged.mandatory[name] = cons2.mandatory[name];\r\n    }\r\n    merged.optional.concat(cons2.optional);\r\n    return merged;\r\n  }\r\n\r\n  function randomIntFromInterval(min, max) {\r\n    return Math.floor(Math.random() * (max - min + 1) + min);\r\n  }\r\n\r\n  function logError(error) {\r\n    // if (error && error.message.includes(\"Failed to set remote answer sdp\")) {\r\n    self.attemptToReconnect();\r\n    // } else {\r\n    // socket.emit('acceptNewCall', padId, window.headerId);\r\n    // }\r\n    console.error('[wrtc]: LogError:', error);\r\n    $('#wrtc_modal #networkError').show().addClass('active').text(`[wrtc]: Error: ${error} ,Reload the session.`);\r\n  }\r\n\r\n  self.pc = pc;\r\n  return self;\r\n})();\r\n"]}